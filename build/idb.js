/******/ (function(modules) { // webpackBootstrap
/******/ 	// The module cache
/******/ 	var installedModules = {};

/******/ 	// The require function
/******/ 	function __webpack_require__(moduleId) {

/******/ 		// Check if module is in cache
/******/ 		if(installedModules[moduleId])
/******/ 			return installedModules[moduleId].exports;

/******/ 		// Create a new module (and put it into the cache)
/******/ 		var module = installedModules[moduleId] = {
/******/ 			i: moduleId,
/******/ 			l: false,
/******/ 			exports: {}
/******/ 		};

/******/ 		// Execute the module function
/******/ 		modules[moduleId].call(module.exports, module, module.exports, __webpack_require__);

/******/ 		// Flag the module as loaded
/******/ 		module.l = true;

/******/ 		// Return the exports of the module
/******/ 		return module.exports;
/******/ 	}


/******/ 	// expose the modules object (__webpack_modules__)
/******/ 	__webpack_require__.m = modules;

/******/ 	// expose the module cache
/******/ 	__webpack_require__.c = installedModules;

/******/ 	// identity function for calling harmory imports with the correct context
/******/ 	__webpack_require__.i = function(value) { return value; };

/******/ 	// define getter function for harmory exports
/******/ 	__webpack_require__.d = function(exports, name, getter) {
/******/ 		Object.defineProperty(exports, name, {
/******/ 			configurable: false,
/******/ 			enumerable: true,
/******/ 			get: getter
/******/ 		});
/******/ 	};

/******/ 	// getDefaultExport function for compatibility with non-harmony modules
/******/ 	__webpack_require__.n = function(module) {
/******/ 		var getter = module && module.__esModule ?
/******/ 			function getDefault() { return module['default']; } :
/******/ 			function getModuleExports() { return module; };
/******/ 		__webpack_require__.d(getter, 'a', getter);
/******/ 		return getter;
/******/ 	};

/******/ 	// Object.prototype.hasOwnProperty.call
/******/ 	__webpack_require__.o = function(object, property) { return Object.prototype.hasOwnProperty.call(object, property); };

/******/ 	// __webpack_public_path__
/******/ 	__webpack_require__.p = "";

/******/ 	// Load entry module and return exports
/******/ 	return __webpack_require__(__webpack_require__.s = 0);
/******/ })
/************************************************************************/
/******/ ([
/* 0 */
/***/ function(module, exports) {

eval("var Builder = function Builder () {\n    this.builder = [];\n    this.indexBuilder = {};\n    this.relations = [];\n    this.tables = [];\n};\n\nvar staticAccessors = { helpers: {},RELATIONS: {} };\n\n/**\n * Sets the index builder value as an 'and' reference\n *\n * @param indexName string\n * @param value mixed\n * @returns {Builder}\n */\nBuilder.prototype.whereIndex = function whereIndex (indexName, value) {\n\n    this.indexBuilder = {\n        index : indexName,\n        value : value,\n        type : 'and'\n    };\n\n    return this;\n};\n\n/**\n * Sets the index builder value as an 'in' reference\n * @param indexName\n * @param value\n * @returns {Builder}\n */\nBuilder.prototype.whereIndexIn = function whereIndexIn (indexName, value) {\n\n    this.indexBuilder = {\n        index : indexName,\n        value : value,\n        type : 'in'\n    };\n\n    return this;\n};\n\n/**\n * Sets the index builder value with point inclusive and sets greater than check\n * @param indexName\n * @param value\n * @returns {Builder}\n */\nBuilder.prototype.indexGte = function indexGte (indexName, value) {\n\n    this.indexBuilder = {\n        index : indexName,\n        value : value,\n        type : 'gte'\n    };\n\n    return this;\n};\n\n/**\n * Sets the index builder value with point not inclusive and sets greater than check\n * @param indexName\n * @param value\n * @returns {Builder}\n */\nBuilder.prototype.indexGt = function indexGt (indexName, value) {\n\n    this.indexBuilder = {\n        index : indexName,\n        value : value,\n        type : 'gt'\n    };\n\n    return this;\n};\n\n/**\n * Sets the index builder value with point inclusive and sets less than check\n * @param indexName\n * @param value\n * @returns {Builder}\n */\nBuilder.prototype.indexLte = function indexLte (indexName, value) {\n\n    this.indexBuilder = {\n        index : indexName,\n        value : value,\n        type : 'lte'\n    };\n\n    return this;\n};\n\n/**\n * Sets the index builder value with point not inclusive and sets less than check\n *\n * @param indexName\n * @param value\n * @returns {Builder}\n */\nBuilder.prototype.indexLt = function indexLt (indexName, value) {\n\n    this.indexBuilder = {\n        index : indexName,\n        value : value,\n        type : 'lt'\n    };\n\n    return this;\n};\n\n/**\n * Sets the index builder value with points inclusive and sets range between them\n * @param indexName\n * @param lower\n * @param upper\n * @returns {Builder}\n */\nBuilder.prototype.indexBetween = function indexBetween (indexName, lower, upper) {\n\n    this.indexBuilder = {\n        index : indexName,\n        value : [lower, upper],\n        type : 'between'\n    };\n\n    return this;\n};\n\nBuilder.prototype.whereIn = function whereIn (attributeName, value) {\n    this.builder.push({\n        attribute : attributeName,\n        value : value,\n        type : 'in'\n    });\n\n    return this;\n};\n\nBuilder.prototype.where = function where (attributeName, value) {\n    this.builder.push({\n        attribute : attributeName,\n        value : value,\n        type : 'and'\n    });\n\n    return this;\n};\n\n\nBuilder.prototype.gte = function gte (attributeName, value) {\n    this.builder.push({\n        attribute : attributeName,\n        value : value,\n        type : 'gte'\n    });\n\n    return this;\n};\n\nBuilder.prototype.gt = function gt (attributeName, value) {\n    this.builder.push({\n        attribute : attributeName,\n        value : value,\n        type : 'gt'\n    });\n\n    return this;\n};\n\nBuilder.prototype.lte = function lte (attributeName, value) {\n    this.builder.push({\n        attribute : attributeName,\n        value : value,\n        type : 'lte'\n    });\n\n    return this;\n};\n\nBuilder.prototype.lt = function lt (attributeName, value) {\n    this.builder.push({\n        attribute : attributeName,\n        value : value,\n        type : 'lt'\n    });\n\n    return this;\n};\n\nBuilder.prototype.between = function between (attributeName, upper, lower) {\n    uppper = parseFloat(upper);\n    lower = parseFloat(lower);\n\n    if(isNaN(upper) || isNaN(lower)){\n        throw \"Between is only for numeric values\";\n    }\n\n    this.builder.push({\n        attribute : attributeName,\n        value : [upper, lower],\n        type : 'between'\n    });\n\n    return this;\n};\n\nBuilder.prototype.relation = function relation (modelName, type, localKey, foreignKey, func, primary) {\n    this.tables.push(modelName);\n\n    this.relations.push({\n        modelName : modelName,\n        func : func,\n        localKey : localKey,\n        foreignKey : foreignKey,\n        type : type,\n        primary : primary\n    });\n\n    return this;\n};\n\nstaticAccessors.helpers.get = function () {\n\n    return {\n\n        checkNestedAttribute: function checkNestedAttribute (attributeString, value, condition) {\n            return condition == Model.helpers.getNestedAttribute(attributeString, value)\n        },\n\n        getNestedAttribute: function getNestedAttribute(attributeString, value) {\n            var attributes = attributeString.split('.');\n            var i;\n            var content = value;\n\n            for(i = 0; i < attributes.length; i++) {\n                if(content[attributes[i]] === undefined){\n                    return undefined;\n                }\n\n                content = content[attributes[i]];\n            }\n\n            return content;\n        },\n\n        replaceNestedValues: function replaceNestedValues(attributes, value) {\n            for(var attribute in attributes) {\n                value[attribute] = attributes[attribute];\n            }\n\n            return value;\n        },\n    };\n\n};\n\nstaticAccessors.RELATIONS.get = function () {\n    return {\n        hasOne : 'hasOne',\n        hasMany : 'hasMany'\n    }\n};\n\nObject.defineProperties( Builder, staticAccessors );\nvar WorkerModelHandler = (function (Builder) {\n    function WorkerModelHandler(modelName, workerContent) {\n        Builder.call(this);\n\n        this.name = modelName;\n        this.worker = workerContent;\n        this.setUpHandler();\n        this.tables = [modelName];\n    }\n\n    if ( Builder ) WorkerModelHandler.__proto__ = Builder;\n    WorkerModelHandler.prototype = Object.create( Builder && Builder.prototype );\n    WorkerModelHandler.prototype.constructor = WorkerModelHandler;\n\n    /**\n     * Finds the model by id\n     * @param id\n     * @returns {Promise}\n     */\n    WorkerModelHandler.prototype.find = function find (id) {\n        var model = this;\n\n        return new Promise(function (resolve, reject) {\n            var timestamp = Date.now();\n\n            model.on(timestamp, 'find', handler);\n            model.on(timestamp, 'find-error', errorHandler);\n\n            model.send(id, timestamp, 'find');\n\n            /**\n             * normal success handler\n             * @param e\n             */\n            function handler(e) {\n                model.removeListener(timestamp, 'find', handler);\n                model.removeListener(timestamp, 'find-error', errorHandler());\n\n                resolve(e.detail);\n            }\n\n            /**\n             * Error handler case\n             * @param e\n             */\n            function errorHandler(e) {\n                model.removeListener(timestamp, 'find', errorHandler);\n                model.removeListener(timestamp, 'find-error', handler);\n                reject(e.detail);\n            }\n\n        });\n    };\n\n    /**\n     * Function fetches list of result matching the criteria\n     * @returns {Promise}\n     */\n    WorkerModelHandler.prototype.get = function get () {\n        var model = this;\n        return new Promise(function (resolve, reject) {\n            var timestamp = Date.now();\n\n            model.on(timestamp, 'get', handler);\n            model.on(timestamp, 'get-error', errorHandler);\n\n            model.send({\n                tables : model.tables,\n                builder : model.builder,\n                indexBuilder : model.indexBuilder,\n                relations : model.relations\n            }, timestamp, 'get');\n\n            function handler(e) {\n                model.removeListener(timestamp, 'get', handler);\n                model.removeListener(timestamp, 'get-error', errorHandler);\n\n                resolve(e.detail);\n            }\n\n            function errorHandler(e) {\n                model.removeListener(timestamp, 'get', errorHandler);\n                model.removeListener(timestamp, 'get-error', handler);\n                reject(e.detail);\n            }\n\n        });\n    };\n\n    /**\n     * Function fetches list of result matching the criteria\n     * @returns {Promise}\n     */\n    WorkerModelHandler.prototype.first = function first () {\n        var model = this;\n        return new Promise(function (resolve, reject) {\n            var timestamp = Date.now();\n\n            model.on(timestamp, 'first', handler);\n            model.on(timestamp, 'first-error', errorHandler);\n\n            model.send({\n                tables : model.tables,\n                builder : model.builder,\n                indexBuilder : model.indexBuilder,\n                relations : model.relations\n            }, timestamp, 'first');\n\n            function handler(e) {\n                model.removeListener(timestamp, 'first', handler);\n                model.removeListener(timestamp, 'first-error', errorHandler);\n\n                resolve(e.detail);\n            }\n\n            function errorHandler(e) {\n                model.removeListener(timestamp, 'first', errorHandler);\n                model.removeListener(timestamp, 'first-error', handler);\n                reject(e.detail);\n            }\n\n        });\n    };\n\n    /**\n     * Creates a record\n     * @param data\n     * @returns {Promise}\n     */\n    WorkerModelHandler.prototype.create = function create (data) {\n        var model = this;\n        return new Promise(function (resolve, reject) {\n            var timestamp = Date.now();\n\n            model.on(timestamp, 'create', handler);\n            model.on(timestamp, 'create-error', errorHandler);\n\n            model.send(data, timestamp, 'create');\n\n            function handler(e) {\n                model.removeListener(timestamp, 'create', handler);\n                model.removeListener(timestamp, 'create-error', errorHandler);\n\n                resolve(e.detail);\n            }\n\n            function errorHandler(e) {\n                model.removeListener(timestamp, 'create', errorHandler);\n                model.removeListener(timestamp, 'create-error', handler);\n                reject(e.detail);\n            }\n\n        });\n    };\n\n    /**\n     * Creates multiple records\n     * @param data Array\n     * @returns {Promise}\n     */\n    WorkerModelHandler.prototype.createMultiple = function createMultiple (data) {\n        var model = this;\n        return new Promise(function (resolve, reject) {\n            var timestamp = Date.now();\n\n            model.on(timestamp, 'createMultiple', handler);\n            model.on(timestamp, 'createMultiple-error', errorHandler);\n\n            model.send(data, timestamp, 'createMultiple');\n\n            function handler(e) {\n                model.removeListener(timestamp, 'createMultiple', handler);\n                model.removeListener(timestamp, 'createMultiple-error', errorHandler);\n\n                resolve(e.detail);\n            }\n\n            function errorHandler(e) {\n                model.removeListener(timestamp, 'createMultiple', errorHandler);\n                model.removeListener(timestamp, 'createMultiple-error', handler);\n                reject(e.detail);\n            }\n\n        });\n    };\n\n    /**\n     * Function updates the various records with matching values\n     * @param data\n     * @returns {Promise}\n     */\n    WorkerModelHandler.prototype.update = function update (data) {\n        var model = this;\n        return new Promise(function (resolve, reject) {\n            var timestamp = Date.now();\n\n            model.on(timestamp, 'update', handler);\n            model.on(timestamp, 'update-error', errorHandler);\n\n            model.send(data, timestamp, 'update');\n\n            function handler(e) {\n                model.removeListener(timestamp, 'update', handler);\n                model.removeListener(timestamp, 'update-error', errorHandler);\n\n                resolve(e.detail);\n            }\n\n            function errorHandler(e) {\n                model.removeListener(timestamp, 'update', errorHandler);\n                model.removeListener(timestamp, 'update-error', handler);\n                reject(e.detail);\n            }\n\n        });\n    };\n\n    /**\n     * Function updates the record at the given id\n     * @param id\n     * @param data\n     * @returns {Promise}\n     */\n    WorkerModelHandler.prototype.save = function save (id, data) {\n        var model = this;\n        return new Promise(function (resolve, reject) {\n\n            var timestamp = Date.now();\n            var content = {\n                id : id,\n                data : data\n            };\n\n            model.on(timestamp, 'save', handler);\n            model.on(timestamp, 'save-error', errorHandler);\n            model.send(content, timestamp, 'save');\n\n            function handler(e) {\n                model.removeListener(timestamp, 'save', handler);\n                model.removeListener(timestamp, 'save-error', errorHandler);\n\n                resolve(e.detail);\n            }\n\n            function errorHandler(e) {\n                model.removeListener(timestamp, 'save', errorHandler);\n                model.removeListener(timestamp, 'save-error', handler);\n                reject(e.detail);\n            }\n\n        });\n    };\n\n    /**\n     * Function deletes the entries at the given point\n     * @param id\n     * @returns {Promise}\n     */\n    WorkerModelHandler.prototype.destroyId = function destroyId (id) {\n        var model = this;\n        return new Promise(function (resolve, reject) {\n\n            var timestamp = Date.now();\n\n            model.on(timestamp, 'destroyId', handler);\n            model.on(timestamp, 'destroyId-error', errorHandler);\n            model.send(id, timestamp, 'destroyId');\n\n            function handler(e) {\n                model.removeListener(timestamp, 'destroyId', handler);\n                model.removeListener(timestamp, 'destroyId-error', errorHandler);\n\n                resolve(e.detail);\n            }\n\n            function errorHandler(e) {\n                model.removeListener(timestamp, 'destroyId', errorHandler);\n                model.removeListener(timestamp, 'destroyId-error', handler);\n                reject(e.detail);\n            }\n\n        });\n    };\n\n    /**\n     * Function deletes the entries\n     * @returns {Promise}\n     */\n    WorkerModelHandler.prototype.destroy = function destroy () {\n        var model = this;\n        return new Promise(function (resolve, reject) {\n\n            var timestamp = Date.now();\n\n            model.on(timestamp, 'destroy', handler);\n            model.on(timestamp, 'destroy-error', errorHandler);\n            model.send({}, timestamp, 'destroy');\n\n            function handler(e) {\n                model.removeListener(timestamp, 'destroy', handler);\n                model.removeListener(timestamp, 'destroy-error', errorHandler);\n\n                resolve(e.detail);\n            }\n\n            function errorHandler(e) {\n                model.removeListener(timestamp, 'destroy', errorHandler);\n                model.removeListener(timestamp, 'destroy-error', handler);\n                reject(e.detail);\n            }\n\n        });\n    };\n\n    /**\n     * Function counts the number of records\n     * @returns {Promise}\n     */\n    WorkerModelHandler.prototype.count = function count () {\n        var model = this;\n        return new Promise(function (resolve, reject) {\n            var timestamp = Date.now();\n\n            model.on(timestamp, 'count', handler);\n            model.on(timestamp, 'count-error', errorHandler);\n\n            model.send({}, timestamp, 'count');\n\n            function handler(e) {\n                model.removeListener(timestamp, 'count', handler);\n                model.removeListener(timestamp, 'count-error', errorHandler);\n\n                resolve(e.detail);\n            }\n\n            function errorHandler(e) {\n                model.removeListener(timestamp, 'count', errorHandler);\n                model.removeListener(timestamp, 'count-error', handler);\n                reject(e.detail);\n            }\n\n        });\n    };\n\n    WorkerModelHandler.prototype.average = function average (attribute) {\n        var model = this;\n        return new Promise(function (resolve, reject) {\n            var timestamp = Date.now();\n\n            model.on(timestamp, 'average', handler);\n            model.on(timestamp, 'average-error', errorHandler);\n\n            model.send(attribute, timestamp, 'average');\n\n            function handler(e) {\n                model.removeListener(timestamp, 'average', handler);\n                model.removeListener(timestamp, 'average-error', errorHandler);\n\n                resolve(e.detail);\n            }\n\n            function errorHandler(e) {\n                model.removeListener(timestamp, 'average', errorHandler);\n                model.removeListener(timestamp, 'average-error', handler);\n                reject(e.detail);\n            }\n\n        });\n    };\n\n    /**\n     * Reduce function is called with each passing iterator value and reduced value is returned\n     * @param func\n     * @param defaultCarry\n     * @returns {Promise}\n     */\n    WorkerModelHandler.prototype.reduce = function reduce (func, defaultCarry) {\n        var model = this;\n        return new Promise(function (resolve, reject) {\n            var timestamp = Date.now();\n\n            model.on(timestamp, 'reduce', handler);\n            model.on(timestamp, 'reduce-error', errorHandler);\n\n            var data = {\n                func : func,\n                defaultCarry : defaultCarry\n            };\n\n            model.send(data, timestamp, 'reduce');\n\n            function handler(e) {\n                model.removeListener(timestamp, 'reduce', handler);\n                model.removeListener(timestamp, 'reduce-error', errorHandler);\n\n                resolve(e.detail);\n            }\n\n            function errorHandler(e) {\n                model.removeListener(timestamp, 'reduce', errorHandler);\n                model.removeListener(timestamp, 'reduce-error', handler);\n                reject(e.detail);\n            }\n\n        });\n    };\n\n    /**\n     * Communicates to webworker\n     * @param data\n     * @param timestamp\n     * @param action\n     */\n    WorkerModelHandler.prototype.send = function send (data, timestamp, action) {\n        var model = this;\n\n        var detail = JSON.stringify(data, function (key, value) {\n            return (typeof value === 'function' ) ? value.toString() : value;\n        });\n\n        var e = {\n            detail : detail,\n            action : action,\n            timestamp : timestamp,\n            model : model.name\n        };\n\n        model.worker.postMessage(e);\n    };\n\n    /**\n     * Sets up basic handler settings to receive messages from worker\n     */\n    WorkerModelHandler.prototype.setUpHandler = function setUpHandler () {\n        var model = this;\n\n        //general handler to act up messages sent from web worker\n        model.worker.onmessage = function(e) {\n            var data = e.data.detail;\n            model.emit(data, e.data.timestamp, e.data.action);\n\n        }\n    };\n\n    /**\n     * Normal emit event on window.document\n     *\n     * @param data\n     * @param timestamp\n     * @param action\n     */\n    WorkerModelHandler.prototype.emit = function emit (data, timestamp, action) {\n        var model = this;\n        var e = new CustomEvent('idb:worker:' + model.modeName + ':' + timestamp + ':' + action, {\n            detail : data\n        });\n\n        window.document.dispatchEvent(e);\n    };\n\n    /**\n     * Removes event listener from window.document\n     *\n     * @param timestamp\n     * @param action\n     * @param func\n     */\n    WorkerModelHandler.prototype.removeListener = function removeListener (timestamp, action, func) {\n        window.document.removeEventListener('idb:worker:' + this.modeName + ':' + timestamp + ':' + action, func);\n    };\n\n    /**\n     * Listens events on window.document\n     *\n     * @param timestamp date time stamp\n     * @param action action name\n     * @param func function to be executed\n     */\n    WorkerModelHandler.prototype.on = function on (timestamp, action, func) {\n        window.document.addEventListener('idb:worker:' + this.modeName + ':' + timestamp + ':' + action, func);\n    };\n\n    return WorkerModelHandler;\n}(Builder));\nvar Model = (function (Builder) {\n    function Model(db, idbKey, modelName, primary){\n        Builder.call(this);\n\n        this.name = modelName;\n        this.db = db;\n        this.primary = primary;\n        this.tables = [this.name];\n        this.idbKey = idbKey;\n        this.hasIdbKey = this.idbKey ? true : false;\n        this.transaction = null;\n        this.attributes = {};\n    }\n\n    if ( Builder ) Model.__proto__ = Builder;\n    Model.prototype = Object.create( Builder && Builder.prototype );\n    Model.prototype.constructor = Model;\n\n    var staticAccessors$1 = { READWRITE: {},READONLY: {} };\n\n    /**\n     * Finds the result on the primary key defined\n     * @param id\n     * @returns {Promise}\n     */\n    Model.prototype.find = function find (id) {\n        var model = this;\n\n        return new Promise(function (resolve, reject) {\n            var transaction = model.getTransaction(model.tables, Model.READONLY);\n            var obj = transaction.objectStore(model.name);\n            var request = obj.get(id);\n            \n            request.onsuccess = function (e) {\n                resolve(e.target.result);\n            };\n\n            request.onerror = function (e) {\n                reject(e);\n            };\n\n        });\n    };\n\n    /**\n     * Searches for first value in database and returns that\n     * @returns {Promise}\n     */\n    Model.prototype.first = function first () {\n        var model = this;\n\n        return new Promise(function (resolve, reject) {\n            var transaction = model.getTransaction(model.tables, Model.READONLY);\n            var obj = transaction.objectStore(model.name);\n            var result = null;\n            var request;\n\n            if(model.indexBuilder.type){\n                request = model.getIndexResult(obj);\n            }else{\n                request = obj.openCursor();\n            }\n\n            request.onsuccess = function (e) {\n                var cursor = e.target.result;\n\n                if(cursor){\n                    if(model.checkBuilderValue(cursor.value)){\n                        var relationsCompleted = 0;\n\n                        result = cursor.value;\n\n                        if(model.relations.length > 0 && (result !== null || result !== undefined)){\n\n\n                            model.relations.forEach(function (relation) {\n\n                                var relationRequest = model.getRelationships(relation, model.transaction, model.getMainResult(result, relation.localKey, false), false);\n\n                                relationRequest.then(function (relationResult) {\n\n                                    relationsCompleted++;\n\n                                    var defaultValue = model.getDefaultRelationValue(relation.type);\n                                    result[relation.modelName] = result[relation.modelName] || defaultValue;\n\n                                    switch (relation.type) {\n                                        case Model.RELATIONS.hasOne :\n                                            if (relationResult !== undefined) {\n                                                result[relation.modelName] = relationResult[relation.foreignKey] == result[relation.localKey] ? relationResult : result[relation.modelName];\n                                            }\n\n                                            break;\n                                        case Model.RELATIONS.hasMany :\n                                            if (relationResult.length > 0) {\n                                                result[relation.modelName] = relationResult.filter(function (relationResultItem) {\n                                                    return relationResultItem[relation.foreignKey] == result[relation.localKey];\n                                                });\n                                            }\n                                            break;\n                                    }\n\n                                    if (relationsCompleted == model.relations.length) {\n                                        resolve(result);\n                                    }\n\n                                }).catch(function (err) {\n                                    reject(err);\n                                });\n                            });\n                        }else{\n                            resolve(cursor.value);\n                            return false;\n                        }\n                    }else{\n                        cursor.continue();\n                    }\n\n                }else{\n                    resolve(result);\n                }\n            };\n\n            request.onerror = function(e) {\n                reject(e);\n            }\n        });\n    };\n\n    /**\n     * Function searches throughout the database and returns a array of result\n     * @returns {Promise}\n     */\n    Model.prototype.get = function get () {\n        var model = this;\n\n        return new Promise(function (resolve, reject) {\n            var transaction = model.getTransaction(model.tables, Model.READONLY);\n            var obj = transaction.objectStore(model.name);\n            var result = [];\n            var request;\n\n            if(model.indexBuilder.type){\n                request = model.getIndexResult(obj);\n            }else{\n                request = obj.openCursor();\n            }\n\n            request.onsuccess = function (e) {\n                var cursor = e.target.result;\n\n                if(cursor){\n                    if(model.checkBuilderValue(cursor.value)){\n                        result.push(cursor.value);\n                    }\n                    cursor.continue();\n\n                }else{\n                    var mainResult, relationsCompleted = 0;\n\n                    if(model.relations.length > 0 && result.length > 0){\n\n\n                        model.relations.forEach(function (relation) {\n\n                            var relationRequest = model.getRelationships(relation, model.transaction, model.getMainResult(result, relation.localKey, true), true);\n\n                            relationRequest.then(function (relationResult) {\n\n                                relationsCompleted++;\n\n                                result = result.map(function (item) {\n\n                                    var defaultValue = model.getDefaultRelationValue(relation.type);\n                                    item[relation.modelName] = item[relation.modelName] || defaultValue;\n\n                                    switch (relation.type) {\n                                        case Model.RELATIONS.hasOne :\n                                            if(relationResult !== undefined) {\n                                                item[relation.modelName] = relationResult[relation.foreignKey] == item[relation.localKey] ? relationResult : item[relation.modelName];\n                                            }\n\n                                            break;\n                                        case Model.RELATIONS.hasMany :\n                                            if(relationResult.length > 0) {\n                                                item[relation.modelName] = relationResult.filter(function (relationResultItem) {\n                                                    return relationResultItem[relation.foreignKey] == item[relation.localKey];\n                                                });\n                                            }\n                                            break;\n                                    }\n\n                                    return item;\n                                });\n\n                                if(relationsCompleted == model.relations.length){\n                                    resolve(result);\n                                }\n\n                            }).catch(function (err) {\n                                reject(err);\n                            })\n                        });\n                    }else{\n                        resolve(result);\n                    }\n                }\n            };\n\n            request.onerror = function(e) {\n                reject(e);\n            }\n        });\n    };\n\n    /**\n     * Function creates a single record\n     * @param data\n     * @returns {Promise}\n     */\n    Model.prototype.create = function create (data) {\n        var model = this;\n\n        return new Promise(function (resolve, reject) {\n            var transaction = model.getTransaction(model.tables, Model.READWRITE);\n\n            var obj = transaction.objectStore(model.name);\n\n            data.createdAt = Date.now();\n            data.updatedAt = Date.now();\n\n            var request = obj.add(data);\n\n            request.onsuccess = function (e) {\n                data[model.primary] = e.target.result;\n                resolve(data);\n            };\n\n            request.onerror = function (e) {\n                reject(e);\n            };\n        });\n\n    };\n\n    /**\n     * Function creates list of records passed\n     * @param dataRecords\n     * @returns {Promise}\n     */\n    Model.prototype.createMultiple = function createMultiple (dataRecords) {\n        var model = this;\n\n        return new Promise(function (resolve, reject) {\n            var transaction = model.getTransaction(model.tables, Model.READWRITE);\n\n            var obj = transaction.objectStore(model.name);\n            var createdAt = Date.now();\n            var updatedAt = Date.now();\n            var result = [];\n\n            dataRecords.forEach(function (data) {\n                data.createdAt = createdAt;\n                data.updatedAt = updatedAt;\n\n                var request = obj.add(data);\n\n                request.onerror = function(e) {\n                    reject(e);\n                };\n\n                request.onsuccess = function(e) {\n                    data[model.primary] = e.target.result;\n\n                    result.push(data);\n\n                    if(result.length === dataRecords.length){\n                        resolve(result);\n                    }\n                };\n            })\n        });\n    };\n\n    /**\n     * Function updates the various records with matching values\n     * @param data\n     * @returns {Promise}\n     */\n    Model.prototype.update = function update (data) {\n\n        var model = this;\n        var updatedAt = Date.now();\n\n        return new Promise(function (resolve, reject) {\n            var transaction = model.getTransaction(model.tables, Model.READWRITE);\n            var obj = transaction.objectStore(model.name);\n            var request, totalRecordsBeingUpdated = 0, totalRecordsUpdated = 0;\n\n            if(model.indexBuilder.type){\n                request = model.getIndexResult(obj);\n            }else{\n                request = obj.openCursor();\n            }\n\n            request.onsuccess = function (e) {\n                var cursor = e.target.result;\n\n                if(cursor){\n                    if(model.checkBuilderValue(cursor.value)){\n                        totalRecordsBeingUpdated++;\n\n                        var id = cursor.value[model.primary];\n                        var createdAt = cursor.value.createdAt;\n\n                        var result = Model.helpers.replaceNestedValues(data, cursor.value);\n                        result[model.primary] = id;\n                        result.createdAt = createdAt;\n                        result.updatedAt = updatedAt;\n\n                        var updateRequest = cursor.update(result);\n\n                        updateRequest.onsuccess = function() {\n                            totalRecordsUpdated++;\n\n                            if(totalRecordsUpdated === totalRecordsBeingUpdated){\n                                resolve(true);\n                            }\n                        };\n\n                        updateRequest.onerror = function(err) {\n                            transaction.abort();\n                            reject(err);\n                        };\n\n                    }\n                    cursor.continue();\n\n                }else{\n                    resolve();\n                }\n            };\n\n            request.onerror = function(e) {\n                reject(e);\n            }\n        });\n    };\n\n    /**\n     * Function updates the record at the given id\n     * @param id\n     * @param data\n     * @returns {Promise}\n     */\n    Model.prototype.save = function save (id, data) {\n        var model = this;\n        var updatedAt = Date.now();\n\n        return new Promise(function (resolve, reject) {\n\n            model.find(id).then(function (result) {\n\n                if(!result){\n                    reject('No record found');\n                }\n\n                var transaction = model.getTransaction(model.tables, Model.READWRITE, true);\n                var obj = transaction.objectStore(model.name);\n\n                var id = result[model.primary];\n                var createdAt = result.createdAt;\n\n                result = Model.helpers.replaceNestedValues(data, result);\n                result[model.primary] = id;\n                result.createdAt = createdAt;\n                result.updatedAt = updatedAt;\n\n                var request = obj.put(result);\n\n                request.onsuccess = function () {\n                    resolve(true);\n                };\n\n                request.onerror = function(e) {\n                    reject(e);\n                }\n            }).catch(function (err) {\n                reject(err);\n            });\n\n        });\n    };\n\n    /**\n     * Function deletes the entries at the given point\n     * @param id\n     * @returns {Promise}\n     */\n    Model.prototype.destroyId = function destroyId (id) {\n        var model = this;\n\n\n        return new Promise(function (resolve, reject) {\n            model.find(id).then(function (result) {\n\n                if(!result){\n                    reject('result at id does not exists');\n                }\n\n                var transaction = model.getTransaction(model.tables, Model.READWRITE, true);\n                var obj = transaction.objectStore(model.name);\n                var request = obj.delete(id);\n\n                request.onsuccess = function (e) {\n                    resolve(e.target.result);\n                };\n\n                request.onerror = function (e) {\n                    reject(e);\n                };\n            }).catch(function (err) {\n                reject(err);\n            });\n\n\n        });\n    };\n\n    /**\n     * Function deletes the entries\n     * @returns {Promise}\n     */\n    Model.prototype.destroy = function destroy () {\n        var model = this;\n\n        return new Promise(function (resolve, reject) {\n            var transaction = model.getTransaction(model.tables, Model.READWRITE);\n            var obj = transaction.objectStore(model.name);\n            var request, totalRecordsBeingDeleted = 0, totalRecordsDeleted = 0;\n\n            if (model.indexBuilder.type) {\n                request = model.getIndexResult(obj);\n            } else {\n                request = obj.openCursor();\n            }\n\n            request.onsuccess = function (e) {\n                var cursor = e.target.result;\n\n                if (cursor) {\n                    if (model.checkBuilderValue(cursor.value)) {\n                        totalRecordsBeingDeleted++;\n\n                        var deleteRequest = cursor.delete();\n\n                        deleteRequest.onsuccess = function () {\n                            totalRecordsDeleted++;\n\n                            if (totalRecordsDeleted === totalRecordsBeingDeleted) {\n                                resolve(true);\n                            }\n                        };\n\n                        deleteRequest.onerror = function (err) {\n                            transaction.abort();\n                            reject(err);\n                        };\n\n                    }\n                    cursor.continue();\n\n                } else {\n                    resolve();\n                }\n            };\n\n            request.onerror = function (e) {\n                reject(e);\n            }\n        });\n    };\n\n    /**\n     * Function counts the number of records\n     * @returns {Promise}\n     */\n    Model.prototype.count = function count () {\n        var model = this;\n\n        return new Promise(function (resolve, reject) {\n            var transaction = model.getTransaction(model.tables, Model.READONLY);\n            var obj = transaction.objectStore(model.name);\n            var result = 0;\n            var request;\n\n            if(model.indexBuilder.type){\n                request = model.getIndexResult(obj);\n            }else{\n                request = obj.openCursor();\n            }\n\n            request.onsuccess = function (e) {\n                var cursor = e.target.result;\n\n                if(cursor){\n                    if(model.checkBuilderValue(cursor.value)){\n                        result++;\n                    }\n\n                    cursor.continue();\n\n                }else{\n                    resolve(result);\n                }\n            };\n\n            request.onerror = function(e) {\n                reject(e);\n            }\n        });\n    };\n\n    /**\n     * Function averages the numeric value at the given point\n     * @param attribute\n     * @returns {Promise}\n     */\n    Model.prototype.average = function average (attribute) {\n        var model = this;\n\n        return new Promise(function (resolve, reject) {\n            var transaction = model.getTransaction(model.tables, Model.READONLY);\n            var obj = transaction.objectStore(model.name);\n            var result = 0, totalRecords = 0;\n            var request;\n\n            if(model.indexBuilder.type){\n                request = model.getIndexResult(obj);\n            }else{\n                request = obj.openCursor();\n            }\n\n            request.onsuccess = function (e) {\n                var cursor = e.target.result;\n\n                if(cursor){\n                    if(model.checkBuilderValue(cursor.value)){\n                        totalRecords++;\n                        var tempResult = Model.helpers.getNestedAttribute(attribute, cursor.value);\n                        tempResult = parseFloat(tempResult);\n                        tempResult = isNaN(tempResult) ? 0 : tempResult;\n                        result += tempResult;\n                    }\n\n                    cursor.continue();\n\n                }else{\n                    resolve(result/totalRecords);\n                }\n            };\n\n            request.onerror = function(e) {\n                reject(e);\n            }\n        });\n    };\n\n    /**\n     * Reduce function is called with each passing iterator value and reduced value is returned\n     * @param func\n     * @param defaultCarry\n     * @returns {Promise}\n     */\n    Model.prototype.reduce = function reduce (func, defaultCarry) {\n        var model = this;\n\n        if(typeof func !== 'function'){\n            throw \"Parameter should be a function type\";\n        }\n\n        return new Promise(function (resolve, reject) {\n            var transaction = model.getTransaction(model.tables, Model.READONLY);\n            var obj = transaction.objectStore(model.name);\n            var result = defaultCarry;\n            var request;\n\n            if(model.indexBuilder.type){\n                request = model.getIndexResult(obj);\n            }else{\n                request = obj.openCursor();\n            }\n\n            request.onsuccess = function (e) {\n                var cursor = e.target.result;\n\n                if(cursor){\n                    if(model.checkBuilderValue(cursor.value)){\n                        result = func(cursor.value, result);\n                    }\n\n                    cursor.continue();\n\n                }else{\n                    resolve(result);\n                }\n            };\n\n            request.onerror = function(e) {\n                reject(e);\n            }\n        });\n    };\n\n    /**\n     * Sets the index search criteria\n     * @param objectStore\n     * @returns {*}\n     */\n    Model.prototype.getIndexResult = function getIndexResult (objectStore) {\n        var builder = this;\n        var range;\n        var index;\n\n\n        if(!builder.indexBuilder.type) {\n            return objectStore.openCursor();\n        }\n\n        if(builder.indexBuilder.index !== builder.primary){\n            index = objectStore.index(builder.indexBuilder.index);\n        }else{\n            index = objectStore;\n        }\n\n        switch (builder.indexBuilder.type) {\n            case 'and' :\n                range = builder.idbKey.only(builder.indexBuilder.value);\n                break;\n\n            case 'in' :\n                builder.whereIn(builder.indexBuilder.index, builder.indexBuilder.value);\n                var values = builder.indexBuilder.value.sort();\n                range = builder.idbKey.bound(values[0], values[values.length - 1], false, false);\n                break;\n\n            case 'gte' :\n                range = builder.idbKey.lowerBound(builder.indexBuilder.value, false);\n                break;\n\n            case 'gt' :\n                range = builder.idbKey.lowerBound(builder.indexBuilder.value, true);\n                break;\n\n            case 'lte' :\n                range = builder.idbKey.upperBound(builder.indexBuilder.value, false);\n                break;\n\n            case 'lt' :\n                range = builder.idbKey.lowerBound(builder.indexBuilder.value, true);\n                break;\n\n            case 'between' :\n                range = builder.idbKey.bound(builder.indexBuilder.value[0], builder.indexBuilder.value[1], false, false);\n                break;\n            default :\n                throw 'Invalid builder type found';\n        }\n\n        return index.openCursor(range);\n    };\n\n    /**\n     * Checks common search criteria other than the index values\n     * @param value\n     * @returns {boolean}\n     */\n    Model.prototype.checkBuilderValue = function checkBuilderValue (value) {\n        var builder = this;\n        var result = true;\n        var i,j;\n        for (i = 0; i < builder.builder.length; i++){\n\n            var condition = builder.builder[i];\n            switch(condition.type){\n\n                case 'and' : //case for one to one search\n                    if(!Model.helpers.checkNestedAttribute(condition.attribute, value, condition.value)){\n                        return false;\n                    }\n                    break;\n\n                case 'in' : //case for list search\n                    var tempCheck = false;\n                    for(j = 0; j < condition.value.length; j++) {\n                        result = Model.helpers.checkNestedAttribute(condition.attribute, value, condition.value[j]);\n                        if(result !== undefined && result !== false) {\n                            tempCheck = true;\n                        }\n                    }\n\n                    if(!tempCheck){\n                        return false;\n                    }\n\n                    result = true;\n\n                    break;\n\n                case 'gte' : //case for checking the value is greater than or is equal to the same\n                    result = Model.helpers.getNestedAttribute(condition.attribute, value);\n\n                    if(result === undefined) {\n                        return false;\n                    }\n\n                    if(result < condition.value){\n                        return false;\n                    }\n\n                    result = true;\n                    break;\n\n                case 'gt' : //case for checking the value is greater than the same\n\n                    result = Model.helpers.getNestedAttribute(condition.attribute, value);\n\n                    if(result === undefined) {\n                        return false;\n                    }\n\n                    if(result <= condition.value){\n                        return false;\n                    }\n\n                    result = true;\n                    break;\n\n                case 'lte' : //case for checking the value is less than or is equal to the same\n                    result = Model.helpers.getNestedAttribute(condition.attribute, value);\n\n                    if(result === undefined) {\n                        return false;\n                    }\n\n                    if(result > condition.value){\n                        return false;\n                    }\n                    result = true;\n                    break;\n\n                case 'lt' : //case for checking the value is less than the same\n                    result = Model.helpers.getNestedAttribute(condition.attribute, value);\n\n                    if(result === undefined) {\n                        return false;\n                    }\n\n                    if(result >= condition.value){\n                        return false;\n                    }\n                    result = true;\n                    break;\n\n                case 'between' : //case for checking the value is between the given range(ONLY WORKS FOR NUMERIC)\n                    result = Model.helpers.getNestedAttribute(condition.attribute, value);\n\n                    if(result === undefined) {\n                        return false;\n                    }\n\n                    if(condition.value[0] >= result && condition.value[1] <= result){\n                        return false\n                    }\n                    result = true;\n                    break;\n\n                default:\n                    result = true;\n            }\n        }\n\n        return result;\n    };\n\n    /**\n     * Creates a transaction\n     * @param tables\n     * @param mode\n     */\n    Model.prototype.createTransaction = function createTransaction (tables, mode) {\n        this.transaction = this.db.transaction(tables, mode)\n    };\n\n    /**\n     * Sets IDBTransaction obejct to current model scope\n     * @param transaction\n     */\n    Model.prototype.setTransaction = function setTransaction (transaction) {\n        this.transaction = transaction\n    };\n\n    /**\n     * Returns the IDBTransaction object set in current scope\n     * @param {Array} tables\n     * @param {String} mode\n     * @param {boolean} overwrite\n     * @returns {*|null}\n     */\n    Model.prototype.getTransaction = function getTransaction (tables, mode, overwrite) {\n        overwrite = overwrite === undefined ? false : overwrite;\n\n        if(!this.transaction || overwrite === true) {\n            this.createTransaction(tables, mode);\n        }\n\n        return this.transaction;\n    };\n\n    /**\n     * Returns the array or direct key value against the input give for the key specified\n     * @param result\n     * @param key\n     * @param isArray\n     * @returns {*}\n     */\n    Model.prototype.getMainResult = function getMainResult (result, key, isArray) {\n        if(isArray){\n            return result.map(function (item) {\n                return item[key];\n            });\n        }else{\n            return result[key];\n        }\n    };\n\n    /**\n     * Searches for relationships assigned with builder and fetches them\n     * @param relation\n     * @param transaction\n     * @param mainResult\n     * @param isArray\n     * @returns {Promise}\n     */\n    Model.prototype.getRelationships = function getRelationships (relation, transaction, mainResult, isArray) {\n\n        isArray = isArray || false;\n\n        var model = this;\n        var primary = relation.primary || 'id';\n\n        /**\n         * @var Model relationModel\n         */\n        var relationModel = new Model(model.db, model.idbKey, relation.modelName, relation.primary);\n\n        //setting the relation transaction same as parent transaction\n        relationModel.setTransaction(transaction);\n\n        //if a secondry builder function was defined\n        if(relation.func){\n            var tempBuilder = new Builder();\n\n            tempBuilder = relation.func(tempBuilder);\n\n            relationModel.tables = tempBuilder.tables;\n            relationModel.tables.push(relationModel.name);\n            relationModel.relations = tempBuilder.relations;\n            relationModel.builder = tempBuilder.builder;\n        }\n\n        //checking type of parent result\n        if(isArray){\n            relationModel.whereIndexIn(relation.foreignKey, mainResult);\n        }else{\n            relationModel.whereIndex(relation.foreignKey, mainResult);\n        }\n\n        return new Promise(function (relationResolve, relationReject) {\n\n            var result;\n\n            //if relation type mentioned\n            switch (relation.type) {\n                case Model.RELATIONS.hasOne :\n                    result = relationModel.first();\n                    break;\n                case Model.RELATIONS.hasMany :\n                    result = relationModel.get();\n                    break;\n                default :\n                    throw \"Invalid relation type provided\";\n            }\n\n            result.then(function (r) {\n                relationResolve(r);\n            }).catch(function (err) {\n                relationReject(err);\n            });\n\n        });\n    };\n\n    /**\n     * Gets the default value of result. Null for hasOne and array for hasMany\n     * @param type\n     * @returns {*}\n     */\n    Model.prototype.getDefaultRelationValue = function getDefaultRelationValue (type) {\n    switch (type) {\n        case Model.RELATIONS.hasOne :\n            return null;\n        case Model.RELATIONS.hasMany :\n            return [];\n        default :\n            return null;\n    }\n};\n\n\n    /**\n     * Readwrite parameter of indexedDB\n     * @return {string}\n     */\n    staticAccessors$1.READWRITE.get = function () {\n        return \"readwrite\";\n    };\n\n    /**\n     * Readonly parameter of indexedDB\n     * @return {string}\n     */\n    staticAccessors$1.READONLY.get = function () {\n        return \"readonly\";\n    };\n\n    Object.defineProperties( Model, staticAccessors$1 );\n\n    return Model;\n}(Builder));\n\nvar Migration = function Migration(db, transaction, migrations) {\n    /**\n     * @var IDBDatabase db\n     */\n    this.db = db;\n    this.migrations = migrations;\n    this.objectStores = [];\n\n    /**\n     * @var IDBTransaction transaction\n     */\n    this.transaction = transaction;\n};\n\nMigration.prototype.createStore = function createStore (schema) {\n    var mig = this;\n    var primary = schema.primary || 'id';\n\n    var objectStore = mig.db.createObjectStore(schema.name, {keyPath: primary, autoIncrement: true});\n    mig.objectStores.push(objectStore);\n\n    if (schema.columns) {\n        schema.columns.forEach(function (column) { return mig.makeIndex(column, objectStore); });\n    }\n\n\n};\n\nMigration.prototype.run = function run () {\n    var mig = this;\n\n    mig.migrations.forEach(function (schema) {\n        if(mig.db.objectStoreNames.contains(schema.name)){\n\n            if(schema.drop){\n                mig.db.deleteObjectStore(schema.name);\n            }else{\n                mig.updateStore(schema);\n            }\n\n\n        }else{\n            mig.createStore(schema);\n        }\n    });\n};\n\nMigration.prototype.makeIndex = function makeIndex (column, objectStore) {\n    column.attributes = column.attributes || {};\n    column.index = column.index || column.name;\n    objectStore.createIndex(column.name, column.index, column.attributes);\n};\n\nMigration.prototype.updateStore = function updateStore (schema) {\n    var mig = this;\n\n    var objectStore = mig.transaction.objectStore(schema.name);\n\n    if (schema.columns) {\n\n        schema.columns.forEach(function (column) {\n            if(!objectStore.indexNames.contains(column.name)){\n                mig.makeIndex(column, objectStore)\n            }\n        });\n    }\n\n    if(schema.dropColumns) {\n        schema.dropColumns.forEach(function (column) {\n            if(objectStore.indexNames.contains(column)){\n                mig.dropIndex(column, objectStore)\n            }\n        });\n    }\n};\n\nMigration.prototype.dropIndex = function dropIndex (columnName, objectStore) {\n    debugger;\n    objectStore.deleteIndex(columnName);\n};\n\nvar DB = function DB(idb, idbKey, settings, useWebWorker, pathToWebWorker) {\n    this.db = idb;\n    this.idbKey = idbKey;\n    this.settings = settings;\n    this.useWebWorker = useWebWorker || false;\n    this.isWebWorker = false;\n    this.pathToWebWorker = pathToWebWorker;\n};\n\n/**\n * Initializes database connection with indexedDB\n *\n * @returns {Promise}\n */\nDB.prototype.connect = function connect () {\n    var db = this;\n    return new Promise(function (resolve, reject) {\n\n        if(db.useWebWorker){\n            db.createWorkerHandler(resolve, reject);\n        }else{\n            db.createNormalHandler(resolve, reject);\n        }\n    });\n};\n\n/**\n * Destroys/Deletes the databaase\n * @param dbName\n */\nDB.prototype.destroy = function destroy (dbName) {\n    console.info('database ' + dbName + ' deleted');\n    this.db.deleteDatabase(dbName);\n};\n\n/**\n * Creates connection in web worker space and if web worker fails\n * then creates normal database connection instance\n * @param resolve\n * @param reject\n */\nDB.prototype.createWorkerHandler = function createWorkerHandler (resolve, reject) {\n    var db = this;\n    try{\n        var worker = new window.Worker(db.pathToWebWorker);\n        var models = {};\n        var timestamp = Date.now();\n\n        worker.postMessage({\n            detail : JSON.stringify(db.settings),\n            action : 'initialize',\n            timestamp : timestamp\n        });\n            \n        worker.onmessage = function (e) {\n            if(e.data.action === 'initialize' && e.data.timestamp === timestamp) {\n                if (e.data.detail === true) {\n                    db.settings.migrations.forEach(function (schema) {\n                        Object.defineProperty(models, schema.name, {\n                            get: function get() {\n                                return new WorkerModelHandler(schema.name, worker, window);\n                            }\n                        });\n                    });\n\n                    db.isWebWorker = true;\n                    resolve(models);\n                } else {\n                    db.createNormalHandler(resolve, reject);\n                }\n            }\n        }\n\n    }catch (e) {\n        reject(e);\n    }\n\n};\n\n/**\n * Creates normal database instance and models\n * @param resolve\n * @param reject\n */\nDB.prototype.createNormalHandler = function createNormalHandler (resolve, reject) {\n    var db = this;\n\n    var request = this.db.open(this.settings.dbName, this.settings.dbVersion);\n\n    request.onupgradeneeded = function (e) {\n        var mig = new Migration(e.target.result, e.target.transaction, db.settings.migrations);\n        mig.run();\n    };\n\n    request.onerror = function (e) {\n        reject(e);\n    };\n\n    request.onsuccess = function (e) {\n        var models = {};\n\n        db.settings.migrations.forEach(function (schema) {\n            var primary = schema.primary || 'id';\n            Object.defineProperty(models, schema.name, {\n                get: function get() {\n                    return new Model(e.target.result, db.idbKey, schema.name, primary);\n                }\n            });\n        });\n\n        resolve(models);\n    };\n};\nwindow.idb = function (settings, useWebWorker, pathToWebWorker){\n    \"use strict\";\n\n    useWebWorker = useWebWorker === undefined ? true : useWebWorker;\n\n    var idb = window.indexedDB || window.mozIndexedDB || window.webkitIndexedDB || window.msIndexedDB;\n    var idbKeyRange = window.IDBKeyRange || window.webkitIDBKeyRange || window.msIDBKeyRange;\n    if(!idb){\n        throw \"IndexedDB not supported\";\n    }\n\n    if(!checkSettingsConfig(settings)){\n        throw \"settings parameter is incorrectly structured\";\n    }\n\n    return new DB(idb, idbKeyRange, settings, checkWebWorker(), pathToWebWorker);\n\n    function checkSettingsConfig(settings) {\n        return true;\n    }\n\n    function checkWebWorker(){\n        if(!useWebWorker) {\n            return false;\n        }\n\n        return (window.Blob && window.Worker);\n    }\n\n};\n\n//# sourceMappingURL=idb.js.map\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiMC5qcyIsInNvdXJjZXMiOlsid2VicGFjazovLy9idWlsZC9pZGIuanM/Mzg5NiJdLCJzb3VyY2VzQ29udGVudCI6WyJjbGFzcyBCdWlsZGVyIHtcblxuICAgIGNvbnN0cnVjdG9yICgpIHtcbiAgICAgICAgdGhpcy5idWlsZGVyID0gW107XG4gICAgICAgIHRoaXMuaW5kZXhCdWlsZGVyID0ge307XG4gICAgICAgIHRoaXMucmVsYXRpb25zID0gW107XG4gICAgICAgIHRoaXMudGFibGVzID0gW107XG4gICAgfVxuXG4gICAgLyoqXG4gICAgICogU2V0cyB0aGUgaW5kZXggYnVpbGRlciB2YWx1ZSBhcyBhbiAnYW5kJyByZWZlcmVuY2VcbiAgICAgKlxuICAgICAqIEBwYXJhbSBpbmRleE5hbWUgc3RyaW5nXG4gICAgICogQHBhcmFtIHZhbHVlIG1peGVkXG4gICAgICogQHJldHVybnMge0J1aWxkZXJ9XG4gICAgICovXG4gICAgd2hlcmVJbmRleChpbmRleE5hbWUsIHZhbHVlKSB7XG5cbiAgICAgICAgdGhpcy5pbmRleEJ1aWxkZXIgPSB7XG4gICAgICAgICAgICBpbmRleCA6IGluZGV4TmFtZSxcbiAgICAgICAgICAgIHZhbHVlIDogdmFsdWUsXG4gICAgICAgICAgICB0eXBlIDogJ2FuZCdcbiAgICAgICAgfTtcblxuICAgICAgICByZXR1cm4gdGhpcztcbiAgICB9XG5cbiAgICAvKipcbiAgICAgKiBTZXRzIHRoZSBpbmRleCBidWlsZGVyIHZhbHVlIGFzIGFuICdpbicgcmVmZXJlbmNlXG4gICAgICogQHBhcmFtIGluZGV4TmFtZVxuICAgICAqIEBwYXJhbSB2YWx1ZVxuICAgICAqIEByZXR1cm5zIHtCdWlsZGVyfVxuICAgICAqL1xuICAgIHdoZXJlSW5kZXhJbihpbmRleE5hbWUsIHZhbHVlKSB7XG5cbiAgICAgICAgdGhpcy5pbmRleEJ1aWxkZXIgPSB7XG4gICAgICAgICAgICBpbmRleCA6IGluZGV4TmFtZSxcbiAgICAgICAgICAgIHZhbHVlIDogdmFsdWUsXG4gICAgICAgICAgICB0eXBlIDogJ2luJ1xuICAgICAgICB9O1xuXG4gICAgICAgIHJldHVybiB0aGlzO1xuICAgIH1cblxuICAgIC8qKlxuICAgICAqIFNldHMgdGhlIGluZGV4IGJ1aWxkZXIgdmFsdWUgd2l0aCBwb2ludCBpbmNsdXNpdmUgYW5kIHNldHMgZ3JlYXRlciB0aGFuIGNoZWNrXG4gICAgICogQHBhcmFtIGluZGV4TmFtZVxuICAgICAqIEBwYXJhbSB2YWx1ZVxuICAgICAqIEByZXR1cm5zIHtCdWlsZGVyfVxuICAgICAqL1xuICAgIGluZGV4R3RlKGluZGV4TmFtZSwgdmFsdWUpIHtcblxuICAgICAgICB0aGlzLmluZGV4QnVpbGRlciA9IHtcbiAgICAgICAgICAgIGluZGV4IDogaW5kZXhOYW1lLFxuICAgICAgICAgICAgdmFsdWUgOiB2YWx1ZSxcbiAgICAgICAgICAgIHR5cGUgOiAnZ3RlJ1xuICAgICAgICB9O1xuXG4gICAgICAgIHJldHVybiB0aGlzO1xuICAgIH1cblxuICAgIC8qKlxuICAgICAqIFNldHMgdGhlIGluZGV4IGJ1aWxkZXIgdmFsdWUgd2l0aCBwb2ludCBub3QgaW5jbHVzaXZlIGFuZCBzZXRzIGdyZWF0ZXIgdGhhbiBjaGVja1xuICAgICAqIEBwYXJhbSBpbmRleE5hbWVcbiAgICAgKiBAcGFyYW0gdmFsdWVcbiAgICAgKiBAcmV0dXJucyB7QnVpbGRlcn1cbiAgICAgKi9cbiAgICBpbmRleEd0KGluZGV4TmFtZSwgdmFsdWUpIHtcblxuICAgICAgICB0aGlzLmluZGV4QnVpbGRlciA9IHtcbiAgICAgICAgICAgIGluZGV4IDogaW5kZXhOYW1lLFxuICAgICAgICAgICAgdmFsdWUgOiB2YWx1ZSxcbiAgICAgICAgICAgIHR5cGUgOiAnZ3QnXG4gICAgICAgIH07XG5cbiAgICAgICAgcmV0dXJuIHRoaXM7XG4gICAgfVxuXG4gICAgLyoqXG4gICAgICogU2V0cyB0aGUgaW5kZXggYnVpbGRlciB2YWx1ZSB3aXRoIHBvaW50IGluY2x1c2l2ZSBhbmQgc2V0cyBsZXNzIHRoYW4gY2hlY2tcbiAgICAgKiBAcGFyYW0gaW5kZXhOYW1lXG4gICAgICogQHBhcmFtIHZhbHVlXG4gICAgICogQHJldHVybnMge0J1aWxkZXJ9XG4gICAgICovXG4gICAgaW5kZXhMdGUoaW5kZXhOYW1lLCB2YWx1ZSkge1xuXG4gICAgICAgIHRoaXMuaW5kZXhCdWlsZGVyID0ge1xuICAgICAgICAgICAgaW5kZXggOiBpbmRleE5hbWUsXG4gICAgICAgICAgICB2YWx1ZSA6IHZhbHVlLFxuICAgICAgICAgICAgdHlwZSA6ICdsdGUnXG4gICAgICAgIH07XG5cbiAgICAgICAgcmV0dXJuIHRoaXM7XG4gICAgfVxuXG4gICAgLyoqXG4gICAgICogU2V0cyB0aGUgaW5kZXggYnVpbGRlciB2YWx1ZSB3aXRoIHBvaW50IG5vdCBpbmNsdXNpdmUgYW5kIHNldHMgbGVzcyB0aGFuIGNoZWNrXG4gICAgICpcbiAgICAgKiBAcGFyYW0gaW5kZXhOYW1lXG4gICAgICogQHBhcmFtIHZhbHVlXG4gICAgICogQHJldHVybnMge0J1aWxkZXJ9XG4gICAgICovXG4gICAgaW5kZXhMdChpbmRleE5hbWUsIHZhbHVlKSB7XG5cbiAgICAgICAgdGhpcy5pbmRleEJ1aWxkZXIgPSB7XG4gICAgICAgICAgICBpbmRleCA6IGluZGV4TmFtZSxcbiAgICAgICAgICAgIHZhbHVlIDogdmFsdWUsXG4gICAgICAgICAgICB0eXBlIDogJ2x0J1xuICAgICAgICB9O1xuXG4gICAgICAgIHJldHVybiB0aGlzO1xuICAgIH1cblxuICAgIC8qKlxuICAgICAqIFNldHMgdGhlIGluZGV4IGJ1aWxkZXIgdmFsdWUgd2l0aCBwb2ludHMgaW5jbHVzaXZlIGFuZCBzZXRzIHJhbmdlIGJldHdlZW4gdGhlbVxuICAgICAqIEBwYXJhbSBpbmRleE5hbWVcbiAgICAgKiBAcGFyYW0gbG93ZXJcbiAgICAgKiBAcGFyYW0gdXBwZXJcbiAgICAgKiBAcmV0dXJucyB7QnVpbGRlcn1cbiAgICAgKi9cbiAgICBpbmRleEJldHdlZW4oaW5kZXhOYW1lLCBsb3dlciwgdXBwZXIpIHtcblxuICAgICAgICB0aGlzLmluZGV4QnVpbGRlciA9IHtcbiAgICAgICAgICAgIGluZGV4IDogaW5kZXhOYW1lLFxuICAgICAgICAgICAgdmFsdWUgOiBbbG93ZXIsIHVwcGVyXSxcbiAgICAgICAgICAgIHR5cGUgOiAnYmV0d2VlbidcbiAgICAgICAgfTtcblxuICAgICAgICByZXR1cm4gdGhpcztcbiAgICB9XG5cbiAgICB3aGVyZUluKGF0dHJpYnV0ZU5hbWUsIHZhbHVlKSB7XG4gICAgICAgIHRoaXMuYnVpbGRlci5wdXNoKHtcbiAgICAgICAgICAgIGF0dHJpYnV0ZSA6IGF0dHJpYnV0ZU5hbWUsXG4gICAgICAgICAgICB2YWx1ZSA6IHZhbHVlLFxuICAgICAgICAgICAgdHlwZSA6ICdpbidcbiAgICAgICAgfSk7XG5cbiAgICAgICAgcmV0dXJuIHRoaXM7XG4gICAgfVxuXG4gICAgd2hlcmUoYXR0cmlidXRlTmFtZSwgdmFsdWUpIHtcbiAgICAgICAgdGhpcy5idWlsZGVyLnB1c2goe1xuICAgICAgICAgICAgYXR0cmlidXRlIDogYXR0cmlidXRlTmFtZSxcbiAgICAgICAgICAgIHZhbHVlIDogdmFsdWUsXG4gICAgICAgICAgICB0eXBlIDogJ2FuZCdcbiAgICAgICAgfSk7XG5cbiAgICAgICAgcmV0dXJuIHRoaXM7XG4gICAgfVxuXG5cbiAgICBndGUoYXR0cmlidXRlTmFtZSwgdmFsdWUpIHtcbiAgICAgICAgdGhpcy5idWlsZGVyLnB1c2goe1xuICAgICAgICAgICAgYXR0cmlidXRlIDogYXR0cmlidXRlTmFtZSxcbiAgICAgICAgICAgIHZhbHVlIDogdmFsdWUsXG4gICAgICAgICAgICB0eXBlIDogJ2d0ZSdcbiAgICAgICAgfSk7XG5cbiAgICAgICAgcmV0dXJuIHRoaXM7XG4gICAgfVxuXG4gICAgZ3QoYXR0cmlidXRlTmFtZSwgdmFsdWUpIHtcbiAgICAgICAgdGhpcy5idWlsZGVyLnB1c2goe1xuICAgICAgICAgICAgYXR0cmlidXRlIDogYXR0cmlidXRlTmFtZSxcbiAgICAgICAgICAgIHZhbHVlIDogdmFsdWUsXG4gICAgICAgICAgICB0eXBlIDogJ2d0J1xuICAgICAgICB9KTtcblxuICAgICAgICByZXR1cm4gdGhpcztcbiAgICB9XG5cbiAgICBsdGUoYXR0cmlidXRlTmFtZSwgdmFsdWUpIHtcbiAgICAgICAgdGhpcy5idWlsZGVyLnB1c2goe1xuICAgICAgICAgICAgYXR0cmlidXRlIDogYXR0cmlidXRlTmFtZSxcbiAgICAgICAgICAgIHZhbHVlIDogdmFsdWUsXG4gICAgICAgICAgICB0eXBlIDogJ2x0ZSdcbiAgICAgICAgfSk7XG5cbiAgICAgICAgcmV0dXJuIHRoaXM7XG4gICAgfVxuXG4gICAgbHQoYXR0cmlidXRlTmFtZSwgdmFsdWUpIHtcbiAgICAgICAgdGhpcy5idWlsZGVyLnB1c2goe1xuICAgICAgICAgICAgYXR0cmlidXRlIDogYXR0cmlidXRlTmFtZSxcbiAgICAgICAgICAgIHZhbHVlIDogdmFsdWUsXG4gICAgICAgICAgICB0eXBlIDogJ2x0J1xuICAgICAgICB9KTtcblxuICAgICAgICByZXR1cm4gdGhpcztcbiAgICB9XG5cbiAgICBiZXR3ZWVuKGF0dHJpYnV0ZU5hbWUsIHVwcGVyLCBsb3dlcikge1xuICAgICAgICB1cHBwZXIgPSBwYXJzZUZsb2F0KHVwcGVyKTtcbiAgICAgICAgbG93ZXIgPSBwYXJzZUZsb2F0KGxvd2VyKTtcblxuICAgICAgICBpZihpc05hTih1cHBlcikgfHwgaXNOYU4obG93ZXIpKXtcbiAgICAgICAgICAgIHRocm93IFwiQmV0d2VlbiBpcyBvbmx5IGZvciBudW1lcmljIHZhbHVlc1wiO1xuICAgICAgICB9XG5cbiAgICAgICAgdGhpcy5idWlsZGVyLnB1c2goe1xuICAgICAgICAgICAgYXR0cmlidXRlIDogYXR0cmlidXRlTmFtZSxcbiAgICAgICAgICAgIHZhbHVlIDogW3VwcGVyLCBsb3dlcl0sXG4gICAgICAgICAgICB0eXBlIDogJ2JldHdlZW4nXG4gICAgICAgIH0pO1xuXG4gICAgICAgIHJldHVybiB0aGlzO1xuICAgIH1cblxuICAgIHJlbGF0aW9uKG1vZGVsTmFtZSwgdHlwZSwgbG9jYWxLZXksIGZvcmVpZ25LZXksIGZ1bmMsIHByaW1hcnkpIHtcbiAgICAgICAgdGhpcy50YWJsZXMucHVzaChtb2RlbE5hbWUpO1xuXG4gICAgICAgIHRoaXMucmVsYXRpb25zLnB1c2goe1xuICAgICAgICAgICAgbW9kZWxOYW1lIDogbW9kZWxOYW1lLFxuICAgICAgICAgICAgZnVuYyA6IGZ1bmMsXG4gICAgICAgICAgICBsb2NhbEtleSA6IGxvY2FsS2V5LFxuICAgICAgICAgICAgZm9yZWlnbktleSA6IGZvcmVpZ25LZXksXG4gICAgICAgICAgICB0eXBlIDogdHlwZSxcbiAgICAgICAgICAgIHByaW1hcnkgOiBwcmltYXJ5XG4gICAgICAgIH0pO1xuXG4gICAgICAgIHJldHVybiB0aGlzO1xuICAgIH1cblxuICAgIHN0YXRpYyBnZXQgaGVscGVycygpIHtcblxuICAgICAgICByZXR1cm4ge1xuXG4gICAgICAgICAgICBjaGVja05lc3RlZEF0dHJpYnV0ZSAoYXR0cmlidXRlU3RyaW5nLCB2YWx1ZSwgY29uZGl0aW9uKSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIGNvbmRpdGlvbiA9PSBNb2RlbC5oZWxwZXJzLmdldE5lc3RlZEF0dHJpYnV0ZShhdHRyaWJ1dGVTdHJpbmcsIHZhbHVlKVxuICAgICAgICAgICAgfSxcblxuICAgICAgICAgICAgZ2V0TmVzdGVkQXR0cmlidXRlKGF0dHJpYnV0ZVN0cmluZywgdmFsdWUpIHtcbiAgICAgICAgICAgICAgICBsZXQgYXR0cmlidXRlcyA9IGF0dHJpYnV0ZVN0cmluZy5zcGxpdCgnLicpO1xuICAgICAgICAgICAgICAgIGxldCBpO1xuICAgICAgICAgICAgICAgIGxldCBjb250ZW50ID0gdmFsdWU7XG5cbiAgICAgICAgICAgICAgICBmb3IoaSA9IDA7IGkgPCBhdHRyaWJ1dGVzLmxlbmd0aDsgaSsrKSB7XG4gICAgICAgICAgICAgICAgICAgIGlmKGNvbnRlbnRbYXR0cmlidXRlc1tpXV0gPT09IHVuZGVmaW5lZCl7XG4gICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gdW5kZWZpbmVkO1xuICAgICAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICAgICAgICAgY29udGVudCA9IGNvbnRlbnRbYXR0cmlidXRlc1tpXV07XG4gICAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAgICAgcmV0dXJuIGNvbnRlbnQ7XG4gICAgICAgICAgICB9LFxuXG4gICAgICAgICAgICByZXBsYWNlTmVzdGVkVmFsdWVzKGF0dHJpYnV0ZXMsIHZhbHVlKSB7XG4gICAgICAgICAgICAgICAgZm9yKGxldCBhdHRyaWJ1dGUgaW4gYXR0cmlidXRlcykge1xuICAgICAgICAgICAgICAgICAgICB2YWx1ZVthdHRyaWJ1dGVdID0gYXR0cmlidXRlc1thdHRyaWJ1dGVdO1xuICAgICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgICAgIHJldHVybiB2YWx1ZTtcbiAgICAgICAgICAgIH0sXG4gICAgICAgIH07XG5cbiAgICB9XG5cbiAgICBzdGF0aWMgZ2V0IFJFTEFUSU9OUygpIHtcbiAgICAgICAgcmV0dXJuIHtcbiAgICAgICAgICAgIGhhc09uZSA6ICdoYXNPbmUnLFxuICAgICAgICAgICAgaGFzTWFueSA6ICdoYXNNYW55J1xuICAgICAgICB9XG4gICAgfVxufVxuY2xhc3MgV29ya2VyTW9kZWxIYW5kbGVyIGV4dGVuZHMgQnVpbGRlcntcblxuICAgIGNvbnN0cnVjdG9yKG1vZGVsTmFtZSwgd29ya2VyQ29udGVudCkge1xuICAgICAgICBzdXBlcigpO1xuXG4gICAgICAgIHRoaXMubmFtZSA9IG1vZGVsTmFtZTtcbiAgICAgICAgdGhpcy53b3JrZXIgPSB3b3JrZXJDb250ZW50O1xuICAgICAgICB0aGlzLnNldFVwSGFuZGxlcigpO1xuICAgICAgICB0aGlzLnRhYmxlcyA9IFttb2RlbE5hbWVdO1xuICAgIH1cblxuICAgIC8qKlxuICAgICAqIEZpbmRzIHRoZSBtb2RlbCBieSBpZFxuICAgICAqIEBwYXJhbSBpZFxuICAgICAqIEByZXR1cm5zIHtQcm9taXNlfVxuICAgICAqL1xuICAgIGZpbmQoaWQpIHtcbiAgICAgICAgbGV0IG1vZGVsID0gdGhpcztcblxuICAgICAgICByZXR1cm4gbmV3IFByb21pc2UoKHJlc29sdmUsIHJlamVjdCkgPT4ge1xuICAgICAgICAgICAgbGV0IHRpbWVzdGFtcCA9IERhdGUubm93KCk7XG5cbiAgICAgICAgICAgIG1vZGVsLm9uKHRpbWVzdGFtcCwgJ2ZpbmQnLCBoYW5kbGVyKTtcbiAgICAgICAgICAgIG1vZGVsLm9uKHRpbWVzdGFtcCwgJ2ZpbmQtZXJyb3InLCBlcnJvckhhbmRsZXIpO1xuXG4gICAgICAgICAgICBtb2RlbC5zZW5kKGlkLCB0aW1lc3RhbXAsICdmaW5kJyk7XG5cbiAgICAgICAgICAgIC8qKlxuICAgICAgICAgICAgICogbm9ybWFsIHN1Y2Nlc3MgaGFuZGxlclxuICAgICAgICAgICAgICogQHBhcmFtIGVcbiAgICAgICAgICAgICAqL1xuICAgICAgICAgICAgZnVuY3Rpb24gaGFuZGxlcihlKSB7XG4gICAgICAgICAgICAgICAgbW9kZWwucmVtb3ZlTGlzdGVuZXIodGltZXN0YW1wLCAnZmluZCcsIGhhbmRsZXIpO1xuICAgICAgICAgICAgICAgIG1vZGVsLnJlbW92ZUxpc3RlbmVyKHRpbWVzdGFtcCwgJ2ZpbmQtZXJyb3InLCBlcnJvckhhbmRsZXIoKSk7XG5cbiAgICAgICAgICAgICAgICByZXNvbHZlKGUuZGV0YWlsKTtcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgLyoqXG4gICAgICAgICAgICAgKiBFcnJvciBoYW5kbGVyIGNhc2VcbiAgICAgICAgICAgICAqIEBwYXJhbSBlXG4gICAgICAgICAgICAgKi9cbiAgICAgICAgICAgIGZ1bmN0aW9uIGVycm9ySGFuZGxlcihlKSB7XG4gICAgICAgICAgICAgICAgbW9kZWwucmVtb3ZlTGlzdGVuZXIodGltZXN0YW1wLCAnZmluZCcsIGVycm9ySGFuZGxlcik7XG4gICAgICAgICAgICAgICAgbW9kZWwucmVtb3ZlTGlzdGVuZXIodGltZXN0YW1wLCAnZmluZC1lcnJvcicsIGhhbmRsZXIpO1xuICAgICAgICAgICAgICAgIHJlamVjdChlLmRldGFpbCk7XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgfSk7XG4gICAgfVxuXG4gICAgLyoqXG4gICAgICogRnVuY3Rpb24gZmV0Y2hlcyBsaXN0IG9mIHJlc3VsdCBtYXRjaGluZyB0aGUgY3JpdGVyaWFcbiAgICAgKiBAcmV0dXJucyB7UHJvbWlzZX1cbiAgICAgKi9cbiAgICBnZXQoKSB7XG4gICAgICAgIGxldCBtb2RlbCA9IHRoaXM7XG4gICAgICAgIHJldHVybiBuZXcgUHJvbWlzZSgocmVzb2x2ZSwgcmVqZWN0KSA9PiB7XG4gICAgICAgICAgICBsZXQgdGltZXN0YW1wID0gRGF0ZS5ub3coKTtcblxuICAgICAgICAgICAgbW9kZWwub24odGltZXN0YW1wLCAnZ2V0JywgaGFuZGxlcik7XG4gICAgICAgICAgICBtb2RlbC5vbih0aW1lc3RhbXAsICdnZXQtZXJyb3InLCBlcnJvckhhbmRsZXIpO1xuXG4gICAgICAgICAgICBtb2RlbC5zZW5kKHtcbiAgICAgICAgICAgICAgICB0YWJsZXMgOiBtb2RlbC50YWJsZXMsXG4gICAgICAgICAgICAgICAgYnVpbGRlciA6IG1vZGVsLmJ1aWxkZXIsXG4gICAgICAgICAgICAgICAgaW5kZXhCdWlsZGVyIDogbW9kZWwuaW5kZXhCdWlsZGVyLFxuICAgICAgICAgICAgICAgIHJlbGF0aW9ucyA6IG1vZGVsLnJlbGF0aW9uc1xuICAgICAgICAgICAgfSwgdGltZXN0YW1wLCAnZ2V0Jyk7XG5cbiAgICAgICAgICAgIGZ1bmN0aW9uIGhhbmRsZXIoZSkge1xuICAgICAgICAgICAgICAgIG1vZGVsLnJlbW92ZUxpc3RlbmVyKHRpbWVzdGFtcCwgJ2dldCcsIGhhbmRsZXIpO1xuICAgICAgICAgICAgICAgIG1vZGVsLnJlbW92ZUxpc3RlbmVyKHRpbWVzdGFtcCwgJ2dldC1lcnJvcicsIGVycm9ySGFuZGxlcik7XG5cbiAgICAgICAgICAgICAgICByZXNvbHZlKGUuZGV0YWlsKTtcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgZnVuY3Rpb24gZXJyb3JIYW5kbGVyKGUpIHtcbiAgICAgICAgICAgICAgICBtb2RlbC5yZW1vdmVMaXN0ZW5lcih0aW1lc3RhbXAsICdnZXQnLCBlcnJvckhhbmRsZXIpO1xuICAgICAgICAgICAgICAgIG1vZGVsLnJlbW92ZUxpc3RlbmVyKHRpbWVzdGFtcCwgJ2dldC1lcnJvcicsIGhhbmRsZXIpO1xuICAgICAgICAgICAgICAgIHJlamVjdChlLmRldGFpbCk7XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgfSk7XG4gICAgfVxuXG4gICAgLyoqXG4gICAgICogRnVuY3Rpb24gZmV0Y2hlcyBsaXN0IG9mIHJlc3VsdCBtYXRjaGluZyB0aGUgY3JpdGVyaWFcbiAgICAgKiBAcmV0dXJucyB7UHJvbWlzZX1cbiAgICAgKi9cbiAgICBmaXJzdCgpIHtcbiAgICAgICAgbGV0IG1vZGVsID0gdGhpcztcbiAgICAgICAgcmV0dXJuIG5ldyBQcm9taXNlKChyZXNvbHZlLCByZWplY3QpID0+IHtcbiAgICAgICAgICAgIGxldCB0aW1lc3RhbXAgPSBEYXRlLm5vdygpO1xuXG4gICAgICAgICAgICBtb2RlbC5vbih0aW1lc3RhbXAsICdmaXJzdCcsIGhhbmRsZXIpO1xuICAgICAgICAgICAgbW9kZWwub24odGltZXN0YW1wLCAnZmlyc3QtZXJyb3InLCBlcnJvckhhbmRsZXIpO1xuXG4gICAgICAgICAgICBtb2RlbC5zZW5kKHtcbiAgICAgICAgICAgICAgICB0YWJsZXMgOiBtb2RlbC50YWJsZXMsXG4gICAgICAgICAgICAgICAgYnVpbGRlciA6IG1vZGVsLmJ1aWxkZXIsXG4gICAgICAgICAgICAgICAgaW5kZXhCdWlsZGVyIDogbW9kZWwuaW5kZXhCdWlsZGVyLFxuICAgICAgICAgICAgICAgIHJlbGF0aW9ucyA6IG1vZGVsLnJlbGF0aW9uc1xuICAgICAgICAgICAgfSwgdGltZXN0YW1wLCAnZmlyc3QnKTtcblxuICAgICAgICAgICAgZnVuY3Rpb24gaGFuZGxlcihlKSB7XG4gICAgICAgICAgICAgICAgbW9kZWwucmVtb3ZlTGlzdGVuZXIodGltZXN0YW1wLCAnZmlyc3QnLCBoYW5kbGVyKTtcbiAgICAgICAgICAgICAgICBtb2RlbC5yZW1vdmVMaXN0ZW5lcih0aW1lc3RhbXAsICdmaXJzdC1lcnJvcicsIGVycm9ySGFuZGxlcik7XG5cbiAgICAgICAgICAgICAgICByZXNvbHZlKGUuZGV0YWlsKTtcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgZnVuY3Rpb24gZXJyb3JIYW5kbGVyKGUpIHtcbiAgICAgICAgICAgICAgICBtb2RlbC5yZW1vdmVMaXN0ZW5lcih0aW1lc3RhbXAsICdmaXJzdCcsIGVycm9ySGFuZGxlcik7XG4gICAgICAgICAgICAgICAgbW9kZWwucmVtb3ZlTGlzdGVuZXIodGltZXN0YW1wLCAnZmlyc3QtZXJyb3InLCBoYW5kbGVyKTtcbiAgICAgICAgICAgICAgICByZWplY3QoZS5kZXRhaWwpO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgIH0pO1xuICAgIH1cblxuICAgIC8qKlxuICAgICAqIENyZWF0ZXMgYSByZWNvcmRcbiAgICAgKiBAcGFyYW0gZGF0YVxuICAgICAqIEByZXR1cm5zIHtQcm9taXNlfVxuICAgICAqL1xuICAgIGNyZWF0ZShkYXRhKSB7XG4gICAgICAgIGxldCBtb2RlbCA9IHRoaXM7XG4gICAgICAgIHJldHVybiBuZXcgUHJvbWlzZSgocmVzb2x2ZSwgcmVqZWN0KSA9PiB7XG4gICAgICAgICAgICBsZXQgdGltZXN0YW1wID0gRGF0ZS5ub3coKTtcblxuICAgICAgICAgICAgbW9kZWwub24odGltZXN0YW1wLCAnY3JlYXRlJywgaGFuZGxlcik7XG4gICAgICAgICAgICBtb2RlbC5vbih0aW1lc3RhbXAsICdjcmVhdGUtZXJyb3InLCBlcnJvckhhbmRsZXIpO1xuXG4gICAgICAgICAgICBtb2RlbC5zZW5kKGRhdGEsIHRpbWVzdGFtcCwgJ2NyZWF0ZScpO1xuXG4gICAgICAgICAgICBmdW5jdGlvbiBoYW5kbGVyKGUpIHtcbiAgICAgICAgICAgICAgICBtb2RlbC5yZW1vdmVMaXN0ZW5lcih0aW1lc3RhbXAsICdjcmVhdGUnLCBoYW5kbGVyKTtcbiAgICAgICAgICAgICAgICBtb2RlbC5yZW1vdmVMaXN0ZW5lcih0aW1lc3RhbXAsICdjcmVhdGUtZXJyb3InLCBlcnJvckhhbmRsZXIpO1xuXG4gICAgICAgICAgICAgICAgcmVzb2x2ZShlLmRldGFpbCk7XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIGZ1bmN0aW9uIGVycm9ySGFuZGxlcihlKSB7XG4gICAgICAgICAgICAgICAgbW9kZWwucmVtb3ZlTGlzdGVuZXIodGltZXN0YW1wLCAnY3JlYXRlJywgZXJyb3JIYW5kbGVyKTtcbiAgICAgICAgICAgICAgICBtb2RlbC5yZW1vdmVMaXN0ZW5lcih0aW1lc3RhbXAsICdjcmVhdGUtZXJyb3InLCBoYW5kbGVyKTtcbiAgICAgICAgICAgICAgICByZWplY3QoZS5kZXRhaWwpO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgIH0pO1xuICAgIH1cblxuICAgIC8qKlxuICAgICAqIENyZWF0ZXMgbXVsdGlwbGUgcmVjb3Jkc1xuICAgICAqIEBwYXJhbSBkYXRhIEFycmF5XG4gICAgICogQHJldHVybnMge1Byb21pc2V9XG4gICAgICovXG4gICAgY3JlYXRlTXVsdGlwbGUoZGF0YSkge1xuICAgICAgICBsZXQgbW9kZWwgPSB0aGlzO1xuICAgICAgICByZXR1cm4gbmV3IFByb21pc2UoKHJlc29sdmUsIHJlamVjdCkgPT4ge1xuICAgICAgICAgICAgbGV0IHRpbWVzdGFtcCA9IERhdGUubm93KCk7XG5cbiAgICAgICAgICAgIG1vZGVsLm9uKHRpbWVzdGFtcCwgJ2NyZWF0ZU11bHRpcGxlJywgaGFuZGxlcik7XG4gICAgICAgICAgICBtb2RlbC5vbih0aW1lc3RhbXAsICdjcmVhdGVNdWx0aXBsZS1lcnJvcicsIGVycm9ySGFuZGxlcik7XG5cbiAgICAgICAgICAgIG1vZGVsLnNlbmQoZGF0YSwgdGltZXN0YW1wLCAnY3JlYXRlTXVsdGlwbGUnKTtcblxuICAgICAgICAgICAgZnVuY3Rpb24gaGFuZGxlcihlKSB7XG4gICAgICAgICAgICAgICAgbW9kZWwucmVtb3ZlTGlzdGVuZXIodGltZXN0YW1wLCAnY3JlYXRlTXVsdGlwbGUnLCBoYW5kbGVyKTtcbiAgICAgICAgICAgICAgICBtb2RlbC5yZW1vdmVMaXN0ZW5lcih0aW1lc3RhbXAsICdjcmVhdGVNdWx0aXBsZS1lcnJvcicsIGVycm9ySGFuZGxlcik7XG5cbiAgICAgICAgICAgICAgICByZXNvbHZlKGUuZGV0YWlsKTtcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgZnVuY3Rpb24gZXJyb3JIYW5kbGVyKGUpIHtcbiAgICAgICAgICAgICAgICBtb2RlbC5yZW1vdmVMaXN0ZW5lcih0aW1lc3RhbXAsICdjcmVhdGVNdWx0aXBsZScsIGVycm9ySGFuZGxlcik7XG4gICAgICAgICAgICAgICAgbW9kZWwucmVtb3ZlTGlzdGVuZXIodGltZXN0YW1wLCAnY3JlYXRlTXVsdGlwbGUtZXJyb3InLCBoYW5kbGVyKTtcbiAgICAgICAgICAgICAgICByZWplY3QoZS5kZXRhaWwpO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgIH0pO1xuICAgIH1cblxuICAgIC8qKlxuICAgICAqIEZ1bmN0aW9uIHVwZGF0ZXMgdGhlIHZhcmlvdXMgcmVjb3JkcyB3aXRoIG1hdGNoaW5nIHZhbHVlc1xuICAgICAqIEBwYXJhbSBkYXRhXG4gICAgICogQHJldHVybnMge1Byb21pc2V9XG4gICAgICovXG4gICAgdXBkYXRlKGRhdGEpIHtcbiAgICAgICAgbGV0IG1vZGVsID0gdGhpcztcbiAgICAgICAgcmV0dXJuIG5ldyBQcm9taXNlKChyZXNvbHZlLCByZWplY3QpID0+IHtcbiAgICAgICAgICAgIGxldCB0aW1lc3RhbXAgPSBEYXRlLm5vdygpO1xuXG4gICAgICAgICAgICBtb2RlbC5vbih0aW1lc3RhbXAsICd1cGRhdGUnLCBoYW5kbGVyKTtcbiAgICAgICAgICAgIG1vZGVsLm9uKHRpbWVzdGFtcCwgJ3VwZGF0ZS1lcnJvcicsIGVycm9ySGFuZGxlcik7XG5cbiAgICAgICAgICAgIG1vZGVsLnNlbmQoZGF0YSwgdGltZXN0YW1wLCAndXBkYXRlJyk7XG5cbiAgICAgICAgICAgIGZ1bmN0aW9uIGhhbmRsZXIoZSkge1xuICAgICAgICAgICAgICAgIG1vZGVsLnJlbW92ZUxpc3RlbmVyKHRpbWVzdGFtcCwgJ3VwZGF0ZScsIGhhbmRsZXIpO1xuICAgICAgICAgICAgICAgIG1vZGVsLnJlbW92ZUxpc3RlbmVyKHRpbWVzdGFtcCwgJ3VwZGF0ZS1lcnJvcicsIGVycm9ySGFuZGxlcik7XG5cbiAgICAgICAgICAgICAgICByZXNvbHZlKGUuZGV0YWlsKTtcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgZnVuY3Rpb24gZXJyb3JIYW5kbGVyKGUpIHtcbiAgICAgICAgICAgICAgICBtb2RlbC5yZW1vdmVMaXN0ZW5lcih0aW1lc3RhbXAsICd1cGRhdGUnLCBlcnJvckhhbmRsZXIpO1xuICAgICAgICAgICAgICAgIG1vZGVsLnJlbW92ZUxpc3RlbmVyKHRpbWVzdGFtcCwgJ3VwZGF0ZS1lcnJvcicsIGhhbmRsZXIpO1xuICAgICAgICAgICAgICAgIHJlamVjdChlLmRldGFpbCk7XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgfSk7XG4gICAgfVxuXG4gICAgLyoqXG4gICAgICogRnVuY3Rpb24gdXBkYXRlcyB0aGUgcmVjb3JkIGF0IHRoZSBnaXZlbiBpZFxuICAgICAqIEBwYXJhbSBpZFxuICAgICAqIEBwYXJhbSBkYXRhXG4gICAgICogQHJldHVybnMge1Byb21pc2V9XG4gICAgICovXG4gICAgc2F2ZShpZCwgZGF0YSkge1xuICAgICAgICBsZXQgbW9kZWwgPSB0aGlzO1xuICAgICAgICByZXR1cm4gbmV3IFByb21pc2UoKHJlc29sdmUsIHJlamVjdCkgPT4ge1xuXG4gICAgICAgICAgICBsZXQgdGltZXN0YW1wID0gRGF0ZS5ub3coKTtcbiAgICAgICAgICAgIGxldCBjb250ZW50ID0ge1xuICAgICAgICAgICAgICAgIGlkIDogaWQsXG4gICAgICAgICAgICAgICAgZGF0YSA6IGRhdGFcbiAgICAgICAgICAgIH07XG5cbiAgICAgICAgICAgIG1vZGVsLm9uKHRpbWVzdGFtcCwgJ3NhdmUnLCBoYW5kbGVyKTtcbiAgICAgICAgICAgIG1vZGVsLm9uKHRpbWVzdGFtcCwgJ3NhdmUtZXJyb3InLCBlcnJvckhhbmRsZXIpO1xuICAgICAgICAgICAgbW9kZWwuc2VuZChjb250ZW50LCB0aW1lc3RhbXAsICdzYXZlJyk7XG5cbiAgICAgICAgICAgIGZ1bmN0aW9uIGhhbmRsZXIoZSkge1xuICAgICAgICAgICAgICAgIG1vZGVsLnJlbW92ZUxpc3RlbmVyKHRpbWVzdGFtcCwgJ3NhdmUnLCBoYW5kbGVyKTtcbiAgICAgICAgICAgICAgICBtb2RlbC5yZW1vdmVMaXN0ZW5lcih0aW1lc3RhbXAsICdzYXZlLWVycm9yJywgZXJyb3JIYW5kbGVyKTtcblxuICAgICAgICAgICAgICAgIHJlc29sdmUoZS5kZXRhaWwpO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICBmdW5jdGlvbiBlcnJvckhhbmRsZXIoZSkge1xuICAgICAgICAgICAgICAgIG1vZGVsLnJlbW92ZUxpc3RlbmVyKHRpbWVzdGFtcCwgJ3NhdmUnLCBlcnJvckhhbmRsZXIpO1xuICAgICAgICAgICAgICAgIG1vZGVsLnJlbW92ZUxpc3RlbmVyKHRpbWVzdGFtcCwgJ3NhdmUtZXJyb3InLCBoYW5kbGVyKTtcbiAgICAgICAgICAgICAgICByZWplY3QoZS5kZXRhaWwpO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgIH0pO1xuICAgIH1cblxuICAgIC8qKlxuICAgICAqIEZ1bmN0aW9uIGRlbGV0ZXMgdGhlIGVudHJpZXMgYXQgdGhlIGdpdmVuIHBvaW50XG4gICAgICogQHBhcmFtIGlkXG4gICAgICogQHJldHVybnMge1Byb21pc2V9XG4gICAgICovXG4gICAgZGVzdHJveUlkKGlkKSB7XG4gICAgICAgIGxldCBtb2RlbCA9IHRoaXM7XG4gICAgICAgIHJldHVybiBuZXcgUHJvbWlzZSgocmVzb2x2ZSwgcmVqZWN0KSA9PiB7XG5cbiAgICAgICAgICAgIGxldCB0aW1lc3RhbXAgPSBEYXRlLm5vdygpO1xuXG4gICAgICAgICAgICBtb2RlbC5vbih0aW1lc3RhbXAsICdkZXN0cm95SWQnLCBoYW5kbGVyKTtcbiAgICAgICAgICAgIG1vZGVsLm9uKHRpbWVzdGFtcCwgJ2Rlc3Ryb3lJZC1lcnJvcicsIGVycm9ySGFuZGxlcik7XG4gICAgICAgICAgICBtb2RlbC5zZW5kKGlkLCB0aW1lc3RhbXAsICdkZXN0cm95SWQnKTtcblxuICAgICAgICAgICAgZnVuY3Rpb24gaGFuZGxlcihlKSB7XG4gICAgICAgICAgICAgICAgbW9kZWwucmVtb3ZlTGlzdGVuZXIodGltZXN0YW1wLCAnZGVzdHJveUlkJywgaGFuZGxlcik7XG4gICAgICAgICAgICAgICAgbW9kZWwucmVtb3ZlTGlzdGVuZXIodGltZXN0YW1wLCAnZGVzdHJveUlkLWVycm9yJywgZXJyb3JIYW5kbGVyKTtcblxuICAgICAgICAgICAgICAgIHJlc29sdmUoZS5kZXRhaWwpO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICBmdW5jdGlvbiBlcnJvckhhbmRsZXIoZSkge1xuICAgICAgICAgICAgICAgIG1vZGVsLnJlbW92ZUxpc3RlbmVyKHRpbWVzdGFtcCwgJ2Rlc3Ryb3lJZCcsIGVycm9ySGFuZGxlcik7XG4gICAgICAgICAgICAgICAgbW9kZWwucmVtb3ZlTGlzdGVuZXIodGltZXN0YW1wLCAnZGVzdHJveUlkLWVycm9yJywgaGFuZGxlcik7XG4gICAgICAgICAgICAgICAgcmVqZWN0KGUuZGV0YWlsKTtcbiAgICAgICAgICAgIH1cblxuICAgICAgICB9KTtcbiAgICB9XG5cbiAgICAvKipcbiAgICAgKiBGdW5jdGlvbiBkZWxldGVzIHRoZSBlbnRyaWVzXG4gICAgICogQHJldHVybnMge1Byb21pc2V9XG4gICAgICovXG4gICAgZGVzdHJveSgpIHtcbiAgICAgICAgbGV0IG1vZGVsID0gdGhpcztcbiAgICAgICAgcmV0dXJuIG5ldyBQcm9taXNlKChyZXNvbHZlLCByZWplY3QpID0+IHtcblxuICAgICAgICAgICAgbGV0IHRpbWVzdGFtcCA9IERhdGUubm93KCk7XG5cbiAgICAgICAgICAgIG1vZGVsLm9uKHRpbWVzdGFtcCwgJ2Rlc3Ryb3knLCBoYW5kbGVyKTtcbiAgICAgICAgICAgIG1vZGVsLm9uKHRpbWVzdGFtcCwgJ2Rlc3Ryb3ktZXJyb3InLCBlcnJvckhhbmRsZXIpO1xuICAgICAgICAgICAgbW9kZWwuc2VuZCh7fSwgdGltZXN0YW1wLCAnZGVzdHJveScpO1xuXG4gICAgICAgICAgICBmdW5jdGlvbiBoYW5kbGVyKGUpIHtcbiAgICAgICAgICAgICAgICBtb2RlbC5yZW1vdmVMaXN0ZW5lcih0aW1lc3RhbXAsICdkZXN0cm95JywgaGFuZGxlcik7XG4gICAgICAgICAgICAgICAgbW9kZWwucmVtb3ZlTGlzdGVuZXIodGltZXN0YW1wLCAnZGVzdHJveS1lcnJvcicsIGVycm9ySGFuZGxlcik7XG5cbiAgICAgICAgICAgICAgICByZXNvbHZlKGUuZGV0YWlsKTtcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgZnVuY3Rpb24gZXJyb3JIYW5kbGVyKGUpIHtcbiAgICAgICAgICAgICAgICBtb2RlbC5yZW1vdmVMaXN0ZW5lcih0aW1lc3RhbXAsICdkZXN0cm95JywgZXJyb3JIYW5kbGVyKTtcbiAgICAgICAgICAgICAgICBtb2RlbC5yZW1vdmVMaXN0ZW5lcih0aW1lc3RhbXAsICdkZXN0cm95LWVycm9yJywgaGFuZGxlcik7XG4gICAgICAgICAgICAgICAgcmVqZWN0KGUuZGV0YWlsKTtcbiAgICAgICAgICAgIH1cblxuICAgICAgICB9KTtcbiAgICB9XG5cbiAgICAvKipcbiAgICAgKiBGdW5jdGlvbiBjb3VudHMgdGhlIG51bWJlciBvZiByZWNvcmRzXG4gICAgICogQHJldHVybnMge1Byb21pc2V9XG4gICAgICovXG4gICAgY291bnQoKSB7XG4gICAgICAgIGxldCBtb2RlbCA9IHRoaXM7XG4gICAgICAgIHJldHVybiBuZXcgUHJvbWlzZSgocmVzb2x2ZSwgcmVqZWN0KSA9PiB7XG4gICAgICAgICAgICBsZXQgdGltZXN0YW1wID0gRGF0ZS5ub3coKTtcblxuICAgICAgICAgICAgbW9kZWwub24odGltZXN0YW1wLCAnY291bnQnLCBoYW5kbGVyKTtcbiAgICAgICAgICAgIG1vZGVsLm9uKHRpbWVzdGFtcCwgJ2NvdW50LWVycm9yJywgZXJyb3JIYW5kbGVyKTtcblxuICAgICAgICAgICAgbW9kZWwuc2VuZCh7fSwgdGltZXN0YW1wLCAnY291bnQnKTtcblxuICAgICAgICAgICAgZnVuY3Rpb24gaGFuZGxlcihlKSB7XG4gICAgICAgICAgICAgICAgbW9kZWwucmVtb3ZlTGlzdGVuZXIodGltZXN0YW1wLCAnY291bnQnLCBoYW5kbGVyKTtcbiAgICAgICAgICAgICAgICBtb2RlbC5yZW1vdmVMaXN0ZW5lcih0aW1lc3RhbXAsICdjb3VudC1lcnJvcicsIGVycm9ySGFuZGxlcik7XG5cbiAgICAgICAgICAgICAgICByZXNvbHZlKGUuZGV0YWlsKTtcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgZnVuY3Rpb24gZXJyb3JIYW5kbGVyKGUpIHtcbiAgICAgICAgICAgICAgICBtb2RlbC5yZW1vdmVMaXN0ZW5lcih0aW1lc3RhbXAsICdjb3VudCcsIGVycm9ySGFuZGxlcik7XG4gICAgICAgICAgICAgICAgbW9kZWwucmVtb3ZlTGlzdGVuZXIodGltZXN0YW1wLCAnY291bnQtZXJyb3InLCBoYW5kbGVyKTtcbiAgICAgICAgICAgICAgICByZWplY3QoZS5kZXRhaWwpO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgIH0pO1xuICAgIH1cblxuICAgIGF2ZXJhZ2UoYXR0cmlidXRlKSB7XG4gICAgICAgIGxldCBtb2RlbCA9IHRoaXM7XG4gICAgICAgIHJldHVybiBuZXcgUHJvbWlzZSgocmVzb2x2ZSwgcmVqZWN0KSA9PiB7XG4gICAgICAgICAgICBsZXQgdGltZXN0YW1wID0gRGF0ZS5ub3coKTtcblxuICAgICAgICAgICAgbW9kZWwub24odGltZXN0YW1wLCAnYXZlcmFnZScsIGhhbmRsZXIpO1xuICAgICAgICAgICAgbW9kZWwub24odGltZXN0YW1wLCAnYXZlcmFnZS1lcnJvcicsIGVycm9ySGFuZGxlcik7XG5cbiAgICAgICAgICAgIG1vZGVsLnNlbmQoYXR0cmlidXRlLCB0aW1lc3RhbXAsICdhdmVyYWdlJyk7XG5cbiAgICAgICAgICAgIGZ1bmN0aW9uIGhhbmRsZXIoZSkge1xuICAgICAgICAgICAgICAgIG1vZGVsLnJlbW92ZUxpc3RlbmVyKHRpbWVzdGFtcCwgJ2F2ZXJhZ2UnLCBoYW5kbGVyKTtcbiAgICAgICAgICAgICAgICBtb2RlbC5yZW1vdmVMaXN0ZW5lcih0aW1lc3RhbXAsICdhdmVyYWdlLWVycm9yJywgZXJyb3JIYW5kbGVyKTtcblxuICAgICAgICAgICAgICAgIHJlc29sdmUoZS5kZXRhaWwpO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICBmdW5jdGlvbiBlcnJvckhhbmRsZXIoZSkge1xuICAgICAgICAgICAgICAgIG1vZGVsLnJlbW92ZUxpc3RlbmVyKHRpbWVzdGFtcCwgJ2F2ZXJhZ2UnLCBlcnJvckhhbmRsZXIpO1xuICAgICAgICAgICAgICAgIG1vZGVsLnJlbW92ZUxpc3RlbmVyKHRpbWVzdGFtcCwgJ2F2ZXJhZ2UtZXJyb3InLCBoYW5kbGVyKTtcbiAgICAgICAgICAgICAgICByZWplY3QoZS5kZXRhaWwpO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgIH0pO1xuICAgIH1cblxuICAgIC8qKlxuICAgICAqIFJlZHVjZSBmdW5jdGlvbiBpcyBjYWxsZWQgd2l0aCBlYWNoIHBhc3NpbmcgaXRlcmF0b3IgdmFsdWUgYW5kIHJlZHVjZWQgdmFsdWUgaXMgcmV0dXJuZWRcbiAgICAgKiBAcGFyYW0gZnVuY1xuICAgICAqIEBwYXJhbSBkZWZhdWx0Q2FycnlcbiAgICAgKiBAcmV0dXJucyB7UHJvbWlzZX1cbiAgICAgKi9cbiAgICByZWR1Y2UoZnVuYywgZGVmYXVsdENhcnJ5KSB7XG4gICAgICAgIGxldCBtb2RlbCA9IHRoaXM7XG4gICAgICAgIHJldHVybiBuZXcgUHJvbWlzZSgocmVzb2x2ZSwgcmVqZWN0KSA9PiB7XG4gICAgICAgICAgICBsZXQgdGltZXN0YW1wID0gRGF0ZS5ub3coKTtcblxuICAgICAgICAgICAgbW9kZWwub24odGltZXN0YW1wLCAncmVkdWNlJywgaGFuZGxlcik7XG4gICAgICAgICAgICBtb2RlbC5vbih0aW1lc3RhbXAsICdyZWR1Y2UtZXJyb3InLCBlcnJvckhhbmRsZXIpO1xuXG4gICAgICAgICAgICBsZXQgZGF0YSA9IHtcbiAgICAgICAgICAgICAgICBmdW5jIDogZnVuYyxcbiAgICAgICAgICAgICAgICBkZWZhdWx0Q2FycnkgOiBkZWZhdWx0Q2FycnlcbiAgICAgICAgICAgIH07XG5cbiAgICAgICAgICAgIG1vZGVsLnNlbmQoZGF0YSwgdGltZXN0YW1wLCAncmVkdWNlJyk7XG5cbiAgICAgICAgICAgIGZ1bmN0aW9uIGhhbmRsZXIoZSkge1xuICAgICAgICAgICAgICAgIG1vZGVsLnJlbW92ZUxpc3RlbmVyKHRpbWVzdGFtcCwgJ3JlZHVjZScsIGhhbmRsZXIpO1xuICAgICAgICAgICAgICAgIG1vZGVsLnJlbW92ZUxpc3RlbmVyKHRpbWVzdGFtcCwgJ3JlZHVjZS1lcnJvcicsIGVycm9ySGFuZGxlcik7XG5cbiAgICAgICAgICAgICAgICByZXNvbHZlKGUuZGV0YWlsKTtcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgZnVuY3Rpb24gZXJyb3JIYW5kbGVyKGUpIHtcbiAgICAgICAgICAgICAgICBtb2RlbC5yZW1vdmVMaXN0ZW5lcih0aW1lc3RhbXAsICdyZWR1Y2UnLCBlcnJvckhhbmRsZXIpO1xuICAgICAgICAgICAgICAgIG1vZGVsLnJlbW92ZUxpc3RlbmVyKHRpbWVzdGFtcCwgJ3JlZHVjZS1lcnJvcicsIGhhbmRsZXIpO1xuICAgICAgICAgICAgICAgIHJlamVjdChlLmRldGFpbCk7XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgfSk7XG4gICAgfVxuXG4gICAgLyoqXG4gICAgICogQ29tbXVuaWNhdGVzIHRvIHdlYndvcmtlclxuICAgICAqIEBwYXJhbSBkYXRhXG4gICAgICogQHBhcmFtIHRpbWVzdGFtcFxuICAgICAqIEBwYXJhbSBhY3Rpb25cbiAgICAgKi9cbiAgICBzZW5kKGRhdGEsIHRpbWVzdGFtcCwgYWN0aW9uKSB7XG4gICAgICAgIGxldCBtb2RlbCA9IHRoaXM7XG5cbiAgICAgICAgbGV0IGRldGFpbCA9IEpTT04uc3RyaW5naWZ5KGRhdGEsIChrZXksIHZhbHVlKSA9PiB7XG4gICAgICAgICAgICByZXR1cm4gKHR5cGVvZiB2YWx1ZSA9PT0gJ2Z1bmN0aW9uJyApID8gdmFsdWUudG9TdHJpbmcoKSA6IHZhbHVlO1xuICAgICAgICB9KTtcblxuICAgICAgICBsZXQgZSA9IHtcbiAgICAgICAgICAgIGRldGFpbCA6IGRldGFpbCxcbiAgICAgICAgICAgIGFjdGlvbiA6IGFjdGlvbixcbiAgICAgICAgICAgIHRpbWVzdGFtcCA6IHRpbWVzdGFtcCxcbiAgICAgICAgICAgIG1vZGVsIDogbW9kZWwubmFtZVxuICAgICAgICB9O1xuXG4gICAgICAgIG1vZGVsLndvcmtlci5wb3N0TWVzc2FnZShlKTtcbiAgICB9XG5cbiAgICAvKipcbiAgICAgKiBTZXRzIHVwIGJhc2ljIGhhbmRsZXIgc2V0dGluZ3MgdG8gcmVjZWl2ZSBtZXNzYWdlcyBmcm9tIHdvcmtlclxuICAgICAqL1xuICAgIHNldFVwSGFuZGxlciAoKSB7XG4gICAgICAgIGxldCBtb2RlbCA9IHRoaXM7XG5cbiAgICAgICAgLy9nZW5lcmFsIGhhbmRsZXIgdG8gYWN0IHVwIG1lc3NhZ2VzIHNlbnQgZnJvbSB3ZWIgd29ya2VyXG4gICAgICAgIG1vZGVsLndvcmtlci5vbm1lc3NhZ2UgPSBmdW5jdGlvbihlKSB7XG4gICAgICAgICAgICBsZXQgZGF0YSA9IGUuZGF0YS5kZXRhaWw7XG4gICAgICAgICAgICBtb2RlbC5lbWl0KGRhdGEsIGUuZGF0YS50aW1lc3RhbXAsIGUuZGF0YS5hY3Rpb24pO1xuXG4gICAgICAgIH1cbiAgICB9XG5cbiAgICAvKipcbiAgICAgKiBOb3JtYWwgZW1pdCBldmVudCBvbiB3aW5kb3cuZG9jdW1lbnRcbiAgICAgKlxuICAgICAqIEBwYXJhbSBkYXRhXG4gICAgICogQHBhcmFtIHRpbWVzdGFtcFxuICAgICAqIEBwYXJhbSBhY3Rpb25cbiAgICAgKi9cbiAgICBlbWl0IChkYXRhLCB0aW1lc3RhbXAsIGFjdGlvbikge1xuICAgICAgICBsZXQgbW9kZWwgPSB0aGlzO1xuICAgICAgICBsZXQgZSA9IG5ldyBDdXN0b21FdmVudCgnaWRiOndvcmtlcjonICsgbW9kZWwubW9kZU5hbWUgKyAnOicgKyB0aW1lc3RhbXAgKyAnOicgKyBhY3Rpb24sIHtcbiAgICAgICAgICAgIGRldGFpbCA6IGRhdGFcbiAgICAgICAgfSk7XG5cbiAgICAgICAgd2luZG93LmRvY3VtZW50LmRpc3BhdGNoRXZlbnQoZSk7XG4gICAgfVxuXG4gICAgLyoqXG4gICAgICogUmVtb3ZlcyBldmVudCBsaXN0ZW5lciBmcm9tIHdpbmRvdy5kb2N1bWVudFxuICAgICAqXG4gICAgICogQHBhcmFtIHRpbWVzdGFtcFxuICAgICAqIEBwYXJhbSBhY3Rpb25cbiAgICAgKiBAcGFyYW0gZnVuY1xuICAgICAqL1xuICAgIHJlbW92ZUxpc3RlbmVyKHRpbWVzdGFtcCwgYWN0aW9uLCBmdW5jKSB7XG4gICAgICAgIHdpbmRvdy5kb2N1bWVudC5yZW1vdmVFdmVudExpc3RlbmVyKCdpZGI6d29ya2VyOicgKyB0aGlzLm1vZGVOYW1lICsgJzonICsgdGltZXN0YW1wICsgJzonICsgYWN0aW9uLCBmdW5jKTtcbiAgICB9XG5cbiAgICAvKipcbiAgICAgKiBMaXN0ZW5zIGV2ZW50cyBvbiB3aW5kb3cuZG9jdW1lbnRcbiAgICAgKlxuICAgICAqIEBwYXJhbSB0aW1lc3RhbXAgZGF0ZSB0aW1lIHN0YW1wXG4gICAgICogQHBhcmFtIGFjdGlvbiBhY3Rpb24gbmFtZVxuICAgICAqIEBwYXJhbSBmdW5jIGZ1bmN0aW9uIHRvIGJlIGV4ZWN1dGVkXG4gICAgICovXG4gICAgb24odGltZXN0YW1wLCBhY3Rpb24sIGZ1bmMpIHtcbiAgICAgICAgd2luZG93LmRvY3VtZW50LmFkZEV2ZW50TGlzdGVuZXIoJ2lkYjp3b3JrZXI6JyArIHRoaXMubW9kZU5hbWUgKyAnOicgKyB0aW1lc3RhbXAgKyAnOicgKyBhY3Rpb24sIGZ1bmMpO1xuICAgIH1cbn1cbmNsYXNzIE1vZGVsIGV4dGVuZHMgQnVpbGRlcntcblxuICAgIGNvbnN0cnVjdG9yKGRiLCBpZGJLZXksIG1vZGVsTmFtZSwgcHJpbWFyeSl7XG4gICAgICAgIHN1cGVyKCk7XG5cbiAgICAgICAgdGhpcy5uYW1lID0gbW9kZWxOYW1lO1xuICAgICAgICB0aGlzLmRiID0gZGI7XG4gICAgICAgIHRoaXMucHJpbWFyeSA9IHByaW1hcnk7XG4gICAgICAgIHRoaXMudGFibGVzID0gW3RoaXMubmFtZV07XG4gICAgICAgIHRoaXMuaWRiS2V5ID0gaWRiS2V5O1xuICAgICAgICB0aGlzLmhhc0lkYktleSA9IHRoaXMuaWRiS2V5ID8gdHJ1ZSA6IGZhbHNlO1xuICAgICAgICB0aGlzLnRyYW5zYWN0aW9uID0gbnVsbDtcbiAgICAgICAgdGhpcy5hdHRyaWJ1dGVzID0ge307XG4gICAgfVxuXG4gICAgLyoqXG4gICAgICogRmluZHMgdGhlIHJlc3VsdCBvbiB0aGUgcHJpbWFyeSBrZXkgZGVmaW5lZFxuICAgICAqIEBwYXJhbSBpZFxuICAgICAqIEByZXR1cm5zIHtQcm9taXNlfVxuICAgICAqL1xuICAgIGZpbmQoaWQpIHtcbiAgICAgICAgbGV0IG1vZGVsID0gdGhpcztcblxuICAgICAgICByZXR1cm4gbmV3IFByb21pc2UoKHJlc29sdmUsIHJlamVjdCkgPT4ge1xuICAgICAgICAgICAgbGV0IHRyYW5zYWN0aW9uID0gbW9kZWwuZ2V0VHJhbnNhY3Rpb24obW9kZWwudGFibGVzLCBNb2RlbC5SRUFET05MWSk7XG4gICAgICAgICAgICBsZXQgb2JqID0gdHJhbnNhY3Rpb24ub2JqZWN0U3RvcmUobW9kZWwubmFtZSk7XG4gICAgICAgICAgICBsZXQgcmVxdWVzdCA9IG9iai5nZXQoaWQpO1xuICAgICAgICAgICAgXG4gICAgICAgICAgICByZXF1ZXN0Lm9uc3VjY2VzcyA9IGZ1bmN0aW9uIChlKSB7XG4gICAgICAgICAgICAgICAgcmVzb2x2ZShlLnRhcmdldC5yZXN1bHQpO1xuICAgICAgICAgICAgfTtcblxuICAgICAgICAgICAgcmVxdWVzdC5vbmVycm9yID0gZnVuY3Rpb24gKGUpIHtcbiAgICAgICAgICAgICAgICByZWplY3QoZSk7XG4gICAgICAgICAgICB9O1xuXG4gICAgICAgIH0pO1xuICAgIH1cblxuICAgIC8qKlxuICAgICAqIFNlYXJjaGVzIGZvciBmaXJzdCB2YWx1ZSBpbiBkYXRhYmFzZSBhbmQgcmV0dXJucyB0aGF0XG4gICAgICogQHJldHVybnMge1Byb21pc2V9XG4gICAgICovXG4gICAgZmlyc3QoKSB7XG4gICAgICAgIGxldCBtb2RlbCA9IHRoaXM7XG5cbiAgICAgICAgcmV0dXJuIG5ldyBQcm9taXNlKChyZXNvbHZlLCByZWplY3QpID0+IHtcbiAgICAgICAgICAgIGxldCB0cmFuc2FjdGlvbiA9IG1vZGVsLmdldFRyYW5zYWN0aW9uKG1vZGVsLnRhYmxlcywgTW9kZWwuUkVBRE9OTFkpO1xuICAgICAgICAgICAgbGV0IG9iaiA9IHRyYW5zYWN0aW9uLm9iamVjdFN0b3JlKG1vZGVsLm5hbWUpO1xuICAgICAgICAgICAgbGV0IHJlc3VsdCA9IG51bGw7XG4gICAgICAgICAgICBsZXQgcmVxdWVzdDtcblxuICAgICAgICAgICAgaWYobW9kZWwuaW5kZXhCdWlsZGVyLnR5cGUpe1xuICAgICAgICAgICAgICAgIHJlcXVlc3QgPSBtb2RlbC5nZXRJbmRleFJlc3VsdChvYmopO1xuICAgICAgICAgICAgfWVsc2V7XG4gICAgICAgICAgICAgICAgcmVxdWVzdCA9IG9iai5vcGVuQ3Vyc29yKCk7XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIHJlcXVlc3Qub25zdWNjZXNzID0gZnVuY3Rpb24gKGUpIHtcbiAgICAgICAgICAgICAgICBsZXQgY3Vyc29yID0gZS50YXJnZXQucmVzdWx0O1xuXG4gICAgICAgICAgICAgICAgaWYoY3Vyc29yKXtcbiAgICAgICAgICAgICAgICAgICAgaWYobW9kZWwuY2hlY2tCdWlsZGVyVmFsdWUoY3Vyc29yLnZhbHVlKSl7XG4gICAgICAgICAgICAgICAgICAgICAgICBsZXQgcmVsYXRpb25zQ29tcGxldGVkID0gMDtcblxuICAgICAgICAgICAgICAgICAgICAgICAgcmVzdWx0ID0gY3Vyc29yLnZhbHVlO1xuXG4gICAgICAgICAgICAgICAgICAgICAgICBpZihtb2RlbC5yZWxhdGlvbnMubGVuZ3RoID4gMCAmJiAocmVzdWx0ICE9PSBudWxsIHx8IHJlc3VsdCAhPT0gdW5kZWZpbmVkKSl7XG5cblxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIG1vZGVsLnJlbGF0aW9ucy5mb3JFYWNoKChyZWxhdGlvbikgPT4ge1xuXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGxldCByZWxhdGlvblJlcXVlc3QgPSBtb2RlbC5nZXRSZWxhdGlvbnNoaXBzKHJlbGF0aW9uLCBtb2RlbC50cmFuc2FjdGlvbiwgbW9kZWwuZ2V0TWFpblJlc3VsdChyZXN1bHQsIHJlbGF0aW9uLmxvY2FsS2V5LCBmYWxzZSksIGZhbHNlKTtcblxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICByZWxhdGlvblJlcXVlc3QudGhlbigocmVsYXRpb25SZXN1bHQpID0+IHtcblxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcmVsYXRpb25zQ29tcGxldGVkKys7XG5cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGxldCBkZWZhdWx0VmFsdWUgPSBtb2RlbC5nZXREZWZhdWx0UmVsYXRpb25WYWx1ZShyZWxhdGlvbi50eXBlKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJlc3VsdFtyZWxhdGlvbi5tb2RlbE5hbWVdID0gcmVzdWx0W3JlbGF0aW9uLm1vZGVsTmFtZV0gfHwgZGVmYXVsdFZhbHVlO1xuXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBzd2l0Y2ggKHJlbGF0aW9uLnR5cGUpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjYXNlIE1vZGVsLlJFTEFUSU9OUy5oYXNPbmUgOlxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAocmVsYXRpb25SZXN1bHQgIT09IHVuZGVmaW5lZCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcmVzdWx0W3JlbGF0aW9uLm1vZGVsTmFtZV0gPSByZWxhdGlvblJlc3VsdFtyZWxhdGlvbi5mb3JlaWduS2V5XSA9PSByZXN1bHRbcmVsYXRpb24ubG9jYWxLZXldID8gcmVsYXRpb25SZXN1bHQgOiByZXN1bHRbcmVsYXRpb24ubW9kZWxOYW1lXTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNhc2UgTW9kZWwuUkVMQVRJT05TLmhhc01hbnkgOlxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAocmVsYXRpb25SZXN1bHQubGVuZ3RoID4gMCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcmVzdWx0W3JlbGF0aW9uLm1vZGVsTmFtZV0gPSByZWxhdGlvblJlc3VsdC5maWx0ZXIoKHJlbGF0aW9uUmVzdWx0SXRlbSkgPT4ge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiByZWxhdGlvblJlc3VsdEl0ZW1bcmVsYXRpb24uZm9yZWlnbktleV0gPT0gcmVzdWx0W3JlbGF0aW9uLmxvY2FsS2V5XTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAocmVsYXRpb25zQ29tcGxldGVkID09IG1vZGVsLnJlbGF0aW9ucy5sZW5ndGgpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXNvbHZlKHJlc3VsdCk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfSkuY2F0Y2goKGVycikgPT4ge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcmVqZWN0KGVycik7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAgICAgICAgICAgfWVsc2V7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgcmVzb2x2ZShjdXJzb3IudmFsdWUpO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBmYWxzZTtcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgfWVsc2V7XG4gICAgICAgICAgICAgICAgICAgICAgICBjdXJzb3IuY29udGludWUoKTtcbiAgICAgICAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAgICAgfWVsc2V7XG4gICAgICAgICAgICAgICAgICAgIHJlc29sdmUocmVzdWx0KTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9O1xuXG4gICAgICAgICAgICByZXF1ZXN0Lm9uZXJyb3IgPSBmdW5jdGlvbihlKSB7XG4gICAgICAgICAgICAgICAgcmVqZWN0KGUpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9KTtcbiAgICB9XG5cbiAgICAvKipcbiAgICAgKiBGdW5jdGlvbiBzZWFyY2hlcyB0aHJvdWdob3V0IHRoZSBkYXRhYmFzZSBhbmQgcmV0dXJucyBhIGFycmF5IG9mIHJlc3VsdFxuICAgICAqIEByZXR1cm5zIHtQcm9taXNlfVxuICAgICAqL1xuICAgIGdldCgpIHtcbiAgICAgICAgbGV0IG1vZGVsID0gdGhpcztcblxuICAgICAgICByZXR1cm4gbmV3IFByb21pc2UoKHJlc29sdmUsIHJlamVjdCkgPT4ge1xuICAgICAgICAgICAgbGV0IHRyYW5zYWN0aW9uID0gbW9kZWwuZ2V0VHJhbnNhY3Rpb24obW9kZWwudGFibGVzLCBNb2RlbC5SRUFET05MWSk7XG4gICAgICAgICAgICBsZXQgb2JqID0gdHJhbnNhY3Rpb24ub2JqZWN0U3RvcmUobW9kZWwubmFtZSk7XG4gICAgICAgICAgICBsZXQgcmVzdWx0ID0gW107XG4gICAgICAgICAgICBsZXQgcmVxdWVzdDtcblxuICAgICAgICAgICAgaWYobW9kZWwuaW5kZXhCdWlsZGVyLnR5cGUpe1xuICAgICAgICAgICAgICAgIHJlcXVlc3QgPSBtb2RlbC5nZXRJbmRleFJlc3VsdChvYmopO1xuICAgICAgICAgICAgfWVsc2V7XG4gICAgICAgICAgICAgICAgcmVxdWVzdCA9IG9iai5vcGVuQ3Vyc29yKCk7XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIHJlcXVlc3Qub25zdWNjZXNzID0gZnVuY3Rpb24gKGUpIHtcbiAgICAgICAgICAgICAgICBsZXQgY3Vyc29yID0gZS50YXJnZXQucmVzdWx0O1xuXG4gICAgICAgICAgICAgICAgaWYoY3Vyc29yKXtcbiAgICAgICAgICAgICAgICAgICAgaWYobW9kZWwuY2hlY2tCdWlsZGVyVmFsdWUoY3Vyc29yLnZhbHVlKSl7XG4gICAgICAgICAgICAgICAgICAgICAgICByZXN1bHQucHVzaChjdXJzb3IudmFsdWUpO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIGN1cnNvci5jb250aW51ZSgpO1xuXG4gICAgICAgICAgICAgICAgfWVsc2V7XG4gICAgICAgICAgICAgICAgICAgIGxldCBtYWluUmVzdWx0LCByZWxhdGlvbnNDb21wbGV0ZWQgPSAwO1xuXG4gICAgICAgICAgICAgICAgICAgIGlmKG1vZGVsLnJlbGF0aW9ucy5sZW5ndGggPiAwICYmIHJlc3VsdC5sZW5ndGggPiAwKXtcblxuXG4gICAgICAgICAgICAgICAgICAgICAgICBtb2RlbC5yZWxhdGlvbnMuZm9yRWFjaCgocmVsYXRpb24pID0+IHtcblxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGxldCByZWxhdGlvblJlcXVlc3QgPSBtb2RlbC5nZXRSZWxhdGlvbnNoaXBzKHJlbGF0aW9uLCBtb2RlbC50cmFuc2FjdGlvbiwgbW9kZWwuZ2V0TWFpblJlc3VsdChyZXN1bHQsIHJlbGF0aW9uLmxvY2FsS2V5LCB0cnVlKSwgdHJ1ZSk7XG5cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICByZWxhdGlvblJlcXVlc3QudGhlbigocmVsYXRpb25SZXN1bHQpID0+IHtcblxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICByZWxhdGlvbnNDb21wbGV0ZWQrKztcblxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXN1bHQgPSByZXN1bHQubWFwKGl0ZW0gPT4ge1xuXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBsZXQgZGVmYXVsdFZhbHVlID0gbW9kZWwuZ2V0RGVmYXVsdFJlbGF0aW9uVmFsdWUocmVsYXRpb24udHlwZSk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpdGVtW3JlbGF0aW9uLm1vZGVsTmFtZV0gPSBpdGVtW3JlbGF0aW9uLm1vZGVsTmFtZV0gfHwgZGVmYXVsdFZhbHVlO1xuXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBzd2l0Y2ggKHJlbGF0aW9uLnR5cGUpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjYXNlIE1vZGVsLlJFTEFUSU9OUy5oYXNPbmUgOlxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZihyZWxhdGlvblJlc3VsdCAhPT0gdW5kZWZpbmVkKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpdGVtW3JlbGF0aW9uLm1vZGVsTmFtZV0gPSByZWxhdGlvblJlc3VsdFtyZWxhdGlvbi5mb3JlaWduS2V5XSA9PSBpdGVtW3JlbGF0aW9uLmxvY2FsS2V5XSA/IHJlbGF0aW9uUmVzdWx0IDogaXRlbVtyZWxhdGlvbi5tb2RlbE5hbWVdO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY2FzZSBNb2RlbC5SRUxBVElPTlMuaGFzTWFueSA6XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmKHJlbGF0aW9uUmVzdWx0Lmxlbmd0aCA+IDApIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGl0ZW1bcmVsYXRpb24ubW9kZWxOYW1lXSA9IHJlbGF0aW9uUmVzdWx0LmZpbHRlcigocmVsYXRpb25SZXN1bHRJdGVtKSA9PiB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHJlbGF0aW9uUmVzdWx0SXRlbVtyZWxhdGlvbi5mb3JlaWduS2V5XSA9PSBpdGVtW3JlbGF0aW9uLmxvY2FsS2V5XTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gaXRlbTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfSk7XG5cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYocmVsYXRpb25zQ29tcGxldGVkID09IG1vZGVsLnJlbGF0aW9ucy5sZW5ndGgpe1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcmVzb2x2ZShyZXN1bHQpO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9KS5jYXRjaCgoZXJyKSA9PiB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJlamVjdChlcnIpO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0pXG4gICAgICAgICAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgICAgICAgfWVsc2V7XG4gICAgICAgICAgICAgICAgICAgICAgICByZXNvbHZlKHJlc3VsdCk7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9O1xuXG4gICAgICAgICAgICByZXF1ZXN0Lm9uZXJyb3IgPSBmdW5jdGlvbihlKSB7XG4gICAgICAgICAgICAgICAgcmVqZWN0KGUpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9KTtcbiAgICB9XG5cbiAgICAvKipcbiAgICAgKiBGdW5jdGlvbiBjcmVhdGVzIGEgc2luZ2xlIHJlY29yZFxuICAgICAqIEBwYXJhbSBkYXRhXG4gICAgICogQHJldHVybnMge1Byb21pc2V9XG4gICAgICovXG4gICAgY3JlYXRlKGRhdGEpIHtcbiAgICAgICAgbGV0IG1vZGVsID0gdGhpcztcblxuICAgICAgICByZXR1cm4gbmV3IFByb21pc2UoKHJlc29sdmUsIHJlamVjdCkgPT4ge1xuICAgICAgICAgICAgbGV0IHRyYW5zYWN0aW9uID0gbW9kZWwuZ2V0VHJhbnNhY3Rpb24obW9kZWwudGFibGVzLCBNb2RlbC5SRUFEV1JJVEUpO1xuXG4gICAgICAgICAgICBsZXQgb2JqID0gdHJhbnNhY3Rpb24ub2JqZWN0U3RvcmUobW9kZWwubmFtZSk7XG5cbiAgICAgICAgICAgIGRhdGEuY3JlYXRlZEF0ID0gRGF0ZS5ub3coKTtcbiAgICAgICAgICAgIGRhdGEudXBkYXRlZEF0ID0gRGF0ZS5ub3coKTtcblxuICAgICAgICAgICAgbGV0IHJlcXVlc3QgPSBvYmouYWRkKGRhdGEpO1xuXG4gICAgICAgICAgICByZXF1ZXN0Lm9uc3VjY2VzcyA9IGZ1bmN0aW9uIChlKSB7XG4gICAgICAgICAgICAgICAgZGF0YVttb2RlbC5wcmltYXJ5XSA9IGUudGFyZ2V0LnJlc3VsdDtcbiAgICAgICAgICAgICAgICByZXNvbHZlKGRhdGEpO1xuICAgICAgICAgICAgfTtcblxuICAgICAgICAgICAgcmVxdWVzdC5vbmVycm9yID0gZnVuY3Rpb24gKGUpIHtcbiAgICAgICAgICAgICAgICByZWplY3QoZSk7XG4gICAgICAgICAgICB9O1xuICAgICAgICB9KTtcblxuICAgIH1cblxuICAgIC8qKlxuICAgICAqIEZ1bmN0aW9uIGNyZWF0ZXMgbGlzdCBvZiByZWNvcmRzIHBhc3NlZFxuICAgICAqIEBwYXJhbSBkYXRhUmVjb3Jkc1xuICAgICAqIEByZXR1cm5zIHtQcm9taXNlfVxuICAgICAqL1xuICAgIGNyZWF0ZU11bHRpcGxlIChkYXRhUmVjb3Jkcykge1xuICAgICAgICBsZXQgbW9kZWwgPSB0aGlzO1xuXG4gICAgICAgIHJldHVybiBuZXcgUHJvbWlzZSgocmVzb2x2ZSwgcmVqZWN0KSA9PiB7XG4gICAgICAgICAgICBsZXQgdHJhbnNhY3Rpb24gPSBtb2RlbC5nZXRUcmFuc2FjdGlvbihtb2RlbC50YWJsZXMsIE1vZGVsLlJFQURXUklURSk7XG5cbiAgICAgICAgICAgIGxldCBvYmogPSB0cmFuc2FjdGlvbi5vYmplY3RTdG9yZShtb2RlbC5uYW1lKTtcbiAgICAgICAgICAgIGxldCBjcmVhdGVkQXQgPSBEYXRlLm5vdygpO1xuICAgICAgICAgICAgbGV0IHVwZGF0ZWRBdCA9IERhdGUubm93KCk7XG4gICAgICAgICAgICBsZXQgcmVzdWx0ID0gW107XG5cbiAgICAgICAgICAgIGRhdGFSZWNvcmRzLmZvckVhY2goKGRhdGEpID0+IHtcbiAgICAgICAgICAgICAgICBkYXRhLmNyZWF0ZWRBdCA9IGNyZWF0ZWRBdDtcbiAgICAgICAgICAgICAgICBkYXRhLnVwZGF0ZWRBdCA9IHVwZGF0ZWRBdDtcblxuICAgICAgICAgICAgICAgIGxldCByZXF1ZXN0ID0gb2JqLmFkZChkYXRhKTtcblxuICAgICAgICAgICAgICAgIHJlcXVlc3Qub25lcnJvciA9IGZ1bmN0aW9uKGUpIHtcbiAgICAgICAgICAgICAgICAgICAgcmVqZWN0KGUpO1xuICAgICAgICAgICAgICAgIH07XG5cbiAgICAgICAgICAgICAgICByZXF1ZXN0Lm9uc3VjY2VzcyA9IGZ1bmN0aW9uKGUpIHtcbiAgICAgICAgICAgICAgICAgICAgZGF0YVttb2RlbC5wcmltYXJ5XSA9IGUudGFyZ2V0LnJlc3VsdDtcblxuICAgICAgICAgICAgICAgICAgICByZXN1bHQucHVzaChkYXRhKTtcblxuICAgICAgICAgICAgICAgICAgICBpZihyZXN1bHQubGVuZ3RoID09PSBkYXRhUmVjb3Jkcy5sZW5ndGgpe1xuICAgICAgICAgICAgICAgICAgICAgICAgcmVzb2x2ZShyZXN1bHQpO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgfTtcbiAgICAgICAgICAgIH0pXG4gICAgICAgIH0pO1xuICAgIH1cblxuICAgIC8qKlxuICAgICAqIEZ1bmN0aW9uIHVwZGF0ZXMgdGhlIHZhcmlvdXMgcmVjb3JkcyB3aXRoIG1hdGNoaW5nIHZhbHVlc1xuICAgICAqIEBwYXJhbSBkYXRhXG4gICAgICogQHJldHVybnMge1Byb21pc2V9XG4gICAgICovXG4gICAgdXBkYXRlKGRhdGEpIHtcblxuICAgICAgICBsZXQgbW9kZWwgPSB0aGlzO1xuICAgICAgICBsZXQgdXBkYXRlZEF0ID0gRGF0ZS5ub3coKTtcblxuICAgICAgICByZXR1cm4gbmV3IFByb21pc2UoKHJlc29sdmUsIHJlamVjdCkgPT4ge1xuICAgICAgICAgICAgbGV0IHRyYW5zYWN0aW9uID0gbW9kZWwuZ2V0VHJhbnNhY3Rpb24obW9kZWwudGFibGVzLCBNb2RlbC5SRUFEV1JJVEUpO1xuICAgICAgICAgICAgbGV0IG9iaiA9IHRyYW5zYWN0aW9uLm9iamVjdFN0b3JlKG1vZGVsLm5hbWUpO1xuICAgICAgICAgICAgbGV0IHJlcXVlc3QsIHRvdGFsUmVjb3Jkc0JlaW5nVXBkYXRlZCA9IDAsIHRvdGFsUmVjb3Jkc1VwZGF0ZWQgPSAwO1xuXG4gICAgICAgICAgICBpZihtb2RlbC5pbmRleEJ1aWxkZXIudHlwZSl7XG4gICAgICAgICAgICAgICAgcmVxdWVzdCA9IG1vZGVsLmdldEluZGV4UmVzdWx0KG9iaik7XG4gICAgICAgICAgICB9ZWxzZXtcbiAgICAgICAgICAgICAgICByZXF1ZXN0ID0gb2JqLm9wZW5DdXJzb3IoKTtcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgcmVxdWVzdC5vbnN1Y2Nlc3MgPSBmdW5jdGlvbiAoZSkge1xuICAgICAgICAgICAgICAgIGxldCBjdXJzb3IgPSBlLnRhcmdldC5yZXN1bHQ7XG5cbiAgICAgICAgICAgICAgICBpZihjdXJzb3Ipe1xuICAgICAgICAgICAgICAgICAgICBpZihtb2RlbC5jaGVja0J1aWxkZXJWYWx1ZShjdXJzb3IudmFsdWUpKXtcbiAgICAgICAgICAgICAgICAgICAgICAgIHRvdGFsUmVjb3Jkc0JlaW5nVXBkYXRlZCsrO1xuXG4gICAgICAgICAgICAgICAgICAgICAgICBsZXQgaWQgPSBjdXJzb3IudmFsdWVbbW9kZWwucHJpbWFyeV07XG4gICAgICAgICAgICAgICAgICAgICAgICBsZXQgY3JlYXRlZEF0ID0gY3Vyc29yLnZhbHVlLmNyZWF0ZWRBdDtcblxuICAgICAgICAgICAgICAgICAgICAgICAgbGV0IHJlc3VsdCA9IE1vZGVsLmhlbHBlcnMucmVwbGFjZU5lc3RlZFZhbHVlcyhkYXRhLCBjdXJzb3IudmFsdWUpO1xuICAgICAgICAgICAgICAgICAgICAgICAgcmVzdWx0W21vZGVsLnByaW1hcnldID0gaWQ7XG4gICAgICAgICAgICAgICAgICAgICAgICByZXN1bHQuY3JlYXRlZEF0ID0gY3JlYXRlZEF0O1xuICAgICAgICAgICAgICAgICAgICAgICAgcmVzdWx0LnVwZGF0ZWRBdCA9IHVwZGF0ZWRBdDtcblxuICAgICAgICAgICAgICAgICAgICAgICAgbGV0IHVwZGF0ZVJlcXVlc3QgPSBjdXJzb3IudXBkYXRlKHJlc3VsdCk7XG5cbiAgICAgICAgICAgICAgICAgICAgICAgIHVwZGF0ZVJlcXVlc3Qub25zdWNjZXNzID0gZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgdG90YWxSZWNvcmRzVXBkYXRlZCsrO1xuXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYodG90YWxSZWNvcmRzVXBkYXRlZCA9PT0gdG90YWxSZWNvcmRzQmVpbmdVcGRhdGVkKXtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcmVzb2x2ZSh0cnVlKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgICAgICB9O1xuXG4gICAgICAgICAgICAgICAgICAgICAgICB1cGRhdGVSZXF1ZXN0Lm9uZXJyb3IgPSBmdW5jdGlvbihlcnIpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0cmFuc2FjdGlvbi5hYm9ydCgpO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJlamVjdChlcnIpO1xuICAgICAgICAgICAgICAgICAgICAgICAgfTtcblxuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIGN1cnNvci5jb250aW51ZSgpO1xuXG4gICAgICAgICAgICAgICAgfWVsc2V7XG4gICAgICAgICAgICAgICAgICAgIHJlc29sdmUoKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9O1xuXG4gICAgICAgICAgICByZXF1ZXN0Lm9uZXJyb3IgPSBmdW5jdGlvbihlKSB7XG4gICAgICAgICAgICAgICAgcmVqZWN0KGUpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9KTtcbiAgICB9XG5cbiAgICAvKipcbiAgICAgKiBGdW5jdGlvbiB1cGRhdGVzIHRoZSByZWNvcmQgYXQgdGhlIGdpdmVuIGlkXG4gICAgICogQHBhcmFtIGlkXG4gICAgICogQHBhcmFtIGRhdGFcbiAgICAgKiBAcmV0dXJucyB7UHJvbWlzZX1cbiAgICAgKi9cbiAgICBzYXZlKGlkLCBkYXRhKSB7XG4gICAgICAgIGxldCBtb2RlbCA9IHRoaXM7XG4gICAgICAgIGxldCB1cGRhdGVkQXQgPSBEYXRlLm5vdygpO1xuXG4gICAgICAgIHJldHVybiBuZXcgUHJvbWlzZSgocmVzb2x2ZSwgcmVqZWN0KSA9PiB7XG5cbiAgICAgICAgICAgIG1vZGVsLmZpbmQoaWQpLnRoZW4oKHJlc3VsdCkgPT4ge1xuXG4gICAgICAgICAgICAgICAgaWYoIXJlc3VsdCl7XG4gICAgICAgICAgICAgICAgICAgIHJlamVjdCgnTm8gcmVjb3JkIGZvdW5kJyk7XG4gICAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAgICAgbGV0IHRyYW5zYWN0aW9uID0gbW9kZWwuZ2V0VHJhbnNhY3Rpb24obW9kZWwudGFibGVzLCBNb2RlbC5SRUFEV1JJVEUsIHRydWUpO1xuICAgICAgICAgICAgICAgIGxldCBvYmogPSB0cmFuc2FjdGlvbi5vYmplY3RTdG9yZShtb2RlbC5uYW1lKTtcblxuICAgICAgICAgICAgICAgIGxldCBpZCA9IHJlc3VsdFttb2RlbC5wcmltYXJ5XTtcbiAgICAgICAgICAgICAgICBsZXQgY3JlYXRlZEF0ID0gcmVzdWx0LmNyZWF0ZWRBdDtcblxuICAgICAgICAgICAgICAgIHJlc3VsdCA9IE1vZGVsLmhlbHBlcnMucmVwbGFjZU5lc3RlZFZhbHVlcyhkYXRhLCByZXN1bHQpO1xuICAgICAgICAgICAgICAgIHJlc3VsdFttb2RlbC5wcmltYXJ5XSA9IGlkO1xuICAgICAgICAgICAgICAgIHJlc3VsdC5jcmVhdGVkQXQgPSBjcmVhdGVkQXQ7XG4gICAgICAgICAgICAgICAgcmVzdWx0LnVwZGF0ZWRBdCA9IHVwZGF0ZWRBdDtcblxuICAgICAgICAgICAgICAgIGxldCByZXF1ZXN0ID0gb2JqLnB1dChyZXN1bHQpO1xuXG4gICAgICAgICAgICAgICAgcmVxdWVzdC5vbnN1Y2Nlc3MgPSBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICAgICAgICAgIHJlc29sdmUodHJ1ZSk7XG4gICAgICAgICAgICAgICAgfTtcblxuICAgICAgICAgICAgICAgIHJlcXVlc3Qub25lcnJvciA9IGZ1bmN0aW9uKGUpIHtcbiAgICAgICAgICAgICAgICAgICAgcmVqZWN0KGUpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH0pLmNhdGNoKChlcnIpID0+IHtcbiAgICAgICAgICAgICAgICByZWplY3QoZXJyKTtcbiAgICAgICAgICAgIH0pO1xuXG4gICAgICAgIH0pO1xuICAgIH1cblxuICAgIC8qKlxuICAgICAqIEZ1bmN0aW9uIGRlbGV0ZXMgdGhlIGVudHJpZXMgYXQgdGhlIGdpdmVuIHBvaW50XG4gICAgICogQHBhcmFtIGlkXG4gICAgICogQHJldHVybnMge1Byb21pc2V9XG4gICAgICovXG4gICAgZGVzdHJveUlkKGlkKSB7XG4gICAgICAgIGxldCBtb2RlbCA9IHRoaXM7XG5cblxuICAgICAgICByZXR1cm4gbmV3IFByb21pc2UoKHJlc29sdmUsIHJlamVjdCkgPT4ge1xuICAgICAgICAgICAgbW9kZWwuZmluZChpZCkudGhlbigocmVzdWx0KSA9PiB7XG5cbiAgICAgICAgICAgICAgICBpZighcmVzdWx0KXtcbiAgICAgICAgICAgICAgICAgICAgcmVqZWN0KCdyZXN1bHQgYXQgaWQgZG9lcyBub3QgZXhpc3RzJyk7XG4gICAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAgICAgbGV0IHRyYW5zYWN0aW9uID0gbW9kZWwuZ2V0VHJhbnNhY3Rpb24obW9kZWwudGFibGVzLCBNb2RlbC5SRUFEV1JJVEUsIHRydWUpO1xuICAgICAgICAgICAgICAgIGxldCBvYmogPSB0cmFuc2FjdGlvbi5vYmplY3RTdG9yZShtb2RlbC5uYW1lKTtcbiAgICAgICAgICAgICAgICBsZXQgcmVxdWVzdCA9IG9iai5kZWxldGUoaWQpO1xuXG4gICAgICAgICAgICAgICAgcmVxdWVzdC5vbnN1Y2Nlc3MgPSBmdW5jdGlvbiAoZSkge1xuICAgICAgICAgICAgICAgICAgICByZXNvbHZlKGUudGFyZ2V0LnJlc3VsdCk7XG4gICAgICAgICAgICAgICAgfTtcblxuICAgICAgICAgICAgICAgIHJlcXVlc3Qub25lcnJvciA9IGZ1bmN0aW9uIChlKSB7XG4gICAgICAgICAgICAgICAgICAgIHJlamVjdChlKTtcbiAgICAgICAgICAgICAgICB9O1xuICAgICAgICAgICAgfSkuY2F0Y2goZXJyID0+IHtcbiAgICAgICAgICAgICAgICByZWplY3QoZXJyKTtcbiAgICAgICAgICAgIH0pO1xuXG5cbiAgICAgICAgfSk7XG4gICAgfVxuXG4gICAgLyoqXG4gICAgICogRnVuY3Rpb24gZGVsZXRlcyB0aGUgZW50cmllc1xuICAgICAqIEByZXR1cm5zIHtQcm9taXNlfVxuICAgICAqL1xuICAgIGRlc3Ryb3koKSB7XG4gICAgICAgIGxldCBtb2RlbCA9IHRoaXM7XG5cbiAgICAgICAgcmV0dXJuIG5ldyBQcm9taXNlKChyZXNvbHZlLCByZWplY3QpID0+IHtcbiAgICAgICAgICAgIGxldCB0cmFuc2FjdGlvbiA9IG1vZGVsLmdldFRyYW5zYWN0aW9uKG1vZGVsLnRhYmxlcywgTW9kZWwuUkVBRFdSSVRFKTtcbiAgICAgICAgICAgIGxldCBvYmogPSB0cmFuc2FjdGlvbi5vYmplY3RTdG9yZShtb2RlbC5uYW1lKTtcbiAgICAgICAgICAgIGxldCByZXF1ZXN0LCB0b3RhbFJlY29yZHNCZWluZ0RlbGV0ZWQgPSAwLCB0b3RhbFJlY29yZHNEZWxldGVkID0gMDtcblxuICAgICAgICAgICAgaWYgKG1vZGVsLmluZGV4QnVpbGRlci50eXBlKSB7XG4gICAgICAgICAgICAgICAgcmVxdWVzdCA9IG1vZGVsLmdldEluZGV4UmVzdWx0KG9iaik7XG4gICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgIHJlcXVlc3QgPSBvYmoub3BlbkN1cnNvcigpO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICByZXF1ZXN0Lm9uc3VjY2VzcyA9IGZ1bmN0aW9uIChlKSB7XG4gICAgICAgICAgICAgICAgbGV0IGN1cnNvciA9IGUudGFyZ2V0LnJlc3VsdDtcblxuICAgICAgICAgICAgICAgIGlmIChjdXJzb3IpIHtcbiAgICAgICAgICAgICAgICAgICAgaWYgKG1vZGVsLmNoZWNrQnVpbGRlclZhbHVlKGN1cnNvci52YWx1ZSkpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHRvdGFsUmVjb3Jkc0JlaW5nRGVsZXRlZCsrO1xuXG4gICAgICAgICAgICAgICAgICAgICAgICBsZXQgZGVsZXRlUmVxdWVzdCA9IGN1cnNvci5kZWxldGUoKTtcblxuICAgICAgICAgICAgICAgICAgICAgICAgZGVsZXRlUmVxdWVzdC5vbnN1Y2Nlc3MgPSBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgdG90YWxSZWNvcmRzRGVsZXRlZCsrO1xuXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHRvdGFsUmVjb3Jkc0RlbGV0ZWQgPT09IHRvdGFsUmVjb3Jkc0JlaW5nRGVsZXRlZCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXNvbHZlKHRydWUpO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgICAgIH07XG5cbiAgICAgICAgICAgICAgICAgICAgICAgIGRlbGV0ZVJlcXVlc3Qub25lcnJvciA9IGZ1bmN0aW9uIChlcnIpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0cmFuc2FjdGlvbi5hYm9ydCgpO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJlamVjdChlcnIpO1xuICAgICAgICAgICAgICAgICAgICAgICAgfTtcblxuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIGN1cnNvci5jb250aW51ZSgpO1xuXG4gICAgICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgcmVzb2x2ZSgpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH07XG5cbiAgICAgICAgICAgIHJlcXVlc3Qub25lcnJvciA9IGZ1bmN0aW9uIChlKSB7XG4gICAgICAgICAgICAgICAgcmVqZWN0KGUpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9KTtcbiAgICB9XG5cbiAgICAvKipcbiAgICAgKiBGdW5jdGlvbiBjb3VudHMgdGhlIG51bWJlciBvZiByZWNvcmRzXG4gICAgICogQHJldHVybnMge1Byb21pc2V9XG4gICAgICovXG4gICAgY291bnQoKSB7XG4gICAgICAgIGxldCBtb2RlbCA9IHRoaXM7XG5cbiAgICAgICAgcmV0dXJuIG5ldyBQcm9taXNlKChyZXNvbHZlLCByZWplY3QpID0+IHtcbiAgICAgICAgICAgIGxldCB0cmFuc2FjdGlvbiA9IG1vZGVsLmdldFRyYW5zYWN0aW9uKG1vZGVsLnRhYmxlcywgTW9kZWwuUkVBRE9OTFkpO1xuICAgICAgICAgICAgbGV0IG9iaiA9IHRyYW5zYWN0aW9uLm9iamVjdFN0b3JlKG1vZGVsLm5hbWUpO1xuICAgICAgICAgICAgbGV0IHJlc3VsdCA9IDA7XG4gICAgICAgICAgICBsZXQgcmVxdWVzdDtcblxuICAgICAgICAgICAgaWYobW9kZWwuaW5kZXhCdWlsZGVyLnR5cGUpe1xuICAgICAgICAgICAgICAgIHJlcXVlc3QgPSBtb2RlbC5nZXRJbmRleFJlc3VsdChvYmopO1xuICAgICAgICAgICAgfWVsc2V7XG4gICAgICAgICAgICAgICAgcmVxdWVzdCA9IG9iai5vcGVuQ3Vyc29yKCk7XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIHJlcXVlc3Qub25zdWNjZXNzID0gZnVuY3Rpb24gKGUpIHtcbiAgICAgICAgICAgICAgICBsZXQgY3Vyc29yID0gZS50YXJnZXQucmVzdWx0O1xuXG4gICAgICAgICAgICAgICAgaWYoY3Vyc29yKXtcbiAgICAgICAgICAgICAgICAgICAgaWYobW9kZWwuY2hlY2tCdWlsZGVyVmFsdWUoY3Vyc29yLnZhbHVlKSl7XG4gICAgICAgICAgICAgICAgICAgICAgICByZXN1bHQrKztcbiAgICAgICAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAgICAgICAgIGN1cnNvci5jb250aW51ZSgpO1xuXG4gICAgICAgICAgICAgICAgfWVsc2V7XG4gICAgICAgICAgICAgICAgICAgIHJlc29sdmUocmVzdWx0KTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9O1xuXG4gICAgICAgICAgICByZXF1ZXN0Lm9uZXJyb3IgPSBmdW5jdGlvbihlKSB7XG4gICAgICAgICAgICAgICAgcmVqZWN0KGUpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9KTtcbiAgICB9XG5cbiAgICAvKipcbiAgICAgKiBGdW5jdGlvbiBhdmVyYWdlcyB0aGUgbnVtZXJpYyB2YWx1ZSBhdCB0aGUgZ2l2ZW4gcG9pbnRcbiAgICAgKiBAcGFyYW0gYXR0cmlidXRlXG4gICAgICogQHJldHVybnMge1Byb21pc2V9XG4gICAgICovXG4gICAgYXZlcmFnZSAoYXR0cmlidXRlKSB7XG4gICAgICAgIGxldCBtb2RlbCA9IHRoaXM7XG5cbiAgICAgICAgcmV0dXJuIG5ldyBQcm9taXNlKChyZXNvbHZlLCByZWplY3QpID0+IHtcbiAgICAgICAgICAgIGxldCB0cmFuc2FjdGlvbiA9IG1vZGVsLmdldFRyYW5zYWN0aW9uKG1vZGVsLnRhYmxlcywgTW9kZWwuUkVBRE9OTFkpO1xuICAgICAgICAgICAgbGV0IG9iaiA9IHRyYW5zYWN0aW9uLm9iamVjdFN0b3JlKG1vZGVsLm5hbWUpO1xuICAgICAgICAgICAgbGV0IHJlc3VsdCA9IDAsIHRvdGFsUmVjb3JkcyA9IDA7XG4gICAgICAgICAgICBsZXQgcmVxdWVzdDtcblxuICAgICAgICAgICAgaWYobW9kZWwuaW5kZXhCdWlsZGVyLnR5cGUpe1xuICAgICAgICAgICAgICAgIHJlcXVlc3QgPSBtb2RlbC5nZXRJbmRleFJlc3VsdChvYmopO1xuICAgICAgICAgICAgfWVsc2V7XG4gICAgICAgICAgICAgICAgcmVxdWVzdCA9IG9iai5vcGVuQ3Vyc29yKCk7XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIHJlcXVlc3Qub25zdWNjZXNzID0gZnVuY3Rpb24gKGUpIHtcbiAgICAgICAgICAgICAgICBsZXQgY3Vyc29yID0gZS50YXJnZXQucmVzdWx0O1xuXG4gICAgICAgICAgICAgICAgaWYoY3Vyc29yKXtcbiAgICAgICAgICAgICAgICAgICAgaWYobW9kZWwuY2hlY2tCdWlsZGVyVmFsdWUoY3Vyc29yLnZhbHVlKSl7XG4gICAgICAgICAgICAgICAgICAgICAgICB0b3RhbFJlY29yZHMrKztcbiAgICAgICAgICAgICAgICAgICAgICAgIGxldCB0ZW1wUmVzdWx0ID0gTW9kZWwuaGVscGVycy5nZXROZXN0ZWRBdHRyaWJ1dGUoYXR0cmlidXRlLCBjdXJzb3IudmFsdWUpO1xuICAgICAgICAgICAgICAgICAgICAgICAgdGVtcFJlc3VsdCA9IHBhcnNlRmxvYXQodGVtcFJlc3VsdCk7XG4gICAgICAgICAgICAgICAgICAgICAgICB0ZW1wUmVzdWx0ID0gaXNOYU4odGVtcFJlc3VsdCkgPyAwIDogdGVtcFJlc3VsdDtcbiAgICAgICAgICAgICAgICAgICAgICAgIHJlc3VsdCArPSB0ZW1wUmVzdWx0O1xuICAgICAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICAgICAgICAgY3Vyc29yLmNvbnRpbnVlKCk7XG5cbiAgICAgICAgICAgICAgICB9ZWxzZXtcbiAgICAgICAgICAgICAgICAgICAgcmVzb2x2ZShyZXN1bHQvdG90YWxSZWNvcmRzKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9O1xuXG4gICAgICAgICAgICByZXF1ZXN0Lm9uZXJyb3IgPSBmdW5jdGlvbihlKSB7XG4gICAgICAgICAgICAgICAgcmVqZWN0KGUpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9KTtcbiAgICB9XG5cbiAgICAvKipcbiAgICAgKiBSZWR1Y2UgZnVuY3Rpb24gaXMgY2FsbGVkIHdpdGggZWFjaCBwYXNzaW5nIGl0ZXJhdG9yIHZhbHVlIGFuZCByZWR1Y2VkIHZhbHVlIGlzIHJldHVybmVkXG4gICAgICogQHBhcmFtIGZ1bmNcbiAgICAgKiBAcGFyYW0gZGVmYXVsdENhcnJ5XG4gICAgICogQHJldHVybnMge1Byb21pc2V9XG4gICAgICovXG4gICAgcmVkdWNlIChmdW5jLCBkZWZhdWx0Q2FycnkpIHtcbiAgICAgICAgbGV0IG1vZGVsID0gdGhpcztcblxuICAgICAgICBpZih0eXBlb2YgZnVuYyAhPT0gJ2Z1bmN0aW9uJyl7XG4gICAgICAgICAgICB0aHJvdyBcIlBhcmFtZXRlciBzaG91bGQgYmUgYSBmdW5jdGlvbiB0eXBlXCI7XG4gICAgICAgIH1cblxuICAgICAgICByZXR1cm4gbmV3IFByb21pc2UoKHJlc29sdmUsIHJlamVjdCkgPT4ge1xuICAgICAgICAgICAgbGV0IHRyYW5zYWN0aW9uID0gbW9kZWwuZ2V0VHJhbnNhY3Rpb24obW9kZWwudGFibGVzLCBNb2RlbC5SRUFET05MWSk7XG4gICAgICAgICAgICBsZXQgb2JqID0gdHJhbnNhY3Rpb24ub2JqZWN0U3RvcmUobW9kZWwubmFtZSk7XG4gICAgICAgICAgICBsZXQgcmVzdWx0ID0gZGVmYXVsdENhcnJ5O1xuICAgICAgICAgICAgbGV0IHJlcXVlc3Q7XG5cbiAgICAgICAgICAgIGlmKG1vZGVsLmluZGV4QnVpbGRlci50eXBlKXtcbiAgICAgICAgICAgICAgICByZXF1ZXN0ID0gbW9kZWwuZ2V0SW5kZXhSZXN1bHQob2JqKTtcbiAgICAgICAgICAgIH1lbHNle1xuICAgICAgICAgICAgICAgIHJlcXVlc3QgPSBvYmoub3BlbkN1cnNvcigpO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICByZXF1ZXN0Lm9uc3VjY2VzcyA9IGZ1bmN0aW9uIChlKSB7XG4gICAgICAgICAgICAgICAgbGV0IGN1cnNvciA9IGUudGFyZ2V0LnJlc3VsdDtcblxuICAgICAgICAgICAgICAgIGlmKGN1cnNvcil7XG4gICAgICAgICAgICAgICAgICAgIGlmKG1vZGVsLmNoZWNrQnVpbGRlclZhbHVlKGN1cnNvci52YWx1ZSkpe1xuICAgICAgICAgICAgICAgICAgICAgICAgcmVzdWx0ID0gZnVuYyhjdXJzb3IudmFsdWUsIHJlc3VsdCk7XG4gICAgICAgICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgICAgICAgICBjdXJzb3IuY29udGludWUoKTtcblxuICAgICAgICAgICAgICAgIH1lbHNle1xuICAgICAgICAgICAgICAgICAgICByZXNvbHZlKHJlc3VsdCk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfTtcblxuICAgICAgICAgICAgcmVxdWVzdC5vbmVycm9yID0gZnVuY3Rpb24oZSkge1xuICAgICAgICAgICAgICAgIHJlamVjdChlKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfSk7XG4gICAgfVxuXG4gICAgLyoqXG4gICAgICogU2V0cyB0aGUgaW5kZXggc2VhcmNoIGNyaXRlcmlhXG4gICAgICogQHBhcmFtIG9iamVjdFN0b3JlXG4gICAgICogQHJldHVybnMgeyp9XG4gICAgICovXG4gICAgZ2V0SW5kZXhSZXN1bHQob2JqZWN0U3RvcmUpIHtcbiAgICAgICAgbGV0IGJ1aWxkZXIgPSB0aGlzO1xuICAgICAgICBsZXQgcmFuZ2U7XG4gICAgICAgIGxldCBpbmRleDtcblxuXG4gICAgICAgIGlmKCFidWlsZGVyLmluZGV4QnVpbGRlci50eXBlKSB7XG4gICAgICAgICAgICByZXR1cm4gb2JqZWN0U3RvcmUub3BlbkN1cnNvcigpO1xuICAgICAgICB9XG5cbiAgICAgICAgaWYoYnVpbGRlci5pbmRleEJ1aWxkZXIuaW5kZXggIT09IGJ1aWxkZXIucHJpbWFyeSl7XG4gICAgICAgICAgICBpbmRleCA9IG9iamVjdFN0b3JlLmluZGV4KGJ1aWxkZXIuaW5kZXhCdWlsZGVyLmluZGV4KTtcbiAgICAgICAgfWVsc2V7XG4gICAgICAgICAgICBpbmRleCA9IG9iamVjdFN0b3JlO1xuICAgICAgICB9XG5cbiAgICAgICAgc3dpdGNoIChidWlsZGVyLmluZGV4QnVpbGRlci50eXBlKSB7XG4gICAgICAgICAgICBjYXNlICdhbmQnIDpcbiAgICAgICAgICAgICAgICByYW5nZSA9IGJ1aWxkZXIuaWRiS2V5Lm9ubHkoYnVpbGRlci5pbmRleEJ1aWxkZXIudmFsdWUpO1xuICAgICAgICAgICAgICAgIGJyZWFrO1xuXG4gICAgICAgICAgICBjYXNlICdpbicgOlxuICAgICAgICAgICAgICAgIGJ1aWxkZXIud2hlcmVJbihidWlsZGVyLmluZGV4QnVpbGRlci5pbmRleCwgYnVpbGRlci5pbmRleEJ1aWxkZXIudmFsdWUpO1xuICAgICAgICAgICAgICAgIGxldCB2YWx1ZXMgPSBidWlsZGVyLmluZGV4QnVpbGRlci52YWx1ZS5zb3J0KCk7XG4gICAgICAgICAgICAgICAgcmFuZ2UgPSBidWlsZGVyLmlkYktleS5ib3VuZCh2YWx1ZXNbMF0sIHZhbHVlc1t2YWx1ZXMubGVuZ3RoIC0gMV0sIGZhbHNlLCBmYWxzZSk7XG4gICAgICAgICAgICAgICAgYnJlYWs7XG5cbiAgICAgICAgICAgIGNhc2UgJ2d0ZScgOlxuICAgICAgICAgICAgICAgIHJhbmdlID0gYnVpbGRlci5pZGJLZXkubG93ZXJCb3VuZChidWlsZGVyLmluZGV4QnVpbGRlci52YWx1ZSwgZmFsc2UpO1xuICAgICAgICAgICAgICAgIGJyZWFrO1xuXG4gICAgICAgICAgICBjYXNlICdndCcgOlxuICAgICAgICAgICAgICAgIHJhbmdlID0gYnVpbGRlci5pZGJLZXkubG93ZXJCb3VuZChidWlsZGVyLmluZGV4QnVpbGRlci52YWx1ZSwgdHJ1ZSk7XG4gICAgICAgICAgICAgICAgYnJlYWs7XG5cbiAgICAgICAgICAgIGNhc2UgJ2x0ZScgOlxuICAgICAgICAgICAgICAgIHJhbmdlID0gYnVpbGRlci5pZGJLZXkudXBwZXJCb3VuZChidWlsZGVyLmluZGV4QnVpbGRlci52YWx1ZSwgZmFsc2UpO1xuICAgICAgICAgICAgICAgIGJyZWFrO1xuXG4gICAgICAgICAgICBjYXNlICdsdCcgOlxuICAgICAgICAgICAgICAgIHJhbmdlID0gYnVpbGRlci5pZGJLZXkubG93ZXJCb3VuZChidWlsZGVyLmluZGV4QnVpbGRlci52YWx1ZSwgdHJ1ZSk7XG4gICAgICAgICAgICAgICAgYnJlYWs7XG5cbiAgICAgICAgICAgIGNhc2UgJ2JldHdlZW4nIDpcbiAgICAgICAgICAgICAgICByYW5nZSA9IGJ1aWxkZXIuaWRiS2V5LmJvdW5kKGJ1aWxkZXIuaW5kZXhCdWlsZGVyLnZhbHVlWzBdLCBidWlsZGVyLmluZGV4QnVpbGRlci52YWx1ZVsxXSwgZmFsc2UsIGZhbHNlKTtcbiAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgIGRlZmF1bHQgOlxuICAgICAgICAgICAgICAgIHRocm93ICdJbnZhbGlkIGJ1aWxkZXIgdHlwZSBmb3VuZCc7XG4gICAgICAgIH1cblxuICAgICAgICByZXR1cm4gaW5kZXgub3BlbkN1cnNvcihyYW5nZSk7XG4gICAgfVxuXG4gICAgLyoqXG4gICAgICogQ2hlY2tzIGNvbW1vbiBzZWFyY2ggY3JpdGVyaWEgb3RoZXIgdGhhbiB0aGUgaW5kZXggdmFsdWVzXG4gICAgICogQHBhcmFtIHZhbHVlXG4gICAgICogQHJldHVybnMge2Jvb2xlYW59XG4gICAgICovXG4gICAgY2hlY2tCdWlsZGVyVmFsdWUodmFsdWUpIHtcbiAgICAgICAgbGV0IGJ1aWxkZXIgPSB0aGlzO1xuICAgICAgICBsZXQgcmVzdWx0ID0gdHJ1ZTtcbiAgICAgICAgbGV0IGksajtcbiAgICAgICAgZm9yIChpID0gMDsgaSA8IGJ1aWxkZXIuYnVpbGRlci5sZW5ndGg7IGkrKyl7XG5cbiAgICAgICAgICAgIGxldCBjb25kaXRpb24gPSBidWlsZGVyLmJ1aWxkZXJbaV07XG4gICAgICAgICAgICBzd2l0Y2goY29uZGl0aW9uLnR5cGUpe1xuXG4gICAgICAgICAgICAgICAgY2FzZSAnYW5kJyA6IC8vY2FzZSBmb3Igb25lIHRvIG9uZSBzZWFyY2hcbiAgICAgICAgICAgICAgICAgICAgaWYoIU1vZGVsLmhlbHBlcnMuY2hlY2tOZXN0ZWRBdHRyaWJ1dGUoY29uZGl0aW9uLmF0dHJpYnV0ZSwgdmFsdWUsIGNvbmRpdGlvbi52YWx1ZSkpe1xuICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIGJyZWFrO1xuXG4gICAgICAgICAgICAgICAgY2FzZSAnaW4nIDogLy9jYXNlIGZvciBsaXN0IHNlYXJjaFxuICAgICAgICAgICAgICAgICAgICBsZXQgdGVtcENoZWNrID0gZmFsc2U7XG4gICAgICAgICAgICAgICAgICAgIGZvcihqID0gMDsgaiA8IGNvbmRpdGlvbi52YWx1ZS5sZW5ndGg7IGorKykge1xuICAgICAgICAgICAgICAgICAgICAgICAgcmVzdWx0ID0gTW9kZWwuaGVscGVycy5jaGVja05lc3RlZEF0dHJpYnV0ZShjb25kaXRpb24uYXR0cmlidXRlLCB2YWx1ZSwgY29uZGl0aW9uLnZhbHVlW2pdKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmKHJlc3VsdCAhPT0gdW5kZWZpbmVkICYmIHJlc3VsdCAhPT0gZmFsc2UpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0ZW1wQ2hlY2sgPSB0cnVlO1xuICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICAgICAgICAgaWYoIXRlbXBDaGVjayl7XG4gICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gZmFsc2U7XG4gICAgICAgICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgICAgICAgICByZXN1bHQgPSB0cnVlO1xuXG4gICAgICAgICAgICAgICAgICAgIGJyZWFrO1xuXG4gICAgICAgICAgICAgICAgY2FzZSAnZ3RlJyA6IC8vY2FzZSBmb3IgY2hlY2tpbmcgdGhlIHZhbHVlIGlzIGdyZWF0ZXIgdGhhbiBvciBpcyBlcXVhbCB0byB0aGUgc2FtZVxuICAgICAgICAgICAgICAgICAgICByZXN1bHQgPSBNb2RlbC5oZWxwZXJzLmdldE5lc3RlZEF0dHJpYnV0ZShjb25kaXRpb24uYXR0cmlidXRlLCB2YWx1ZSk7XG5cbiAgICAgICAgICAgICAgICAgICAgaWYocmVzdWx0ID09PSB1bmRlZmluZWQpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBmYWxzZTtcbiAgICAgICAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAgICAgICAgIGlmKHJlc3VsdCA8IGNvbmRpdGlvbi52YWx1ZSl7XG4gICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gZmFsc2U7XG4gICAgICAgICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgICAgICAgICByZXN1bHQgPSB0cnVlO1xuICAgICAgICAgICAgICAgICAgICBicmVhaztcblxuICAgICAgICAgICAgICAgIGNhc2UgJ2d0JyA6IC8vY2FzZSBmb3IgY2hlY2tpbmcgdGhlIHZhbHVlIGlzIGdyZWF0ZXIgdGhhbiB0aGUgc2FtZVxuXG4gICAgICAgICAgICAgICAgICAgIHJlc3VsdCA9IE1vZGVsLmhlbHBlcnMuZ2V0TmVzdGVkQXR0cmlidXRlKGNvbmRpdGlvbi5hdHRyaWJ1dGUsIHZhbHVlKTtcblxuICAgICAgICAgICAgICAgICAgICBpZihyZXN1bHQgPT09IHVuZGVmaW5lZCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgICAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICAgICAgICAgaWYocmVzdWx0IDw9IGNvbmRpdGlvbi52YWx1ZSl7XG4gICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gZmFsc2U7XG4gICAgICAgICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgICAgICAgICByZXN1bHQgPSB0cnVlO1xuICAgICAgICAgICAgICAgICAgICBicmVhaztcblxuICAgICAgICAgICAgICAgIGNhc2UgJ2x0ZScgOiAvL2Nhc2UgZm9yIGNoZWNraW5nIHRoZSB2YWx1ZSBpcyBsZXNzIHRoYW4gb3IgaXMgZXF1YWwgdG8gdGhlIHNhbWVcbiAgICAgICAgICAgICAgICAgICAgcmVzdWx0ID0gTW9kZWwuaGVscGVycy5nZXROZXN0ZWRBdHRyaWJ1dGUoY29uZGl0aW9uLmF0dHJpYnV0ZSwgdmFsdWUpO1xuXG4gICAgICAgICAgICAgICAgICAgIGlmKHJlc3VsdCA9PT0gdW5kZWZpbmVkKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gZmFsc2U7XG4gICAgICAgICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgICAgICAgICBpZihyZXN1bHQgPiBjb25kaXRpb24udmFsdWUpe1xuICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIHJlc3VsdCA9IHRydWU7XG4gICAgICAgICAgICAgICAgICAgIGJyZWFrO1xuXG4gICAgICAgICAgICAgICAgY2FzZSAnbHQnIDogLy9jYXNlIGZvciBjaGVja2luZyB0aGUgdmFsdWUgaXMgbGVzcyB0aGFuIHRoZSBzYW1lXG4gICAgICAgICAgICAgICAgICAgIHJlc3VsdCA9IE1vZGVsLmhlbHBlcnMuZ2V0TmVzdGVkQXR0cmlidXRlKGNvbmRpdGlvbi5hdHRyaWJ1dGUsIHZhbHVlKTtcblxuICAgICAgICAgICAgICAgICAgICBpZihyZXN1bHQgPT09IHVuZGVmaW5lZCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgICAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICAgICAgICAgaWYocmVzdWx0ID49IGNvbmRpdGlvbi52YWx1ZSl7XG4gICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gZmFsc2U7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgcmVzdWx0ID0gdHJ1ZTtcbiAgICAgICAgICAgICAgICAgICAgYnJlYWs7XG5cbiAgICAgICAgICAgICAgICBjYXNlICdiZXR3ZWVuJyA6IC8vY2FzZSBmb3IgY2hlY2tpbmcgdGhlIHZhbHVlIGlzIGJldHdlZW4gdGhlIGdpdmVuIHJhbmdlKE9OTFkgV09SS1MgRk9SIE5VTUVSSUMpXG4gICAgICAgICAgICAgICAgICAgIHJlc3VsdCA9IE1vZGVsLmhlbHBlcnMuZ2V0TmVzdGVkQXR0cmlidXRlKGNvbmRpdGlvbi5hdHRyaWJ1dGUsIHZhbHVlKTtcblxuICAgICAgICAgICAgICAgICAgICBpZihyZXN1bHQgPT09IHVuZGVmaW5lZCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgICAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICAgICAgICAgaWYoY29uZGl0aW9uLnZhbHVlWzBdID49IHJlc3VsdCAmJiBjb25kaXRpb24udmFsdWVbMV0gPD0gcmVzdWx0KXtcbiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBmYWxzZVxuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIHJlc3VsdCA9IHRydWU7XG4gICAgICAgICAgICAgICAgICAgIGJyZWFrO1xuXG4gICAgICAgICAgICAgICAgZGVmYXVsdDpcbiAgICAgICAgICAgICAgICAgICAgcmVzdWx0ID0gdHJ1ZTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuXG4gICAgICAgIHJldHVybiByZXN1bHQ7XG4gICAgfVxuXG4gICAgLyoqXG4gICAgICogQ3JlYXRlcyBhIHRyYW5zYWN0aW9uXG4gICAgICogQHBhcmFtIHRhYmxlc1xuICAgICAqIEBwYXJhbSBtb2RlXG4gICAgICovXG4gICAgY3JlYXRlVHJhbnNhY3Rpb24odGFibGVzLCBtb2RlKSB7XG4gICAgICAgIHRoaXMudHJhbnNhY3Rpb24gPSB0aGlzLmRiLnRyYW5zYWN0aW9uKHRhYmxlcywgbW9kZSlcbiAgICB9XG5cbiAgICAvKipcbiAgICAgKiBTZXRzIElEQlRyYW5zYWN0aW9uIG9iZWpjdCB0byBjdXJyZW50IG1vZGVsIHNjb3BlXG4gICAgICogQHBhcmFtIHRyYW5zYWN0aW9uXG4gICAgICovXG4gICAgc2V0VHJhbnNhY3Rpb24odHJhbnNhY3Rpb24pIHtcbiAgICAgICAgdGhpcy50cmFuc2FjdGlvbiA9IHRyYW5zYWN0aW9uXG4gICAgfVxuXG4gICAgLyoqXG4gICAgICogUmV0dXJucyB0aGUgSURCVHJhbnNhY3Rpb24gb2JqZWN0IHNldCBpbiBjdXJyZW50IHNjb3BlXG4gICAgICogQHBhcmFtIHtBcnJheX0gdGFibGVzXG4gICAgICogQHBhcmFtIHtTdHJpbmd9IG1vZGVcbiAgICAgKiBAcGFyYW0ge2Jvb2xlYW59IG92ZXJ3cml0ZVxuICAgICAqIEByZXR1cm5zIHsqfG51bGx9XG4gICAgICovXG4gICAgZ2V0VHJhbnNhY3Rpb24odGFibGVzLCBtb2RlLCBvdmVyd3JpdGUpIHtcbiAgICAgICAgb3ZlcndyaXRlID0gb3ZlcndyaXRlID09PSB1bmRlZmluZWQgPyBmYWxzZSA6IG92ZXJ3cml0ZTtcblxuICAgICAgICBpZighdGhpcy50cmFuc2FjdGlvbiB8fCBvdmVyd3JpdGUgPT09IHRydWUpIHtcbiAgICAgICAgICAgIHRoaXMuY3JlYXRlVHJhbnNhY3Rpb24odGFibGVzLCBtb2RlKTtcbiAgICAgICAgfVxuXG4gICAgICAgIHJldHVybiB0aGlzLnRyYW5zYWN0aW9uO1xuICAgIH1cblxuICAgIC8qKlxuICAgICAqIFJldHVybnMgdGhlIGFycmF5IG9yIGRpcmVjdCBrZXkgdmFsdWUgYWdhaW5zdCB0aGUgaW5wdXQgZ2l2ZSBmb3IgdGhlIGtleSBzcGVjaWZpZWRcbiAgICAgKiBAcGFyYW0gcmVzdWx0XG4gICAgICogQHBhcmFtIGtleVxuICAgICAqIEBwYXJhbSBpc0FycmF5XG4gICAgICogQHJldHVybnMgeyp9XG4gICAgICovXG4gICAgZ2V0TWFpblJlc3VsdCAocmVzdWx0LCBrZXksIGlzQXJyYXkpIHtcbiAgICAgICAgaWYoaXNBcnJheSl7XG4gICAgICAgICAgICByZXR1cm4gcmVzdWx0Lm1hcCgoaXRlbSkgPT4ge1xuICAgICAgICAgICAgICAgIHJldHVybiBpdGVtW2tleV07XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgfWVsc2V7XG4gICAgICAgICAgICByZXR1cm4gcmVzdWx0W2tleV07XG4gICAgICAgIH1cbiAgICB9XG5cbiAgICAvKipcbiAgICAgKiBTZWFyY2hlcyBmb3IgcmVsYXRpb25zaGlwcyBhc3NpZ25lZCB3aXRoIGJ1aWxkZXIgYW5kIGZldGNoZXMgdGhlbVxuICAgICAqIEBwYXJhbSByZWxhdGlvblxuICAgICAqIEBwYXJhbSB0cmFuc2FjdGlvblxuICAgICAqIEBwYXJhbSBtYWluUmVzdWx0XG4gICAgICogQHBhcmFtIGlzQXJyYXlcbiAgICAgKiBAcmV0dXJucyB7UHJvbWlzZX1cbiAgICAgKi9cbiAgICBnZXRSZWxhdGlvbnNoaXBzIChyZWxhdGlvbiwgdHJhbnNhY3Rpb24sIG1haW5SZXN1bHQsIGlzQXJyYXkpIHtcblxuICAgICAgICBpc0FycmF5ID0gaXNBcnJheSB8fCBmYWxzZTtcblxuICAgICAgICBsZXQgbW9kZWwgPSB0aGlzO1xuICAgICAgICBsZXQgcHJpbWFyeSA9IHJlbGF0aW9uLnByaW1hcnkgfHwgJ2lkJztcblxuICAgICAgICAvKipcbiAgICAgICAgICogQHZhciBNb2RlbCByZWxhdGlvbk1vZGVsXG4gICAgICAgICAqL1xuICAgICAgICBsZXQgcmVsYXRpb25Nb2RlbCA9IG5ldyBNb2RlbChtb2RlbC5kYiwgbW9kZWwuaWRiS2V5LCByZWxhdGlvbi5tb2RlbE5hbWUsIHJlbGF0aW9uLnByaW1hcnkpO1xuXG4gICAgICAgIC8vc2V0dGluZyB0aGUgcmVsYXRpb24gdHJhbnNhY3Rpb24gc2FtZSBhcyBwYXJlbnQgdHJhbnNhY3Rpb25cbiAgICAgICAgcmVsYXRpb25Nb2RlbC5zZXRUcmFuc2FjdGlvbih0cmFuc2FjdGlvbik7XG5cbiAgICAgICAgLy9pZiBhIHNlY29uZHJ5IGJ1aWxkZXIgZnVuY3Rpb24gd2FzIGRlZmluZWRcbiAgICAgICAgaWYocmVsYXRpb24uZnVuYyl7XG4gICAgICAgICAgICBsZXQgdGVtcEJ1aWxkZXIgPSBuZXcgQnVpbGRlcigpO1xuXG4gICAgICAgICAgICB0ZW1wQnVpbGRlciA9IHJlbGF0aW9uLmZ1bmModGVtcEJ1aWxkZXIpO1xuXG4gICAgICAgICAgICByZWxhdGlvbk1vZGVsLnRhYmxlcyA9IHRlbXBCdWlsZGVyLnRhYmxlcztcbiAgICAgICAgICAgIHJlbGF0aW9uTW9kZWwudGFibGVzLnB1c2gocmVsYXRpb25Nb2RlbC5uYW1lKTtcbiAgICAgICAgICAgIHJlbGF0aW9uTW9kZWwucmVsYXRpb25zID0gdGVtcEJ1aWxkZXIucmVsYXRpb25zO1xuICAgICAgICAgICAgcmVsYXRpb25Nb2RlbC5idWlsZGVyID0gdGVtcEJ1aWxkZXIuYnVpbGRlcjtcbiAgICAgICAgfVxuXG4gICAgICAgIC8vY2hlY2tpbmcgdHlwZSBvZiBwYXJlbnQgcmVzdWx0XG4gICAgICAgIGlmKGlzQXJyYXkpe1xuICAgICAgICAgICAgcmVsYXRpb25Nb2RlbC53aGVyZUluZGV4SW4ocmVsYXRpb24uZm9yZWlnbktleSwgbWFpblJlc3VsdCk7XG4gICAgICAgIH1lbHNle1xuICAgICAgICAgICAgcmVsYXRpb25Nb2RlbC53aGVyZUluZGV4KHJlbGF0aW9uLmZvcmVpZ25LZXksIG1haW5SZXN1bHQpO1xuICAgICAgICB9XG5cbiAgICAgICAgcmV0dXJuIG5ldyBQcm9taXNlKChyZWxhdGlvblJlc29sdmUsIHJlbGF0aW9uUmVqZWN0KSA9PiB7XG5cbiAgICAgICAgICAgIGxldCByZXN1bHQ7XG5cbiAgICAgICAgICAgIC8vaWYgcmVsYXRpb24gdHlwZSBtZW50aW9uZWRcbiAgICAgICAgICAgIHN3aXRjaCAocmVsYXRpb24udHlwZSkge1xuICAgICAgICAgICAgICAgIGNhc2UgTW9kZWwuUkVMQVRJT05TLmhhc09uZSA6XG4gICAgICAgICAgICAgICAgICAgIHJlc3VsdCA9IHJlbGF0aW9uTW9kZWwuZmlyc3QoKTtcbiAgICAgICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICAgICAgY2FzZSBNb2RlbC5SRUxBVElPTlMuaGFzTWFueSA6XG4gICAgICAgICAgICAgICAgICAgIHJlc3VsdCA9IHJlbGF0aW9uTW9kZWwuZ2V0KCk7XG4gICAgICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgICAgIGRlZmF1bHQgOlxuICAgICAgICAgICAgICAgICAgICB0aHJvdyBcIkludmFsaWQgcmVsYXRpb24gdHlwZSBwcm92aWRlZFwiO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICByZXN1bHQudGhlbihyID0+IHtcbiAgICAgICAgICAgICAgICByZWxhdGlvblJlc29sdmUocik7XG4gICAgICAgICAgICB9KS5jYXRjaChlcnIgPT4ge1xuICAgICAgICAgICAgICAgIHJlbGF0aW9uUmVqZWN0KGVycik7XG4gICAgICAgICAgICB9KTtcblxuICAgICAgICB9KTtcbiAgICB9XG5cbiAgICAvKipcbiAgICAgKiBHZXRzIHRoZSBkZWZhdWx0IHZhbHVlIG9mIHJlc3VsdC4gTnVsbCBmb3IgaGFzT25lIGFuZCBhcnJheSBmb3IgaGFzTWFueVxuICAgICAqIEBwYXJhbSB0eXBlXG4gICAgICogQHJldHVybnMgeyp9XG4gICAgICovXG4gICAgZ2V0RGVmYXVsdFJlbGF0aW9uVmFsdWUodHlwZSkge1xuICAgIHN3aXRjaCAodHlwZSkge1xuICAgICAgICBjYXNlIE1vZGVsLlJFTEFUSU9OUy5oYXNPbmUgOlxuICAgICAgICAgICAgcmV0dXJuIG51bGw7XG4gICAgICAgIGNhc2UgTW9kZWwuUkVMQVRJT05TLmhhc01hbnkgOlxuICAgICAgICAgICAgcmV0dXJuIFtdO1xuICAgICAgICBkZWZhdWx0IDpcbiAgICAgICAgICAgIHJldHVybiBudWxsO1xuICAgIH1cbn1cblxuXG4gICAgLyoqXG4gICAgICogUmVhZHdyaXRlIHBhcmFtZXRlciBvZiBpbmRleGVkREJcbiAgICAgKiBAcmV0dXJuIHtzdHJpbmd9XG4gICAgICovXG4gICAgc3RhdGljIGdldCBSRUFEV1JJVEUoKSB7XG4gICAgICAgIHJldHVybiBcInJlYWR3cml0ZVwiO1xuICAgIH1cblxuICAgIC8qKlxuICAgICAqIFJlYWRvbmx5IHBhcmFtZXRlciBvZiBpbmRleGVkREJcbiAgICAgKiBAcmV0dXJuIHtzdHJpbmd9XG4gICAgICovXG4gICAgc3RhdGljIGdldCBSRUFET05MWSgpIHtcbiAgICAgICAgcmV0dXJuIFwicmVhZG9ubHlcIjtcbiAgICB9XG5cbn1cblxuY2xhc3MgTWlncmF0aW9uIHtcbiAgICBjb25zdHJ1Y3RvcihkYiwgdHJhbnNhY3Rpb24sIG1pZ3JhdGlvbnMpIHtcbiAgICAgICAgLyoqXG4gICAgICAgICAqIEB2YXIgSURCRGF0YWJhc2UgZGJcbiAgICAgICAgICovXG4gICAgICAgIHRoaXMuZGIgPSBkYjtcbiAgICAgICAgdGhpcy5taWdyYXRpb25zID0gbWlncmF0aW9ucztcbiAgICAgICAgdGhpcy5vYmplY3RTdG9yZXMgPSBbXTtcblxuICAgICAgICAvKipcbiAgICAgICAgICogQHZhciBJREJUcmFuc2FjdGlvbiB0cmFuc2FjdGlvblxuICAgICAgICAgKi9cbiAgICAgICAgdGhpcy50cmFuc2FjdGlvbiA9IHRyYW5zYWN0aW9uO1xuICAgIH1cblxuICAgIGNyZWF0ZVN0b3JlKHNjaGVtYSkge1xuICAgICAgICBsZXQgbWlnID0gdGhpcztcbiAgICAgICAgbGV0IHByaW1hcnkgPSBzY2hlbWEucHJpbWFyeSB8fCAnaWQnO1xuXG4gICAgICAgIGxldCBvYmplY3RTdG9yZSA9IG1pZy5kYi5jcmVhdGVPYmplY3RTdG9yZShzY2hlbWEubmFtZSwge2tleVBhdGg6IHByaW1hcnksIGF1dG9JbmNyZW1lbnQ6IHRydWV9KTtcbiAgICAgICAgbWlnLm9iamVjdFN0b3Jlcy5wdXNoKG9iamVjdFN0b3JlKTtcblxuICAgICAgICBpZiAoc2NoZW1hLmNvbHVtbnMpIHtcbiAgICAgICAgICAgIHNjaGVtYS5jb2x1bW5zLmZvckVhY2goKGNvbHVtbikgPT4gbWlnLm1ha2VJbmRleChjb2x1bW4sIG9iamVjdFN0b3JlKSk7XG4gICAgICAgIH1cblxuXG4gICAgfVxuXG4gICAgcnVuKCkge1xuICAgICAgICBsZXQgbWlnID0gdGhpcztcblxuICAgICAgICBtaWcubWlncmF0aW9ucy5mb3JFYWNoKChzY2hlbWEpID0+IHtcbiAgICAgICAgICAgIGlmKG1pZy5kYi5vYmplY3RTdG9yZU5hbWVzLmNvbnRhaW5zKHNjaGVtYS5uYW1lKSl7XG5cbiAgICAgICAgICAgICAgICBpZihzY2hlbWEuZHJvcCl7XG4gICAgICAgICAgICAgICAgICAgIG1pZy5kYi5kZWxldGVPYmplY3RTdG9yZShzY2hlbWEubmFtZSk7XG4gICAgICAgICAgICAgICAgfWVsc2V7XG4gICAgICAgICAgICAgICAgICAgIG1pZy51cGRhdGVTdG9yZShzY2hlbWEpO1xuICAgICAgICAgICAgICAgIH1cblxuXG4gICAgICAgICAgICB9ZWxzZXtcbiAgICAgICAgICAgICAgICBtaWcuY3JlYXRlU3RvcmUoc2NoZW1hKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfSk7XG4gICAgfVxuXG4gICAgbWFrZUluZGV4KGNvbHVtbiwgb2JqZWN0U3RvcmUpIHtcbiAgICAgICAgY29sdW1uLmF0dHJpYnV0ZXMgPSBjb2x1bW4uYXR0cmlidXRlcyB8fCB7fTtcbiAgICAgICAgY29sdW1uLmluZGV4ID0gY29sdW1uLmluZGV4IHx8IGNvbHVtbi5uYW1lO1xuICAgICAgICBvYmplY3RTdG9yZS5jcmVhdGVJbmRleChjb2x1bW4ubmFtZSwgY29sdW1uLmluZGV4LCBjb2x1bW4uYXR0cmlidXRlcyk7XG4gICAgfVxuXG4gICAgdXBkYXRlU3RvcmUoc2NoZW1hKSB7XG4gICAgICAgIGxldCBtaWcgPSB0aGlzO1xuXG4gICAgICAgIGxldCBvYmplY3RTdG9yZSA9IG1pZy50cmFuc2FjdGlvbi5vYmplY3RTdG9yZShzY2hlbWEubmFtZSk7XG5cbiAgICAgICAgaWYgKHNjaGVtYS5jb2x1bW5zKSB7XG5cbiAgICAgICAgICAgIHNjaGVtYS5jb2x1bW5zLmZvckVhY2goKGNvbHVtbikgPT4ge1xuICAgICAgICAgICAgICAgIGlmKCFvYmplY3RTdG9yZS5pbmRleE5hbWVzLmNvbnRhaW5zKGNvbHVtbi5uYW1lKSl7XG4gICAgICAgICAgICAgICAgICAgIG1pZy5tYWtlSW5kZXgoY29sdW1uLCBvYmplY3RTdG9yZSlcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgfVxuXG4gICAgICAgIGlmKHNjaGVtYS5kcm9wQ29sdW1ucykge1xuICAgICAgICAgICAgc2NoZW1hLmRyb3BDb2x1bW5zLmZvckVhY2goKGNvbHVtbikgPT4ge1xuICAgICAgICAgICAgICAgIGlmKG9iamVjdFN0b3JlLmluZGV4TmFtZXMuY29udGFpbnMoY29sdW1uKSl7XG4gICAgICAgICAgICAgICAgICAgIG1pZy5kcm9wSW5kZXgoY29sdW1uLCBvYmplY3RTdG9yZSlcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgfVxuICAgIH1cblxuICAgIGRyb3BJbmRleChjb2x1bW5OYW1lLCBvYmplY3RTdG9yZSkge1xuICAgICAgICBkZWJ1Z2dlcjtcbiAgICAgICAgb2JqZWN0U3RvcmUuZGVsZXRlSW5kZXgoY29sdW1uTmFtZSk7XG4gICAgfVxuXG59XG5cbmNsYXNzIERCIHtcblxuICAgIGNvbnN0cnVjdG9yKGlkYiwgaWRiS2V5LCBzZXR0aW5ncywgdXNlV2ViV29ya2VyLCBwYXRoVG9XZWJXb3JrZXIpIHtcbiAgICAgICAgdGhpcy5kYiA9IGlkYjtcbiAgICAgICAgdGhpcy5pZGJLZXkgPSBpZGJLZXk7XG4gICAgICAgIHRoaXMuc2V0dGluZ3MgPSBzZXR0aW5ncztcbiAgICAgICAgdGhpcy51c2VXZWJXb3JrZXIgPSB1c2VXZWJXb3JrZXIgfHwgZmFsc2U7XG4gICAgICAgIHRoaXMuaXNXZWJXb3JrZXIgPSBmYWxzZTtcbiAgICAgICAgdGhpcy5wYXRoVG9XZWJXb3JrZXIgPSBwYXRoVG9XZWJXb3JrZXI7XG4gICAgfVxuXG4gICAgLyoqXG4gICAgICogSW5pdGlhbGl6ZXMgZGF0YWJhc2UgY29ubmVjdGlvbiB3aXRoIGluZGV4ZWREQlxuICAgICAqXG4gICAgICogQHJldHVybnMge1Byb21pc2V9XG4gICAgICovXG4gICAgY29ubmVjdCgpIHtcbiAgICAgICAgbGV0IGRiID0gdGhpcztcbiAgICAgICAgcmV0dXJuIG5ldyBQcm9taXNlKChyZXNvbHZlLCByZWplY3QpID0+IHtcblxuICAgICAgICAgICAgaWYoZGIudXNlV2ViV29ya2VyKXtcbiAgICAgICAgICAgICAgICBkYi5jcmVhdGVXb3JrZXJIYW5kbGVyKHJlc29sdmUsIHJlamVjdCk7XG4gICAgICAgICAgICB9ZWxzZXtcbiAgICAgICAgICAgICAgICBkYi5jcmVhdGVOb3JtYWxIYW5kbGVyKHJlc29sdmUsIHJlamVjdCk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH0pO1xuICAgIH1cblxuICAgIC8qKlxuICAgICAqIERlc3Ryb3lzL0RlbGV0ZXMgdGhlIGRhdGFiYWFzZVxuICAgICAqIEBwYXJhbSBkYk5hbWVcbiAgICAgKi9cbiAgICBkZXN0cm95KGRiTmFtZSkge1xuICAgICAgICBjb25zb2xlLmluZm8oJ2RhdGFiYXNlICcgKyBkYk5hbWUgKyAnIGRlbGV0ZWQnKTtcbiAgICAgICAgdGhpcy5kYi5kZWxldGVEYXRhYmFzZShkYk5hbWUpO1xuICAgIH1cblxuICAgIC8qKlxuICAgICAqIENyZWF0ZXMgY29ubmVjdGlvbiBpbiB3ZWIgd29ya2VyIHNwYWNlIGFuZCBpZiB3ZWIgd29ya2VyIGZhaWxzXG4gICAgICogdGhlbiBjcmVhdGVzIG5vcm1hbCBkYXRhYmFzZSBjb25uZWN0aW9uIGluc3RhbmNlXG4gICAgICogQHBhcmFtIHJlc29sdmVcbiAgICAgKiBAcGFyYW0gcmVqZWN0XG4gICAgICovXG4gICAgY3JlYXRlV29ya2VySGFuZGxlciAocmVzb2x2ZSwgcmVqZWN0KSB7XG4gICAgICAgIGxldCBkYiA9IHRoaXM7XG4gICAgICAgIHRyeXtcbiAgICAgICAgICAgIGxldCB3b3JrZXIgPSBuZXcgd2luZG93LldvcmtlcihkYi5wYXRoVG9XZWJXb3JrZXIpO1xuICAgICAgICAgICAgbGV0IG1vZGVscyA9IHt9O1xuICAgICAgICAgICAgbGV0IHRpbWVzdGFtcCA9IERhdGUubm93KCk7XG5cbiAgICAgICAgICAgIHdvcmtlci5wb3N0TWVzc2FnZSh7XG4gICAgICAgICAgICAgICAgZGV0YWlsIDogSlNPTi5zdHJpbmdpZnkoZGIuc2V0dGluZ3MpLFxuICAgICAgICAgICAgICAgIGFjdGlvbiA6ICdpbml0aWFsaXplJyxcbiAgICAgICAgICAgICAgICB0aW1lc3RhbXAgOiB0aW1lc3RhbXBcbiAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgXG4gICAgICAgICAgICB3b3JrZXIub25tZXNzYWdlID0gZnVuY3Rpb24gKGUpIHtcbiAgICAgICAgICAgICAgICBpZihlLmRhdGEuYWN0aW9uID09PSAnaW5pdGlhbGl6ZScgJiYgZS5kYXRhLnRpbWVzdGFtcCA9PT0gdGltZXN0YW1wKSB7XG4gICAgICAgICAgICAgICAgICAgIGlmIChlLmRhdGEuZGV0YWlsID09PSB0cnVlKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBkYi5zZXR0aW5ncy5taWdyYXRpb25zLmZvckVhY2goKHNjaGVtYSkgPT4ge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIE9iamVjdC5kZWZpbmVQcm9wZXJ0eShtb2RlbHMsIHNjaGVtYS5uYW1lLCB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGdldCgpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBuZXcgV29ya2VyTW9kZWxIYW5kbGVyKHNjaGVtYS5uYW1lLCB3b3JrZXIsIHdpbmRvdyk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgICAgICAgICAgIH0pO1xuXG4gICAgICAgICAgICAgICAgICAgICAgICBkYi5pc1dlYldvcmtlciA9IHRydWU7XG4gICAgICAgICAgICAgICAgICAgICAgICByZXNvbHZlKG1vZGVscyk7XG4gICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBkYi5jcmVhdGVOb3JtYWxIYW5kbGVyKHJlc29sdmUsIHJlamVjdCk7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgfWNhdGNoIChlKSB7XG4gICAgICAgICAgICByZWplY3QoZSk7XG4gICAgICAgIH1cblxuICAgIH1cblxuICAgIC8qKlxuICAgICAqIENyZWF0ZXMgbm9ybWFsIGRhdGFiYXNlIGluc3RhbmNlIGFuZCBtb2RlbHNcbiAgICAgKiBAcGFyYW0gcmVzb2x2ZVxuICAgICAqIEBwYXJhbSByZWplY3RcbiAgICAgKi9cbiAgICBjcmVhdGVOb3JtYWxIYW5kbGVyIChyZXNvbHZlLCByZWplY3QpIHtcbiAgICAgICAgbGV0IGRiID0gdGhpcztcblxuICAgICAgICBsZXQgcmVxdWVzdCA9IHRoaXMuZGIub3Blbih0aGlzLnNldHRpbmdzLmRiTmFtZSwgdGhpcy5zZXR0aW5ncy5kYlZlcnNpb24pO1xuXG4gICAgICAgIHJlcXVlc3Qub251cGdyYWRlbmVlZGVkID0gZnVuY3Rpb24gKGUpIHtcbiAgICAgICAgICAgIGxldCBtaWcgPSBuZXcgTWlncmF0aW9uKGUudGFyZ2V0LnJlc3VsdCwgZS50YXJnZXQudHJhbnNhY3Rpb24sIGRiLnNldHRpbmdzLm1pZ3JhdGlvbnMpO1xuICAgICAgICAgICAgbWlnLnJ1bigpO1xuICAgICAgICB9O1xuXG4gICAgICAgIHJlcXVlc3Qub25lcnJvciA9IGZ1bmN0aW9uIChlKSB7XG4gICAgICAgICAgICByZWplY3QoZSk7XG4gICAgICAgIH07XG5cbiAgICAgICAgcmVxdWVzdC5vbnN1Y2Nlc3MgPSBmdW5jdGlvbiAoZSkge1xuICAgICAgICAgICAgbGV0IG1vZGVscyA9IHt9O1xuXG4gICAgICAgICAgICBkYi5zZXR0aW5ncy5taWdyYXRpb25zLmZvckVhY2goKHNjaGVtYSkgPT4ge1xuICAgICAgICAgICAgICAgIGxldCBwcmltYXJ5ID0gc2NoZW1hLnByaW1hcnkgfHwgJ2lkJztcbiAgICAgICAgICAgICAgICBPYmplY3QuZGVmaW5lUHJvcGVydHkobW9kZWxzLCBzY2hlbWEubmFtZSwge1xuICAgICAgICAgICAgICAgICAgICBnZXQoKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gbmV3IE1vZGVsKGUudGFyZ2V0LnJlc3VsdCwgZGIuaWRiS2V5LCBzY2hlbWEubmFtZSwgcHJpbWFyeSk7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIH0pO1xuXG4gICAgICAgICAgICByZXNvbHZlKG1vZGVscyk7XG4gICAgICAgIH07XG4gICAgfVxufVxud2luZG93LmlkYiA9IGZ1bmN0aW9uIChzZXR0aW5ncywgdXNlV2ViV29ya2VyLCBwYXRoVG9XZWJXb3JrZXIpe1xuICAgIFwidXNlIHN0cmljdFwiO1xuXG4gICAgdXNlV2ViV29ya2VyID0gdXNlV2ViV29ya2VyID09PSB1bmRlZmluZWQgPyB0cnVlIDogdXNlV2ViV29ya2VyO1xuXG4gICAgbGV0IGlkYiA9IHdpbmRvdy5pbmRleGVkREIgfHwgd2luZG93Lm1vekluZGV4ZWREQiB8fCB3aW5kb3cud2Via2l0SW5kZXhlZERCIHx8IHdpbmRvdy5tc0luZGV4ZWREQjtcbiAgICBsZXQgaWRiS2V5UmFuZ2UgPSB3aW5kb3cuSURCS2V5UmFuZ2UgfHwgd2luZG93LndlYmtpdElEQktleVJhbmdlIHx8IHdpbmRvdy5tc0lEQktleVJhbmdlO1xuICAgIGlmKCFpZGIpe1xuICAgICAgICB0aHJvdyBcIkluZGV4ZWREQiBub3Qgc3VwcG9ydGVkXCI7XG4gICAgfVxuXG4gICAgaWYoIWNoZWNrU2V0dGluZ3NDb25maWcoc2V0dGluZ3MpKXtcbiAgICAgICAgdGhyb3cgXCJzZXR0aW5ncyBwYXJhbWV0ZXIgaXMgaW5jb3JyZWN0bHkgc3RydWN0dXJlZFwiO1xuICAgIH1cblxuICAgIHJldHVybiBuZXcgREIoaWRiLCBpZGJLZXlSYW5nZSwgc2V0dGluZ3MsIGNoZWNrV2ViV29ya2VyKCksIHBhdGhUb1dlYldvcmtlcik7XG5cbiAgICBmdW5jdGlvbiBjaGVja1NldHRpbmdzQ29uZmlnKHNldHRpbmdzKSB7XG4gICAgICAgIHJldHVybiB0cnVlO1xuICAgIH1cblxuICAgIGZ1bmN0aW9uIGNoZWNrV2ViV29ya2VyKCl7XG4gICAgICAgIGlmKCF1c2VXZWJXb3JrZXIpIHtcbiAgICAgICAgICAgIHJldHVybiBmYWxzZTtcbiAgICAgICAgfVxuXG4gICAgICAgIHJldHVybiAod2luZG93LkJsb2IgJiYgd2luZG93Lldvcmtlcik7XG4gICAgfVxuXG59O1xuXG4vLyMgc291cmNlTWFwcGluZ1VSTD1pZGIuanMubWFwXG5cblxuXG4vLyBXRUJQQUNLIEZPT1RFUiAvL1xuLy8gYnVpbGQvaWRiLmpzIl0sIm1hcHBpbmdzIjoiQUFBQTtBQUdBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQURBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQUE7QUFDQTtBQUFBO0FBR0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7O0FBREE7QUFDQTs7Ozs7O0FBTUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7Ozs7QUFLQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7Ozs7QUFLQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7Ozs7O0FBS0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7Ozs7O0FBS0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7Ozs7OztBQU1BO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7Ozs7OztBQU1BO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7Ozs7OztBQU1BO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7Ozs7Ozs7QUFPQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7Ozs7OztBQU1BO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7Ozs7O0FBS0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7Ozs7QUFLQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7Ozs7OztBQU9BO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOzs7Ozs7O0FBT0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7OztBQUlBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7Ozs7Ozs7QUFRQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7Ozs7Ozs7O0FBUUE7QUFDQTtBQUNBO0FBQ0E7Ozs7Ozs7O0FBUUE7QUFDQTtBQUNBO0FBQ0E7O0FBOWRBO0FBK2RBO0FBQUE7QUFHQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7Ozs7O0FBREE7QUFDQTs7Ozs7O0FBTUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7Ozs7O0FBS0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOzs7OztBQUtBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOzs7Ozs7QUFNQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7Ozs7O0FBTUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7Ozs7OztBQU1BO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7Ozs7OztBQU9BO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7Ozs7O0FBTUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOzs7OztBQUtBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7Ozs7O0FBS0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOzs7Ozs7QUFNQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7Ozs7OztBQU9BO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOzs7Ozs7QUFNQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOzs7Ozs7QUFNQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7Ozs7OztBQU1BO0FBQ0E7QUFDQTtBQUNBOzs7OztBQUtBO0FBQ0E7QUFDQTtBQUNBOzs7Ozs7OztBQVFBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOzs7Ozs7OztBQVFBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOzs7Ozs7Ozs7QUFTQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7OztBQUlBO0FBQ0E7O0FBRUE7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7Ozs7OztBQU1BO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7Ozs7QUFLQTtBQUNBO0FBQ0E7QUFDQTs7Ozs7QUFLQTtBQUNBO0FBQ0E7QUFDQTs7OztBQWw2QkE7QUFDQTtBQW82QkE7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBR0E7QUFHQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOzsiLCJzb3VyY2VSb290IjoiIn0=");

/***/ }
/******/ ]);