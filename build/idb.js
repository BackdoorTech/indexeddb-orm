/******/ (function(modules) { // webpackBootstrap
/******/ 	// The module cache
/******/ 	var installedModules = {};

/******/ 	// The require function
/******/ 	function __webpack_require__(moduleId) {

/******/ 		// Check if module is in cache
/******/ 		if(installedModules[moduleId])
/******/ 			return installedModules[moduleId].exports;

/******/ 		// Create a new module (and put it into the cache)
/******/ 		var module = installedModules[moduleId] = {
/******/ 			i: moduleId,
/******/ 			l: false,
/******/ 			exports: {}
/******/ 		};

/******/ 		// Execute the module function
/******/ 		modules[moduleId].call(module.exports, module, module.exports, __webpack_require__);

/******/ 		// Flag the module as loaded
/******/ 		module.l = true;

/******/ 		// Return the exports of the module
/******/ 		return module.exports;
/******/ 	}


/******/ 	// expose the modules object (__webpack_modules__)
/******/ 	__webpack_require__.m = modules;

/******/ 	// expose the module cache
/******/ 	__webpack_require__.c = installedModules;

/******/ 	// identity function for calling harmory imports with the correct context
/******/ 	__webpack_require__.i = function(value) { return value; };

/******/ 	// define getter function for harmory exports
/******/ 	__webpack_require__.d = function(exports, name, getter) {
/******/ 		Object.defineProperty(exports, name, {
/******/ 			configurable: false,
/******/ 			enumerable: true,
/******/ 			get: getter
/******/ 		});
/******/ 	};

/******/ 	// getDefaultExport function for compatibility with non-harmony modules
/******/ 	__webpack_require__.n = function(module) {
/******/ 		var getter = module && module.__esModule ?
/******/ 			function getDefault() { return module['default']; } :
/******/ 			function getModuleExports() { return module; };
/******/ 		__webpack_require__.d(getter, 'a', getter);
/******/ 		return getter;
/******/ 	};

/******/ 	// Object.prototype.hasOwnProperty.call
/******/ 	__webpack_require__.o = function(object, property) { return Object.prototype.hasOwnProperty.call(object, property); };

/******/ 	// __webpack_public_path__
/******/ 	__webpack_require__.p = "";

/******/ 	// Load entry module and return exports
/******/ 	return __webpack_require__(__webpack_require__.s = 0);
/******/ })
/************************************************************************/
/******/ ([
/* 0 */
/***/ function(module, exports) {

eval("var Builder = function Builder () {\n    this.builder = [];\n    this.indexBuilder = {};\n    this.relations = [];\n    this.tables = [];\n};\n\nvar prototypeAccessors = { RELATIONS: {} };\nvar staticAccessors = { helpers: {},RELATIONS: {} };\n\n/**\n * Sets the index builder value as an 'and' reference\n *\n * @param indexName string\n * @param value mixed\n * @returns {Builder}\n */\nBuilder.prototype.whereIndex = function whereIndex (indexName, value) {\n\n    this.indexBuilder = {\n        index : indexName,\n        value : value,\n        type : 'and'\n    };\n\n    return this;\n};\n\n/**\n * Sets the index builder value as an 'in' reference\n * @param indexName\n * @param value\n * @returns {Builder}\n */\nBuilder.prototype.whereIndexIn = function whereIndexIn (indexName, value) {\n\n    this.indexBuilder = {\n        index : indexName,\n        value : value,\n        type : 'in'\n    };\n\n    return this;\n};\n\n/**\n * Sets the index builder value with point inclusive and sets greater than check\n * @param indexName\n * @param value\n * @returns {Builder}\n */\nBuilder.prototype.indexGte = function indexGte (indexName, value) {\n\n    this.indexBuilder = {\n        index : indexName,\n        value : value,\n        type : 'gte'\n    };\n\n    return this;\n};\n\n/**\n * Sets the index builder value with point not inclusive and sets greater than check\n * @param indexName\n * @param value\n * @returns {Builder}\n */\nBuilder.prototype.indexGt = function indexGt (indexName, value) {\n\n    this.indexBuilder = {\n        index : indexName,\n        value : value,\n        type : 'gt'\n    };\n\n    return this;\n};\n\n/**\n * Sets the index builder value with point inclusive and sets less than check\n * @param indexName\n * @param value\n * @returns {Builder}\n */\nBuilder.prototype.indexLte = function indexLte (indexName, value) {\n\n    this.indexBuilder = {\n        index : indexName,\n        value : value,\n        type : 'lte'\n    };\n\n    return this;\n};\n\n/**\n * Sets the index builder value with point not inclusive and sets less than check\n *\n * @param indexName\n * @param value\n * @returns {Builder}\n */\nBuilder.prototype.indexLt = function indexLt (indexName, value) {\n\n    this.indexBuilder = {\n        index : indexName,\n        value : value,\n        type : 'lt'\n    };\n\n    return this;\n};\n\n/**\n * Sets the index builder value with points inclusive and sets range between them\n * @param indexName\n * @param lower\n * @param upper\n * @returns {Builder}\n */\nBuilder.prototype.indexBetween = function indexBetween (indexName, lower, upper) {\n\n    this.indexBuilder = {\n        index : indexName,\n        value : [lower, upper],\n        type : 'between'\n    };\n\n    return this;\n};\n\nBuilder.prototype.whereIn = function whereIn (attributeName, value) {\n    this.builder.push({\n        attribute : attributeName,\n        value : value,\n        type : 'in'\n    });\n\n    return this;\n};\n\nBuilder.prototype.where = function where (attributeName, value) {\n    this.builder.push({\n        attribute : attributeName,\n        value : value,\n        type : 'and'\n    });\n\n    return this;\n};\n\n\nBuilder.prototype.gte = function gte (attributeName, value) {\n    this.builder.push({\n        attribute : attributeName,\n        value : value,\n        type : 'gte'\n    });\n\n    return this;\n};\n\nBuilder.prototype.gt = function gt (attributeName, value) {\n    this.builder.push({\n        attribute : attributeName,\n        value : value,\n        type : 'gt'\n    });\n\n    return this;\n};\n\nBuilder.prototype.lte = function lte (attributeName, value) {\n    this.builder.push({\n        attribute : attributeName,\n        value : value,\n        type : 'lte'\n    });\n\n    return this;\n};\n\nBuilder.prototype.lt = function lt (attributeName, value) {\n    this.builder.push({\n        attribute : attributeName,\n        value : value,\n        type : 'lt'\n    });\n\n    return this;\n};\n\nBuilder.prototype.between = function between (attributeName, upper, lower) {\n    uppper = parseFloat(upper);\n    lower = parseFloat(lower);\n\n    if(isNaN(upper) || isNaN(lower)){\n        throw \"Between is only for numeric values\";\n    }\n\n    this.builder.push({\n        attribute : attributeName,\n        value : [upper, lower],\n        type : 'between'\n    });\n\n    return this;\n};\n\nBuilder.prototype.relation = function relation (modelName, type, localKey, foreignKey, func, primary) {\n    this.tables.push(modelName);\n\n    this.relations.push({\n        modelName : modelName,\n        func : func,\n        localKey : localKey,\n        foreignKey : foreignKey,\n        type : type,\n        primary : primary\n    });\n\n    return this;\n};\n\nstaticAccessors.helpers.get = function () {\n\n    return {\n\n        checkNestedAttribute: function checkNestedAttribute (attributeString, value, condition) {\n            return condition == Model.helpers.getNestedAttribute(attributeString, value)\n        },\n\n        getNestedAttribute: function getNestedAttribute(attributeString, value) {\n            var attributes = attributeString.split('.');\n            var i;\n            var content = value;\n\n            for(i = 0; i < attributes.length; i++) {\n                if(content[attributes[i]] === undefined){\n                    return undefined;\n                }\n\n                content = content[attributes[i]];\n            }\n\n            return content;\n        },\n\n        replaceNestedValues: function replaceNestedValues(attributes, value) {\n            for(var attribute in attributes) {\n                value[attribute] = attributes[attribute];\n            }\n\n            return value;\n        },\n    };\n\n};\n\nprototypeAccessors.RELATIONS.get = function () {\n    return Builder.RELATIONS;\n};\n\nstaticAccessors.RELATIONS.get = function () {\n    return {\n        hasOne : 'hasOne',\n        hasMany : 'hasMany'\n    }\n};\n\nObject.defineProperties( Builder.prototype, prototypeAccessors );\nObject.defineProperties( Builder, staticAccessors );\nvar WorkerModelHandler = (function (Builder) {\n    function WorkerModelHandler(modelName, workerContent) {\n        Builder.call(this);\n\n        this.name = modelName;\n        this.worker = workerContent;\n        this.setUpHandler();\n        this.tables = [modelName];\n    }\n\n    if ( Builder ) WorkerModelHandler.__proto__ = Builder;\n    WorkerModelHandler.prototype = Object.create( Builder && Builder.prototype );\n    WorkerModelHandler.prototype.constructor = WorkerModelHandler;\n\n    /**\n     * Finds the model by id\n     * @param id\n     * @returns {Promise}\n     */\n    WorkerModelHandler.prototype.find = function find (id) {\n        var model = this;\n\n        return new Promise(function (resolve, reject) {\n            var timestamp = Date.now();\n\n            model.on(timestamp, 'find', handler);\n            model.on(timestamp, 'find-error', errorHandler);\n\n            model.send(id, timestamp, 'find');\n\n            /**\n             * normal success handler\n             * @param e\n             */\n            function handler(e) {\n                model.removeListener(timestamp, 'find', handler);\n                model.removeListener(timestamp, 'find-error', errorHandler());\n\n                resolve(e.detail);\n            }\n\n            /**\n             * Error handler case\n             * @param e\n             */\n            function errorHandler(e) {\n                model.removeListener(timestamp, 'find', errorHandler);\n                model.removeListener(timestamp, 'find-error', handler);\n                reject(e.detail);\n            }\n\n        });\n    };\n\n    /**\n     * Function fetches list of result matching the criteria\n     * @returns {Promise}\n     */\n    WorkerModelHandler.prototype.get = function get () {\n        var model = this;\n        return new Promise(function (resolve, reject) {\n            var timestamp = Date.now();\n\n            model.on(timestamp, 'get', handler);\n            model.on(timestamp, 'get-error', errorHandler);\n\n            model.send({\n                tables : model.tables,\n                builder : model.builder,\n                indexBuilder : model.indexBuilder,\n                relations : model.relations\n            }, timestamp, 'get');\n\n            function handler(e) {\n                model.removeListener(timestamp, 'get', handler);\n                model.removeListener(timestamp, 'get-error', errorHandler);\n\n                resolve(e.detail);\n            }\n\n            function errorHandler(e) {\n                model.removeListener(timestamp, 'get', errorHandler);\n                model.removeListener(timestamp, 'get-error', handler);\n                reject(e.detail);\n            }\n\n        });\n    };\n\n    /**\n     * Function fetches list of result matching the criteria\n     * @returns {Promise}\n     */\n    WorkerModelHandler.prototype.first = function first () {\n        var model = this;\n        return new Promise(function (resolve, reject) {\n            var timestamp = Date.now();\n\n            model.on(timestamp, 'first', handler);\n            model.on(timestamp, 'first-error', errorHandler);\n\n            model.send({\n                tables : model.tables,\n                builder : model.builder,\n                indexBuilder : model.indexBuilder,\n                relations : model.relations\n            }, timestamp, 'first');\n\n            function handler(e) {\n                model.removeListener(timestamp, 'first', handler);\n                model.removeListener(timestamp, 'first-error', errorHandler);\n\n                resolve(e.detail);\n            }\n\n            function errorHandler(e) {\n                model.removeListener(timestamp, 'first', errorHandler);\n                model.removeListener(timestamp, 'first-error', handler);\n                reject(e.detail);\n            }\n\n        });\n    };\n\n    /**\n     * Creates a record\n     * @param data\n     * @returns {Promise}\n     */\n    WorkerModelHandler.prototype.create = function create (data) {\n        var model = this;\n        return new Promise(function (resolve, reject) {\n            var timestamp = Date.now();\n\n            model.on(timestamp, 'create', handler);\n            model.on(timestamp, 'create-error', errorHandler);\n\n            model.send(data, timestamp, 'create');\n\n            function handler(e) {\n                model.removeListener(timestamp, 'create', handler);\n                model.removeListener(timestamp, 'create-error', errorHandler);\n\n                resolve(e.detail);\n            }\n\n            function errorHandler(e) {\n                model.removeListener(timestamp, 'create', errorHandler);\n                model.removeListener(timestamp, 'create-error', handler);\n                reject(e.detail);\n            }\n\n        });\n    };\n\n    /**\n     * Creates multiple records\n     * @param data Array\n     * @returns {Promise}\n     */\n    WorkerModelHandler.prototype.createMultiple = function createMultiple (data) {\n        var model = this;\n        return new Promise(function (resolve, reject) {\n            var timestamp = Date.now();\n\n            model.on(timestamp, 'createMultiple', handler);\n            model.on(timestamp, 'createMultiple-error', errorHandler);\n\n            model.send(data, timestamp, 'createMultiple');\n\n            function handler(e) {\n                model.removeListener(timestamp, 'createMultiple', handler);\n                model.removeListener(timestamp, 'createMultiple-error', errorHandler);\n\n                resolve(e.detail);\n            }\n\n            function errorHandler(e) {\n                model.removeListener(timestamp, 'createMultiple', errorHandler);\n                model.removeListener(timestamp, 'createMultiple-error', handler);\n                reject(e.detail);\n            }\n\n        });\n    };\n\n    /**\n     * Function updates the various records with matching values\n     * @param data\n     * @returns {Promise}\n     */\n    WorkerModelHandler.prototype.update = function update (data) {\n        var model = this;\n        return new Promise(function (resolve, reject) {\n            var timestamp = Date.now();\n\n            model.on(timestamp, 'update', handler);\n            model.on(timestamp, 'update-error', errorHandler);\n\n            model.send(data, timestamp, 'update');\n\n            function handler(e) {\n                model.removeListener(timestamp, 'update', handler);\n                model.removeListener(timestamp, 'update-error', errorHandler);\n\n                resolve(e.detail);\n            }\n\n            function errorHandler(e) {\n                model.removeListener(timestamp, 'update', errorHandler);\n                model.removeListener(timestamp, 'update-error', handler);\n                reject(e.detail);\n            }\n\n        });\n    };\n\n    /**\n     * Function updates the record at the given id\n     * @param id\n     * @param data\n     * @returns {Promise}\n     */\n    WorkerModelHandler.prototype.save = function save (id, data) {\n        var model = this;\n        return new Promise(function (resolve, reject) {\n\n            var timestamp = Date.now();\n            var content = {\n                id : id,\n                data : data\n            };\n\n            model.on(timestamp, 'save', handler);\n            model.on(timestamp, 'save-error', errorHandler);\n            model.send(content, timestamp, 'save');\n\n            function handler(e) {\n                model.removeListener(timestamp, 'save', handler);\n                model.removeListener(timestamp, 'save-error', errorHandler);\n\n                resolve(e.detail);\n            }\n\n            function errorHandler(e) {\n                model.removeListener(timestamp, 'save', errorHandler);\n                model.removeListener(timestamp, 'save-error', handler);\n                reject(e.detail);\n            }\n\n        });\n    };\n\n    /**\n     * Function deletes the entries at the given point\n     * @param id\n     * @returns {Promise}\n     */\n    WorkerModelHandler.prototype.destroyId = function destroyId (id) {\n        var model = this;\n        return new Promise(function (resolve, reject) {\n\n            var timestamp = Date.now();\n\n            model.on(timestamp, 'destroyId', handler);\n            model.on(timestamp, 'destroyId-error', errorHandler);\n            model.send(id, timestamp, 'destroyId');\n\n            function handler(e) {\n                model.removeListener(timestamp, 'destroyId', handler);\n                model.removeListener(timestamp, 'destroyId-error', errorHandler);\n\n                resolve(e.detail);\n            }\n\n            function errorHandler(e) {\n                model.removeListener(timestamp, 'destroyId', errorHandler);\n                model.removeListener(timestamp, 'destroyId-error', handler);\n                reject(e.detail);\n            }\n\n        });\n    };\n\n    /**\n     * Function deletes the entries\n     * @returns {Promise}\n     */\n    WorkerModelHandler.prototype.destroy = function destroy () {\n        var model = this;\n        return new Promise(function (resolve, reject) {\n\n            var timestamp = Date.now();\n\n            model.on(timestamp, 'destroy', handler);\n            model.on(timestamp, 'destroy-error', errorHandler);\n            model.send({}, timestamp, 'destroy');\n\n            function handler(e) {\n                model.removeListener(timestamp, 'destroy', handler);\n                model.removeListener(timestamp, 'destroy-error', errorHandler);\n\n                resolve(e.detail);\n            }\n\n            function errorHandler(e) {\n                model.removeListener(timestamp, 'destroy', errorHandler);\n                model.removeListener(timestamp, 'destroy-error', handler);\n                reject(e.detail);\n            }\n\n        });\n    };\n\n    /**\n     * Function counts the number of records\n     * @returns {Promise}\n     */\n    WorkerModelHandler.prototype.count = function count () {\n        var model = this;\n        return new Promise(function (resolve, reject) {\n            var timestamp = Date.now();\n\n            model.on(timestamp, 'count', handler);\n            model.on(timestamp, 'count-error', errorHandler);\n\n            model.send({}, timestamp, 'count');\n\n            function handler(e) {\n                model.removeListener(timestamp, 'count', handler);\n                model.removeListener(timestamp, 'count-error', errorHandler);\n\n                resolve(e.detail);\n            }\n\n            function errorHandler(e) {\n                model.removeListener(timestamp, 'count', errorHandler);\n                model.removeListener(timestamp, 'count-error', handler);\n                reject(e.detail);\n            }\n\n        });\n    };\n\n    WorkerModelHandler.prototype.average = function average (attribute) {\n        var model = this;\n        return new Promise(function (resolve, reject) {\n            var timestamp = Date.now();\n\n            model.on(timestamp, 'average', handler);\n            model.on(timestamp, 'average-error', errorHandler);\n\n            model.send(attribute, timestamp, 'average');\n\n            function handler(e) {\n                model.removeListener(timestamp, 'average', handler);\n                model.removeListener(timestamp, 'average-error', errorHandler);\n\n                resolve(e.detail);\n            }\n\n            function errorHandler(e) {\n                model.removeListener(timestamp, 'average', errorHandler);\n                model.removeListener(timestamp, 'average-error', handler);\n                reject(e.detail);\n            }\n\n        });\n    };\n\n    /**\n     * Reduce function is called with each passing iterator value and reduced value is returned\n     * @param func\n     * @param defaultCarry\n     * @returns {Promise}\n     */\n    WorkerModelHandler.prototype.reduce = function reduce (func, defaultCarry) {\n        var model = this;\n        return new Promise(function (resolve, reject) {\n            var timestamp = Date.now();\n\n            model.on(timestamp, 'reduce', handler);\n            model.on(timestamp, 'reduce-error', errorHandler);\n\n            var data = {\n                func : func,\n                defaultCarry : defaultCarry\n            };\n\n            model.send(data, timestamp, 'reduce');\n\n            function handler(e) {\n                model.removeListener(timestamp, 'reduce', handler);\n                model.removeListener(timestamp, 'reduce-error', errorHandler);\n\n                resolve(e.detail);\n            }\n\n            function errorHandler(e) {\n                model.removeListener(timestamp, 'reduce', errorHandler);\n                model.removeListener(timestamp, 'reduce-error', handler);\n                reject(e.detail);\n            }\n\n        });\n    };\n\n    /**\n     * Communicates to webworker\n     * @param data\n     * @param timestamp\n     * @param action\n     */\n    WorkerModelHandler.prototype.send = function send (data, timestamp, action) {\n        var model = this;\n\n        var detail = JSON.stringify(data, function (key, value) {\n            return (typeof value === 'function' ) ? value.toString() : value;\n        });\n\n        var e = {\n            detail : detail,\n            action : action,\n            timestamp : timestamp,\n            model : model.name\n        };\n\n        model.worker.postMessage(e);\n    };\n\n    /**\n     * Sets up basic handler settings to receive messages from worker\n     */\n    WorkerModelHandler.prototype.setUpHandler = function setUpHandler () {\n        var model = this;\n\n        //general handler to act up messages sent from web worker\n        model.worker.onmessage = function(e) {\n            var data = e.data.detail;\n            model.emit(data, e.data.timestamp, e.data.action);\n\n        }\n    };\n\n    /**\n     * Normal emit event on window.document\n     *\n     * @param data\n     * @param timestamp\n     * @param action\n     */\n    WorkerModelHandler.prototype.emit = function emit (data, timestamp, action) {\n        var model = this;\n        var e = new CustomEvent('idb:worker:' + model.modeName + ':' + timestamp + ':' + action, {\n            detail : data\n        });\n\n        window.document.dispatchEvent(e);\n    };\n\n    /**\n     * Removes event listener from window.document\n     *\n     * @param timestamp\n     * @param action\n     * @param func\n     */\n    WorkerModelHandler.prototype.removeListener = function removeListener (timestamp, action, func) {\n        window.document.removeEventListener('idb:worker:' + this.modeName + ':' + timestamp + ':' + action, func);\n    };\n\n    /**\n     * Listens events on window.document\n     *\n     * @param timestamp date time stamp\n     * @param action action name\n     * @param func function to be executed\n     */\n    WorkerModelHandler.prototype.on = function on (timestamp, action, func) {\n        window.document.addEventListener('idb:worker:' + this.modeName + ':' + timestamp + ':' + action, func);\n    };\n\n    return WorkerModelHandler;\n}(Builder));\nvar Model = (function (Builder) {\n    function Model(db, idbKey, modelName, primary){\n        Builder.call(this);\n\n        this.name = modelName;\n        this.db = db;\n        this.primary = primary;\n        this.tables = [this.name];\n        this.idbKey = idbKey;\n        this.hasIdbKey = this.idbKey ? true : false;\n        this.transaction = null;\n        this.attributes = {};\n    }\n\n    if ( Builder ) Model.__proto__ = Builder;\n    Model.prototype = Object.create( Builder && Builder.prototype );\n    Model.prototype.constructor = Model;\n\n    var staticAccessors$1 = { READWRITE: {},READONLY: {} };\n\n    /**\n     * Finds the result on the primary key defined\n     * @param id\n     * @returns {Promise}\n     */\n    Model.prototype.find = function find (id) {\n        var model = this;\n\n        return new Promise(function (resolve, reject) {\n            var transaction = model.getTransaction(model.tables, Model.READONLY);\n            var obj = transaction.objectStore(model.name);\n            var request = obj.get(id);\n            \n            request.onsuccess = function (e) {\n                resolve(e.target.result);\n            };\n\n            request.onerror = function (e) {\n                reject(e);\n            };\n\n        });\n    };\n\n    /**\n     * Searches for first value in database and returns that\n     * @returns {Promise}\n     */\n    Model.prototype.first = function first () {\n        var model = this;\n\n        return new Promise(function (resolve, reject) {\n            var transaction = model.getTransaction(model.tables, Model.READONLY);\n            var obj = transaction.objectStore(model.name);\n            var result = null;\n            var request;\n\n            if(model.indexBuilder.type){\n                request = model.getIndexResult(obj);\n            }else{\n                request = obj.openCursor();\n            }\n\n            request.onsuccess = function (e) {\n                var cursor = e.target.result;\n\n                if(cursor){\n                    if(model.checkBuilderValue(cursor.value)){\n                        var relationsCompleted = 0;\n\n                        result = cursor.value;\n\n                        if(model.relations.length > 0 && (result !== null || result !== undefined)){\n\n\n                            model.relations.forEach(function (relation) {\n\n                                var relationRequest = model.getRelationships(relation, model.transaction, model.getMainResult(result, relation.localKey, false), false);\n\n                                relationRequest.then(function (relationResult) {\n\n                                    relationsCompleted++;\n\n                                    var defaultValue = model.getDefaultRelationValue(relation.type);\n                                    result[relation.modelName] = result[relation.modelName] || defaultValue;\n\n                                    switch (relation.type) {\n                                        case Model.RELATIONS.hasOne :\n                                            if (relationResult !== undefined) {\n                                                result[relation.modelName] = relationResult[relation.foreignKey] == result[relation.localKey] ? relationResult : result[relation.modelName];\n                                            }\n\n                                            break;\n                                        case Model.RELATIONS.hasMany :\n                                            if (relationResult.length > 0) {\n                                                result[relation.modelName] = relationResult.filter(function (relationResultItem) {\n                                                    return relationResultItem[relation.foreignKey] == result[relation.localKey];\n                                                });\n                                            }\n                                            break;\n                                    }\n\n                                    if (relationsCompleted == model.relations.length) {\n                                        resolve(result);\n                                    }\n\n                                }).catch(function (err) {\n                                    reject(err);\n                                });\n                            });\n                        }else{\n                            resolve(cursor.value);\n                            return false;\n                        }\n                    }else{\n                        cursor.continue();\n                    }\n\n                }else{\n                    resolve(result);\n                }\n            };\n\n            request.onerror = function(e) {\n                reject(e);\n            }\n        });\n    };\n\n    /**\n     * Function searches throughout the database and returns a array of result\n     * @returns {Promise}\n     */\n    Model.prototype.get = function get () {\n        var model = this;\n\n        return new Promise(function (resolve, reject) {\n            var transaction = model.getTransaction(model.tables, Model.READONLY);\n            var obj = transaction.objectStore(model.name);\n            var result = [];\n            var request;\n\n            if(model.indexBuilder.type){\n                request = model.getIndexResult(obj);\n            }else{\n                request = obj.openCursor();\n            }\n\n            request.onsuccess = function (e) {\n                var cursor = e.target.result;\n\n                if(cursor){\n                    if(model.checkBuilderValue(cursor.value)){\n                        result.push(cursor.value);\n                    }\n                    cursor.continue();\n\n                }else{\n                    var mainResult, relationsCompleted = 0;\n\n                    if(model.relations.length > 0 && result.length > 0){\n\n\n                        model.relations.forEach(function (relation) {\n\n                            var relationRequest = model.getRelationships(relation, model.transaction, model.getMainResult(result, relation.localKey, true), true);\n\n                            relationRequest.then(function (relationResult) {\n\n                                relationsCompleted++;\n\n                                result = result.map(function (item) {\n\n                                    var defaultValue = model.getDefaultRelationValue(relation.type);\n                                    item[relation.modelName] = item[relation.modelName] || defaultValue;\n\n                                    switch (relation.type) {\n                                        case Model.RELATIONS.hasOne :\n                                            if(relationResult !== undefined) {\n                                                item[relation.modelName] = relationResult[relation.foreignKey] == item[relation.localKey] ? relationResult : item[relation.modelName];\n                                            }\n\n                                            break;\n                                        case Model.RELATIONS.hasMany :\n                                            if(relationResult.length > 0) {\n                                                item[relation.modelName] = relationResult.filter(function (relationResultItem) {\n                                                    return relationResultItem[relation.foreignKey] == item[relation.localKey];\n                                                });\n                                            }\n                                            break;\n                                    }\n\n                                    return item;\n                                });\n\n                                if(relationsCompleted == model.relations.length){\n                                    resolve(result);\n                                }\n\n                            }).catch(function (err) {\n                                reject(err);\n                            })\n                        });\n                    }else{\n                        resolve(result);\n                    }\n                }\n            };\n\n            request.onerror = function(e) {\n                reject(e);\n            }\n        });\n    };\n\n    /**\n     * Function creates a single record\n     * @param data\n     * @returns {Promise}\n     */\n    Model.prototype.create = function create (data) {\n        var model = this;\n\n        return new Promise(function (resolve, reject) {\n            var transaction = model.getTransaction(model.tables, Model.READWRITE);\n\n            var obj = transaction.objectStore(model.name);\n\n            data.createdAt = Date.now();\n            data.updatedAt = Date.now();\n\n            var request = obj.add(data);\n\n            request.onsuccess = function (e) {\n                data[model.primary] = e.target.result;\n                resolve(data);\n            };\n\n            request.onerror = function (e) {\n                reject(e);\n            };\n        });\n\n    };\n\n    /**\n     * Function creates list of records passed\n     * @param dataRecords\n     * @returns {Promise}\n     */\n    Model.prototype.createMultiple = function createMultiple (dataRecords) {\n        var model = this;\n\n        return new Promise(function (resolve, reject) {\n            var transaction = model.getTransaction(model.tables, Model.READWRITE);\n\n            var obj = transaction.objectStore(model.name);\n            var createdAt = Date.now();\n            var updatedAt = Date.now();\n            var result = [];\n\n            dataRecords.forEach(function (data) {\n                data.createdAt = createdAt;\n                data.updatedAt = updatedAt;\n\n                var request = obj.add(data);\n\n                request.onerror = function(e) {\n                    reject(e);\n                };\n\n                request.onsuccess = function(e) {\n                    data[model.primary] = e.target.result;\n\n                    result.push(data);\n\n                    if(result.length === dataRecords.length){\n                        resolve(result);\n                    }\n                };\n            })\n        });\n    };\n\n    /**\n     * Function updates the various records with matching values\n     * @param data\n     * @returns {Promise}\n     */\n    Model.prototype.update = function update (data) {\n\n        var model = this;\n        var updatedAt = Date.now();\n\n        return new Promise(function (resolve, reject) {\n            var transaction = model.getTransaction(model.tables, Model.READWRITE);\n            var obj = transaction.objectStore(model.name);\n            var request, totalRecordsBeingUpdated = 0, totalRecordsUpdated = 0;\n\n            if(model.indexBuilder.type){\n                request = model.getIndexResult(obj);\n            }else{\n                request = obj.openCursor();\n            }\n\n            request.onsuccess = function (e) {\n                var cursor = e.target.result;\n\n                if(cursor){\n                    if(model.checkBuilderValue(cursor.value)){\n                        totalRecordsBeingUpdated++;\n\n                        var id = cursor.value[model.primary];\n                        var createdAt = cursor.value.createdAt;\n\n                        var result = Model.helpers.replaceNestedValues(data, cursor.value);\n                        result[model.primary] = id;\n                        result.createdAt = createdAt;\n                        result.updatedAt = updatedAt;\n\n                        var updateRequest = cursor.update(result);\n\n                        updateRequest.onsuccess = function() {\n                            totalRecordsUpdated++;\n\n                            if(totalRecordsUpdated === totalRecordsBeingUpdated){\n                                resolve(true);\n                            }\n                        };\n\n                        updateRequest.onerror = function(err) {\n                            transaction.abort();\n                            reject(err);\n                        };\n\n                    }\n                    cursor.continue();\n\n                }else{\n                    resolve();\n                }\n            };\n\n            request.onerror = function(e) {\n                reject(e);\n            }\n        });\n    };\n\n    /**\n     * Function updates the record at the given id\n     * @param id\n     * @param data\n     * @returns {Promise}\n     */\n    Model.prototype.save = function save (id, data) {\n        var model = this;\n        var updatedAt = Date.now();\n\n        return new Promise(function (resolve, reject) {\n\n            model.find(id).then(function (result) {\n\n                if(!result){\n                    reject('No record found');\n                }\n\n                var transaction = model.getTransaction(model.tables, Model.READWRITE, true);\n                var obj = transaction.objectStore(model.name);\n\n                var id = result[model.primary];\n                var createdAt = result.createdAt;\n\n                result = Model.helpers.replaceNestedValues(data, result);\n                result[model.primary] = id;\n                result.createdAt = createdAt;\n                result.updatedAt = updatedAt;\n\n                var request = obj.put(result);\n\n                request.onsuccess = function () {\n                    resolve(true);\n                };\n\n                request.onerror = function(e) {\n                    reject(e);\n                }\n            }).catch(function (err) {\n                reject(err);\n            });\n\n        });\n    };\n\n    /**\n     * Function deletes the entries at the given point\n     * @param id\n     * @returns {Promise}\n     */\n    Model.prototype.destroyId = function destroyId (id) {\n        var model = this;\n\n\n        return new Promise(function (resolve, reject) {\n            model.find(id).then(function (result) {\n\n                if(!result){\n                    reject('result at id does not exists');\n                }\n\n                var transaction = model.getTransaction(model.tables, Model.READWRITE, true);\n                var obj = transaction.objectStore(model.name);\n                var request = obj.delete(id);\n\n                request.onsuccess = function (e) {\n                    resolve(e.target.result);\n                };\n\n                request.onerror = function (e) {\n                    reject(e);\n                };\n            }).catch(function (err) {\n                reject(err);\n            });\n\n\n        });\n    };\n\n    /**\n     * Function deletes the entries\n     * @returns {Promise}\n     */\n    Model.prototype.destroy = function destroy () {\n        var model = this;\n\n        return new Promise(function (resolve, reject) {\n            var transaction = model.getTransaction(model.tables, Model.READWRITE);\n            var obj = transaction.objectStore(model.name);\n            var request, totalRecordsBeingDeleted = 0, totalRecordsDeleted = 0;\n\n            if (model.indexBuilder.type) {\n                request = model.getIndexResult(obj);\n            } else {\n                request = obj.openCursor();\n            }\n\n            request.onsuccess = function (e) {\n                var cursor = e.target.result;\n\n                if (cursor) {\n                    if (model.checkBuilderValue(cursor.value)) {\n                        totalRecordsBeingDeleted++;\n\n                        var deleteRequest = cursor.delete();\n\n                        deleteRequest.onsuccess = function () {\n                            totalRecordsDeleted++;\n\n                            if (totalRecordsDeleted === totalRecordsBeingDeleted) {\n                                resolve(true);\n                            }\n                        };\n\n                        deleteRequest.onerror = function (err) {\n                            transaction.abort();\n                            reject(err);\n                        };\n\n                    }\n                    cursor.continue();\n\n                } else {\n                    resolve();\n                }\n            };\n\n            request.onerror = function (e) {\n                reject(e);\n            }\n        });\n    };\n\n    /**\n     * Function counts the number of records\n     * @returns {Promise}\n     */\n    Model.prototype.count = function count () {\n        var model = this;\n\n        return new Promise(function (resolve, reject) {\n            var transaction = model.getTransaction(model.tables, Model.READONLY);\n            var obj = transaction.objectStore(model.name);\n            var result = 0;\n            var request;\n\n            if(model.indexBuilder.type){\n                request = model.getIndexResult(obj);\n            }else{\n                request = obj.openCursor();\n            }\n\n            request.onsuccess = function (e) {\n                var cursor = e.target.result;\n\n                if(cursor){\n                    if(model.checkBuilderValue(cursor.value)){\n                        result++;\n                    }\n\n                    cursor.continue();\n\n                }else{\n                    resolve(result);\n                }\n            };\n\n            request.onerror = function(e) {\n                reject(e);\n            }\n        });\n    };\n\n    /**\n     * Function averages the numeric value at the given point\n     * @param attribute\n     * @returns {Promise}\n     */\n    Model.prototype.average = function average (attribute) {\n        var model = this;\n\n        return new Promise(function (resolve, reject) {\n            var transaction = model.getTransaction(model.tables, Model.READONLY);\n            var obj = transaction.objectStore(model.name);\n            var result = 0, totalRecords = 0;\n            var request;\n\n            if(model.indexBuilder.type){\n                request = model.getIndexResult(obj);\n            }else{\n                request = obj.openCursor();\n            }\n\n            request.onsuccess = function (e) {\n                var cursor = e.target.result;\n\n                if(cursor){\n                    if(model.checkBuilderValue(cursor.value)){\n                        totalRecords++;\n                        var tempResult = Model.helpers.getNestedAttribute(attribute, cursor.value);\n                        tempResult = parseFloat(tempResult);\n                        tempResult = isNaN(tempResult) ? 0 : tempResult;\n                        result += tempResult;\n                    }\n\n                    cursor.continue();\n\n                }else{\n                    resolve(result/totalRecords);\n                }\n            };\n\n            request.onerror = function(e) {\n                reject(e);\n            }\n        });\n    };\n\n    /**\n     * Reduce function is called with each passing iterator value and reduced value is returned\n     * @param func\n     * @param defaultCarry\n     * @returns {Promise}\n     */\n    Model.prototype.reduce = function reduce (func, defaultCarry) {\n        var model = this;\n\n        if(typeof func !== 'function'){\n            throw \"Parameter should be a function type\";\n        }\n\n        return new Promise(function (resolve, reject) {\n            var transaction = model.getTransaction(model.tables, Model.READONLY);\n            var obj = transaction.objectStore(model.name);\n            var result = defaultCarry;\n            var request;\n\n            if(model.indexBuilder.type){\n                request = model.getIndexResult(obj);\n            }else{\n                request = obj.openCursor();\n            }\n\n            request.onsuccess = function (e) {\n                var cursor = e.target.result;\n\n                if(cursor){\n                    if(model.checkBuilderValue(cursor.value)){\n                        result = func(cursor.value, result);\n                    }\n\n                    cursor.continue();\n\n                }else{\n                    resolve(result);\n                }\n            };\n\n            request.onerror = function(e) {\n                reject(e);\n            }\n        });\n    };\n\n    /**\n     * Sets the index search criteria\n     * @param objectStore\n     * @returns {*}\n     */\n    Model.prototype.getIndexResult = function getIndexResult (objectStore) {\n        var builder = this;\n        var range;\n        var index;\n\n\n        if(!builder.indexBuilder.type) {\n            return objectStore.openCursor();\n        }\n\n        if(builder.indexBuilder.index !== builder.primary){\n            index = objectStore.index(builder.indexBuilder.index);\n        }else{\n            index = objectStore;\n        }\n\n        switch (builder.indexBuilder.type) {\n            case 'and' :\n                range = builder.idbKey.only(builder.indexBuilder.value);\n                break;\n\n            case 'in' :\n                builder.whereIn(builder.indexBuilder.index, builder.indexBuilder.value);\n                var values = builder.indexBuilder.value.sort();\n                range = builder.idbKey.bound(values[0], values[values.length - 1], false, false);\n                break;\n\n            case 'gte' :\n                range = builder.idbKey.lowerBound(builder.indexBuilder.value, false);\n                break;\n\n            case 'gt' :\n                range = builder.idbKey.lowerBound(builder.indexBuilder.value, true);\n                break;\n\n            case 'lte' :\n                range = builder.idbKey.upperBound(builder.indexBuilder.value, false);\n                break;\n\n            case 'lt' :\n                range = builder.idbKey.lowerBound(builder.indexBuilder.value, true);\n                break;\n\n            case 'between' :\n                range = builder.idbKey.bound(builder.indexBuilder.value[0], builder.indexBuilder.value[1], false, false);\n                break;\n            default :\n                throw 'Invalid builder type found';\n        }\n\n        return index.openCursor(range);\n    };\n\n    /**\n     * Checks common search criteria other than the index values\n     * @param value\n     * @returns {boolean}\n     */\n    Model.prototype.checkBuilderValue = function checkBuilderValue (value) {\n        var builder = this;\n        var result = true;\n        var i,j;\n        for (i = 0; i < builder.builder.length; i++){\n\n            var condition = builder.builder[i];\n            switch(condition.type){\n\n                case 'and' : //case for one to one search\n                    if(!Model.helpers.checkNestedAttribute(condition.attribute, value, condition.value)){\n                        return false;\n                    }\n                    break;\n\n                case 'in' : //case for list search\n                    var tempCheck = false;\n                    for(j = 0; j < condition.value.length; j++) {\n                        result = Model.helpers.checkNestedAttribute(condition.attribute, value, condition.value[j]);\n                        if(result !== undefined && result !== false) {\n                            tempCheck = true;\n                        }\n                    }\n\n                    if(!tempCheck){\n                        return false;\n                    }\n\n                    result = true;\n\n                    break;\n\n                case 'gte' : //case for checking the value is greater than or is equal to the same\n                    result = Model.helpers.getNestedAttribute(condition.attribute, value);\n\n                    if(result === undefined) {\n                        return false;\n                    }\n\n                    if(result < condition.value){\n                        return false;\n                    }\n\n                    result = true;\n                    break;\n\n                case 'gt' : //case for checking the value is greater than the same\n\n                    result = Model.helpers.getNestedAttribute(condition.attribute, value);\n\n                    if(result === undefined) {\n                        return false;\n                    }\n\n                    if(result <= condition.value){\n                        return false;\n                    }\n\n                    result = true;\n                    break;\n\n                case 'lte' : //case for checking the value is less than or is equal to the same\n                    result = Model.helpers.getNestedAttribute(condition.attribute, value);\n\n                    if(result === undefined) {\n                        return false;\n                    }\n\n                    if(result > condition.value){\n                        return false;\n                    }\n                    result = true;\n                    break;\n\n                case 'lt' : //case for checking the value is less than the same\n                    result = Model.helpers.getNestedAttribute(condition.attribute, value);\n\n                    if(result === undefined) {\n                        return false;\n                    }\n\n                    if(result >= condition.value){\n                        return false;\n                    }\n                    result = true;\n                    break;\n\n                case 'between' : //case for checking the value is between the given range(ONLY WORKS FOR NUMERIC)\n                    result = Model.helpers.getNestedAttribute(condition.attribute, value);\n\n                    if(result === undefined) {\n                        return false;\n                    }\n\n                    if(condition.value[0] >= result && condition.value[1] <= result){\n                        return false\n                    }\n                    result = true;\n                    break;\n\n                default:\n                    result = true;\n            }\n        }\n\n        return result;\n    };\n\n    /**\n     * Creates a transaction\n     * @param tables\n     * @param mode\n     */\n    Model.prototype.createTransaction = function createTransaction (tables, mode) {\n        this.transaction = this.db.transaction(tables, mode)\n    };\n\n    /**\n     * Sets IDBTransaction obejct to current model scope\n     * @param transaction\n     */\n    Model.prototype.setTransaction = function setTransaction (transaction) {\n        this.transaction = transaction\n    };\n\n    /**\n     * Returns the IDBTransaction object set in current scope\n     * @param {Array} tables\n     * @param {String} mode\n     * @param {boolean} overwrite\n     * @returns {*|null}\n     */\n    Model.prototype.getTransaction = function getTransaction (tables, mode, overwrite) {\n        overwrite = overwrite === undefined ? false : overwrite;\n\n        if(!this.transaction || overwrite === true) {\n            this.createTransaction(tables, mode);\n        }\n\n        return this.transaction;\n    };\n\n    /**\n     * Returns the array or direct key value against the input give for the key specified\n     * @param result\n     * @param key\n     * @param isArray\n     * @returns {*}\n     */\n    Model.prototype.getMainResult = function getMainResult (result, key, isArray) {\n        if(isArray){\n            return result.map(function (item) {\n                return item[key];\n            });\n        }else{\n            return result[key];\n        }\n    };\n\n    /**\n     * Searches for relationships assigned with builder and fetches them\n     * @param relation\n     * @param transaction\n     * @param mainResult\n     * @param isArray\n     * @returns {Promise}\n     */\n    Model.prototype.getRelationships = function getRelationships (relation, transaction, mainResult, isArray) {\n\n        isArray = isArray || false;\n\n        var model = this;\n        var primary = relation.primary || 'id';\n\n        /**\n         * @var Model relationModel\n         */\n        var relationModel = new Model(model.db, model.idbKey, relation.modelName, relation.primary);\n\n        //setting the relation transaction same as parent transaction\n        relationModel.setTransaction(transaction);\n\n        //if a secondry builder function was defined\n        if(relation.func){\n            var tempBuilder = new Builder();\n\n            tempBuilder = relation.func(tempBuilder);\n\n            relationModel.tables = tempBuilder.tables;\n            relationModel.tables.push(relationModel.name);\n            relationModel.relations = tempBuilder.relations;\n            relationModel.builder = tempBuilder.builder;\n        }\n\n        //checking type of parent result\n        if(isArray){\n            relationModel.whereIndexIn(relation.foreignKey, mainResult);\n        }else{\n            relationModel.whereIndex(relation.foreignKey, mainResult);\n        }\n\n        return new Promise(function (relationResolve, relationReject) {\n\n            var result;\n\n            //if relation type mentioned\n            switch (relation.type) {\n                case Model.RELATIONS.hasOne :\n                    result = relationModel.first();\n                    break;\n                case Model.RELATIONS.hasMany :\n                    result = relationModel.get();\n                    break;\n                default :\n                    throw \"Invalid relation type provided\";\n            }\n\n            result.then(function (r) {\n                relationResolve(r);\n            }).catch(function (err) {\n                relationReject(err);\n            });\n\n        });\n    };\n\n    /**\n     * Gets the default value of result. Null for hasOne and array for hasMany\n     * @param type\n     * @returns {*}\n     */\n    Model.prototype.getDefaultRelationValue = function getDefaultRelationValue (type) {\n    switch (type) {\n        case Model.RELATIONS.hasOne :\n            return null;\n        case Model.RELATIONS.hasMany :\n            return [];\n        default :\n            return null;\n    }\n};\n\n\n    /**\n     * Readwrite parameter of indexedDB\n     * @return {string}\n     */\n    staticAccessors$1.READWRITE.get = function () {\n        return \"readwrite\";\n    };\n\n    /**\n     * Readonly parameter of indexedDB\n     * @return {string}\n     */\n    staticAccessors$1.READONLY.get = function () {\n        return \"readonly\";\n    };\n\n    Object.defineProperties( Model, staticAccessors$1 );\n\n    return Model;\n}(Builder));\n\nvar Migration = function Migration(db, transaction, migrations) {\n    /**\n     * @var IDBDatabase db\n     */\n    this.db = db;\n    this.migrations = migrations;\n    this.objectStores = [];\n\n    /**\n     * @var IDBTransaction transaction\n     */\n    this.transaction = transaction;\n};\n\nMigration.prototype.createStore = function createStore (schema) {\n    var mig = this;\n    var primary = schema.primary || 'id';\n\n    var objectStore = mig.db.createObjectStore(schema.name, {keyPath: primary, autoIncrement: true});\n    mig.objectStores.push(objectStore);\n\n    if (schema.columns) {\n        schema.columns.forEach(function (column) { return mig.makeIndex(column, objectStore); });\n    }\n\n\n};\n\nMigration.prototype.run = function run () {\n    var mig = this;\n\n    mig.migrations.forEach(function (schema) {\n        if(mig.db.objectStoreNames.contains(schema.name)){\n\n            if(schema.drop){\n                mig.db.deleteObjectStore(schema.name);\n            }else{\n                mig.updateStore(schema);\n            }\n\n\n        }else{\n            mig.createStore(schema);\n        }\n    });\n};\n\nMigration.prototype.makeIndex = function makeIndex (column, objectStore) {\n    column.attributes = column.attributes || {};\n    column.index = column.index || column.name;\n    objectStore.createIndex(column.name, column.index, column.attributes);\n};\n\nMigration.prototype.updateStore = function updateStore (schema) {\n    var mig = this;\n\n    var objectStore = mig.transaction.objectStore(schema.name);\n\n    if (schema.columns) {\n\n        schema.columns.forEach(function (column) {\n            if(!objectStore.indexNames.contains(column.name)){\n                mig.makeIndex(column, objectStore)\n            }\n        });\n    }\n\n    if(schema.dropColumns) {\n        schema.dropColumns.forEach(function (column) {\n            if(objectStore.indexNames.contains(column)){\n                mig.dropIndex(column, objectStore)\n            }\n        });\n    }\n};\n\nMigration.prototype.dropIndex = function dropIndex (columnName, objectStore) {\n    debugger;\n    objectStore.deleteIndex(columnName);\n};\n\nvar DB = function DB(idb, idbKey, settings, useWebWorker, pathToWebWorker) {\n    this.db = idb;\n    this.idbKey = idbKey;\n    this.settings = settings;\n    this.useWebWorker = useWebWorker || false;\n    this.isWebWorker = false;\n    this.pathToWebWorker = pathToWebWorker;\n};\n\n/**\n * Initializes database connection with indexedDB\n *\n * @returns {Promise}\n */\nDB.prototype.connect = function connect () {\n    var db = this;\n    return new Promise(function (resolve, reject) {\n\n        if(db.useWebWorker){\n            db.createWorkerHandler(resolve, reject);\n        }else{\n            db.createNormalHandler(resolve, reject);\n        }\n    });\n};\n\n/**\n * Destroys/Deletes the databaase\n * @param dbName\n */\nDB.prototype.destroy = function destroy (dbName) {\n    console.info('database ' + dbName + ' deleted');\n    this.db.deleteDatabase(dbName);\n};\n\n/**\n * Creates connection in web worker space and if web worker fails\n * then creates normal database connection instance\n * @param resolve\n * @param reject\n */\nDB.prototype.createWorkerHandler = function createWorkerHandler (resolve, reject) {\n    var db = this;\n    try{\n        var worker = new window.Worker(db.pathToWebWorker);\n        var models = {};\n        var timestamp = Date.now();\n\n        worker.postMessage({\n            detail : JSON.stringify(db.settings),\n            action : 'initialize',\n            timestamp : timestamp\n        });\n            \n        worker.onmessage = function (e) {\n            if(e.data.action === 'initialize' && e.data.timestamp === timestamp) {\n                if (e.data.detail === true) {\n                    db.settings.migrations.forEach(function (schema) {\n                        Object.defineProperty(models, schema.name, {\n                            get: function get() {\n                                return new WorkerModelHandler(schema.name, worker, window);\n                            }\n                        });\n                    });\n\n                    db.isWebWorker = true;\n                    resolve(models);\n                } else {\n                    db.createNormalHandler(resolve, reject);\n                }\n            }\n        }\n\n    }catch (e) {\n        reject(e);\n    }\n\n};\n\n/**\n * Creates normal database instance and models\n * @param resolve\n * @param reject\n */\nDB.prototype.createNormalHandler = function createNormalHandler (resolve, reject) {\n    var db = this;\n\n    var request = this.db.open(this.settings.dbName, this.settings.dbVersion);\n\n    request.onupgradeneeded = function (e) {\n        var mig = new Migration(e.target.result, e.target.transaction, db.settings.migrations);\n        mig.run();\n    };\n\n    request.onerror = function (e) {\n        reject(e);\n    };\n\n    request.onsuccess = function (e) {\n        var models = {};\n\n        db.settings.migrations.forEach(function (schema) {\n            var primary = schema.primary || 'id';\n            Object.defineProperty(models, schema.name, {\n                get: function get() {\n                    return new Model(e.target.result, db.idbKey, schema.name, primary);\n                }\n            });\n        });\n\n        resolve(models);\n    };\n};\nwindow.idb = function (settings, useWebWorker, pathToWebWorker){\n    \"use strict\";\n\n    useWebWorker = useWebWorker === undefined ? false : useWebWorker;\n\n    if(useWebWorker && !pathToWebWorker){\n        throw \"Path to worker not defined\";\n    }\n\n    var idb = window.indexedDB || window.mozIndexedDB || window.webkitIndexedDB || window.msIndexedDB;\n    var idbKeyRange = window.IDBKeyRange || window.webkitIDBKeyRange || window.msIDBKeyRange;\n    if(!idb){\n        throw \"IndexedDB not supported\";\n    }\n\n    if(!checkSettingsConfig(settings)){\n        throw \"settings parameter is incorrectly structured\";\n    }\n\n    return new DB(idb, idbKeyRange, settings, checkWebWorker(), pathToWebWorker);\n\n    function checkSettingsConfig(settings) {\n        return true;\n    }\n\n    function checkWebWorker(){\n        if(!useWebWorker) {\n            return false;\n        }\n\n        return (window.Blob && window.Worker);\n    }\n\n};\n\n//# sourceMappingURL=idb.js.map\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiMC5qcyIsInNvdXJjZXMiOlsid2VicGFjazovLy9idWlsZC9pZGIuanM/Mzg5NiJdLCJzb3VyY2VzQ29udGVudCI6WyJjbGFzcyBCdWlsZGVyIHtcblxuICAgIGNvbnN0cnVjdG9yICgpIHtcbiAgICAgICAgdGhpcy5idWlsZGVyID0gW107XG4gICAgICAgIHRoaXMuaW5kZXhCdWlsZGVyID0ge307XG4gICAgICAgIHRoaXMucmVsYXRpb25zID0gW107XG4gICAgICAgIHRoaXMudGFibGVzID0gW107XG4gICAgfVxuXG4gICAgLyoqXG4gICAgICogU2V0cyB0aGUgaW5kZXggYnVpbGRlciB2YWx1ZSBhcyBhbiAnYW5kJyByZWZlcmVuY2VcbiAgICAgKlxuICAgICAqIEBwYXJhbSBpbmRleE5hbWUgc3RyaW5nXG4gICAgICogQHBhcmFtIHZhbHVlIG1peGVkXG4gICAgICogQHJldHVybnMge0J1aWxkZXJ9XG4gICAgICovXG4gICAgd2hlcmVJbmRleChpbmRleE5hbWUsIHZhbHVlKSB7XG5cbiAgICAgICAgdGhpcy5pbmRleEJ1aWxkZXIgPSB7XG4gICAgICAgICAgICBpbmRleCA6IGluZGV4TmFtZSxcbiAgICAgICAgICAgIHZhbHVlIDogdmFsdWUsXG4gICAgICAgICAgICB0eXBlIDogJ2FuZCdcbiAgICAgICAgfTtcblxuICAgICAgICByZXR1cm4gdGhpcztcbiAgICB9XG5cbiAgICAvKipcbiAgICAgKiBTZXRzIHRoZSBpbmRleCBidWlsZGVyIHZhbHVlIGFzIGFuICdpbicgcmVmZXJlbmNlXG4gICAgICogQHBhcmFtIGluZGV4TmFtZVxuICAgICAqIEBwYXJhbSB2YWx1ZVxuICAgICAqIEByZXR1cm5zIHtCdWlsZGVyfVxuICAgICAqL1xuICAgIHdoZXJlSW5kZXhJbihpbmRleE5hbWUsIHZhbHVlKSB7XG5cbiAgICAgICAgdGhpcy5pbmRleEJ1aWxkZXIgPSB7XG4gICAgICAgICAgICBpbmRleCA6IGluZGV4TmFtZSxcbiAgICAgICAgICAgIHZhbHVlIDogdmFsdWUsXG4gICAgICAgICAgICB0eXBlIDogJ2luJ1xuICAgICAgICB9O1xuXG4gICAgICAgIHJldHVybiB0aGlzO1xuICAgIH1cblxuICAgIC8qKlxuICAgICAqIFNldHMgdGhlIGluZGV4IGJ1aWxkZXIgdmFsdWUgd2l0aCBwb2ludCBpbmNsdXNpdmUgYW5kIHNldHMgZ3JlYXRlciB0aGFuIGNoZWNrXG4gICAgICogQHBhcmFtIGluZGV4TmFtZVxuICAgICAqIEBwYXJhbSB2YWx1ZVxuICAgICAqIEByZXR1cm5zIHtCdWlsZGVyfVxuICAgICAqL1xuICAgIGluZGV4R3RlKGluZGV4TmFtZSwgdmFsdWUpIHtcblxuICAgICAgICB0aGlzLmluZGV4QnVpbGRlciA9IHtcbiAgICAgICAgICAgIGluZGV4IDogaW5kZXhOYW1lLFxuICAgICAgICAgICAgdmFsdWUgOiB2YWx1ZSxcbiAgICAgICAgICAgIHR5cGUgOiAnZ3RlJ1xuICAgICAgICB9O1xuXG4gICAgICAgIHJldHVybiB0aGlzO1xuICAgIH1cblxuICAgIC8qKlxuICAgICAqIFNldHMgdGhlIGluZGV4IGJ1aWxkZXIgdmFsdWUgd2l0aCBwb2ludCBub3QgaW5jbHVzaXZlIGFuZCBzZXRzIGdyZWF0ZXIgdGhhbiBjaGVja1xuICAgICAqIEBwYXJhbSBpbmRleE5hbWVcbiAgICAgKiBAcGFyYW0gdmFsdWVcbiAgICAgKiBAcmV0dXJucyB7QnVpbGRlcn1cbiAgICAgKi9cbiAgICBpbmRleEd0KGluZGV4TmFtZSwgdmFsdWUpIHtcblxuICAgICAgICB0aGlzLmluZGV4QnVpbGRlciA9IHtcbiAgICAgICAgICAgIGluZGV4IDogaW5kZXhOYW1lLFxuICAgICAgICAgICAgdmFsdWUgOiB2YWx1ZSxcbiAgICAgICAgICAgIHR5cGUgOiAnZ3QnXG4gICAgICAgIH07XG5cbiAgICAgICAgcmV0dXJuIHRoaXM7XG4gICAgfVxuXG4gICAgLyoqXG4gICAgICogU2V0cyB0aGUgaW5kZXggYnVpbGRlciB2YWx1ZSB3aXRoIHBvaW50IGluY2x1c2l2ZSBhbmQgc2V0cyBsZXNzIHRoYW4gY2hlY2tcbiAgICAgKiBAcGFyYW0gaW5kZXhOYW1lXG4gICAgICogQHBhcmFtIHZhbHVlXG4gICAgICogQHJldHVybnMge0J1aWxkZXJ9XG4gICAgICovXG4gICAgaW5kZXhMdGUoaW5kZXhOYW1lLCB2YWx1ZSkge1xuXG4gICAgICAgIHRoaXMuaW5kZXhCdWlsZGVyID0ge1xuICAgICAgICAgICAgaW5kZXggOiBpbmRleE5hbWUsXG4gICAgICAgICAgICB2YWx1ZSA6IHZhbHVlLFxuICAgICAgICAgICAgdHlwZSA6ICdsdGUnXG4gICAgICAgIH07XG5cbiAgICAgICAgcmV0dXJuIHRoaXM7XG4gICAgfVxuXG4gICAgLyoqXG4gICAgICogU2V0cyB0aGUgaW5kZXggYnVpbGRlciB2YWx1ZSB3aXRoIHBvaW50IG5vdCBpbmNsdXNpdmUgYW5kIHNldHMgbGVzcyB0aGFuIGNoZWNrXG4gICAgICpcbiAgICAgKiBAcGFyYW0gaW5kZXhOYW1lXG4gICAgICogQHBhcmFtIHZhbHVlXG4gICAgICogQHJldHVybnMge0J1aWxkZXJ9XG4gICAgICovXG4gICAgaW5kZXhMdChpbmRleE5hbWUsIHZhbHVlKSB7XG5cbiAgICAgICAgdGhpcy5pbmRleEJ1aWxkZXIgPSB7XG4gICAgICAgICAgICBpbmRleCA6IGluZGV4TmFtZSxcbiAgICAgICAgICAgIHZhbHVlIDogdmFsdWUsXG4gICAgICAgICAgICB0eXBlIDogJ2x0J1xuICAgICAgICB9O1xuXG4gICAgICAgIHJldHVybiB0aGlzO1xuICAgIH1cblxuICAgIC8qKlxuICAgICAqIFNldHMgdGhlIGluZGV4IGJ1aWxkZXIgdmFsdWUgd2l0aCBwb2ludHMgaW5jbHVzaXZlIGFuZCBzZXRzIHJhbmdlIGJldHdlZW4gdGhlbVxuICAgICAqIEBwYXJhbSBpbmRleE5hbWVcbiAgICAgKiBAcGFyYW0gbG93ZXJcbiAgICAgKiBAcGFyYW0gdXBwZXJcbiAgICAgKiBAcmV0dXJucyB7QnVpbGRlcn1cbiAgICAgKi9cbiAgICBpbmRleEJldHdlZW4oaW5kZXhOYW1lLCBsb3dlciwgdXBwZXIpIHtcblxuICAgICAgICB0aGlzLmluZGV4QnVpbGRlciA9IHtcbiAgICAgICAgICAgIGluZGV4IDogaW5kZXhOYW1lLFxuICAgICAgICAgICAgdmFsdWUgOiBbbG93ZXIsIHVwcGVyXSxcbiAgICAgICAgICAgIHR5cGUgOiAnYmV0d2VlbidcbiAgICAgICAgfTtcblxuICAgICAgICByZXR1cm4gdGhpcztcbiAgICB9XG5cbiAgICB3aGVyZUluKGF0dHJpYnV0ZU5hbWUsIHZhbHVlKSB7XG4gICAgICAgIHRoaXMuYnVpbGRlci5wdXNoKHtcbiAgICAgICAgICAgIGF0dHJpYnV0ZSA6IGF0dHJpYnV0ZU5hbWUsXG4gICAgICAgICAgICB2YWx1ZSA6IHZhbHVlLFxuICAgICAgICAgICAgdHlwZSA6ICdpbidcbiAgICAgICAgfSk7XG5cbiAgICAgICAgcmV0dXJuIHRoaXM7XG4gICAgfVxuXG4gICAgd2hlcmUoYXR0cmlidXRlTmFtZSwgdmFsdWUpIHtcbiAgICAgICAgdGhpcy5idWlsZGVyLnB1c2goe1xuICAgICAgICAgICAgYXR0cmlidXRlIDogYXR0cmlidXRlTmFtZSxcbiAgICAgICAgICAgIHZhbHVlIDogdmFsdWUsXG4gICAgICAgICAgICB0eXBlIDogJ2FuZCdcbiAgICAgICAgfSk7XG5cbiAgICAgICAgcmV0dXJuIHRoaXM7XG4gICAgfVxuXG5cbiAgICBndGUoYXR0cmlidXRlTmFtZSwgdmFsdWUpIHtcbiAgICAgICAgdGhpcy5idWlsZGVyLnB1c2goe1xuICAgICAgICAgICAgYXR0cmlidXRlIDogYXR0cmlidXRlTmFtZSxcbiAgICAgICAgICAgIHZhbHVlIDogdmFsdWUsXG4gICAgICAgICAgICB0eXBlIDogJ2d0ZSdcbiAgICAgICAgfSk7XG5cbiAgICAgICAgcmV0dXJuIHRoaXM7XG4gICAgfVxuXG4gICAgZ3QoYXR0cmlidXRlTmFtZSwgdmFsdWUpIHtcbiAgICAgICAgdGhpcy5idWlsZGVyLnB1c2goe1xuICAgICAgICAgICAgYXR0cmlidXRlIDogYXR0cmlidXRlTmFtZSxcbiAgICAgICAgICAgIHZhbHVlIDogdmFsdWUsXG4gICAgICAgICAgICB0eXBlIDogJ2d0J1xuICAgICAgICB9KTtcblxuICAgICAgICByZXR1cm4gdGhpcztcbiAgICB9XG5cbiAgICBsdGUoYXR0cmlidXRlTmFtZSwgdmFsdWUpIHtcbiAgICAgICAgdGhpcy5idWlsZGVyLnB1c2goe1xuICAgICAgICAgICAgYXR0cmlidXRlIDogYXR0cmlidXRlTmFtZSxcbiAgICAgICAgICAgIHZhbHVlIDogdmFsdWUsXG4gICAgICAgICAgICB0eXBlIDogJ2x0ZSdcbiAgICAgICAgfSk7XG5cbiAgICAgICAgcmV0dXJuIHRoaXM7XG4gICAgfVxuXG4gICAgbHQoYXR0cmlidXRlTmFtZSwgdmFsdWUpIHtcbiAgICAgICAgdGhpcy5idWlsZGVyLnB1c2goe1xuICAgICAgICAgICAgYXR0cmlidXRlIDogYXR0cmlidXRlTmFtZSxcbiAgICAgICAgICAgIHZhbHVlIDogdmFsdWUsXG4gICAgICAgICAgICB0eXBlIDogJ2x0J1xuICAgICAgICB9KTtcblxuICAgICAgICByZXR1cm4gdGhpcztcbiAgICB9XG5cbiAgICBiZXR3ZWVuKGF0dHJpYnV0ZU5hbWUsIHVwcGVyLCBsb3dlcikge1xuICAgICAgICB1cHBwZXIgPSBwYXJzZUZsb2F0KHVwcGVyKTtcbiAgICAgICAgbG93ZXIgPSBwYXJzZUZsb2F0KGxvd2VyKTtcblxuICAgICAgICBpZihpc05hTih1cHBlcikgfHwgaXNOYU4obG93ZXIpKXtcbiAgICAgICAgICAgIHRocm93IFwiQmV0d2VlbiBpcyBvbmx5IGZvciBudW1lcmljIHZhbHVlc1wiO1xuICAgICAgICB9XG5cbiAgICAgICAgdGhpcy5idWlsZGVyLnB1c2goe1xuICAgICAgICAgICAgYXR0cmlidXRlIDogYXR0cmlidXRlTmFtZSxcbiAgICAgICAgICAgIHZhbHVlIDogW3VwcGVyLCBsb3dlcl0sXG4gICAgICAgICAgICB0eXBlIDogJ2JldHdlZW4nXG4gICAgICAgIH0pO1xuXG4gICAgICAgIHJldHVybiB0aGlzO1xuICAgIH1cblxuICAgIHJlbGF0aW9uKG1vZGVsTmFtZSwgdHlwZSwgbG9jYWxLZXksIGZvcmVpZ25LZXksIGZ1bmMsIHByaW1hcnkpIHtcbiAgICAgICAgdGhpcy50YWJsZXMucHVzaChtb2RlbE5hbWUpO1xuXG4gICAgICAgIHRoaXMucmVsYXRpb25zLnB1c2goe1xuICAgICAgICAgICAgbW9kZWxOYW1lIDogbW9kZWxOYW1lLFxuICAgICAgICAgICAgZnVuYyA6IGZ1bmMsXG4gICAgICAgICAgICBsb2NhbEtleSA6IGxvY2FsS2V5LFxuICAgICAgICAgICAgZm9yZWlnbktleSA6IGZvcmVpZ25LZXksXG4gICAgICAgICAgICB0eXBlIDogdHlwZSxcbiAgICAgICAgICAgIHByaW1hcnkgOiBwcmltYXJ5XG4gICAgICAgIH0pO1xuXG4gICAgICAgIHJldHVybiB0aGlzO1xuICAgIH1cblxuICAgIHN0YXRpYyBnZXQgaGVscGVycygpIHtcblxuICAgICAgICByZXR1cm4ge1xuXG4gICAgICAgICAgICBjaGVja05lc3RlZEF0dHJpYnV0ZSAoYXR0cmlidXRlU3RyaW5nLCB2YWx1ZSwgY29uZGl0aW9uKSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIGNvbmRpdGlvbiA9PSBNb2RlbC5oZWxwZXJzLmdldE5lc3RlZEF0dHJpYnV0ZShhdHRyaWJ1dGVTdHJpbmcsIHZhbHVlKVxuICAgICAgICAgICAgfSxcblxuICAgICAgICAgICAgZ2V0TmVzdGVkQXR0cmlidXRlKGF0dHJpYnV0ZVN0cmluZywgdmFsdWUpIHtcbiAgICAgICAgICAgICAgICBsZXQgYXR0cmlidXRlcyA9IGF0dHJpYnV0ZVN0cmluZy5zcGxpdCgnLicpO1xuICAgICAgICAgICAgICAgIGxldCBpO1xuICAgICAgICAgICAgICAgIGxldCBjb250ZW50ID0gdmFsdWU7XG5cbiAgICAgICAgICAgICAgICBmb3IoaSA9IDA7IGkgPCBhdHRyaWJ1dGVzLmxlbmd0aDsgaSsrKSB7XG4gICAgICAgICAgICAgICAgICAgIGlmKGNvbnRlbnRbYXR0cmlidXRlc1tpXV0gPT09IHVuZGVmaW5lZCl7XG4gICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gdW5kZWZpbmVkO1xuICAgICAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICAgICAgICAgY29udGVudCA9IGNvbnRlbnRbYXR0cmlidXRlc1tpXV07XG4gICAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAgICAgcmV0dXJuIGNvbnRlbnQ7XG4gICAgICAgICAgICB9LFxuXG4gICAgICAgICAgICByZXBsYWNlTmVzdGVkVmFsdWVzKGF0dHJpYnV0ZXMsIHZhbHVlKSB7XG4gICAgICAgICAgICAgICAgZm9yKGxldCBhdHRyaWJ1dGUgaW4gYXR0cmlidXRlcykge1xuICAgICAgICAgICAgICAgICAgICB2YWx1ZVthdHRyaWJ1dGVdID0gYXR0cmlidXRlc1thdHRyaWJ1dGVdO1xuICAgICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgICAgIHJldHVybiB2YWx1ZTtcbiAgICAgICAgICAgIH0sXG4gICAgICAgIH07XG5cbiAgICB9XG5cbiAgICBnZXQgUkVMQVRJT05TICgpIHtcbiAgICAgICAgcmV0dXJuIEJ1aWxkZXIuUkVMQVRJT05TO1xuICAgIH1cblxuICAgIHN0YXRpYyBnZXQgUkVMQVRJT05TKCkge1xuICAgICAgICByZXR1cm4ge1xuICAgICAgICAgICAgaGFzT25lIDogJ2hhc09uZScsXG4gICAgICAgICAgICBoYXNNYW55IDogJ2hhc01hbnknXG4gICAgICAgIH1cbiAgICB9XG59XG5jbGFzcyBXb3JrZXJNb2RlbEhhbmRsZXIgZXh0ZW5kcyBCdWlsZGVye1xuXG4gICAgY29uc3RydWN0b3IobW9kZWxOYW1lLCB3b3JrZXJDb250ZW50KSB7XG4gICAgICAgIHN1cGVyKCk7XG5cbiAgICAgICAgdGhpcy5uYW1lID0gbW9kZWxOYW1lO1xuICAgICAgICB0aGlzLndvcmtlciA9IHdvcmtlckNvbnRlbnQ7XG4gICAgICAgIHRoaXMuc2V0VXBIYW5kbGVyKCk7XG4gICAgICAgIHRoaXMudGFibGVzID0gW21vZGVsTmFtZV07XG4gICAgfVxuXG4gICAgLyoqXG4gICAgICogRmluZHMgdGhlIG1vZGVsIGJ5IGlkXG4gICAgICogQHBhcmFtIGlkXG4gICAgICogQHJldHVybnMge1Byb21pc2V9XG4gICAgICovXG4gICAgZmluZChpZCkge1xuICAgICAgICBsZXQgbW9kZWwgPSB0aGlzO1xuXG4gICAgICAgIHJldHVybiBuZXcgUHJvbWlzZSgocmVzb2x2ZSwgcmVqZWN0KSA9PiB7XG4gICAgICAgICAgICBsZXQgdGltZXN0YW1wID0gRGF0ZS5ub3coKTtcblxuICAgICAgICAgICAgbW9kZWwub24odGltZXN0YW1wLCAnZmluZCcsIGhhbmRsZXIpO1xuICAgICAgICAgICAgbW9kZWwub24odGltZXN0YW1wLCAnZmluZC1lcnJvcicsIGVycm9ySGFuZGxlcik7XG5cbiAgICAgICAgICAgIG1vZGVsLnNlbmQoaWQsIHRpbWVzdGFtcCwgJ2ZpbmQnKTtcblxuICAgICAgICAgICAgLyoqXG4gICAgICAgICAgICAgKiBub3JtYWwgc3VjY2VzcyBoYW5kbGVyXG4gICAgICAgICAgICAgKiBAcGFyYW0gZVxuICAgICAgICAgICAgICovXG4gICAgICAgICAgICBmdW5jdGlvbiBoYW5kbGVyKGUpIHtcbiAgICAgICAgICAgICAgICBtb2RlbC5yZW1vdmVMaXN0ZW5lcih0aW1lc3RhbXAsICdmaW5kJywgaGFuZGxlcik7XG4gICAgICAgICAgICAgICAgbW9kZWwucmVtb3ZlTGlzdGVuZXIodGltZXN0YW1wLCAnZmluZC1lcnJvcicsIGVycm9ySGFuZGxlcigpKTtcblxuICAgICAgICAgICAgICAgIHJlc29sdmUoZS5kZXRhaWwpO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAvKipcbiAgICAgICAgICAgICAqIEVycm9yIGhhbmRsZXIgY2FzZVxuICAgICAgICAgICAgICogQHBhcmFtIGVcbiAgICAgICAgICAgICAqL1xuICAgICAgICAgICAgZnVuY3Rpb24gZXJyb3JIYW5kbGVyKGUpIHtcbiAgICAgICAgICAgICAgICBtb2RlbC5yZW1vdmVMaXN0ZW5lcih0aW1lc3RhbXAsICdmaW5kJywgZXJyb3JIYW5kbGVyKTtcbiAgICAgICAgICAgICAgICBtb2RlbC5yZW1vdmVMaXN0ZW5lcih0aW1lc3RhbXAsICdmaW5kLWVycm9yJywgaGFuZGxlcik7XG4gICAgICAgICAgICAgICAgcmVqZWN0KGUuZGV0YWlsKTtcbiAgICAgICAgICAgIH1cblxuICAgICAgICB9KTtcbiAgICB9XG5cbiAgICAvKipcbiAgICAgKiBGdW5jdGlvbiBmZXRjaGVzIGxpc3Qgb2YgcmVzdWx0IG1hdGNoaW5nIHRoZSBjcml0ZXJpYVxuICAgICAqIEByZXR1cm5zIHtQcm9taXNlfVxuICAgICAqL1xuICAgIGdldCgpIHtcbiAgICAgICAgbGV0IG1vZGVsID0gdGhpcztcbiAgICAgICAgcmV0dXJuIG5ldyBQcm9taXNlKChyZXNvbHZlLCByZWplY3QpID0+IHtcbiAgICAgICAgICAgIGxldCB0aW1lc3RhbXAgPSBEYXRlLm5vdygpO1xuXG4gICAgICAgICAgICBtb2RlbC5vbih0aW1lc3RhbXAsICdnZXQnLCBoYW5kbGVyKTtcbiAgICAgICAgICAgIG1vZGVsLm9uKHRpbWVzdGFtcCwgJ2dldC1lcnJvcicsIGVycm9ySGFuZGxlcik7XG5cbiAgICAgICAgICAgIG1vZGVsLnNlbmQoe1xuICAgICAgICAgICAgICAgIHRhYmxlcyA6IG1vZGVsLnRhYmxlcyxcbiAgICAgICAgICAgICAgICBidWlsZGVyIDogbW9kZWwuYnVpbGRlcixcbiAgICAgICAgICAgICAgICBpbmRleEJ1aWxkZXIgOiBtb2RlbC5pbmRleEJ1aWxkZXIsXG4gICAgICAgICAgICAgICAgcmVsYXRpb25zIDogbW9kZWwucmVsYXRpb25zXG4gICAgICAgICAgICB9LCB0aW1lc3RhbXAsICdnZXQnKTtcblxuICAgICAgICAgICAgZnVuY3Rpb24gaGFuZGxlcihlKSB7XG4gICAgICAgICAgICAgICAgbW9kZWwucmVtb3ZlTGlzdGVuZXIodGltZXN0YW1wLCAnZ2V0JywgaGFuZGxlcik7XG4gICAgICAgICAgICAgICAgbW9kZWwucmVtb3ZlTGlzdGVuZXIodGltZXN0YW1wLCAnZ2V0LWVycm9yJywgZXJyb3JIYW5kbGVyKTtcblxuICAgICAgICAgICAgICAgIHJlc29sdmUoZS5kZXRhaWwpO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICBmdW5jdGlvbiBlcnJvckhhbmRsZXIoZSkge1xuICAgICAgICAgICAgICAgIG1vZGVsLnJlbW92ZUxpc3RlbmVyKHRpbWVzdGFtcCwgJ2dldCcsIGVycm9ySGFuZGxlcik7XG4gICAgICAgICAgICAgICAgbW9kZWwucmVtb3ZlTGlzdGVuZXIodGltZXN0YW1wLCAnZ2V0LWVycm9yJywgaGFuZGxlcik7XG4gICAgICAgICAgICAgICAgcmVqZWN0KGUuZGV0YWlsKTtcbiAgICAgICAgICAgIH1cblxuICAgICAgICB9KTtcbiAgICB9XG5cbiAgICAvKipcbiAgICAgKiBGdW5jdGlvbiBmZXRjaGVzIGxpc3Qgb2YgcmVzdWx0IG1hdGNoaW5nIHRoZSBjcml0ZXJpYVxuICAgICAqIEByZXR1cm5zIHtQcm9taXNlfVxuICAgICAqL1xuICAgIGZpcnN0KCkge1xuICAgICAgICBsZXQgbW9kZWwgPSB0aGlzO1xuICAgICAgICByZXR1cm4gbmV3IFByb21pc2UoKHJlc29sdmUsIHJlamVjdCkgPT4ge1xuICAgICAgICAgICAgbGV0IHRpbWVzdGFtcCA9IERhdGUubm93KCk7XG5cbiAgICAgICAgICAgIG1vZGVsLm9uKHRpbWVzdGFtcCwgJ2ZpcnN0JywgaGFuZGxlcik7XG4gICAgICAgICAgICBtb2RlbC5vbih0aW1lc3RhbXAsICdmaXJzdC1lcnJvcicsIGVycm9ySGFuZGxlcik7XG5cbiAgICAgICAgICAgIG1vZGVsLnNlbmQoe1xuICAgICAgICAgICAgICAgIHRhYmxlcyA6IG1vZGVsLnRhYmxlcyxcbiAgICAgICAgICAgICAgICBidWlsZGVyIDogbW9kZWwuYnVpbGRlcixcbiAgICAgICAgICAgICAgICBpbmRleEJ1aWxkZXIgOiBtb2RlbC5pbmRleEJ1aWxkZXIsXG4gICAgICAgICAgICAgICAgcmVsYXRpb25zIDogbW9kZWwucmVsYXRpb25zXG4gICAgICAgICAgICB9LCB0aW1lc3RhbXAsICdmaXJzdCcpO1xuXG4gICAgICAgICAgICBmdW5jdGlvbiBoYW5kbGVyKGUpIHtcbiAgICAgICAgICAgICAgICBtb2RlbC5yZW1vdmVMaXN0ZW5lcih0aW1lc3RhbXAsICdmaXJzdCcsIGhhbmRsZXIpO1xuICAgICAgICAgICAgICAgIG1vZGVsLnJlbW92ZUxpc3RlbmVyKHRpbWVzdGFtcCwgJ2ZpcnN0LWVycm9yJywgZXJyb3JIYW5kbGVyKTtcblxuICAgICAgICAgICAgICAgIHJlc29sdmUoZS5kZXRhaWwpO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICBmdW5jdGlvbiBlcnJvckhhbmRsZXIoZSkge1xuICAgICAgICAgICAgICAgIG1vZGVsLnJlbW92ZUxpc3RlbmVyKHRpbWVzdGFtcCwgJ2ZpcnN0JywgZXJyb3JIYW5kbGVyKTtcbiAgICAgICAgICAgICAgICBtb2RlbC5yZW1vdmVMaXN0ZW5lcih0aW1lc3RhbXAsICdmaXJzdC1lcnJvcicsIGhhbmRsZXIpO1xuICAgICAgICAgICAgICAgIHJlamVjdChlLmRldGFpbCk7XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgfSk7XG4gICAgfVxuXG4gICAgLyoqXG4gICAgICogQ3JlYXRlcyBhIHJlY29yZFxuICAgICAqIEBwYXJhbSBkYXRhXG4gICAgICogQHJldHVybnMge1Byb21pc2V9XG4gICAgICovXG4gICAgY3JlYXRlKGRhdGEpIHtcbiAgICAgICAgbGV0IG1vZGVsID0gdGhpcztcbiAgICAgICAgcmV0dXJuIG5ldyBQcm9taXNlKChyZXNvbHZlLCByZWplY3QpID0+IHtcbiAgICAgICAgICAgIGxldCB0aW1lc3RhbXAgPSBEYXRlLm5vdygpO1xuXG4gICAgICAgICAgICBtb2RlbC5vbih0aW1lc3RhbXAsICdjcmVhdGUnLCBoYW5kbGVyKTtcbiAgICAgICAgICAgIG1vZGVsLm9uKHRpbWVzdGFtcCwgJ2NyZWF0ZS1lcnJvcicsIGVycm9ySGFuZGxlcik7XG5cbiAgICAgICAgICAgIG1vZGVsLnNlbmQoZGF0YSwgdGltZXN0YW1wLCAnY3JlYXRlJyk7XG5cbiAgICAgICAgICAgIGZ1bmN0aW9uIGhhbmRsZXIoZSkge1xuICAgICAgICAgICAgICAgIG1vZGVsLnJlbW92ZUxpc3RlbmVyKHRpbWVzdGFtcCwgJ2NyZWF0ZScsIGhhbmRsZXIpO1xuICAgICAgICAgICAgICAgIG1vZGVsLnJlbW92ZUxpc3RlbmVyKHRpbWVzdGFtcCwgJ2NyZWF0ZS1lcnJvcicsIGVycm9ySGFuZGxlcik7XG5cbiAgICAgICAgICAgICAgICByZXNvbHZlKGUuZGV0YWlsKTtcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgZnVuY3Rpb24gZXJyb3JIYW5kbGVyKGUpIHtcbiAgICAgICAgICAgICAgICBtb2RlbC5yZW1vdmVMaXN0ZW5lcih0aW1lc3RhbXAsICdjcmVhdGUnLCBlcnJvckhhbmRsZXIpO1xuICAgICAgICAgICAgICAgIG1vZGVsLnJlbW92ZUxpc3RlbmVyKHRpbWVzdGFtcCwgJ2NyZWF0ZS1lcnJvcicsIGhhbmRsZXIpO1xuICAgICAgICAgICAgICAgIHJlamVjdChlLmRldGFpbCk7XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgfSk7XG4gICAgfVxuXG4gICAgLyoqXG4gICAgICogQ3JlYXRlcyBtdWx0aXBsZSByZWNvcmRzXG4gICAgICogQHBhcmFtIGRhdGEgQXJyYXlcbiAgICAgKiBAcmV0dXJucyB7UHJvbWlzZX1cbiAgICAgKi9cbiAgICBjcmVhdGVNdWx0aXBsZShkYXRhKSB7XG4gICAgICAgIGxldCBtb2RlbCA9IHRoaXM7XG4gICAgICAgIHJldHVybiBuZXcgUHJvbWlzZSgocmVzb2x2ZSwgcmVqZWN0KSA9PiB7XG4gICAgICAgICAgICBsZXQgdGltZXN0YW1wID0gRGF0ZS5ub3coKTtcblxuICAgICAgICAgICAgbW9kZWwub24odGltZXN0YW1wLCAnY3JlYXRlTXVsdGlwbGUnLCBoYW5kbGVyKTtcbiAgICAgICAgICAgIG1vZGVsLm9uKHRpbWVzdGFtcCwgJ2NyZWF0ZU11bHRpcGxlLWVycm9yJywgZXJyb3JIYW5kbGVyKTtcblxuICAgICAgICAgICAgbW9kZWwuc2VuZChkYXRhLCB0aW1lc3RhbXAsICdjcmVhdGVNdWx0aXBsZScpO1xuXG4gICAgICAgICAgICBmdW5jdGlvbiBoYW5kbGVyKGUpIHtcbiAgICAgICAgICAgICAgICBtb2RlbC5yZW1vdmVMaXN0ZW5lcih0aW1lc3RhbXAsICdjcmVhdGVNdWx0aXBsZScsIGhhbmRsZXIpO1xuICAgICAgICAgICAgICAgIG1vZGVsLnJlbW92ZUxpc3RlbmVyKHRpbWVzdGFtcCwgJ2NyZWF0ZU11bHRpcGxlLWVycm9yJywgZXJyb3JIYW5kbGVyKTtcblxuICAgICAgICAgICAgICAgIHJlc29sdmUoZS5kZXRhaWwpO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICBmdW5jdGlvbiBlcnJvckhhbmRsZXIoZSkge1xuICAgICAgICAgICAgICAgIG1vZGVsLnJlbW92ZUxpc3RlbmVyKHRpbWVzdGFtcCwgJ2NyZWF0ZU11bHRpcGxlJywgZXJyb3JIYW5kbGVyKTtcbiAgICAgICAgICAgICAgICBtb2RlbC5yZW1vdmVMaXN0ZW5lcih0aW1lc3RhbXAsICdjcmVhdGVNdWx0aXBsZS1lcnJvcicsIGhhbmRsZXIpO1xuICAgICAgICAgICAgICAgIHJlamVjdChlLmRldGFpbCk7XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgfSk7XG4gICAgfVxuXG4gICAgLyoqXG4gICAgICogRnVuY3Rpb24gdXBkYXRlcyB0aGUgdmFyaW91cyByZWNvcmRzIHdpdGggbWF0Y2hpbmcgdmFsdWVzXG4gICAgICogQHBhcmFtIGRhdGFcbiAgICAgKiBAcmV0dXJucyB7UHJvbWlzZX1cbiAgICAgKi9cbiAgICB1cGRhdGUoZGF0YSkge1xuICAgICAgICBsZXQgbW9kZWwgPSB0aGlzO1xuICAgICAgICByZXR1cm4gbmV3IFByb21pc2UoKHJlc29sdmUsIHJlamVjdCkgPT4ge1xuICAgICAgICAgICAgbGV0IHRpbWVzdGFtcCA9IERhdGUubm93KCk7XG5cbiAgICAgICAgICAgIG1vZGVsLm9uKHRpbWVzdGFtcCwgJ3VwZGF0ZScsIGhhbmRsZXIpO1xuICAgICAgICAgICAgbW9kZWwub24odGltZXN0YW1wLCAndXBkYXRlLWVycm9yJywgZXJyb3JIYW5kbGVyKTtcblxuICAgICAgICAgICAgbW9kZWwuc2VuZChkYXRhLCB0aW1lc3RhbXAsICd1cGRhdGUnKTtcblxuICAgICAgICAgICAgZnVuY3Rpb24gaGFuZGxlcihlKSB7XG4gICAgICAgICAgICAgICAgbW9kZWwucmVtb3ZlTGlzdGVuZXIodGltZXN0YW1wLCAndXBkYXRlJywgaGFuZGxlcik7XG4gICAgICAgICAgICAgICAgbW9kZWwucmVtb3ZlTGlzdGVuZXIodGltZXN0YW1wLCAndXBkYXRlLWVycm9yJywgZXJyb3JIYW5kbGVyKTtcblxuICAgICAgICAgICAgICAgIHJlc29sdmUoZS5kZXRhaWwpO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICBmdW5jdGlvbiBlcnJvckhhbmRsZXIoZSkge1xuICAgICAgICAgICAgICAgIG1vZGVsLnJlbW92ZUxpc3RlbmVyKHRpbWVzdGFtcCwgJ3VwZGF0ZScsIGVycm9ySGFuZGxlcik7XG4gICAgICAgICAgICAgICAgbW9kZWwucmVtb3ZlTGlzdGVuZXIodGltZXN0YW1wLCAndXBkYXRlLWVycm9yJywgaGFuZGxlcik7XG4gICAgICAgICAgICAgICAgcmVqZWN0KGUuZGV0YWlsKTtcbiAgICAgICAgICAgIH1cblxuICAgICAgICB9KTtcbiAgICB9XG5cbiAgICAvKipcbiAgICAgKiBGdW5jdGlvbiB1cGRhdGVzIHRoZSByZWNvcmQgYXQgdGhlIGdpdmVuIGlkXG4gICAgICogQHBhcmFtIGlkXG4gICAgICogQHBhcmFtIGRhdGFcbiAgICAgKiBAcmV0dXJucyB7UHJvbWlzZX1cbiAgICAgKi9cbiAgICBzYXZlKGlkLCBkYXRhKSB7XG4gICAgICAgIGxldCBtb2RlbCA9IHRoaXM7XG4gICAgICAgIHJldHVybiBuZXcgUHJvbWlzZSgocmVzb2x2ZSwgcmVqZWN0KSA9PiB7XG5cbiAgICAgICAgICAgIGxldCB0aW1lc3RhbXAgPSBEYXRlLm5vdygpO1xuICAgICAgICAgICAgbGV0IGNvbnRlbnQgPSB7XG4gICAgICAgICAgICAgICAgaWQgOiBpZCxcbiAgICAgICAgICAgICAgICBkYXRhIDogZGF0YVxuICAgICAgICAgICAgfTtcblxuICAgICAgICAgICAgbW9kZWwub24odGltZXN0YW1wLCAnc2F2ZScsIGhhbmRsZXIpO1xuICAgICAgICAgICAgbW9kZWwub24odGltZXN0YW1wLCAnc2F2ZS1lcnJvcicsIGVycm9ySGFuZGxlcik7XG4gICAgICAgICAgICBtb2RlbC5zZW5kKGNvbnRlbnQsIHRpbWVzdGFtcCwgJ3NhdmUnKTtcblxuICAgICAgICAgICAgZnVuY3Rpb24gaGFuZGxlcihlKSB7XG4gICAgICAgICAgICAgICAgbW9kZWwucmVtb3ZlTGlzdGVuZXIodGltZXN0YW1wLCAnc2F2ZScsIGhhbmRsZXIpO1xuICAgICAgICAgICAgICAgIG1vZGVsLnJlbW92ZUxpc3RlbmVyKHRpbWVzdGFtcCwgJ3NhdmUtZXJyb3InLCBlcnJvckhhbmRsZXIpO1xuXG4gICAgICAgICAgICAgICAgcmVzb2x2ZShlLmRldGFpbCk7XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIGZ1bmN0aW9uIGVycm9ySGFuZGxlcihlKSB7XG4gICAgICAgICAgICAgICAgbW9kZWwucmVtb3ZlTGlzdGVuZXIodGltZXN0YW1wLCAnc2F2ZScsIGVycm9ySGFuZGxlcik7XG4gICAgICAgICAgICAgICAgbW9kZWwucmVtb3ZlTGlzdGVuZXIodGltZXN0YW1wLCAnc2F2ZS1lcnJvcicsIGhhbmRsZXIpO1xuICAgICAgICAgICAgICAgIHJlamVjdChlLmRldGFpbCk7XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgfSk7XG4gICAgfVxuXG4gICAgLyoqXG4gICAgICogRnVuY3Rpb24gZGVsZXRlcyB0aGUgZW50cmllcyBhdCB0aGUgZ2l2ZW4gcG9pbnRcbiAgICAgKiBAcGFyYW0gaWRcbiAgICAgKiBAcmV0dXJucyB7UHJvbWlzZX1cbiAgICAgKi9cbiAgICBkZXN0cm95SWQoaWQpIHtcbiAgICAgICAgbGV0IG1vZGVsID0gdGhpcztcbiAgICAgICAgcmV0dXJuIG5ldyBQcm9taXNlKChyZXNvbHZlLCByZWplY3QpID0+IHtcblxuICAgICAgICAgICAgbGV0IHRpbWVzdGFtcCA9IERhdGUubm93KCk7XG5cbiAgICAgICAgICAgIG1vZGVsLm9uKHRpbWVzdGFtcCwgJ2Rlc3Ryb3lJZCcsIGhhbmRsZXIpO1xuICAgICAgICAgICAgbW9kZWwub24odGltZXN0YW1wLCAnZGVzdHJveUlkLWVycm9yJywgZXJyb3JIYW5kbGVyKTtcbiAgICAgICAgICAgIG1vZGVsLnNlbmQoaWQsIHRpbWVzdGFtcCwgJ2Rlc3Ryb3lJZCcpO1xuXG4gICAgICAgICAgICBmdW5jdGlvbiBoYW5kbGVyKGUpIHtcbiAgICAgICAgICAgICAgICBtb2RlbC5yZW1vdmVMaXN0ZW5lcih0aW1lc3RhbXAsICdkZXN0cm95SWQnLCBoYW5kbGVyKTtcbiAgICAgICAgICAgICAgICBtb2RlbC5yZW1vdmVMaXN0ZW5lcih0aW1lc3RhbXAsICdkZXN0cm95SWQtZXJyb3InLCBlcnJvckhhbmRsZXIpO1xuXG4gICAgICAgICAgICAgICAgcmVzb2x2ZShlLmRldGFpbCk7XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIGZ1bmN0aW9uIGVycm9ySGFuZGxlcihlKSB7XG4gICAgICAgICAgICAgICAgbW9kZWwucmVtb3ZlTGlzdGVuZXIodGltZXN0YW1wLCAnZGVzdHJveUlkJywgZXJyb3JIYW5kbGVyKTtcbiAgICAgICAgICAgICAgICBtb2RlbC5yZW1vdmVMaXN0ZW5lcih0aW1lc3RhbXAsICdkZXN0cm95SWQtZXJyb3InLCBoYW5kbGVyKTtcbiAgICAgICAgICAgICAgICByZWplY3QoZS5kZXRhaWwpO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgIH0pO1xuICAgIH1cblxuICAgIC8qKlxuICAgICAqIEZ1bmN0aW9uIGRlbGV0ZXMgdGhlIGVudHJpZXNcbiAgICAgKiBAcmV0dXJucyB7UHJvbWlzZX1cbiAgICAgKi9cbiAgICBkZXN0cm95KCkge1xuICAgICAgICBsZXQgbW9kZWwgPSB0aGlzO1xuICAgICAgICByZXR1cm4gbmV3IFByb21pc2UoKHJlc29sdmUsIHJlamVjdCkgPT4ge1xuXG4gICAgICAgICAgICBsZXQgdGltZXN0YW1wID0gRGF0ZS5ub3coKTtcblxuICAgICAgICAgICAgbW9kZWwub24odGltZXN0YW1wLCAnZGVzdHJveScsIGhhbmRsZXIpO1xuICAgICAgICAgICAgbW9kZWwub24odGltZXN0YW1wLCAnZGVzdHJveS1lcnJvcicsIGVycm9ySGFuZGxlcik7XG4gICAgICAgICAgICBtb2RlbC5zZW5kKHt9LCB0aW1lc3RhbXAsICdkZXN0cm95Jyk7XG5cbiAgICAgICAgICAgIGZ1bmN0aW9uIGhhbmRsZXIoZSkge1xuICAgICAgICAgICAgICAgIG1vZGVsLnJlbW92ZUxpc3RlbmVyKHRpbWVzdGFtcCwgJ2Rlc3Ryb3knLCBoYW5kbGVyKTtcbiAgICAgICAgICAgICAgICBtb2RlbC5yZW1vdmVMaXN0ZW5lcih0aW1lc3RhbXAsICdkZXN0cm95LWVycm9yJywgZXJyb3JIYW5kbGVyKTtcblxuICAgICAgICAgICAgICAgIHJlc29sdmUoZS5kZXRhaWwpO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICBmdW5jdGlvbiBlcnJvckhhbmRsZXIoZSkge1xuICAgICAgICAgICAgICAgIG1vZGVsLnJlbW92ZUxpc3RlbmVyKHRpbWVzdGFtcCwgJ2Rlc3Ryb3knLCBlcnJvckhhbmRsZXIpO1xuICAgICAgICAgICAgICAgIG1vZGVsLnJlbW92ZUxpc3RlbmVyKHRpbWVzdGFtcCwgJ2Rlc3Ryb3ktZXJyb3InLCBoYW5kbGVyKTtcbiAgICAgICAgICAgICAgICByZWplY3QoZS5kZXRhaWwpO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgIH0pO1xuICAgIH1cblxuICAgIC8qKlxuICAgICAqIEZ1bmN0aW9uIGNvdW50cyB0aGUgbnVtYmVyIG9mIHJlY29yZHNcbiAgICAgKiBAcmV0dXJucyB7UHJvbWlzZX1cbiAgICAgKi9cbiAgICBjb3VudCgpIHtcbiAgICAgICAgbGV0IG1vZGVsID0gdGhpcztcbiAgICAgICAgcmV0dXJuIG5ldyBQcm9taXNlKChyZXNvbHZlLCByZWplY3QpID0+IHtcbiAgICAgICAgICAgIGxldCB0aW1lc3RhbXAgPSBEYXRlLm5vdygpO1xuXG4gICAgICAgICAgICBtb2RlbC5vbih0aW1lc3RhbXAsICdjb3VudCcsIGhhbmRsZXIpO1xuICAgICAgICAgICAgbW9kZWwub24odGltZXN0YW1wLCAnY291bnQtZXJyb3InLCBlcnJvckhhbmRsZXIpO1xuXG4gICAgICAgICAgICBtb2RlbC5zZW5kKHt9LCB0aW1lc3RhbXAsICdjb3VudCcpO1xuXG4gICAgICAgICAgICBmdW5jdGlvbiBoYW5kbGVyKGUpIHtcbiAgICAgICAgICAgICAgICBtb2RlbC5yZW1vdmVMaXN0ZW5lcih0aW1lc3RhbXAsICdjb3VudCcsIGhhbmRsZXIpO1xuICAgICAgICAgICAgICAgIG1vZGVsLnJlbW92ZUxpc3RlbmVyKHRpbWVzdGFtcCwgJ2NvdW50LWVycm9yJywgZXJyb3JIYW5kbGVyKTtcblxuICAgICAgICAgICAgICAgIHJlc29sdmUoZS5kZXRhaWwpO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICBmdW5jdGlvbiBlcnJvckhhbmRsZXIoZSkge1xuICAgICAgICAgICAgICAgIG1vZGVsLnJlbW92ZUxpc3RlbmVyKHRpbWVzdGFtcCwgJ2NvdW50JywgZXJyb3JIYW5kbGVyKTtcbiAgICAgICAgICAgICAgICBtb2RlbC5yZW1vdmVMaXN0ZW5lcih0aW1lc3RhbXAsICdjb3VudC1lcnJvcicsIGhhbmRsZXIpO1xuICAgICAgICAgICAgICAgIHJlamVjdChlLmRldGFpbCk7XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgfSk7XG4gICAgfVxuXG4gICAgYXZlcmFnZShhdHRyaWJ1dGUpIHtcbiAgICAgICAgbGV0IG1vZGVsID0gdGhpcztcbiAgICAgICAgcmV0dXJuIG5ldyBQcm9taXNlKChyZXNvbHZlLCByZWplY3QpID0+IHtcbiAgICAgICAgICAgIGxldCB0aW1lc3RhbXAgPSBEYXRlLm5vdygpO1xuXG4gICAgICAgICAgICBtb2RlbC5vbih0aW1lc3RhbXAsICdhdmVyYWdlJywgaGFuZGxlcik7XG4gICAgICAgICAgICBtb2RlbC5vbih0aW1lc3RhbXAsICdhdmVyYWdlLWVycm9yJywgZXJyb3JIYW5kbGVyKTtcblxuICAgICAgICAgICAgbW9kZWwuc2VuZChhdHRyaWJ1dGUsIHRpbWVzdGFtcCwgJ2F2ZXJhZ2UnKTtcblxuICAgICAgICAgICAgZnVuY3Rpb24gaGFuZGxlcihlKSB7XG4gICAgICAgICAgICAgICAgbW9kZWwucmVtb3ZlTGlzdGVuZXIodGltZXN0YW1wLCAnYXZlcmFnZScsIGhhbmRsZXIpO1xuICAgICAgICAgICAgICAgIG1vZGVsLnJlbW92ZUxpc3RlbmVyKHRpbWVzdGFtcCwgJ2F2ZXJhZ2UtZXJyb3InLCBlcnJvckhhbmRsZXIpO1xuXG4gICAgICAgICAgICAgICAgcmVzb2x2ZShlLmRldGFpbCk7XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIGZ1bmN0aW9uIGVycm9ySGFuZGxlcihlKSB7XG4gICAgICAgICAgICAgICAgbW9kZWwucmVtb3ZlTGlzdGVuZXIodGltZXN0YW1wLCAnYXZlcmFnZScsIGVycm9ySGFuZGxlcik7XG4gICAgICAgICAgICAgICAgbW9kZWwucmVtb3ZlTGlzdGVuZXIodGltZXN0YW1wLCAnYXZlcmFnZS1lcnJvcicsIGhhbmRsZXIpO1xuICAgICAgICAgICAgICAgIHJlamVjdChlLmRldGFpbCk7XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgfSk7XG4gICAgfVxuXG4gICAgLyoqXG4gICAgICogUmVkdWNlIGZ1bmN0aW9uIGlzIGNhbGxlZCB3aXRoIGVhY2ggcGFzc2luZyBpdGVyYXRvciB2YWx1ZSBhbmQgcmVkdWNlZCB2YWx1ZSBpcyByZXR1cm5lZFxuICAgICAqIEBwYXJhbSBmdW5jXG4gICAgICogQHBhcmFtIGRlZmF1bHRDYXJyeVxuICAgICAqIEByZXR1cm5zIHtQcm9taXNlfVxuICAgICAqL1xuICAgIHJlZHVjZShmdW5jLCBkZWZhdWx0Q2FycnkpIHtcbiAgICAgICAgbGV0IG1vZGVsID0gdGhpcztcbiAgICAgICAgcmV0dXJuIG5ldyBQcm9taXNlKChyZXNvbHZlLCByZWplY3QpID0+IHtcbiAgICAgICAgICAgIGxldCB0aW1lc3RhbXAgPSBEYXRlLm5vdygpO1xuXG4gICAgICAgICAgICBtb2RlbC5vbih0aW1lc3RhbXAsICdyZWR1Y2UnLCBoYW5kbGVyKTtcbiAgICAgICAgICAgIG1vZGVsLm9uKHRpbWVzdGFtcCwgJ3JlZHVjZS1lcnJvcicsIGVycm9ySGFuZGxlcik7XG5cbiAgICAgICAgICAgIGxldCBkYXRhID0ge1xuICAgICAgICAgICAgICAgIGZ1bmMgOiBmdW5jLFxuICAgICAgICAgICAgICAgIGRlZmF1bHRDYXJyeSA6IGRlZmF1bHRDYXJyeVxuICAgICAgICAgICAgfTtcblxuICAgICAgICAgICAgbW9kZWwuc2VuZChkYXRhLCB0aW1lc3RhbXAsICdyZWR1Y2UnKTtcblxuICAgICAgICAgICAgZnVuY3Rpb24gaGFuZGxlcihlKSB7XG4gICAgICAgICAgICAgICAgbW9kZWwucmVtb3ZlTGlzdGVuZXIodGltZXN0YW1wLCAncmVkdWNlJywgaGFuZGxlcik7XG4gICAgICAgICAgICAgICAgbW9kZWwucmVtb3ZlTGlzdGVuZXIodGltZXN0YW1wLCAncmVkdWNlLWVycm9yJywgZXJyb3JIYW5kbGVyKTtcblxuICAgICAgICAgICAgICAgIHJlc29sdmUoZS5kZXRhaWwpO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICBmdW5jdGlvbiBlcnJvckhhbmRsZXIoZSkge1xuICAgICAgICAgICAgICAgIG1vZGVsLnJlbW92ZUxpc3RlbmVyKHRpbWVzdGFtcCwgJ3JlZHVjZScsIGVycm9ySGFuZGxlcik7XG4gICAgICAgICAgICAgICAgbW9kZWwucmVtb3ZlTGlzdGVuZXIodGltZXN0YW1wLCAncmVkdWNlLWVycm9yJywgaGFuZGxlcik7XG4gICAgICAgICAgICAgICAgcmVqZWN0KGUuZGV0YWlsKTtcbiAgICAgICAgICAgIH1cblxuICAgICAgICB9KTtcbiAgICB9XG5cbiAgICAvKipcbiAgICAgKiBDb21tdW5pY2F0ZXMgdG8gd2Vid29ya2VyXG4gICAgICogQHBhcmFtIGRhdGFcbiAgICAgKiBAcGFyYW0gdGltZXN0YW1wXG4gICAgICogQHBhcmFtIGFjdGlvblxuICAgICAqL1xuICAgIHNlbmQoZGF0YSwgdGltZXN0YW1wLCBhY3Rpb24pIHtcbiAgICAgICAgbGV0IG1vZGVsID0gdGhpcztcblxuICAgICAgICBsZXQgZGV0YWlsID0gSlNPTi5zdHJpbmdpZnkoZGF0YSwgKGtleSwgdmFsdWUpID0+IHtcbiAgICAgICAgICAgIHJldHVybiAodHlwZW9mIHZhbHVlID09PSAnZnVuY3Rpb24nICkgPyB2YWx1ZS50b1N0cmluZygpIDogdmFsdWU7XG4gICAgICAgIH0pO1xuXG4gICAgICAgIGxldCBlID0ge1xuICAgICAgICAgICAgZGV0YWlsIDogZGV0YWlsLFxuICAgICAgICAgICAgYWN0aW9uIDogYWN0aW9uLFxuICAgICAgICAgICAgdGltZXN0YW1wIDogdGltZXN0YW1wLFxuICAgICAgICAgICAgbW9kZWwgOiBtb2RlbC5uYW1lXG4gICAgICAgIH07XG5cbiAgICAgICAgbW9kZWwud29ya2VyLnBvc3RNZXNzYWdlKGUpO1xuICAgIH1cblxuICAgIC8qKlxuICAgICAqIFNldHMgdXAgYmFzaWMgaGFuZGxlciBzZXR0aW5ncyB0byByZWNlaXZlIG1lc3NhZ2VzIGZyb20gd29ya2VyXG4gICAgICovXG4gICAgc2V0VXBIYW5kbGVyICgpIHtcbiAgICAgICAgbGV0IG1vZGVsID0gdGhpcztcblxuICAgICAgICAvL2dlbmVyYWwgaGFuZGxlciB0byBhY3QgdXAgbWVzc2FnZXMgc2VudCBmcm9tIHdlYiB3b3JrZXJcbiAgICAgICAgbW9kZWwud29ya2VyLm9ubWVzc2FnZSA9IGZ1bmN0aW9uKGUpIHtcbiAgICAgICAgICAgIGxldCBkYXRhID0gZS5kYXRhLmRldGFpbDtcbiAgICAgICAgICAgIG1vZGVsLmVtaXQoZGF0YSwgZS5kYXRhLnRpbWVzdGFtcCwgZS5kYXRhLmFjdGlvbik7XG5cbiAgICAgICAgfVxuICAgIH1cblxuICAgIC8qKlxuICAgICAqIE5vcm1hbCBlbWl0IGV2ZW50IG9uIHdpbmRvdy5kb2N1bWVudFxuICAgICAqXG4gICAgICogQHBhcmFtIGRhdGFcbiAgICAgKiBAcGFyYW0gdGltZXN0YW1wXG4gICAgICogQHBhcmFtIGFjdGlvblxuICAgICAqL1xuICAgIGVtaXQgKGRhdGEsIHRpbWVzdGFtcCwgYWN0aW9uKSB7XG4gICAgICAgIGxldCBtb2RlbCA9IHRoaXM7XG4gICAgICAgIGxldCBlID0gbmV3IEN1c3RvbUV2ZW50KCdpZGI6d29ya2VyOicgKyBtb2RlbC5tb2RlTmFtZSArICc6JyArIHRpbWVzdGFtcCArICc6JyArIGFjdGlvbiwge1xuICAgICAgICAgICAgZGV0YWlsIDogZGF0YVxuICAgICAgICB9KTtcblxuICAgICAgICB3aW5kb3cuZG9jdW1lbnQuZGlzcGF0Y2hFdmVudChlKTtcbiAgICB9XG5cbiAgICAvKipcbiAgICAgKiBSZW1vdmVzIGV2ZW50IGxpc3RlbmVyIGZyb20gd2luZG93LmRvY3VtZW50XG4gICAgICpcbiAgICAgKiBAcGFyYW0gdGltZXN0YW1wXG4gICAgICogQHBhcmFtIGFjdGlvblxuICAgICAqIEBwYXJhbSBmdW5jXG4gICAgICovXG4gICAgcmVtb3ZlTGlzdGVuZXIodGltZXN0YW1wLCBhY3Rpb24sIGZ1bmMpIHtcbiAgICAgICAgd2luZG93LmRvY3VtZW50LnJlbW92ZUV2ZW50TGlzdGVuZXIoJ2lkYjp3b3JrZXI6JyArIHRoaXMubW9kZU5hbWUgKyAnOicgKyB0aW1lc3RhbXAgKyAnOicgKyBhY3Rpb24sIGZ1bmMpO1xuICAgIH1cblxuICAgIC8qKlxuICAgICAqIExpc3RlbnMgZXZlbnRzIG9uIHdpbmRvdy5kb2N1bWVudFxuICAgICAqXG4gICAgICogQHBhcmFtIHRpbWVzdGFtcCBkYXRlIHRpbWUgc3RhbXBcbiAgICAgKiBAcGFyYW0gYWN0aW9uIGFjdGlvbiBuYW1lXG4gICAgICogQHBhcmFtIGZ1bmMgZnVuY3Rpb24gdG8gYmUgZXhlY3V0ZWRcbiAgICAgKi9cbiAgICBvbih0aW1lc3RhbXAsIGFjdGlvbiwgZnVuYykge1xuICAgICAgICB3aW5kb3cuZG9jdW1lbnQuYWRkRXZlbnRMaXN0ZW5lcignaWRiOndvcmtlcjonICsgdGhpcy5tb2RlTmFtZSArICc6JyArIHRpbWVzdGFtcCArICc6JyArIGFjdGlvbiwgZnVuYyk7XG4gICAgfVxufVxuY2xhc3MgTW9kZWwgZXh0ZW5kcyBCdWlsZGVye1xuXG4gICAgY29uc3RydWN0b3IoZGIsIGlkYktleSwgbW9kZWxOYW1lLCBwcmltYXJ5KXtcbiAgICAgICAgc3VwZXIoKTtcblxuICAgICAgICB0aGlzLm5hbWUgPSBtb2RlbE5hbWU7XG4gICAgICAgIHRoaXMuZGIgPSBkYjtcbiAgICAgICAgdGhpcy5wcmltYXJ5ID0gcHJpbWFyeTtcbiAgICAgICAgdGhpcy50YWJsZXMgPSBbdGhpcy5uYW1lXTtcbiAgICAgICAgdGhpcy5pZGJLZXkgPSBpZGJLZXk7XG4gICAgICAgIHRoaXMuaGFzSWRiS2V5ID0gdGhpcy5pZGJLZXkgPyB0cnVlIDogZmFsc2U7XG4gICAgICAgIHRoaXMudHJhbnNhY3Rpb24gPSBudWxsO1xuICAgICAgICB0aGlzLmF0dHJpYnV0ZXMgPSB7fTtcbiAgICB9XG5cbiAgICAvKipcbiAgICAgKiBGaW5kcyB0aGUgcmVzdWx0IG9uIHRoZSBwcmltYXJ5IGtleSBkZWZpbmVkXG4gICAgICogQHBhcmFtIGlkXG4gICAgICogQHJldHVybnMge1Byb21pc2V9XG4gICAgICovXG4gICAgZmluZChpZCkge1xuICAgICAgICBsZXQgbW9kZWwgPSB0aGlzO1xuXG4gICAgICAgIHJldHVybiBuZXcgUHJvbWlzZSgocmVzb2x2ZSwgcmVqZWN0KSA9PiB7XG4gICAgICAgICAgICBsZXQgdHJhbnNhY3Rpb24gPSBtb2RlbC5nZXRUcmFuc2FjdGlvbihtb2RlbC50YWJsZXMsIE1vZGVsLlJFQURPTkxZKTtcbiAgICAgICAgICAgIGxldCBvYmogPSB0cmFuc2FjdGlvbi5vYmplY3RTdG9yZShtb2RlbC5uYW1lKTtcbiAgICAgICAgICAgIGxldCByZXF1ZXN0ID0gb2JqLmdldChpZCk7XG4gICAgICAgICAgICBcbiAgICAgICAgICAgIHJlcXVlc3Qub25zdWNjZXNzID0gZnVuY3Rpb24gKGUpIHtcbiAgICAgICAgICAgICAgICByZXNvbHZlKGUudGFyZ2V0LnJlc3VsdCk7XG4gICAgICAgICAgICB9O1xuXG4gICAgICAgICAgICByZXF1ZXN0Lm9uZXJyb3IgPSBmdW5jdGlvbiAoZSkge1xuICAgICAgICAgICAgICAgIHJlamVjdChlKTtcbiAgICAgICAgICAgIH07XG5cbiAgICAgICAgfSk7XG4gICAgfVxuXG4gICAgLyoqXG4gICAgICogU2VhcmNoZXMgZm9yIGZpcnN0IHZhbHVlIGluIGRhdGFiYXNlIGFuZCByZXR1cm5zIHRoYXRcbiAgICAgKiBAcmV0dXJucyB7UHJvbWlzZX1cbiAgICAgKi9cbiAgICBmaXJzdCgpIHtcbiAgICAgICAgbGV0IG1vZGVsID0gdGhpcztcblxuICAgICAgICByZXR1cm4gbmV3IFByb21pc2UoKHJlc29sdmUsIHJlamVjdCkgPT4ge1xuICAgICAgICAgICAgbGV0IHRyYW5zYWN0aW9uID0gbW9kZWwuZ2V0VHJhbnNhY3Rpb24obW9kZWwudGFibGVzLCBNb2RlbC5SRUFET05MWSk7XG4gICAgICAgICAgICBsZXQgb2JqID0gdHJhbnNhY3Rpb24ub2JqZWN0U3RvcmUobW9kZWwubmFtZSk7XG4gICAgICAgICAgICBsZXQgcmVzdWx0ID0gbnVsbDtcbiAgICAgICAgICAgIGxldCByZXF1ZXN0O1xuXG4gICAgICAgICAgICBpZihtb2RlbC5pbmRleEJ1aWxkZXIudHlwZSl7XG4gICAgICAgICAgICAgICAgcmVxdWVzdCA9IG1vZGVsLmdldEluZGV4UmVzdWx0KG9iaik7XG4gICAgICAgICAgICB9ZWxzZXtcbiAgICAgICAgICAgICAgICByZXF1ZXN0ID0gb2JqLm9wZW5DdXJzb3IoKTtcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgcmVxdWVzdC5vbnN1Y2Nlc3MgPSBmdW5jdGlvbiAoZSkge1xuICAgICAgICAgICAgICAgIGxldCBjdXJzb3IgPSBlLnRhcmdldC5yZXN1bHQ7XG5cbiAgICAgICAgICAgICAgICBpZihjdXJzb3Ipe1xuICAgICAgICAgICAgICAgICAgICBpZihtb2RlbC5jaGVja0J1aWxkZXJWYWx1ZShjdXJzb3IudmFsdWUpKXtcbiAgICAgICAgICAgICAgICAgICAgICAgIGxldCByZWxhdGlvbnNDb21wbGV0ZWQgPSAwO1xuXG4gICAgICAgICAgICAgICAgICAgICAgICByZXN1bHQgPSBjdXJzb3IudmFsdWU7XG5cbiAgICAgICAgICAgICAgICAgICAgICAgIGlmKG1vZGVsLnJlbGF0aW9ucy5sZW5ndGggPiAwICYmIChyZXN1bHQgIT09IG51bGwgfHwgcmVzdWx0ICE9PSB1bmRlZmluZWQpKXtcblxuXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgbW9kZWwucmVsYXRpb25zLmZvckVhY2goKHJlbGF0aW9uKSA9PiB7XG5cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgbGV0IHJlbGF0aW9uUmVxdWVzdCA9IG1vZGVsLmdldFJlbGF0aW9uc2hpcHMocmVsYXRpb24sIG1vZGVsLnRyYW5zYWN0aW9uLCBtb2RlbC5nZXRNYWluUmVzdWx0KHJlc3VsdCwgcmVsYXRpb24ubG9jYWxLZXksIGZhbHNlKSwgZmFsc2UpO1xuXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJlbGF0aW9uUmVxdWVzdC50aGVuKChyZWxhdGlvblJlc3VsdCkgPT4ge1xuXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICByZWxhdGlvbnNDb21wbGV0ZWQrKztcblxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgbGV0IGRlZmF1bHRWYWx1ZSA9IG1vZGVsLmdldERlZmF1bHRSZWxhdGlvblZhbHVlKHJlbGF0aW9uLnR5cGUpO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcmVzdWx0W3JlbGF0aW9uLm1vZGVsTmFtZV0gPSByZXN1bHRbcmVsYXRpb24ubW9kZWxOYW1lXSB8fCBkZWZhdWx0VmFsdWU7XG5cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHN3aXRjaCAocmVsYXRpb24udHlwZSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNhc2UgTW9kZWwuUkVMQVRJT05TLmhhc09uZSA6XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChyZWxhdGlvblJlc3VsdCAhPT0gdW5kZWZpbmVkKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXN1bHRbcmVsYXRpb24ubW9kZWxOYW1lXSA9IHJlbGF0aW9uUmVzdWx0W3JlbGF0aW9uLmZvcmVpZ25LZXldID09IHJlc3VsdFtyZWxhdGlvbi5sb2NhbEtleV0gPyByZWxhdGlvblJlc3VsdCA6IHJlc3VsdFtyZWxhdGlvbi5tb2RlbE5hbWVdO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY2FzZSBNb2RlbC5SRUxBVElPTlMuaGFzTWFueSA6XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChyZWxhdGlvblJlc3VsdC5sZW5ndGggPiAwKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXN1bHRbcmVsYXRpb24ubW9kZWxOYW1lXSA9IHJlbGF0aW9uUmVzdWx0LmZpbHRlcigocmVsYXRpb25SZXN1bHRJdGVtKSA9PiB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHJlbGF0aW9uUmVzdWx0SXRlbVtyZWxhdGlvbi5mb3JlaWduS2V5XSA9PSByZXN1bHRbcmVsYXRpb24ubG9jYWxLZXldO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChyZWxhdGlvbnNDb21wbGV0ZWQgPT0gbW9kZWwucmVsYXRpb25zLmxlbmd0aCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJlc29sdmUocmVzdWx0KTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9KS5jYXRjaCgoZXJyKSA9PiB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICByZWplY3QoZXJyKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgICAgICAgICAgICB9ZWxzZXtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXNvbHZlKGN1cnNvci52YWx1ZSk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICB9ZWxzZXtcbiAgICAgICAgICAgICAgICAgICAgICAgIGN1cnNvci5jb250aW51ZSgpO1xuICAgICAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICAgICB9ZWxzZXtcbiAgICAgICAgICAgICAgICAgICAgcmVzb2x2ZShyZXN1bHQpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH07XG5cbiAgICAgICAgICAgIHJlcXVlc3Qub25lcnJvciA9IGZ1bmN0aW9uKGUpIHtcbiAgICAgICAgICAgICAgICByZWplY3QoZSk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH0pO1xuICAgIH1cblxuICAgIC8qKlxuICAgICAqIEZ1bmN0aW9uIHNlYXJjaGVzIHRocm91Z2hvdXQgdGhlIGRhdGFiYXNlIGFuZCByZXR1cm5zIGEgYXJyYXkgb2YgcmVzdWx0XG4gICAgICogQHJldHVybnMge1Byb21pc2V9XG4gICAgICovXG4gICAgZ2V0KCkge1xuICAgICAgICBsZXQgbW9kZWwgPSB0aGlzO1xuXG4gICAgICAgIHJldHVybiBuZXcgUHJvbWlzZSgocmVzb2x2ZSwgcmVqZWN0KSA9PiB7XG4gICAgICAgICAgICBsZXQgdHJhbnNhY3Rpb24gPSBtb2RlbC5nZXRUcmFuc2FjdGlvbihtb2RlbC50YWJsZXMsIE1vZGVsLlJFQURPTkxZKTtcbiAgICAgICAgICAgIGxldCBvYmogPSB0cmFuc2FjdGlvbi5vYmplY3RTdG9yZShtb2RlbC5uYW1lKTtcbiAgICAgICAgICAgIGxldCByZXN1bHQgPSBbXTtcbiAgICAgICAgICAgIGxldCByZXF1ZXN0O1xuXG4gICAgICAgICAgICBpZihtb2RlbC5pbmRleEJ1aWxkZXIudHlwZSl7XG4gICAgICAgICAgICAgICAgcmVxdWVzdCA9IG1vZGVsLmdldEluZGV4UmVzdWx0KG9iaik7XG4gICAgICAgICAgICB9ZWxzZXtcbiAgICAgICAgICAgICAgICByZXF1ZXN0ID0gb2JqLm9wZW5DdXJzb3IoKTtcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgcmVxdWVzdC5vbnN1Y2Nlc3MgPSBmdW5jdGlvbiAoZSkge1xuICAgICAgICAgICAgICAgIGxldCBjdXJzb3IgPSBlLnRhcmdldC5yZXN1bHQ7XG5cbiAgICAgICAgICAgICAgICBpZihjdXJzb3Ipe1xuICAgICAgICAgICAgICAgICAgICBpZihtb2RlbC5jaGVja0J1aWxkZXJWYWx1ZShjdXJzb3IudmFsdWUpKXtcbiAgICAgICAgICAgICAgICAgICAgICAgIHJlc3VsdC5wdXNoKGN1cnNvci52YWx1ZSk7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgY3Vyc29yLmNvbnRpbnVlKCk7XG5cbiAgICAgICAgICAgICAgICB9ZWxzZXtcbiAgICAgICAgICAgICAgICAgICAgbGV0IG1haW5SZXN1bHQsIHJlbGF0aW9uc0NvbXBsZXRlZCA9IDA7XG5cbiAgICAgICAgICAgICAgICAgICAgaWYobW9kZWwucmVsYXRpb25zLmxlbmd0aCA+IDAgJiYgcmVzdWx0Lmxlbmd0aCA+IDApe1xuXG5cbiAgICAgICAgICAgICAgICAgICAgICAgIG1vZGVsLnJlbGF0aW9ucy5mb3JFYWNoKChyZWxhdGlvbikgPT4ge1xuXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgbGV0IHJlbGF0aW9uUmVxdWVzdCA9IG1vZGVsLmdldFJlbGF0aW9uc2hpcHMocmVsYXRpb24sIG1vZGVsLnRyYW5zYWN0aW9uLCBtb2RlbC5nZXRNYWluUmVzdWx0KHJlc3VsdCwgcmVsYXRpb24ubG9jYWxLZXksIHRydWUpLCB0cnVlKTtcblxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJlbGF0aW9uUmVxdWVzdC50aGVuKChyZWxhdGlvblJlc3VsdCkgPT4ge1xuXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJlbGF0aW9uc0NvbXBsZXRlZCsrO1xuXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJlc3VsdCA9IHJlc3VsdC5tYXAoaXRlbSA9PiB7XG5cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGxldCBkZWZhdWx0VmFsdWUgPSBtb2RlbC5nZXREZWZhdWx0UmVsYXRpb25WYWx1ZShyZWxhdGlvbi50eXBlKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGl0ZW1bcmVsYXRpb24ubW9kZWxOYW1lXSA9IGl0ZW1bcmVsYXRpb24ubW9kZWxOYW1lXSB8fCBkZWZhdWx0VmFsdWU7XG5cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHN3aXRjaCAocmVsYXRpb24udHlwZSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNhc2UgTW9kZWwuUkVMQVRJT05TLmhhc09uZSA6XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmKHJlbGF0aW9uUmVzdWx0ICE9PSB1bmRlZmluZWQpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGl0ZW1bcmVsYXRpb24ubW9kZWxOYW1lXSA9IHJlbGF0aW9uUmVzdWx0W3JlbGF0aW9uLmZvcmVpZ25LZXldID09IGl0ZW1bcmVsYXRpb24ubG9jYWxLZXldID8gcmVsYXRpb25SZXN1bHQgOiBpdGVtW3JlbGF0aW9uLm1vZGVsTmFtZV07XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjYXNlIE1vZGVsLlJFTEFUSU9OUy5oYXNNYW55IDpcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYocmVsYXRpb25SZXN1bHQubGVuZ3RoID4gMCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaXRlbVtyZWxhdGlvbi5tb2RlbE5hbWVdID0gcmVsYXRpb25SZXN1bHQuZmlsdGVyKChyZWxhdGlvblJlc3VsdEl0ZW0pID0+IHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gcmVsYXRpb25SZXN1bHRJdGVtW3JlbGF0aW9uLmZvcmVpZ25LZXldID09IGl0ZW1bcmVsYXRpb24ubG9jYWxLZXldO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBpdGVtO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9KTtcblxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZihyZWxhdGlvbnNDb21wbGV0ZWQgPT0gbW9kZWwucmVsYXRpb25zLmxlbmd0aCl7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXNvbHZlKHJlc3VsdCk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0pLmNhdGNoKChlcnIpID0+IHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcmVqZWN0KGVycik7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfSlcbiAgICAgICAgICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAgICAgICB9ZWxzZXtcbiAgICAgICAgICAgICAgICAgICAgICAgIHJlc29sdmUocmVzdWx0KTtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH07XG5cbiAgICAgICAgICAgIHJlcXVlc3Qub25lcnJvciA9IGZ1bmN0aW9uKGUpIHtcbiAgICAgICAgICAgICAgICByZWplY3QoZSk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH0pO1xuICAgIH1cblxuICAgIC8qKlxuICAgICAqIEZ1bmN0aW9uIGNyZWF0ZXMgYSBzaW5nbGUgcmVjb3JkXG4gICAgICogQHBhcmFtIGRhdGFcbiAgICAgKiBAcmV0dXJucyB7UHJvbWlzZX1cbiAgICAgKi9cbiAgICBjcmVhdGUoZGF0YSkge1xuICAgICAgICBsZXQgbW9kZWwgPSB0aGlzO1xuXG4gICAgICAgIHJldHVybiBuZXcgUHJvbWlzZSgocmVzb2x2ZSwgcmVqZWN0KSA9PiB7XG4gICAgICAgICAgICBsZXQgdHJhbnNhY3Rpb24gPSBtb2RlbC5nZXRUcmFuc2FjdGlvbihtb2RlbC50YWJsZXMsIE1vZGVsLlJFQURXUklURSk7XG5cbiAgICAgICAgICAgIGxldCBvYmogPSB0cmFuc2FjdGlvbi5vYmplY3RTdG9yZShtb2RlbC5uYW1lKTtcblxuICAgICAgICAgICAgZGF0YS5jcmVhdGVkQXQgPSBEYXRlLm5vdygpO1xuICAgICAgICAgICAgZGF0YS51cGRhdGVkQXQgPSBEYXRlLm5vdygpO1xuXG4gICAgICAgICAgICBsZXQgcmVxdWVzdCA9IG9iai5hZGQoZGF0YSk7XG5cbiAgICAgICAgICAgIHJlcXVlc3Qub25zdWNjZXNzID0gZnVuY3Rpb24gKGUpIHtcbiAgICAgICAgICAgICAgICBkYXRhW21vZGVsLnByaW1hcnldID0gZS50YXJnZXQucmVzdWx0O1xuICAgICAgICAgICAgICAgIHJlc29sdmUoZGF0YSk7XG4gICAgICAgICAgICB9O1xuXG4gICAgICAgICAgICByZXF1ZXN0Lm9uZXJyb3IgPSBmdW5jdGlvbiAoZSkge1xuICAgICAgICAgICAgICAgIHJlamVjdChlKTtcbiAgICAgICAgICAgIH07XG4gICAgICAgIH0pO1xuXG4gICAgfVxuXG4gICAgLyoqXG4gICAgICogRnVuY3Rpb24gY3JlYXRlcyBsaXN0IG9mIHJlY29yZHMgcGFzc2VkXG4gICAgICogQHBhcmFtIGRhdGFSZWNvcmRzXG4gICAgICogQHJldHVybnMge1Byb21pc2V9XG4gICAgICovXG4gICAgY3JlYXRlTXVsdGlwbGUgKGRhdGFSZWNvcmRzKSB7XG4gICAgICAgIGxldCBtb2RlbCA9IHRoaXM7XG5cbiAgICAgICAgcmV0dXJuIG5ldyBQcm9taXNlKChyZXNvbHZlLCByZWplY3QpID0+IHtcbiAgICAgICAgICAgIGxldCB0cmFuc2FjdGlvbiA9IG1vZGVsLmdldFRyYW5zYWN0aW9uKG1vZGVsLnRhYmxlcywgTW9kZWwuUkVBRFdSSVRFKTtcblxuICAgICAgICAgICAgbGV0IG9iaiA9IHRyYW5zYWN0aW9uLm9iamVjdFN0b3JlKG1vZGVsLm5hbWUpO1xuICAgICAgICAgICAgbGV0IGNyZWF0ZWRBdCA9IERhdGUubm93KCk7XG4gICAgICAgICAgICBsZXQgdXBkYXRlZEF0ID0gRGF0ZS5ub3coKTtcbiAgICAgICAgICAgIGxldCByZXN1bHQgPSBbXTtcblxuICAgICAgICAgICAgZGF0YVJlY29yZHMuZm9yRWFjaCgoZGF0YSkgPT4ge1xuICAgICAgICAgICAgICAgIGRhdGEuY3JlYXRlZEF0ID0gY3JlYXRlZEF0O1xuICAgICAgICAgICAgICAgIGRhdGEudXBkYXRlZEF0ID0gdXBkYXRlZEF0O1xuXG4gICAgICAgICAgICAgICAgbGV0IHJlcXVlc3QgPSBvYmouYWRkKGRhdGEpO1xuXG4gICAgICAgICAgICAgICAgcmVxdWVzdC5vbmVycm9yID0gZnVuY3Rpb24oZSkge1xuICAgICAgICAgICAgICAgICAgICByZWplY3QoZSk7XG4gICAgICAgICAgICAgICAgfTtcblxuICAgICAgICAgICAgICAgIHJlcXVlc3Qub25zdWNjZXNzID0gZnVuY3Rpb24oZSkge1xuICAgICAgICAgICAgICAgICAgICBkYXRhW21vZGVsLnByaW1hcnldID0gZS50YXJnZXQucmVzdWx0O1xuXG4gICAgICAgICAgICAgICAgICAgIHJlc3VsdC5wdXNoKGRhdGEpO1xuXG4gICAgICAgICAgICAgICAgICAgIGlmKHJlc3VsdC5sZW5ndGggPT09IGRhdGFSZWNvcmRzLmxlbmd0aCl7XG4gICAgICAgICAgICAgICAgICAgICAgICByZXNvbHZlKHJlc3VsdCk7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB9O1xuICAgICAgICAgICAgfSlcbiAgICAgICAgfSk7XG4gICAgfVxuXG4gICAgLyoqXG4gICAgICogRnVuY3Rpb24gdXBkYXRlcyB0aGUgdmFyaW91cyByZWNvcmRzIHdpdGggbWF0Y2hpbmcgdmFsdWVzXG4gICAgICogQHBhcmFtIGRhdGFcbiAgICAgKiBAcmV0dXJucyB7UHJvbWlzZX1cbiAgICAgKi9cbiAgICB1cGRhdGUoZGF0YSkge1xuXG4gICAgICAgIGxldCBtb2RlbCA9IHRoaXM7XG4gICAgICAgIGxldCB1cGRhdGVkQXQgPSBEYXRlLm5vdygpO1xuXG4gICAgICAgIHJldHVybiBuZXcgUHJvbWlzZSgocmVzb2x2ZSwgcmVqZWN0KSA9PiB7XG4gICAgICAgICAgICBsZXQgdHJhbnNhY3Rpb24gPSBtb2RlbC5nZXRUcmFuc2FjdGlvbihtb2RlbC50YWJsZXMsIE1vZGVsLlJFQURXUklURSk7XG4gICAgICAgICAgICBsZXQgb2JqID0gdHJhbnNhY3Rpb24ub2JqZWN0U3RvcmUobW9kZWwubmFtZSk7XG4gICAgICAgICAgICBsZXQgcmVxdWVzdCwgdG90YWxSZWNvcmRzQmVpbmdVcGRhdGVkID0gMCwgdG90YWxSZWNvcmRzVXBkYXRlZCA9IDA7XG5cbiAgICAgICAgICAgIGlmKG1vZGVsLmluZGV4QnVpbGRlci50eXBlKXtcbiAgICAgICAgICAgICAgICByZXF1ZXN0ID0gbW9kZWwuZ2V0SW5kZXhSZXN1bHQob2JqKTtcbiAgICAgICAgICAgIH1lbHNle1xuICAgICAgICAgICAgICAgIHJlcXVlc3QgPSBvYmoub3BlbkN1cnNvcigpO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICByZXF1ZXN0Lm9uc3VjY2VzcyA9IGZ1bmN0aW9uIChlKSB7XG4gICAgICAgICAgICAgICAgbGV0IGN1cnNvciA9IGUudGFyZ2V0LnJlc3VsdDtcblxuICAgICAgICAgICAgICAgIGlmKGN1cnNvcil7XG4gICAgICAgICAgICAgICAgICAgIGlmKG1vZGVsLmNoZWNrQnVpbGRlclZhbHVlKGN1cnNvci52YWx1ZSkpe1xuICAgICAgICAgICAgICAgICAgICAgICAgdG90YWxSZWNvcmRzQmVpbmdVcGRhdGVkKys7XG5cbiAgICAgICAgICAgICAgICAgICAgICAgIGxldCBpZCA9IGN1cnNvci52YWx1ZVttb2RlbC5wcmltYXJ5XTtcbiAgICAgICAgICAgICAgICAgICAgICAgIGxldCBjcmVhdGVkQXQgPSBjdXJzb3IudmFsdWUuY3JlYXRlZEF0O1xuXG4gICAgICAgICAgICAgICAgICAgICAgICBsZXQgcmVzdWx0ID0gTW9kZWwuaGVscGVycy5yZXBsYWNlTmVzdGVkVmFsdWVzKGRhdGEsIGN1cnNvci52YWx1ZSk7XG4gICAgICAgICAgICAgICAgICAgICAgICByZXN1bHRbbW9kZWwucHJpbWFyeV0gPSBpZDtcbiAgICAgICAgICAgICAgICAgICAgICAgIHJlc3VsdC5jcmVhdGVkQXQgPSBjcmVhdGVkQXQ7XG4gICAgICAgICAgICAgICAgICAgICAgICByZXN1bHQudXBkYXRlZEF0ID0gdXBkYXRlZEF0O1xuXG4gICAgICAgICAgICAgICAgICAgICAgICBsZXQgdXBkYXRlUmVxdWVzdCA9IGN1cnNvci51cGRhdGUocmVzdWx0KTtcblxuICAgICAgICAgICAgICAgICAgICAgICAgdXBkYXRlUmVxdWVzdC5vbnN1Y2Nlc3MgPSBmdW5jdGlvbigpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0b3RhbFJlY29yZHNVcGRhdGVkKys7XG5cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZih0b3RhbFJlY29yZHNVcGRhdGVkID09PSB0b3RhbFJlY29yZHNCZWluZ1VwZGF0ZWQpe1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXNvbHZlKHRydWUpO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgICAgIH07XG5cbiAgICAgICAgICAgICAgICAgICAgICAgIHVwZGF0ZVJlcXVlc3Qub25lcnJvciA9IGZ1bmN0aW9uKGVycikge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRyYW5zYWN0aW9uLmFib3J0KCk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgcmVqZWN0KGVycik7XG4gICAgICAgICAgICAgICAgICAgICAgICB9O1xuXG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgY3Vyc29yLmNvbnRpbnVlKCk7XG5cbiAgICAgICAgICAgICAgICB9ZWxzZXtcbiAgICAgICAgICAgICAgICAgICAgcmVzb2x2ZSgpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH07XG5cbiAgICAgICAgICAgIHJlcXVlc3Qub25lcnJvciA9IGZ1bmN0aW9uKGUpIHtcbiAgICAgICAgICAgICAgICByZWplY3QoZSk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH0pO1xuICAgIH1cblxuICAgIC8qKlxuICAgICAqIEZ1bmN0aW9uIHVwZGF0ZXMgdGhlIHJlY29yZCBhdCB0aGUgZ2l2ZW4gaWRcbiAgICAgKiBAcGFyYW0gaWRcbiAgICAgKiBAcGFyYW0gZGF0YVxuICAgICAqIEByZXR1cm5zIHtQcm9taXNlfVxuICAgICAqL1xuICAgIHNhdmUoaWQsIGRhdGEpIHtcbiAgICAgICAgbGV0IG1vZGVsID0gdGhpcztcbiAgICAgICAgbGV0IHVwZGF0ZWRBdCA9IERhdGUubm93KCk7XG5cbiAgICAgICAgcmV0dXJuIG5ldyBQcm9taXNlKChyZXNvbHZlLCByZWplY3QpID0+IHtcblxuICAgICAgICAgICAgbW9kZWwuZmluZChpZCkudGhlbigocmVzdWx0KSA9PiB7XG5cbiAgICAgICAgICAgICAgICBpZighcmVzdWx0KXtcbiAgICAgICAgICAgICAgICAgICAgcmVqZWN0KCdObyByZWNvcmQgZm91bmQnKTtcbiAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICAgICBsZXQgdHJhbnNhY3Rpb24gPSBtb2RlbC5nZXRUcmFuc2FjdGlvbihtb2RlbC50YWJsZXMsIE1vZGVsLlJFQURXUklURSwgdHJ1ZSk7XG4gICAgICAgICAgICAgICAgbGV0IG9iaiA9IHRyYW5zYWN0aW9uLm9iamVjdFN0b3JlKG1vZGVsLm5hbWUpO1xuXG4gICAgICAgICAgICAgICAgbGV0IGlkID0gcmVzdWx0W21vZGVsLnByaW1hcnldO1xuICAgICAgICAgICAgICAgIGxldCBjcmVhdGVkQXQgPSByZXN1bHQuY3JlYXRlZEF0O1xuXG4gICAgICAgICAgICAgICAgcmVzdWx0ID0gTW9kZWwuaGVscGVycy5yZXBsYWNlTmVzdGVkVmFsdWVzKGRhdGEsIHJlc3VsdCk7XG4gICAgICAgICAgICAgICAgcmVzdWx0W21vZGVsLnByaW1hcnldID0gaWQ7XG4gICAgICAgICAgICAgICAgcmVzdWx0LmNyZWF0ZWRBdCA9IGNyZWF0ZWRBdDtcbiAgICAgICAgICAgICAgICByZXN1bHQudXBkYXRlZEF0ID0gdXBkYXRlZEF0O1xuXG4gICAgICAgICAgICAgICAgbGV0IHJlcXVlc3QgPSBvYmoucHV0KHJlc3VsdCk7XG5cbiAgICAgICAgICAgICAgICByZXF1ZXN0Lm9uc3VjY2VzcyA9IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgICAgICAgICAgcmVzb2x2ZSh0cnVlKTtcbiAgICAgICAgICAgICAgICB9O1xuXG4gICAgICAgICAgICAgICAgcmVxdWVzdC5vbmVycm9yID0gZnVuY3Rpb24oZSkge1xuICAgICAgICAgICAgICAgICAgICByZWplY3QoZSk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfSkuY2F0Y2goKGVycikgPT4ge1xuICAgICAgICAgICAgICAgIHJlamVjdChlcnIpO1xuICAgICAgICAgICAgfSk7XG5cbiAgICAgICAgfSk7XG4gICAgfVxuXG4gICAgLyoqXG4gICAgICogRnVuY3Rpb24gZGVsZXRlcyB0aGUgZW50cmllcyBhdCB0aGUgZ2l2ZW4gcG9pbnRcbiAgICAgKiBAcGFyYW0gaWRcbiAgICAgKiBAcmV0dXJucyB7UHJvbWlzZX1cbiAgICAgKi9cbiAgICBkZXN0cm95SWQoaWQpIHtcbiAgICAgICAgbGV0IG1vZGVsID0gdGhpcztcblxuXG4gICAgICAgIHJldHVybiBuZXcgUHJvbWlzZSgocmVzb2x2ZSwgcmVqZWN0KSA9PiB7XG4gICAgICAgICAgICBtb2RlbC5maW5kKGlkKS50aGVuKChyZXN1bHQpID0+IHtcblxuICAgICAgICAgICAgICAgIGlmKCFyZXN1bHQpe1xuICAgICAgICAgICAgICAgICAgICByZWplY3QoJ3Jlc3VsdCBhdCBpZCBkb2VzIG5vdCBleGlzdHMnKTtcbiAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICAgICBsZXQgdHJhbnNhY3Rpb24gPSBtb2RlbC5nZXRUcmFuc2FjdGlvbihtb2RlbC50YWJsZXMsIE1vZGVsLlJFQURXUklURSwgdHJ1ZSk7XG4gICAgICAgICAgICAgICAgbGV0IG9iaiA9IHRyYW5zYWN0aW9uLm9iamVjdFN0b3JlKG1vZGVsLm5hbWUpO1xuICAgICAgICAgICAgICAgIGxldCByZXF1ZXN0ID0gb2JqLmRlbGV0ZShpZCk7XG5cbiAgICAgICAgICAgICAgICByZXF1ZXN0Lm9uc3VjY2VzcyA9IGZ1bmN0aW9uIChlKSB7XG4gICAgICAgICAgICAgICAgICAgIHJlc29sdmUoZS50YXJnZXQucmVzdWx0KTtcbiAgICAgICAgICAgICAgICB9O1xuXG4gICAgICAgICAgICAgICAgcmVxdWVzdC5vbmVycm9yID0gZnVuY3Rpb24gKGUpIHtcbiAgICAgICAgICAgICAgICAgICAgcmVqZWN0KGUpO1xuICAgICAgICAgICAgICAgIH07XG4gICAgICAgICAgICB9KS5jYXRjaChlcnIgPT4ge1xuICAgICAgICAgICAgICAgIHJlamVjdChlcnIpO1xuICAgICAgICAgICAgfSk7XG5cblxuICAgICAgICB9KTtcbiAgICB9XG5cbiAgICAvKipcbiAgICAgKiBGdW5jdGlvbiBkZWxldGVzIHRoZSBlbnRyaWVzXG4gICAgICogQHJldHVybnMge1Byb21pc2V9XG4gICAgICovXG4gICAgZGVzdHJveSgpIHtcbiAgICAgICAgbGV0IG1vZGVsID0gdGhpcztcblxuICAgICAgICByZXR1cm4gbmV3IFByb21pc2UoKHJlc29sdmUsIHJlamVjdCkgPT4ge1xuICAgICAgICAgICAgbGV0IHRyYW5zYWN0aW9uID0gbW9kZWwuZ2V0VHJhbnNhY3Rpb24obW9kZWwudGFibGVzLCBNb2RlbC5SRUFEV1JJVEUpO1xuICAgICAgICAgICAgbGV0IG9iaiA9IHRyYW5zYWN0aW9uLm9iamVjdFN0b3JlKG1vZGVsLm5hbWUpO1xuICAgICAgICAgICAgbGV0IHJlcXVlc3QsIHRvdGFsUmVjb3Jkc0JlaW5nRGVsZXRlZCA9IDAsIHRvdGFsUmVjb3Jkc0RlbGV0ZWQgPSAwO1xuXG4gICAgICAgICAgICBpZiAobW9kZWwuaW5kZXhCdWlsZGVyLnR5cGUpIHtcbiAgICAgICAgICAgICAgICByZXF1ZXN0ID0gbW9kZWwuZ2V0SW5kZXhSZXN1bHQob2JqKTtcbiAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgcmVxdWVzdCA9IG9iai5vcGVuQ3Vyc29yKCk7XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIHJlcXVlc3Qub25zdWNjZXNzID0gZnVuY3Rpb24gKGUpIHtcbiAgICAgICAgICAgICAgICBsZXQgY3Vyc29yID0gZS50YXJnZXQucmVzdWx0O1xuXG4gICAgICAgICAgICAgICAgaWYgKGN1cnNvcikge1xuICAgICAgICAgICAgICAgICAgICBpZiAobW9kZWwuY2hlY2tCdWlsZGVyVmFsdWUoY3Vyc29yLnZhbHVlKSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgdG90YWxSZWNvcmRzQmVpbmdEZWxldGVkKys7XG5cbiAgICAgICAgICAgICAgICAgICAgICAgIGxldCBkZWxldGVSZXF1ZXN0ID0gY3Vyc29yLmRlbGV0ZSgpO1xuXG4gICAgICAgICAgICAgICAgICAgICAgICBkZWxldGVSZXF1ZXN0Lm9uc3VjY2VzcyA9IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0b3RhbFJlY29yZHNEZWxldGVkKys7XG5cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAodG90YWxSZWNvcmRzRGVsZXRlZCA9PT0gdG90YWxSZWNvcmRzQmVpbmdEZWxldGVkKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJlc29sdmUodHJ1ZSk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICAgICAgfTtcblxuICAgICAgICAgICAgICAgICAgICAgICAgZGVsZXRlUmVxdWVzdC5vbmVycm9yID0gZnVuY3Rpb24gKGVycikge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRyYW5zYWN0aW9uLmFib3J0KCk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgcmVqZWN0KGVycik7XG4gICAgICAgICAgICAgICAgICAgICAgICB9O1xuXG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgY3Vyc29yLmNvbnRpbnVlKCk7XG5cbiAgICAgICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICByZXNvbHZlKCk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfTtcblxuICAgICAgICAgICAgcmVxdWVzdC5vbmVycm9yID0gZnVuY3Rpb24gKGUpIHtcbiAgICAgICAgICAgICAgICByZWplY3QoZSk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH0pO1xuICAgIH1cblxuICAgIC8qKlxuICAgICAqIEZ1bmN0aW9uIGNvdW50cyB0aGUgbnVtYmVyIG9mIHJlY29yZHNcbiAgICAgKiBAcmV0dXJucyB7UHJvbWlzZX1cbiAgICAgKi9cbiAgICBjb3VudCgpIHtcbiAgICAgICAgbGV0IG1vZGVsID0gdGhpcztcblxuICAgICAgICByZXR1cm4gbmV3IFByb21pc2UoKHJlc29sdmUsIHJlamVjdCkgPT4ge1xuICAgICAgICAgICAgbGV0IHRyYW5zYWN0aW9uID0gbW9kZWwuZ2V0VHJhbnNhY3Rpb24obW9kZWwudGFibGVzLCBNb2RlbC5SRUFET05MWSk7XG4gICAgICAgICAgICBsZXQgb2JqID0gdHJhbnNhY3Rpb24ub2JqZWN0U3RvcmUobW9kZWwubmFtZSk7XG4gICAgICAgICAgICBsZXQgcmVzdWx0ID0gMDtcbiAgICAgICAgICAgIGxldCByZXF1ZXN0O1xuXG4gICAgICAgICAgICBpZihtb2RlbC5pbmRleEJ1aWxkZXIudHlwZSl7XG4gICAgICAgICAgICAgICAgcmVxdWVzdCA9IG1vZGVsLmdldEluZGV4UmVzdWx0KG9iaik7XG4gICAgICAgICAgICB9ZWxzZXtcbiAgICAgICAgICAgICAgICByZXF1ZXN0ID0gb2JqLm9wZW5DdXJzb3IoKTtcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgcmVxdWVzdC5vbnN1Y2Nlc3MgPSBmdW5jdGlvbiAoZSkge1xuICAgICAgICAgICAgICAgIGxldCBjdXJzb3IgPSBlLnRhcmdldC5yZXN1bHQ7XG5cbiAgICAgICAgICAgICAgICBpZihjdXJzb3Ipe1xuICAgICAgICAgICAgICAgICAgICBpZihtb2RlbC5jaGVja0J1aWxkZXJWYWx1ZShjdXJzb3IudmFsdWUpKXtcbiAgICAgICAgICAgICAgICAgICAgICAgIHJlc3VsdCsrO1xuICAgICAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICAgICAgICAgY3Vyc29yLmNvbnRpbnVlKCk7XG5cbiAgICAgICAgICAgICAgICB9ZWxzZXtcbiAgICAgICAgICAgICAgICAgICAgcmVzb2x2ZShyZXN1bHQpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH07XG5cbiAgICAgICAgICAgIHJlcXVlc3Qub25lcnJvciA9IGZ1bmN0aW9uKGUpIHtcbiAgICAgICAgICAgICAgICByZWplY3QoZSk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH0pO1xuICAgIH1cblxuICAgIC8qKlxuICAgICAqIEZ1bmN0aW9uIGF2ZXJhZ2VzIHRoZSBudW1lcmljIHZhbHVlIGF0IHRoZSBnaXZlbiBwb2ludFxuICAgICAqIEBwYXJhbSBhdHRyaWJ1dGVcbiAgICAgKiBAcmV0dXJucyB7UHJvbWlzZX1cbiAgICAgKi9cbiAgICBhdmVyYWdlIChhdHRyaWJ1dGUpIHtcbiAgICAgICAgbGV0IG1vZGVsID0gdGhpcztcblxuICAgICAgICByZXR1cm4gbmV3IFByb21pc2UoKHJlc29sdmUsIHJlamVjdCkgPT4ge1xuICAgICAgICAgICAgbGV0IHRyYW5zYWN0aW9uID0gbW9kZWwuZ2V0VHJhbnNhY3Rpb24obW9kZWwudGFibGVzLCBNb2RlbC5SRUFET05MWSk7XG4gICAgICAgICAgICBsZXQgb2JqID0gdHJhbnNhY3Rpb24ub2JqZWN0U3RvcmUobW9kZWwubmFtZSk7XG4gICAgICAgICAgICBsZXQgcmVzdWx0ID0gMCwgdG90YWxSZWNvcmRzID0gMDtcbiAgICAgICAgICAgIGxldCByZXF1ZXN0O1xuXG4gICAgICAgICAgICBpZihtb2RlbC5pbmRleEJ1aWxkZXIudHlwZSl7XG4gICAgICAgICAgICAgICAgcmVxdWVzdCA9IG1vZGVsLmdldEluZGV4UmVzdWx0KG9iaik7XG4gICAgICAgICAgICB9ZWxzZXtcbiAgICAgICAgICAgICAgICByZXF1ZXN0ID0gb2JqLm9wZW5DdXJzb3IoKTtcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgcmVxdWVzdC5vbnN1Y2Nlc3MgPSBmdW5jdGlvbiAoZSkge1xuICAgICAgICAgICAgICAgIGxldCBjdXJzb3IgPSBlLnRhcmdldC5yZXN1bHQ7XG5cbiAgICAgICAgICAgICAgICBpZihjdXJzb3Ipe1xuICAgICAgICAgICAgICAgICAgICBpZihtb2RlbC5jaGVja0J1aWxkZXJWYWx1ZShjdXJzb3IudmFsdWUpKXtcbiAgICAgICAgICAgICAgICAgICAgICAgIHRvdGFsUmVjb3JkcysrO1xuICAgICAgICAgICAgICAgICAgICAgICAgbGV0IHRlbXBSZXN1bHQgPSBNb2RlbC5oZWxwZXJzLmdldE5lc3RlZEF0dHJpYnV0ZShhdHRyaWJ1dGUsIGN1cnNvci52YWx1ZSk7XG4gICAgICAgICAgICAgICAgICAgICAgICB0ZW1wUmVzdWx0ID0gcGFyc2VGbG9hdCh0ZW1wUmVzdWx0KTtcbiAgICAgICAgICAgICAgICAgICAgICAgIHRlbXBSZXN1bHQgPSBpc05hTih0ZW1wUmVzdWx0KSA/IDAgOiB0ZW1wUmVzdWx0O1xuICAgICAgICAgICAgICAgICAgICAgICAgcmVzdWx0ICs9IHRlbXBSZXN1bHQ7XG4gICAgICAgICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgICAgICAgICBjdXJzb3IuY29udGludWUoKTtcblxuICAgICAgICAgICAgICAgIH1lbHNle1xuICAgICAgICAgICAgICAgICAgICByZXNvbHZlKHJlc3VsdC90b3RhbFJlY29yZHMpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH07XG5cbiAgICAgICAgICAgIHJlcXVlc3Qub25lcnJvciA9IGZ1bmN0aW9uKGUpIHtcbiAgICAgICAgICAgICAgICByZWplY3QoZSk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH0pO1xuICAgIH1cblxuICAgIC8qKlxuICAgICAqIFJlZHVjZSBmdW5jdGlvbiBpcyBjYWxsZWQgd2l0aCBlYWNoIHBhc3NpbmcgaXRlcmF0b3IgdmFsdWUgYW5kIHJlZHVjZWQgdmFsdWUgaXMgcmV0dXJuZWRcbiAgICAgKiBAcGFyYW0gZnVuY1xuICAgICAqIEBwYXJhbSBkZWZhdWx0Q2FycnlcbiAgICAgKiBAcmV0dXJucyB7UHJvbWlzZX1cbiAgICAgKi9cbiAgICByZWR1Y2UgKGZ1bmMsIGRlZmF1bHRDYXJyeSkge1xuICAgICAgICBsZXQgbW9kZWwgPSB0aGlzO1xuXG4gICAgICAgIGlmKHR5cGVvZiBmdW5jICE9PSAnZnVuY3Rpb24nKXtcbiAgICAgICAgICAgIHRocm93IFwiUGFyYW1ldGVyIHNob3VsZCBiZSBhIGZ1bmN0aW9uIHR5cGVcIjtcbiAgICAgICAgfVxuXG4gICAgICAgIHJldHVybiBuZXcgUHJvbWlzZSgocmVzb2x2ZSwgcmVqZWN0KSA9PiB7XG4gICAgICAgICAgICBsZXQgdHJhbnNhY3Rpb24gPSBtb2RlbC5nZXRUcmFuc2FjdGlvbihtb2RlbC50YWJsZXMsIE1vZGVsLlJFQURPTkxZKTtcbiAgICAgICAgICAgIGxldCBvYmogPSB0cmFuc2FjdGlvbi5vYmplY3RTdG9yZShtb2RlbC5uYW1lKTtcbiAgICAgICAgICAgIGxldCByZXN1bHQgPSBkZWZhdWx0Q2Fycnk7XG4gICAgICAgICAgICBsZXQgcmVxdWVzdDtcblxuICAgICAgICAgICAgaWYobW9kZWwuaW5kZXhCdWlsZGVyLnR5cGUpe1xuICAgICAgICAgICAgICAgIHJlcXVlc3QgPSBtb2RlbC5nZXRJbmRleFJlc3VsdChvYmopO1xuICAgICAgICAgICAgfWVsc2V7XG4gICAgICAgICAgICAgICAgcmVxdWVzdCA9IG9iai5vcGVuQ3Vyc29yKCk7XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIHJlcXVlc3Qub25zdWNjZXNzID0gZnVuY3Rpb24gKGUpIHtcbiAgICAgICAgICAgICAgICBsZXQgY3Vyc29yID0gZS50YXJnZXQucmVzdWx0O1xuXG4gICAgICAgICAgICAgICAgaWYoY3Vyc29yKXtcbiAgICAgICAgICAgICAgICAgICAgaWYobW9kZWwuY2hlY2tCdWlsZGVyVmFsdWUoY3Vyc29yLnZhbHVlKSl7XG4gICAgICAgICAgICAgICAgICAgICAgICByZXN1bHQgPSBmdW5jKGN1cnNvci52YWx1ZSwgcmVzdWx0KTtcbiAgICAgICAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAgICAgICAgIGN1cnNvci5jb250aW51ZSgpO1xuXG4gICAgICAgICAgICAgICAgfWVsc2V7XG4gICAgICAgICAgICAgICAgICAgIHJlc29sdmUocmVzdWx0KTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9O1xuXG4gICAgICAgICAgICByZXF1ZXN0Lm9uZXJyb3IgPSBmdW5jdGlvbihlKSB7XG4gICAgICAgICAgICAgICAgcmVqZWN0KGUpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9KTtcbiAgICB9XG5cbiAgICAvKipcbiAgICAgKiBTZXRzIHRoZSBpbmRleCBzZWFyY2ggY3JpdGVyaWFcbiAgICAgKiBAcGFyYW0gb2JqZWN0U3RvcmVcbiAgICAgKiBAcmV0dXJucyB7Kn1cbiAgICAgKi9cbiAgICBnZXRJbmRleFJlc3VsdChvYmplY3RTdG9yZSkge1xuICAgICAgICBsZXQgYnVpbGRlciA9IHRoaXM7XG4gICAgICAgIGxldCByYW5nZTtcbiAgICAgICAgbGV0IGluZGV4O1xuXG5cbiAgICAgICAgaWYoIWJ1aWxkZXIuaW5kZXhCdWlsZGVyLnR5cGUpIHtcbiAgICAgICAgICAgIHJldHVybiBvYmplY3RTdG9yZS5vcGVuQ3Vyc29yKCk7XG4gICAgICAgIH1cblxuICAgICAgICBpZihidWlsZGVyLmluZGV4QnVpbGRlci5pbmRleCAhPT0gYnVpbGRlci5wcmltYXJ5KXtcbiAgICAgICAgICAgIGluZGV4ID0gb2JqZWN0U3RvcmUuaW5kZXgoYnVpbGRlci5pbmRleEJ1aWxkZXIuaW5kZXgpO1xuICAgICAgICB9ZWxzZXtcbiAgICAgICAgICAgIGluZGV4ID0gb2JqZWN0U3RvcmU7XG4gICAgICAgIH1cblxuICAgICAgICBzd2l0Y2ggKGJ1aWxkZXIuaW5kZXhCdWlsZGVyLnR5cGUpIHtcbiAgICAgICAgICAgIGNhc2UgJ2FuZCcgOlxuICAgICAgICAgICAgICAgIHJhbmdlID0gYnVpbGRlci5pZGJLZXkub25seShidWlsZGVyLmluZGV4QnVpbGRlci52YWx1ZSk7XG4gICAgICAgICAgICAgICAgYnJlYWs7XG5cbiAgICAgICAgICAgIGNhc2UgJ2luJyA6XG4gICAgICAgICAgICAgICAgYnVpbGRlci53aGVyZUluKGJ1aWxkZXIuaW5kZXhCdWlsZGVyLmluZGV4LCBidWlsZGVyLmluZGV4QnVpbGRlci52YWx1ZSk7XG4gICAgICAgICAgICAgICAgbGV0IHZhbHVlcyA9IGJ1aWxkZXIuaW5kZXhCdWlsZGVyLnZhbHVlLnNvcnQoKTtcbiAgICAgICAgICAgICAgICByYW5nZSA9IGJ1aWxkZXIuaWRiS2V5LmJvdW5kKHZhbHVlc1swXSwgdmFsdWVzW3ZhbHVlcy5sZW5ndGggLSAxXSwgZmFsc2UsIGZhbHNlKTtcbiAgICAgICAgICAgICAgICBicmVhaztcblxuICAgICAgICAgICAgY2FzZSAnZ3RlJyA6XG4gICAgICAgICAgICAgICAgcmFuZ2UgPSBidWlsZGVyLmlkYktleS5sb3dlckJvdW5kKGJ1aWxkZXIuaW5kZXhCdWlsZGVyLnZhbHVlLCBmYWxzZSk7XG4gICAgICAgICAgICAgICAgYnJlYWs7XG5cbiAgICAgICAgICAgIGNhc2UgJ2d0JyA6XG4gICAgICAgICAgICAgICAgcmFuZ2UgPSBidWlsZGVyLmlkYktleS5sb3dlckJvdW5kKGJ1aWxkZXIuaW5kZXhCdWlsZGVyLnZhbHVlLCB0cnVlKTtcbiAgICAgICAgICAgICAgICBicmVhaztcblxuICAgICAgICAgICAgY2FzZSAnbHRlJyA6XG4gICAgICAgICAgICAgICAgcmFuZ2UgPSBidWlsZGVyLmlkYktleS51cHBlckJvdW5kKGJ1aWxkZXIuaW5kZXhCdWlsZGVyLnZhbHVlLCBmYWxzZSk7XG4gICAgICAgICAgICAgICAgYnJlYWs7XG5cbiAgICAgICAgICAgIGNhc2UgJ2x0JyA6XG4gICAgICAgICAgICAgICAgcmFuZ2UgPSBidWlsZGVyLmlkYktleS5sb3dlckJvdW5kKGJ1aWxkZXIuaW5kZXhCdWlsZGVyLnZhbHVlLCB0cnVlKTtcbiAgICAgICAgICAgICAgICBicmVhaztcblxuICAgICAgICAgICAgY2FzZSAnYmV0d2VlbicgOlxuICAgICAgICAgICAgICAgIHJhbmdlID0gYnVpbGRlci5pZGJLZXkuYm91bmQoYnVpbGRlci5pbmRleEJ1aWxkZXIudmFsdWVbMF0sIGJ1aWxkZXIuaW5kZXhCdWlsZGVyLnZhbHVlWzFdLCBmYWxzZSwgZmFsc2UpO1xuICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgZGVmYXVsdCA6XG4gICAgICAgICAgICAgICAgdGhyb3cgJ0ludmFsaWQgYnVpbGRlciB0eXBlIGZvdW5kJztcbiAgICAgICAgfVxuXG4gICAgICAgIHJldHVybiBpbmRleC5vcGVuQ3Vyc29yKHJhbmdlKTtcbiAgICB9XG5cbiAgICAvKipcbiAgICAgKiBDaGVja3MgY29tbW9uIHNlYXJjaCBjcml0ZXJpYSBvdGhlciB0aGFuIHRoZSBpbmRleCB2YWx1ZXNcbiAgICAgKiBAcGFyYW0gdmFsdWVcbiAgICAgKiBAcmV0dXJucyB7Ym9vbGVhbn1cbiAgICAgKi9cbiAgICBjaGVja0J1aWxkZXJWYWx1ZSh2YWx1ZSkge1xuICAgICAgICBsZXQgYnVpbGRlciA9IHRoaXM7XG4gICAgICAgIGxldCByZXN1bHQgPSB0cnVlO1xuICAgICAgICBsZXQgaSxqO1xuICAgICAgICBmb3IgKGkgPSAwOyBpIDwgYnVpbGRlci5idWlsZGVyLmxlbmd0aDsgaSsrKXtcblxuICAgICAgICAgICAgbGV0IGNvbmRpdGlvbiA9IGJ1aWxkZXIuYnVpbGRlcltpXTtcbiAgICAgICAgICAgIHN3aXRjaChjb25kaXRpb24udHlwZSl7XG5cbiAgICAgICAgICAgICAgICBjYXNlICdhbmQnIDogLy9jYXNlIGZvciBvbmUgdG8gb25lIHNlYXJjaFxuICAgICAgICAgICAgICAgICAgICBpZighTW9kZWwuaGVscGVycy5jaGVja05lc3RlZEF0dHJpYnV0ZShjb25kaXRpb24uYXR0cmlidXRlLCB2YWx1ZSwgY29uZGl0aW9uLnZhbHVlKSl7XG4gICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gZmFsc2U7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgYnJlYWs7XG5cbiAgICAgICAgICAgICAgICBjYXNlICdpbicgOiAvL2Nhc2UgZm9yIGxpc3Qgc2VhcmNoXG4gICAgICAgICAgICAgICAgICAgIGxldCB0ZW1wQ2hlY2sgPSBmYWxzZTtcbiAgICAgICAgICAgICAgICAgICAgZm9yKGogPSAwOyBqIDwgY29uZGl0aW9uLnZhbHVlLmxlbmd0aDsgaisrKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICByZXN1bHQgPSBNb2RlbC5oZWxwZXJzLmNoZWNrTmVzdGVkQXR0cmlidXRlKGNvbmRpdGlvbi5hdHRyaWJ1dGUsIHZhbHVlLCBjb25kaXRpb24udmFsdWVbal0pO1xuICAgICAgICAgICAgICAgICAgICAgICAgaWYocmVzdWx0ICE9PSB1bmRlZmluZWQgJiYgcmVzdWx0ICE9PSBmYWxzZSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRlbXBDaGVjayA9IHRydWU7XG4gICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgICAgICAgICBpZighdGVtcENoZWNrKXtcbiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBmYWxzZTtcbiAgICAgICAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAgICAgICAgIHJlc3VsdCA9IHRydWU7XG5cbiAgICAgICAgICAgICAgICAgICAgYnJlYWs7XG5cbiAgICAgICAgICAgICAgICBjYXNlICdndGUnIDogLy9jYXNlIGZvciBjaGVja2luZyB0aGUgdmFsdWUgaXMgZ3JlYXRlciB0aGFuIG9yIGlzIGVxdWFsIHRvIHRoZSBzYW1lXG4gICAgICAgICAgICAgICAgICAgIHJlc3VsdCA9IE1vZGVsLmhlbHBlcnMuZ2V0TmVzdGVkQXR0cmlidXRlKGNvbmRpdGlvbi5hdHRyaWJ1dGUsIHZhbHVlKTtcblxuICAgICAgICAgICAgICAgICAgICBpZihyZXN1bHQgPT09IHVuZGVmaW5lZCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgICAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICAgICAgICAgaWYocmVzdWx0IDwgY29uZGl0aW9uLnZhbHVlKXtcbiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBmYWxzZTtcbiAgICAgICAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAgICAgICAgIHJlc3VsdCA9IHRydWU7XG4gICAgICAgICAgICAgICAgICAgIGJyZWFrO1xuXG4gICAgICAgICAgICAgICAgY2FzZSAnZ3QnIDogLy9jYXNlIGZvciBjaGVja2luZyB0aGUgdmFsdWUgaXMgZ3JlYXRlciB0aGFuIHRoZSBzYW1lXG5cbiAgICAgICAgICAgICAgICAgICAgcmVzdWx0ID0gTW9kZWwuaGVscGVycy5nZXROZXN0ZWRBdHRyaWJ1dGUoY29uZGl0aW9uLmF0dHJpYnV0ZSwgdmFsdWUpO1xuXG4gICAgICAgICAgICAgICAgICAgIGlmKHJlc3VsdCA9PT0gdW5kZWZpbmVkKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gZmFsc2U7XG4gICAgICAgICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgICAgICAgICBpZihyZXN1bHQgPD0gY29uZGl0aW9uLnZhbHVlKXtcbiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBmYWxzZTtcbiAgICAgICAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAgICAgICAgIHJlc3VsdCA9IHRydWU7XG4gICAgICAgICAgICAgICAgICAgIGJyZWFrO1xuXG4gICAgICAgICAgICAgICAgY2FzZSAnbHRlJyA6IC8vY2FzZSBmb3IgY2hlY2tpbmcgdGhlIHZhbHVlIGlzIGxlc3MgdGhhbiBvciBpcyBlcXVhbCB0byB0aGUgc2FtZVxuICAgICAgICAgICAgICAgICAgICByZXN1bHQgPSBNb2RlbC5oZWxwZXJzLmdldE5lc3RlZEF0dHJpYnV0ZShjb25kaXRpb24uYXR0cmlidXRlLCB2YWx1ZSk7XG5cbiAgICAgICAgICAgICAgICAgICAgaWYocmVzdWx0ID09PSB1bmRlZmluZWQpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBmYWxzZTtcbiAgICAgICAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAgICAgICAgIGlmKHJlc3VsdCA+IGNvbmRpdGlvbi52YWx1ZSl7XG4gICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gZmFsc2U7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgcmVzdWx0ID0gdHJ1ZTtcbiAgICAgICAgICAgICAgICAgICAgYnJlYWs7XG5cbiAgICAgICAgICAgICAgICBjYXNlICdsdCcgOiAvL2Nhc2UgZm9yIGNoZWNraW5nIHRoZSB2YWx1ZSBpcyBsZXNzIHRoYW4gdGhlIHNhbWVcbiAgICAgICAgICAgICAgICAgICAgcmVzdWx0ID0gTW9kZWwuaGVscGVycy5nZXROZXN0ZWRBdHRyaWJ1dGUoY29uZGl0aW9uLmF0dHJpYnV0ZSwgdmFsdWUpO1xuXG4gICAgICAgICAgICAgICAgICAgIGlmKHJlc3VsdCA9PT0gdW5kZWZpbmVkKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gZmFsc2U7XG4gICAgICAgICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgICAgICAgICBpZihyZXN1bHQgPj0gY29uZGl0aW9uLnZhbHVlKXtcbiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBmYWxzZTtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICByZXN1bHQgPSB0cnVlO1xuICAgICAgICAgICAgICAgICAgICBicmVhaztcblxuICAgICAgICAgICAgICAgIGNhc2UgJ2JldHdlZW4nIDogLy9jYXNlIGZvciBjaGVja2luZyB0aGUgdmFsdWUgaXMgYmV0d2VlbiB0aGUgZ2l2ZW4gcmFuZ2UoT05MWSBXT1JLUyBGT1IgTlVNRVJJQylcbiAgICAgICAgICAgICAgICAgICAgcmVzdWx0ID0gTW9kZWwuaGVscGVycy5nZXROZXN0ZWRBdHRyaWJ1dGUoY29uZGl0aW9uLmF0dHJpYnV0ZSwgdmFsdWUpO1xuXG4gICAgICAgICAgICAgICAgICAgIGlmKHJlc3VsdCA9PT0gdW5kZWZpbmVkKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gZmFsc2U7XG4gICAgICAgICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgICAgICAgICBpZihjb25kaXRpb24udmFsdWVbMF0gPj0gcmVzdWx0ICYmIGNvbmRpdGlvbi52YWx1ZVsxXSA8PSByZXN1bHQpe1xuICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGZhbHNlXG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgcmVzdWx0ID0gdHJ1ZTtcbiAgICAgICAgICAgICAgICAgICAgYnJlYWs7XG5cbiAgICAgICAgICAgICAgICBkZWZhdWx0OlxuICAgICAgICAgICAgICAgICAgICByZXN1bHQgPSB0cnVlO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG5cbiAgICAgICAgcmV0dXJuIHJlc3VsdDtcbiAgICB9XG5cbiAgICAvKipcbiAgICAgKiBDcmVhdGVzIGEgdHJhbnNhY3Rpb25cbiAgICAgKiBAcGFyYW0gdGFibGVzXG4gICAgICogQHBhcmFtIG1vZGVcbiAgICAgKi9cbiAgICBjcmVhdGVUcmFuc2FjdGlvbih0YWJsZXMsIG1vZGUpIHtcbiAgICAgICAgdGhpcy50cmFuc2FjdGlvbiA9IHRoaXMuZGIudHJhbnNhY3Rpb24odGFibGVzLCBtb2RlKVxuICAgIH1cblxuICAgIC8qKlxuICAgICAqIFNldHMgSURCVHJhbnNhY3Rpb24gb2JlamN0IHRvIGN1cnJlbnQgbW9kZWwgc2NvcGVcbiAgICAgKiBAcGFyYW0gdHJhbnNhY3Rpb25cbiAgICAgKi9cbiAgICBzZXRUcmFuc2FjdGlvbih0cmFuc2FjdGlvbikge1xuICAgICAgICB0aGlzLnRyYW5zYWN0aW9uID0gdHJhbnNhY3Rpb25cbiAgICB9XG5cbiAgICAvKipcbiAgICAgKiBSZXR1cm5zIHRoZSBJREJUcmFuc2FjdGlvbiBvYmplY3Qgc2V0IGluIGN1cnJlbnQgc2NvcGVcbiAgICAgKiBAcGFyYW0ge0FycmF5fSB0YWJsZXNcbiAgICAgKiBAcGFyYW0ge1N0cmluZ30gbW9kZVxuICAgICAqIEBwYXJhbSB7Ym9vbGVhbn0gb3ZlcndyaXRlXG4gICAgICogQHJldHVybnMgeyp8bnVsbH1cbiAgICAgKi9cbiAgICBnZXRUcmFuc2FjdGlvbih0YWJsZXMsIG1vZGUsIG92ZXJ3cml0ZSkge1xuICAgICAgICBvdmVyd3JpdGUgPSBvdmVyd3JpdGUgPT09IHVuZGVmaW5lZCA/IGZhbHNlIDogb3ZlcndyaXRlO1xuXG4gICAgICAgIGlmKCF0aGlzLnRyYW5zYWN0aW9uIHx8IG92ZXJ3cml0ZSA9PT0gdHJ1ZSkge1xuICAgICAgICAgICAgdGhpcy5jcmVhdGVUcmFuc2FjdGlvbih0YWJsZXMsIG1vZGUpO1xuICAgICAgICB9XG5cbiAgICAgICAgcmV0dXJuIHRoaXMudHJhbnNhY3Rpb247XG4gICAgfVxuXG4gICAgLyoqXG4gICAgICogUmV0dXJucyB0aGUgYXJyYXkgb3IgZGlyZWN0IGtleSB2YWx1ZSBhZ2FpbnN0IHRoZSBpbnB1dCBnaXZlIGZvciB0aGUga2V5IHNwZWNpZmllZFxuICAgICAqIEBwYXJhbSByZXN1bHRcbiAgICAgKiBAcGFyYW0ga2V5XG4gICAgICogQHBhcmFtIGlzQXJyYXlcbiAgICAgKiBAcmV0dXJucyB7Kn1cbiAgICAgKi9cbiAgICBnZXRNYWluUmVzdWx0IChyZXN1bHQsIGtleSwgaXNBcnJheSkge1xuICAgICAgICBpZihpc0FycmF5KXtcbiAgICAgICAgICAgIHJldHVybiByZXN1bHQubWFwKChpdGVtKSA9PiB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIGl0ZW1ba2V5XTtcbiAgICAgICAgICAgIH0pO1xuICAgICAgICB9ZWxzZXtcbiAgICAgICAgICAgIHJldHVybiByZXN1bHRba2V5XTtcbiAgICAgICAgfVxuICAgIH1cblxuICAgIC8qKlxuICAgICAqIFNlYXJjaGVzIGZvciByZWxhdGlvbnNoaXBzIGFzc2lnbmVkIHdpdGggYnVpbGRlciBhbmQgZmV0Y2hlcyB0aGVtXG4gICAgICogQHBhcmFtIHJlbGF0aW9uXG4gICAgICogQHBhcmFtIHRyYW5zYWN0aW9uXG4gICAgICogQHBhcmFtIG1haW5SZXN1bHRcbiAgICAgKiBAcGFyYW0gaXNBcnJheVxuICAgICAqIEByZXR1cm5zIHtQcm9taXNlfVxuICAgICAqL1xuICAgIGdldFJlbGF0aW9uc2hpcHMgKHJlbGF0aW9uLCB0cmFuc2FjdGlvbiwgbWFpblJlc3VsdCwgaXNBcnJheSkge1xuXG4gICAgICAgIGlzQXJyYXkgPSBpc0FycmF5IHx8IGZhbHNlO1xuXG4gICAgICAgIGxldCBtb2RlbCA9IHRoaXM7XG4gICAgICAgIGxldCBwcmltYXJ5ID0gcmVsYXRpb24ucHJpbWFyeSB8fCAnaWQnO1xuXG4gICAgICAgIC8qKlxuICAgICAgICAgKiBAdmFyIE1vZGVsIHJlbGF0aW9uTW9kZWxcbiAgICAgICAgICovXG4gICAgICAgIGxldCByZWxhdGlvbk1vZGVsID0gbmV3IE1vZGVsKG1vZGVsLmRiLCBtb2RlbC5pZGJLZXksIHJlbGF0aW9uLm1vZGVsTmFtZSwgcmVsYXRpb24ucHJpbWFyeSk7XG5cbiAgICAgICAgLy9zZXR0aW5nIHRoZSByZWxhdGlvbiB0cmFuc2FjdGlvbiBzYW1lIGFzIHBhcmVudCB0cmFuc2FjdGlvblxuICAgICAgICByZWxhdGlvbk1vZGVsLnNldFRyYW5zYWN0aW9uKHRyYW5zYWN0aW9uKTtcblxuICAgICAgICAvL2lmIGEgc2Vjb25kcnkgYnVpbGRlciBmdW5jdGlvbiB3YXMgZGVmaW5lZFxuICAgICAgICBpZihyZWxhdGlvbi5mdW5jKXtcbiAgICAgICAgICAgIGxldCB0ZW1wQnVpbGRlciA9IG5ldyBCdWlsZGVyKCk7XG5cbiAgICAgICAgICAgIHRlbXBCdWlsZGVyID0gcmVsYXRpb24uZnVuYyh0ZW1wQnVpbGRlcik7XG5cbiAgICAgICAgICAgIHJlbGF0aW9uTW9kZWwudGFibGVzID0gdGVtcEJ1aWxkZXIudGFibGVzO1xuICAgICAgICAgICAgcmVsYXRpb25Nb2RlbC50YWJsZXMucHVzaChyZWxhdGlvbk1vZGVsLm5hbWUpO1xuICAgICAgICAgICAgcmVsYXRpb25Nb2RlbC5yZWxhdGlvbnMgPSB0ZW1wQnVpbGRlci5yZWxhdGlvbnM7XG4gICAgICAgICAgICByZWxhdGlvbk1vZGVsLmJ1aWxkZXIgPSB0ZW1wQnVpbGRlci5idWlsZGVyO1xuICAgICAgICB9XG5cbiAgICAgICAgLy9jaGVja2luZyB0eXBlIG9mIHBhcmVudCByZXN1bHRcbiAgICAgICAgaWYoaXNBcnJheSl7XG4gICAgICAgICAgICByZWxhdGlvbk1vZGVsLndoZXJlSW5kZXhJbihyZWxhdGlvbi5mb3JlaWduS2V5LCBtYWluUmVzdWx0KTtcbiAgICAgICAgfWVsc2V7XG4gICAgICAgICAgICByZWxhdGlvbk1vZGVsLndoZXJlSW5kZXgocmVsYXRpb24uZm9yZWlnbktleSwgbWFpblJlc3VsdCk7XG4gICAgICAgIH1cblxuICAgICAgICByZXR1cm4gbmV3IFByb21pc2UoKHJlbGF0aW9uUmVzb2x2ZSwgcmVsYXRpb25SZWplY3QpID0+IHtcblxuICAgICAgICAgICAgbGV0IHJlc3VsdDtcblxuICAgICAgICAgICAgLy9pZiByZWxhdGlvbiB0eXBlIG1lbnRpb25lZFxuICAgICAgICAgICAgc3dpdGNoIChyZWxhdGlvbi50eXBlKSB7XG4gICAgICAgICAgICAgICAgY2FzZSBNb2RlbC5SRUxBVElPTlMuaGFzT25lIDpcbiAgICAgICAgICAgICAgICAgICAgcmVzdWx0ID0gcmVsYXRpb25Nb2RlbC5maXJzdCgpO1xuICAgICAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgICAgICBjYXNlIE1vZGVsLlJFTEFUSU9OUy5oYXNNYW55IDpcbiAgICAgICAgICAgICAgICAgICAgcmVzdWx0ID0gcmVsYXRpb25Nb2RlbC5nZXQoKTtcbiAgICAgICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICAgICAgZGVmYXVsdCA6XG4gICAgICAgICAgICAgICAgICAgIHRocm93IFwiSW52YWxpZCByZWxhdGlvbiB0eXBlIHByb3ZpZGVkXCI7XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIHJlc3VsdC50aGVuKHIgPT4ge1xuICAgICAgICAgICAgICAgIHJlbGF0aW9uUmVzb2x2ZShyKTtcbiAgICAgICAgICAgIH0pLmNhdGNoKGVyciA9PiB7XG4gICAgICAgICAgICAgICAgcmVsYXRpb25SZWplY3QoZXJyKTtcbiAgICAgICAgICAgIH0pO1xuXG4gICAgICAgIH0pO1xuICAgIH1cblxuICAgIC8qKlxuICAgICAqIEdldHMgdGhlIGRlZmF1bHQgdmFsdWUgb2YgcmVzdWx0LiBOdWxsIGZvciBoYXNPbmUgYW5kIGFycmF5IGZvciBoYXNNYW55XG4gICAgICogQHBhcmFtIHR5cGVcbiAgICAgKiBAcmV0dXJucyB7Kn1cbiAgICAgKi9cbiAgICBnZXREZWZhdWx0UmVsYXRpb25WYWx1ZSh0eXBlKSB7XG4gICAgc3dpdGNoICh0eXBlKSB7XG4gICAgICAgIGNhc2UgTW9kZWwuUkVMQVRJT05TLmhhc09uZSA6XG4gICAgICAgICAgICByZXR1cm4gbnVsbDtcbiAgICAgICAgY2FzZSBNb2RlbC5SRUxBVElPTlMuaGFzTWFueSA6XG4gICAgICAgICAgICByZXR1cm4gW107XG4gICAgICAgIGRlZmF1bHQgOlxuICAgICAgICAgICAgcmV0dXJuIG51bGw7XG4gICAgfVxufVxuXG5cbiAgICAvKipcbiAgICAgKiBSZWFkd3JpdGUgcGFyYW1ldGVyIG9mIGluZGV4ZWREQlxuICAgICAqIEByZXR1cm4ge3N0cmluZ31cbiAgICAgKi9cbiAgICBzdGF0aWMgZ2V0IFJFQURXUklURSgpIHtcbiAgICAgICAgcmV0dXJuIFwicmVhZHdyaXRlXCI7XG4gICAgfVxuXG4gICAgLyoqXG4gICAgICogUmVhZG9ubHkgcGFyYW1ldGVyIG9mIGluZGV4ZWREQlxuICAgICAqIEByZXR1cm4ge3N0cmluZ31cbiAgICAgKi9cbiAgICBzdGF0aWMgZ2V0IFJFQURPTkxZKCkge1xuICAgICAgICByZXR1cm4gXCJyZWFkb25seVwiO1xuICAgIH1cblxufVxuXG5jbGFzcyBNaWdyYXRpb24ge1xuICAgIGNvbnN0cnVjdG9yKGRiLCB0cmFuc2FjdGlvbiwgbWlncmF0aW9ucykge1xuICAgICAgICAvKipcbiAgICAgICAgICogQHZhciBJREJEYXRhYmFzZSBkYlxuICAgICAgICAgKi9cbiAgICAgICAgdGhpcy5kYiA9IGRiO1xuICAgICAgICB0aGlzLm1pZ3JhdGlvbnMgPSBtaWdyYXRpb25zO1xuICAgICAgICB0aGlzLm9iamVjdFN0b3JlcyA9IFtdO1xuXG4gICAgICAgIC8qKlxuICAgICAgICAgKiBAdmFyIElEQlRyYW5zYWN0aW9uIHRyYW5zYWN0aW9uXG4gICAgICAgICAqL1xuICAgICAgICB0aGlzLnRyYW5zYWN0aW9uID0gdHJhbnNhY3Rpb247XG4gICAgfVxuXG4gICAgY3JlYXRlU3RvcmUoc2NoZW1hKSB7XG4gICAgICAgIGxldCBtaWcgPSB0aGlzO1xuICAgICAgICBsZXQgcHJpbWFyeSA9IHNjaGVtYS5wcmltYXJ5IHx8ICdpZCc7XG5cbiAgICAgICAgbGV0IG9iamVjdFN0b3JlID0gbWlnLmRiLmNyZWF0ZU9iamVjdFN0b3JlKHNjaGVtYS5uYW1lLCB7a2V5UGF0aDogcHJpbWFyeSwgYXV0b0luY3JlbWVudDogdHJ1ZX0pO1xuICAgICAgICBtaWcub2JqZWN0U3RvcmVzLnB1c2gob2JqZWN0U3RvcmUpO1xuXG4gICAgICAgIGlmIChzY2hlbWEuY29sdW1ucykge1xuICAgICAgICAgICAgc2NoZW1hLmNvbHVtbnMuZm9yRWFjaCgoY29sdW1uKSA9PiBtaWcubWFrZUluZGV4KGNvbHVtbiwgb2JqZWN0U3RvcmUpKTtcbiAgICAgICAgfVxuXG5cbiAgICB9XG5cbiAgICBydW4oKSB7XG4gICAgICAgIGxldCBtaWcgPSB0aGlzO1xuXG4gICAgICAgIG1pZy5taWdyYXRpb25zLmZvckVhY2goKHNjaGVtYSkgPT4ge1xuICAgICAgICAgICAgaWYobWlnLmRiLm9iamVjdFN0b3JlTmFtZXMuY29udGFpbnMoc2NoZW1hLm5hbWUpKXtcblxuICAgICAgICAgICAgICAgIGlmKHNjaGVtYS5kcm9wKXtcbiAgICAgICAgICAgICAgICAgICAgbWlnLmRiLmRlbGV0ZU9iamVjdFN0b3JlKHNjaGVtYS5uYW1lKTtcbiAgICAgICAgICAgICAgICB9ZWxzZXtcbiAgICAgICAgICAgICAgICAgICAgbWlnLnVwZGF0ZVN0b3JlKHNjaGVtYSk7XG4gICAgICAgICAgICAgICAgfVxuXG5cbiAgICAgICAgICAgIH1lbHNle1xuICAgICAgICAgICAgICAgIG1pZy5jcmVhdGVTdG9yZShzY2hlbWEpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9KTtcbiAgICB9XG5cbiAgICBtYWtlSW5kZXgoY29sdW1uLCBvYmplY3RTdG9yZSkge1xuICAgICAgICBjb2x1bW4uYXR0cmlidXRlcyA9IGNvbHVtbi5hdHRyaWJ1dGVzIHx8IHt9O1xuICAgICAgICBjb2x1bW4uaW5kZXggPSBjb2x1bW4uaW5kZXggfHwgY29sdW1uLm5hbWU7XG4gICAgICAgIG9iamVjdFN0b3JlLmNyZWF0ZUluZGV4KGNvbHVtbi5uYW1lLCBjb2x1bW4uaW5kZXgsIGNvbHVtbi5hdHRyaWJ1dGVzKTtcbiAgICB9XG5cbiAgICB1cGRhdGVTdG9yZShzY2hlbWEpIHtcbiAgICAgICAgbGV0IG1pZyA9IHRoaXM7XG5cbiAgICAgICAgbGV0IG9iamVjdFN0b3JlID0gbWlnLnRyYW5zYWN0aW9uLm9iamVjdFN0b3JlKHNjaGVtYS5uYW1lKTtcblxuICAgICAgICBpZiAoc2NoZW1hLmNvbHVtbnMpIHtcblxuICAgICAgICAgICAgc2NoZW1hLmNvbHVtbnMuZm9yRWFjaCgoY29sdW1uKSA9PiB7XG4gICAgICAgICAgICAgICAgaWYoIW9iamVjdFN0b3JlLmluZGV4TmFtZXMuY29udGFpbnMoY29sdW1uLm5hbWUpKXtcbiAgICAgICAgICAgICAgICAgICAgbWlnLm1ha2VJbmRleChjb2x1bW4sIG9iamVjdFN0b3JlKVxuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH0pO1xuICAgICAgICB9XG5cbiAgICAgICAgaWYoc2NoZW1hLmRyb3BDb2x1bW5zKSB7XG4gICAgICAgICAgICBzY2hlbWEuZHJvcENvbHVtbnMuZm9yRWFjaCgoY29sdW1uKSA9PiB7XG4gICAgICAgICAgICAgICAgaWYob2JqZWN0U3RvcmUuaW5kZXhOYW1lcy5jb250YWlucyhjb2x1bW4pKXtcbiAgICAgICAgICAgICAgICAgICAgbWlnLmRyb3BJbmRleChjb2x1bW4sIG9iamVjdFN0b3JlKVxuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH0pO1xuICAgICAgICB9XG4gICAgfVxuXG4gICAgZHJvcEluZGV4KGNvbHVtbk5hbWUsIG9iamVjdFN0b3JlKSB7XG4gICAgICAgIGRlYnVnZ2VyO1xuICAgICAgICBvYmplY3RTdG9yZS5kZWxldGVJbmRleChjb2x1bW5OYW1lKTtcbiAgICB9XG5cbn1cblxuY2xhc3MgREIge1xuXG4gICAgY29uc3RydWN0b3IoaWRiLCBpZGJLZXksIHNldHRpbmdzLCB1c2VXZWJXb3JrZXIsIHBhdGhUb1dlYldvcmtlcikge1xuICAgICAgICB0aGlzLmRiID0gaWRiO1xuICAgICAgICB0aGlzLmlkYktleSA9IGlkYktleTtcbiAgICAgICAgdGhpcy5zZXR0aW5ncyA9IHNldHRpbmdzO1xuICAgICAgICB0aGlzLnVzZVdlYldvcmtlciA9IHVzZVdlYldvcmtlciB8fCBmYWxzZTtcbiAgICAgICAgdGhpcy5pc1dlYldvcmtlciA9IGZhbHNlO1xuICAgICAgICB0aGlzLnBhdGhUb1dlYldvcmtlciA9IHBhdGhUb1dlYldvcmtlcjtcbiAgICB9XG5cbiAgICAvKipcbiAgICAgKiBJbml0aWFsaXplcyBkYXRhYmFzZSBjb25uZWN0aW9uIHdpdGggaW5kZXhlZERCXG4gICAgICpcbiAgICAgKiBAcmV0dXJucyB7UHJvbWlzZX1cbiAgICAgKi9cbiAgICBjb25uZWN0KCkge1xuICAgICAgICBsZXQgZGIgPSB0aGlzO1xuICAgICAgICByZXR1cm4gbmV3IFByb21pc2UoKHJlc29sdmUsIHJlamVjdCkgPT4ge1xuXG4gICAgICAgICAgICBpZihkYi51c2VXZWJXb3JrZXIpe1xuICAgICAgICAgICAgICAgIGRiLmNyZWF0ZVdvcmtlckhhbmRsZXIocmVzb2x2ZSwgcmVqZWN0KTtcbiAgICAgICAgICAgIH1lbHNle1xuICAgICAgICAgICAgICAgIGRiLmNyZWF0ZU5vcm1hbEhhbmRsZXIocmVzb2x2ZSwgcmVqZWN0KTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfSk7XG4gICAgfVxuXG4gICAgLyoqXG4gICAgICogRGVzdHJveXMvRGVsZXRlcyB0aGUgZGF0YWJhYXNlXG4gICAgICogQHBhcmFtIGRiTmFtZVxuICAgICAqL1xuICAgIGRlc3Ryb3koZGJOYW1lKSB7XG4gICAgICAgIGNvbnNvbGUuaW5mbygnZGF0YWJhc2UgJyArIGRiTmFtZSArICcgZGVsZXRlZCcpO1xuICAgICAgICB0aGlzLmRiLmRlbGV0ZURhdGFiYXNlKGRiTmFtZSk7XG4gICAgfVxuXG4gICAgLyoqXG4gICAgICogQ3JlYXRlcyBjb25uZWN0aW9uIGluIHdlYiB3b3JrZXIgc3BhY2UgYW5kIGlmIHdlYiB3b3JrZXIgZmFpbHNcbiAgICAgKiB0aGVuIGNyZWF0ZXMgbm9ybWFsIGRhdGFiYXNlIGNvbm5lY3Rpb24gaW5zdGFuY2VcbiAgICAgKiBAcGFyYW0gcmVzb2x2ZVxuICAgICAqIEBwYXJhbSByZWplY3RcbiAgICAgKi9cbiAgICBjcmVhdGVXb3JrZXJIYW5kbGVyIChyZXNvbHZlLCByZWplY3QpIHtcbiAgICAgICAgbGV0IGRiID0gdGhpcztcbiAgICAgICAgdHJ5e1xuICAgICAgICAgICAgbGV0IHdvcmtlciA9IG5ldyB3aW5kb3cuV29ya2VyKGRiLnBhdGhUb1dlYldvcmtlcik7XG4gICAgICAgICAgICBsZXQgbW9kZWxzID0ge307XG4gICAgICAgICAgICBsZXQgdGltZXN0YW1wID0gRGF0ZS5ub3coKTtcblxuICAgICAgICAgICAgd29ya2VyLnBvc3RNZXNzYWdlKHtcbiAgICAgICAgICAgICAgICBkZXRhaWwgOiBKU09OLnN0cmluZ2lmeShkYi5zZXR0aW5ncyksXG4gICAgICAgICAgICAgICAgYWN0aW9uIDogJ2luaXRpYWxpemUnLFxuICAgICAgICAgICAgICAgIHRpbWVzdGFtcCA6IHRpbWVzdGFtcFxuICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICBcbiAgICAgICAgICAgIHdvcmtlci5vbm1lc3NhZ2UgPSBmdW5jdGlvbiAoZSkge1xuICAgICAgICAgICAgICAgIGlmKGUuZGF0YS5hY3Rpb24gPT09ICdpbml0aWFsaXplJyAmJiBlLmRhdGEudGltZXN0YW1wID09PSB0aW1lc3RhbXApIHtcbiAgICAgICAgICAgICAgICAgICAgaWYgKGUuZGF0YS5kZXRhaWwgPT09IHRydWUpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGRiLnNldHRpbmdzLm1pZ3JhdGlvbnMuZm9yRWFjaCgoc2NoZW1hKSA9PiB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgT2JqZWN0LmRlZmluZVByb3BlcnR5KG1vZGVscywgc2NoZW1hLm5hbWUsIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZ2V0KCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIG5ldyBXb3JrZXJNb2RlbEhhbmRsZXIoc2NoZW1hLm5hbWUsIHdvcmtlciwgd2luZG93KTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAgICAgICAgICAgfSk7XG5cbiAgICAgICAgICAgICAgICAgICAgICAgIGRiLmlzV2ViV29ya2VyID0gdHJ1ZTtcbiAgICAgICAgICAgICAgICAgICAgICAgIHJlc29sdmUobW9kZWxzKTtcbiAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGRiLmNyZWF0ZU5vcm1hbEhhbmRsZXIocmVzb2x2ZSwgcmVqZWN0KTtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cblxuICAgICAgICB9Y2F0Y2ggKGUpIHtcbiAgICAgICAgICAgIHJlamVjdChlKTtcbiAgICAgICAgfVxuXG4gICAgfVxuXG4gICAgLyoqXG4gICAgICogQ3JlYXRlcyBub3JtYWwgZGF0YWJhc2UgaW5zdGFuY2UgYW5kIG1vZGVsc1xuICAgICAqIEBwYXJhbSByZXNvbHZlXG4gICAgICogQHBhcmFtIHJlamVjdFxuICAgICAqL1xuICAgIGNyZWF0ZU5vcm1hbEhhbmRsZXIgKHJlc29sdmUsIHJlamVjdCkge1xuICAgICAgICBsZXQgZGIgPSB0aGlzO1xuXG4gICAgICAgIGxldCByZXF1ZXN0ID0gdGhpcy5kYi5vcGVuKHRoaXMuc2V0dGluZ3MuZGJOYW1lLCB0aGlzLnNldHRpbmdzLmRiVmVyc2lvbik7XG5cbiAgICAgICAgcmVxdWVzdC5vbnVwZ3JhZGVuZWVkZWQgPSBmdW5jdGlvbiAoZSkge1xuICAgICAgICAgICAgbGV0IG1pZyA9IG5ldyBNaWdyYXRpb24oZS50YXJnZXQucmVzdWx0LCBlLnRhcmdldC50cmFuc2FjdGlvbiwgZGIuc2V0dGluZ3MubWlncmF0aW9ucyk7XG4gICAgICAgICAgICBtaWcucnVuKCk7XG4gICAgICAgIH07XG5cbiAgICAgICAgcmVxdWVzdC5vbmVycm9yID0gZnVuY3Rpb24gKGUpIHtcbiAgICAgICAgICAgIHJlamVjdChlKTtcbiAgICAgICAgfTtcblxuICAgICAgICByZXF1ZXN0Lm9uc3VjY2VzcyA9IGZ1bmN0aW9uIChlKSB7XG4gICAgICAgICAgICBsZXQgbW9kZWxzID0ge307XG5cbiAgICAgICAgICAgIGRiLnNldHRpbmdzLm1pZ3JhdGlvbnMuZm9yRWFjaCgoc2NoZW1hKSA9PiB7XG4gICAgICAgICAgICAgICAgbGV0IHByaW1hcnkgPSBzY2hlbWEucHJpbWFyeSB8fCAnaWQnO1xuICAgICAgICAgICAgICAgIE9iamVjdC5kZWZpbmVQcm9wZXJ0eShtb2RlbHMsIHNjaGVtYS5uYW1lLCB7XG4gICAgICAgICAgICAgICAgICAgIGdldCgpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBuZXcgTW9kZWwoZS50YXJnZXQucmVzdWx0LCBkYi5pZGJLZXksIHNjaGVtYS5uYW1lLCBwcmltYXJ5KTtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgfSk7XG5cbiAgICAgICAgICAgIHJlc29sdmUobW9kZWxzKTtcbiAgICAgICAgfTtcbiAgICB9XG59XG53aW5kb3cuaWRiID0gZnVuY3Rpb24gKHNldHRpbmdzLCB1c2VXZWJXb3JrZXIsIHBhdGhUb1dlYldvcmtlcil7XG4gICAgXCJ1c2Ugc3RyaWN0XCI7XG5cbiAgICB1c2VXZWJXb3JrZXIgPSB1c2VXZWJXb3JrZXIgPT09IHVuZGVmaW5lZCA/IGZhbHNlIDogdXNlV2ViV29ya2VyO1xuXG4gICAgaWYodXNlV2ViV29ya2VyICYmICFwYXRoVG9XZWJXb3JrZXIpe1xuICAgICAgICB0aHJvdyBcIlBhdGggdG8gd29ya2VyIG5vdCBkZWZpbmVkXCI7XG4gICAgfVxuXG4gICAgbGV0IGlkYiA9IHdpbmRvdy5pbmRleGVkREIgfHwgd2luZG93Lm1vekluZGV4ZWREQiB8fCB3aW5kb3cud2Via2l0SW5kZXhlZERCIHx8IHdpbmRvdy5tc0luZGV4ZWREQjtcbiAgICBsZXQgaWRiS2V5UmFuZ2UgPSB3aW5kb3cuSURCS2V5UmFuZ2UgfHwgd2luZG93LndlYmtpdElEQktleVJhbmdlIHx8IHdpbmRvdy5tc0lEQktleVJhbmdlO1xuICAgIGlmKCFpZGIpe1xuICAgICAgICB0aHJvdyBcIkluZGV4ZWREQiBub3Qgc3VwcG9ydGVkXCI7XG4gICAgfVxuXG4gICAgaWYoIWNoZWNrU2V0dGluZ3NDb25maWcoc2V0dGluZ3MpKXtcbiAgICAgICAgdGhyb3cgXCJzZXR0aW5ncyBwYXJhbWV0ZXIgaXMgaW5jb3JyZWN0bHkgc3RydWN0dXJlZFwiO1xuICAgIH1cblxuICAgIHJldHVybiBuZXcgREIoaWRiLCBpZGJLZXlSYW5nZSwgc2V0dGluZ3MsIGNoZWNrV2ViV29ya2VyKCksIHBhdGhUb1dlYldvcmtlcik7XG5cbiAgICBmdW5jdGlvbiBjaGVja1NldHRpbmdzQ29uZmlnKHNldHRpbmdzKSB7XG4gICAgICAgIHJldHVybiB0cnVlO1xuICAgIH1cblxuICAgIGZ1bmN0aW9uIGNoZWNrV2ViV29ya2VyKCl7XG4gICAgICAgIGlmKCF1c2VXZWJXb3JrZXIpIHtcbiAgICAgICAgICAgIHJldHVybiBmYWxzZTtcbiAgICAgICAgfVxuXG4gICAgICAgIHJldHVybiAod2luZG93LkJsb2IgJiYgd2luZG93Lldvcmtlcik7XG4gICAgfVxuXG59O1xuXG4vLyMgc291cmNlTWFwcGluZ1VSTD1pZGIuanMubWFwXG5cblxuXG4vLyBXRUJQQUNLIEZPT1RFUiAvL1xuLy8gYnVpbGQvaWRiLmpzIl0sIm1hcHBpbmdzIjoiQUFBQTtBQUdBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFEQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUFBO0FBQ0E7QUFBQTtBQUdBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7OztBQURBO0FBQ0E7Ozs7OztBQU1BO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7Ozs7O0FBS0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7Ozs7O0FBS0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOzs7OztBQUtBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOzs7OztBQUtBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOzs7Ozs7QUFNQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOzs7Ozs7QUFNQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOzs7Ozs7QUFNQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOzs7Ozs7O0FBT0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOzs7Ozs7QUFNQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOzs7OztBQUtBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7Ozs7O0FBS0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7Ozs7Ozs7QUFPQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7Ozs7OztBQU9BO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7Ozs7QUFJQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7Ozs7Ozs7O0FBUUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOzs7Ozs7OztBQVFBO0FBQ0E7QUFDQTtBQUNBOzs7Ozs7OztBQVFBO0FBQ0E7QUFDQTtBQUNBOztBQTlkQTtBQStkQTtBQUFBO0FBR0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOzs7OztBQURBO0FBQ0E7Ozs7OztBQU1BO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOzs7OztBQUtBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7Ozs7QUFLQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7Ozs7O0FBTUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7Ozs7OztBQU1BO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOzs7Ozs7QUFNQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7Ozs7Ozs7QUFPQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7Ozs7OztBQU1BO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7Ozs7QUFLQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOzs7OztBQUtBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7Ozs7O0FBTUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7Ozs7Ozs7QUFPQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7Ozs7O0FBTUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7Ozs7O0FBTUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOzs7Ozs7QUFNQTtBQUNBO0FBQ0E7QUFDQTs7Ozs7QUFLQTtBQUNBO0FBQ0E7QUFDQTs7Ozs7Ozs7QUFRQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7Ozs7Ozs7QUFRQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7Ozs7Ozs7O0FBU0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7Ozs7QUFJQTtBQUNBOztBQUVBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOzs7Ozs7QUFNQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7Ozs7O0FBS0E7QUFDQTtBQUNBO0FBQ0E7Ozs7O0FBS0E7QUFDQTtBQUNBO0FBQ0E7Ozs7QUFsNkJBO0FBQ0E7QUFvNkJBO0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUdBO0FBR0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOzsiLCJzb3VyY2VSb290IjoiIn0=");

/***/ }
/******/ ]);