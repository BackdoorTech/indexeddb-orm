!function(e){var t={};function n(r){if(t[r])return t[r].exports;var i=t[r]={i:r,l:!1,exports:{}};return e[r].call(i.exports,i,i.exports,n),i.l=!0,i.exports}n.m=e,n.c=t,n.d=function(e,t,r){n.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:r})},n.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},n.t=function(e,t){if(1&t&&(e=n(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var r=Object.create(null);if(n.r(r),Object.defineProperty(r,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var i in e)n.d(r,i,function(t){return e[t]}.bind(null,i));return r},n.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return n.d(t,"a",t),t},n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},n.p="",n(n.s=14)}([function(e,t,n){e.exports=n(9)},function(e,t){function n(e,t,n,r,i,a,o){try{var u=e[a](o),s=u.value}catch(e){return void n(e)}u.done?t(s):Promise.resolve(s).then(r,i)}e.exports=function(e){return function(){var t=this,r=arguments;return new Promise(function(i,a){var o=e.apply(t,r);function u(e){n(o,i,a,u,s,"next",e)}function s(e){n(o,i,a,u,s,"throw",e)}u(void 0)})}}},function(e,t){e.exports=function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}},function(e,t){function n(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}e.exports=function(e,t,r){return t&&n(e.prototype,t),r&&n(e,r),e}},function(e,t){function n(t){return e.exports=n=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)},n(t)}e.exports=n},function(e,t,n){var r=n(10),i=n(11);e.exports=function(e,t){return!t||"object"!==r(t)&&"function"!=typeof t?i(e):t}},function(e,t,n){var r=n(8);e.exports=function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&r(e,t)}},function(e,t,n){var r=n(4),i=n(8),a=n(12),o=n(13);function u(t){var n="function"==typeof Map?new Map:void 0;return e.exports=u=function(e){if(null===e||!a(e))return e;if("function"!=typeof e)throw new TypeError("Super expression must either be null or a function");if(void 0!==n){if(n.has(e))return n.get(e);n.set(e,t)}function t(){return o(e,arguments,r(this).constructor)}return t.prototype=Object.create(e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),i(t,e)},u(t)}e.exports=u},function(e,t){function n(t,r){return e.exports=n=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e},n(t,r)}e.exports=n},function(e,t,n){var r=function(e){"use strict";var t,n=Object.prototype,r=n.hasOwnProperty,i="function"==typeof Symbol?Symbol:{},a=i.iterator||"@@iterator",o=i.asyncIterator||"@@asyncIterator",u=i.toStringTag||"@@toStringTag";function s(e,t,n,r){var i=t&&t.prototype instanceof p?t:p,a=Object.create(i.prototype),o=new I(r||[]);return a._invoke=function(e,t,n){var r=l;return function(i,a){if(r===f)throw new Error("Generator is already running");if(r===d){if("throw"===i)throw a;return O()}for(n.method=i,n.arg=a;;){var o=n.delegate;if(o){var u=E(o,n);if(u){if(u===v)continue;return u}}if("next"===n.method)n.sent=n._sent=n.arg;else if("throw"===n.method){if(r===l)throw r=d,n.arg;n.dispatchException(n.arg)}else"return"===n.method&&n.abrupt("return",n.arg);r=f;var s=c(e,t,n);if("normal"===s.type){if(r=n.done?d:h,s.arg===v)continue;return{value:s.arg,done:n.done}}"throw"===s.type&&(r=d,n.method="throw",n.arg=s.arg)}}}(e,n,o),a}function c(e,t,n){try{return{type:"normal",arg:e.call(t,n)}}catch(e){return{type:"throw",arg:e}}}e.wrap=s;var l="suspendedStart",h="suspendedYield",f="executing",d="completed",v={};function p(){}function y(){}function b(){}var m={};m[a]=function(){return this};var w=Object.getPrototypeOf,g=w&&w(w(L([])));g&&g!==n&&r.call(g,a)&&(m=g);var x=b.prototype=p.prototype=Object.create(m);function k(e){["next","throw","return"].forEach(function(t){e[t]=function(e){return this._invoke(t,e)}})}function S(e){var t;this._invoke=function(n,i){function a(){return new Promise(function(t,a){!function t(n,i,a,o){var u=c(e[n],e,i);if("throw"!==u.type){var s=u.arg,l=s.value;return l&&"object"==typeof l&&r.call(l,"__await")?Promise.resolve(l.__await).then(function(e){t("next",e,a,o)},function(e){t("throw",e,a,o)}):Promise.resolve(l).then(function(e){s.value=e,a(s)},function(e){return t("throw",e,a,o)})}o(u.arg)}(n,i,t,a)})}return t=t?t.then(a,a):a()}}function E(e,n){var r=e.iterator[n.method];if(r===t){if(n.delegate=null,"throw"===n.method){if(e.iterator.return&&(n.method="return",n.arg=t,E(e,n),"throw"===n.method))return v;n.method="throw",n.arg=new TypeError("The iterator does not provide a 'throw' method")}return v}var i=c(r,e.iterator,n.arg);if("throw"===i.type)return n.method="throw",n.arg=i.arg,n.delegate=null,v;var a=i.arg;return a?a.done?(n[e.resultName]=a.value,n.next=e.nextLoc,"return"!==n.method&&(n.method="next",n.arg=t),n.delegate=null,v):a:(n.method="throw",n.arg=new TypeError("iterator result is not an object"),n.delegate=null,v)}function R(e){var t={tryLoc:e[0]};1 in e&&(t.catchLoc=e[1]),2 in e&&(t.finallyLoc=e[2],t.afterLoc=e[3]),this.tryEntries.push(t)}function T(e){var t=e.completion||{};t.type="normal",delete t.arg,e.completion=t}function I(e){this.tryEntries=[{tryLoc:"root"}],e.forEach(R,this),this.reset(!0)}function L(e){if(e){var n=e[a];if(n)return n.call(e);if("function"==typeof e.next)return e;if(!isNaN(e.length)){var i=-1,o=function n(){for(;++i<e.length;)if(r.call(e,i))return n.value=e[i],n.done=!1,n;return n.value=t,n.done=!0,n};return o.next=o}}return{next:O}}function O(){return{value:t,done:!0}}return y.prototype=x.constructor=b,b.constructor=y,b[u]=y.displayName="GeneratorFunction",e.isGeneratorFunction=function(e){var t="function"==typeof e&&e.constructor;return!!t&&(t===y||"GeneratorFunction"===(t.displayName||t.name))},e.mark=function(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,b):(e.__proto__=b,u in e||(e[u]="GeneratorFunction")),e.prototype=Object.create(x),e},e.awrap=function(e){return{__await:e}},k(S.prototype),S.prototype[o]=function(){return this},e.AsyncIterator=S,e.async=function(t,n,r,i){var a=new S(s(t,n,r,i));return e.isGeneratorFunction(n)?a:a.next().then(function(e){return e.done?e.value:a.next()})},k(x),x[u]="Generator",x[a]=function(){return this},x.toString=function(){return"[object Generator]"},e.keys=function(e){var t=[];for(var n in e)t.push(n);return t.reverse(),function n(){for(;t.length;){var r=t.pop();if(r in e)return n.value=r,n.done=!1,n}return n.done=!0,n}},e.values=L,I.prototype={constructor:I,reset:function(e){if(this.prev=0,this.next=0,this.sent=this._sent=t,this.done=!1,this.delegate=null,this.method="next",this.arg=t,this.tryEntries.forEach(T),!e)for(var n in this)"t"===n.charAt(0)&&r.call(this,n)&&!isNaN(+n.slice(1))&&(this[n]=t)},stop:function(){this.done=!0;var e=this.tryEntries[0].completion;if("throw"===e.type)throw e.arg;return this.rval},dispatchException:function(e){if(this.done)throw e;var n=this;function i(r,i){return u.type="throw",u.arg=e,n.next=r,i&&(n.method="next",n.arg=t),!!i}for(var a=this.tryEntries.length-1;a>=0;--a){var o=this.tryEntries[a],u=o.completion;if("root"===o.tryLoc)return i("end");if(o.tryLoc<=this.prev){var s=r.call(o,"catchLoc"),c=r.call(o,"finallyLoc");if(s&&c){if(this.prev<o.catchLoc)return i(o.catchLoc,!0);if(this.prev<o.finallyLoc)return i(o.finallyLoc)}else if(s){if(this.prev<o.catchLoc)return i(o.catchLoc,!0)}else{if(!c)throw new Error("try statement without catch or finally");if(this.prev<o.finallyLoc)return i(o.finallyLoc)}}}},abrupt:function(e,t){for(var n=this.tryEntries.length-1;n>=0;--n){var i=this.tryEntries[n];if(i.tryLoc<=this.prev&&r.call(i,"finallyLoc")&&this.prev<i.finallyLoc){var a=i;break}}a&&("break"===e||"continue"===e)&&a.tryLoc<=t&&t<=a.finallyLoc&&(a=null);var o=a?a.completion:{};return o.type=e,o.arg=t,a?(this.method="next",this.next=a.finallyLoc,v):this.complete(o)},complete:function(e,t){if("throw"===e.type)throw e.arg;return"break"===e.type||"continue"===e.type?this.next=e.arg:"return"===e.type?(this.rval=this.arg=e.arg,this.method="return",this.next="end"):"normal"===e.type&&t&&(this.next=t),v},finish:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var n=this.tryEntries[t];if(n.finallyLoc===e)return this.complete(n.completion,n.afterLoc),T(n),v}},catch:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var n=this.tryEntries[t];if(n.tryLoc===e){var r=n.completion;if("throw"===r.type){var i=r.arg;T(n)}return i}}throw new Error("illegal catch attempt")},delegateYield:function(e,n,r){return this.delegate={iterator:L(e),resultName:n,nextLoc:r},"next"===this.method&&(this.arg=t),v}},e}(e.exports);try{regeneratorRuntime=r}catch(e){Function("r","regeneratorRuntime = r")(r)}},function(e,t){function n(e){return(n="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function r(t){return"function"==typeof Symbol&&"symbol"===n(Symbol.iterator)?e.exports=r=function(e){return n(e)}:e.exports=r=function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":n(e)},r(t)}e.exports=r},function(e,t){e.exports=function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}},function(e,t){e.exports=function(e){return-1!==Function.toString.call(e).indexOf("[native code]")}},function(e,t,n){var r=n(8);function i(t,n,a){return!function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],function(){})),!0}catch(e){return!1}}()?e.exports=i=function(e,t,n){var i=[null];i.push.apply(i,t);var a=new(Function.bind.apply(e,i));return n&&r(a,n.prototype),a}:e.exports=i=Reflect.construct,i.apply(null,arguments)}e.exports=i},function(e,t,n){"use strict";n.r(t);var r,i,a,o,u=n(0),s=n.n(u),c=n(1),l=n.n(c),h=n(2),f=n.n(h),d=n(3),v=n.n(d);!function(e){e.ReadOnly="readonly",e.Write="readwrite",e.VersionChange="versionchange"}(r||(r={})),function(e){e.HasOne="hasOne",e.HasMany="hasMany",e.HasManyMultiEntry="hasManyMultiEntry",e.HasManyThroughMultiEntry="hasManyThroughMultiEntry"}(i||(i={})),function(e){e.Between="between",e.Where="where",e.WhereIn="whereIn",e.WhereInArray="whereInArray",e.GreaterThan="gt",e.GreaterThanEqual="gte",e.LessThanEqual="lte",e.LessThan="lt"}(a||(a={})),function(e){e.Ascending="next",e.AscendingUnique="nextunique",e.Descending="prev",e.DescendingUnique="prevunique"}(o||(o={}));var p=function(){function e(t,n,r){f()(this,e),this.tables=t,this.db=n,this.transaction=r}return v()(e,[{key:"run",value:function(){var e=l()(s.a.mark(function e(){var t,n,r,i,a,o,u,c,l,h,f,d,v=this;return s.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:for(t=!0,n=!1,r=void 0,e.prev=3,i=this.tables[Symbol.iterator]();!(t=(a=i.next()).done);t=!0)o=a.value,this.db.objectStoreNames.contains(o.name)?o.objectStore=this.transaction.objectStore(o.name):o.objectStore=this.createObjectStore(o),this.createColumns(o,o.objectStore),this.dropOldColumns(o,o.objectStore),this.setupSyncColumn(o,o.objectStore);e.next=11;break;case 7:e.prev=7,e.t0=e.catch(3),n=!0,r=e.t0;case 11:e.prev=11,e.prev=12,t||null==i.return||i.return();case 14:if(e.prev=14,!n){e.next=17;break}throw r;case 17:return e.finish(14);case 18:return e.finish(11);case 19:for(u=!0,c=!1,l=void 0,e.prev=22,h=function(){var e=d.value;v.tables.find(function(t){return t.name===e})||v.db.deleteObjectStore(e)},f=this.allStoreNames()[Symbol.iterator]();!(u=(d=f.next()).done);u=!0)h();e.next=31;break;case 27:e.prev=27,e.t1=e.catch(22),c=!0,l=e.t1;case 31:e.prev=31,e.prev=32,u||null==f.return||f.return();case 34:if(e.prev=34,!c){e.next=37;break}throw l;case 37:return e.finish(34);case 38:return e.finish(31);case 39:return e.abrupt("return",this.tables);case 40:case"end":return e.stop()}},e,this,[[3,7,11,19],[12,,14,18],[22,27,31,39],[32,,34,38]])}));return function(){return e.apply(this,arguments)}}()},{key:"createIndex",value:function(e,t){var n=e.attributes||{},r=e.index||e.name;return t.createIndex(e.name,r,n)}},{key:"dropIndex",value:function(e,t){return t.deleteIndex(e),!0}},{key:"createObjectStore",value:function(e){var t=e.primary||"_id";return this.db.createObjectStore(e.name,{keyPath:t,autoIncrement:!0})}},{key:"dropObjectStore",value:function(e){return!0}},{key:"createColumns",value:function(e,t){var n=!0,r=!1,i=void 0;try{for(var a,o=e.columns[Symbol.iterator]();!(n=(a=o.next()).done);n=!0){var u=a.value;t.indexNames.contains(u.name)||(u.dbIndex=this.createIndex(u,t))}}catch(e){r=!0,i=e}finally{try{n||null==o.return||o.return()}finally{if(r)throw i}}}},{key:"dropOldColumns",value:function(e,t){for(var n=this,r=t.indexNames,i=function(i){e.columns.find(function(e){return e.name===r[i]})||n.dropIndex(r[i],t)},a=0;a<r.length;a++)i(a)}},{key:"allStoreNames",value:function(){for(var e=[],t=0;t<this.db.objectStoreNames.length;t++)e.push(this.db.objectStoreNames[t]);return e}},{key:"listObjectStores",value:function(){var e=[],t=!0,n=!1,r=void 0;try{for(var i,a=this.allStoreNames()[Symbol.iterator]();!(t=(i=a.next()).done);t=!0){var o=i.value;e.push(this.transaction.objectStore(o))}}catch(e){n=!0,r=e}finally{try{t||null==a.return||a.return()}finally{if(n)throw r}}return e}},{key:"setupSyncColumn",value:function(e,t){var n=e.syncColumnName||"syncOn";e.syncColumn?t.indexNames.contains(n)||this.createIndex({name:n,index:n},t):t.indexNames.contains(n)&&this.dropIndex(n,t)}}]),e}(),y=n(5),b=n.n(y),m=n(4),w=n.n(m),g=n(6),x=n.n(g);function k(e,t){for(var n=e.split("."),r=t,i=0;i<n.length;i++){if(void 0===r[n[i]])return;r=r[n[i]]}return r}function S(e,t){for(var n in e)t.hasOwnProperty(n)&&(t[n]instanceof Object?e[n]=S({},t[n]):e[n]=t[n]);for(var r in t)e.hasOwnProperty(r)||(e[r]=t[r]);return e}var E=function(e){function t(){var e;return f()(this,t),(e=b()(this,w()(t).apply(this,arguments))).indexBuilder=null,e.builder=[],e.cursor=null,e}return x()(t,e),v()(t,[{key:"whereIndex",value:function(e,t){return this.indexBuilder={index:e,value:t,type:a.Where},this}},{key:"whereIndexIn",value:function(e,t){return this.indexBuilder={index:e,value:t,type:a.WhereIn},this}},{key:"whereMultiIndexIn",value:function(e,t){arguments.length>2&&void 0!==arguments[2]&&arguments[2];return this.indexBuilder={index:e,value:t,type:a.WhereInArray},this}},{key:"indexGte",value:function(e,t){return this.indexBuilder={index:e,value:t,type:a.GreaterThanEqual},this}},{key:"indexGt",value:function(e,t){return this.indexBuilder={index:e,value:t,type:a.GreaterThan},this}},{key:"indexLte",value:function(e,t){return this.indexBuilder={index:e,value:t,type:a.LessThanEqual},this}},{key:"indexLt",value:function(e,t){return this.indexBuilder={index:e,value:t,type:a.LessThan},this}},{key:"indexBetween",value:function(e,t,n){return this.indexBuilder={index:e,value:[t,n],type:a.Between},this}},{key:"where",value:function(e,t){return this.builder.push({attribute:e,value:t,type:a.Where}),this}},{key:"whereIn",value:function(e,t){return this.builder.push({attribute:e,value:t,type:a.WhereIn}),this}},{key:"whereInArray",value:function(e,t){arguments.length>2&&void 0!==arguments[2]&&arguments[2];return this.builder.push({attribute:e,value:t,type:a.WhereInArray}),this}},{key:"gte",value:function(e,t){return this.builder.push({attribute:e,value:t,type:a.GreaterThanEqual}),this}},{key:"gt",value:function(e,t){return this.builder.push({attribute:e,value:t,type:a.GreaterThan}),this}},{key:"lte",value:function(e,t){return this.builder.push({attribute:e,value:t,type:a.LessThanEqual}),this}},{key:"lt",value:function(e,t){return this.builder.push({attribute:e,value:t,type:a.LessThan}),this}},{key:"between",value:function(e,t,n){return this.builder.push({attribute:e,value:[t,n],type:a.Between}),this}},{key:"cursorDirection",value:function(e){return this.cursor=e,this}},{key:"keyRange",value:function(e){var t;switch(e.type){case a.Where:t=IDBKeyRange.only(e.value);break;case a.WhereIn:this.whereIn(e.index,e.value);var n=e.value.sort();t=IDBKeyRange.bound(n[0],n[n.length-1],!1,!1);break;case a.GreaterThanEqual:t=IDBKeyRange.lowerBound(e.value,!1);break;case a.GreaterThan:t=IDBKeyRange.lowerBound(e.value,!0);break;case a.LessThanEqual:t=IDBKeyRange.upperBound(e.value,!1);break;case a.LessThan:t=IDBKeyRange.lowerBound(e.value,!0);break;case a.Between:t=IDBKeyRange.bound(e.value[0],e.value[1],!1,!1);break;case a.WhereInArray:this.whereInArray(e.index,e.value);var r=e.value.sort();t=IDBKeyRange.bound(r[0],r[r.length-1],!1,!1);break;default:throw"Invalid builder type given"}return t}},{key:"allowedToProcess",value:function(e){var t=!0,n=!1,r=void 0;try{for(var i,o=this.builder[Symbol.iterator]();!(t=(i=o.next()).done);t=!0){var u=i.value;switch(u.type){case a.Where:if(!k(u.attribute,e)===u.value)return!1;break;case a.WhereIn:var s=!1,c=k(u.attribute,e),l=!0,h=!1,f=void 0;try{for(var d,v=u.value[Symbol.iterator]();!(l=(d=v.next()).done);l=!0){if(c===d.value){s=!0;break}}}catch(e){h=!0,f=e}finally{try{l||null==v.return||v.return()}finally{if(h)throw f}}if(!s)return!1;break;case a.WhereInArray:var p=!1,y=k(u.attribute,e);if(!(y instanceof Array))return!1;var b=!0,m=!1,w=void 0;try{for(var g,x=u.value[Symbol.iterator]();!(b=(g=x.next()).done);b=!0){var S=g.value;if(y.includes(S)){p=!0;break}}}catch(e){m=!0,w=e}finally{try{b||null==x.return||x.return()}finally{if(m)throw w}}if(!p)return!1;break;case a.GreaterThan:if(k(u.attribute,e)<=u.value)return!1;break;case a.GreaterThanEqual:if(k(u.attribute,e)<u.value)return!1;break;case a.LessThan:if(k(u.attribute,e)>=u.value)return!1;break;case a.LessThanEqual:if(k(u.attribute,e)>u.value)return!1;break;case a.Between:var E=k(u.attribute,e);if(u.value[0]>=E&&u.value[1]<=E)return!1;break;default:throw new Error("Query type not recognized")}}}catch(e){n=!0,r=e}finally{try{t||null==o.return||o.return()}finally{if(n)throw r}}return!0}},{key:"resetBuilder",value:function(){return this.indexBuilder=null,this.builder=[],this}}]),t}(function(){function e(){f()(this,e),this.relations=[],this.customRelations=[]}return v()(e,[{key:"tableNames",value:function(e){return e.map(function(e){return e.name})}},{key:"with",value:function(e){var t=this.relations.filter(function(t){return!e.find(function(e){return e.model===t.model})});return this.relations=t.concat(e),this}},{key:"relation",value:function(e,t,n,r,i){var a=this.relations.findIndex(function(t){return t.model===e});return-1!==a&&this.relations.splice(a,1),this.relations.push({model:e,type:t,localKey:n,foreignKey:r,func:i}),this}},{key:"withCustom",value:function(e){var t=this.customRelations.filter(function(t){return!e.find(function(e){return e===t})});return this.customRelations=t.concat(e),this}}]),e}()),R=function(e){function t(){return f()(this,t),b()(this,w()(t).apply(this,arguments))}return x()(t,e),v()(t,[{key:"filteredModel",value:function(e,t){e=this.bindBuilder(e);var n=new E;if(t.func){var r=t.func(n);e.builder=e.builder.concat(r.builder),e.with(n.relations)}return e}},{key:"bindBuilder",value:function(e){return e.builder=e.builder.concat(this.builder),e.with(this.relations),e}},{key:"getRelationModel",value:function(e){var t;if("string"==typeof e.model){var n=this.connector.migrationSchema.tables.find(function(t){return t.name===e.model});if(!n)throw new Error("Table schema not found");t=new K(this.db,n,this.connector)}else t=e.model;return t}},{key:"getLocalKey",value:function(e,t){var n=e.table.primary||"_id";return t.localKey?t.localKey:n}},{key:"getAttributeName",value:function(e,t){return t.attributeName||e.table.name}}]),t}(E),T=function(e){function t(e,n,r,i){var a;return f()(this,t),(a=b()(this,w()(t).call(this))).db=e,a.connector=n,a.parentModel=r,a.childRelation=i,a}return x()(t,e),v()(t,[{key:"fetch",value:function(){var e=l()(s.a.mark(function e(t){var n,r,i,a=this;return s.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(n=this.getRelationModel(this.childRelation),n=this.filteredModel(n,this.childRelation),r=[],1!==t.length){e.next=11;break}return n.whereIndex(this.childRelation.foreignKey,t[0][this.getLocalKey(this.parentModel,this.childRelation)]),e.next=7,n.first();case 7:e.t0=e.sent,r=[e.t0],e.next=16;break;case 11:return i=t.map(function(e){return e[a.getLocalKey(a.parentModel,a.childRelation)]}),n.whereIndexIn(this.childRelation.foreignKey,i).cursorDirection(o.AscendingUnique),e.next=15,n.all();case 15:r=e.sent;case 16:return e.abrupt("return",this.bindResults(t,r,this.childRelation));case 17:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()},{key:"bindResults",value:function(e,t,n){var r=this,i=this.getLocalKey(this.parentModel,this.childRelation);return e.forEach(function(e){var a=t.find(function(t){return t[n.foreignKey]===e[i]});e[r.getAttributeName(r.parentModel,n)]=a||null}),Promise.resolve(e)}}]),t}(R),I=function(e){function t(e,n,r,i){var a;return f()(this,t),(a=b()(this,w()(t).call(this))).db=e,a.connector=n,a.parentModel=r,a.childRelation=i,a}return x()(t,e),v()(t,[{key:"fetch",value:function(){var e=l()(s.a.mark(function e(t){var n,r,i,a=this;return s.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return n=this.getRelationModel(this.childRelation),n=this.filteredModel(n,this.childRelation),r=t.map(function(e){return e[a.getLocalKey(a.parentModel,a.childRelation)]}),n.whereIndexIn(this.childRelation.foreignKey,r),e.next=6,n.all();case 6:return i=e.sent,e.abrupt("return",this.bindResults(t,i,this.childRelation));case 8:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()},{key:"bindResults",value:function(e,t,n){var r=this,i=this.getLocalKey(this.parentModel,this.childRelation);return e.forEach(function(e){e[r.getAttributeName(r.parentModel,n)]=t.filter(function(t){return t[n.foreignKey]===e[i]})}),Promise.resolve(e)}}]),t}(R),L=function(e){function t(e,n,r,i){var a;return f()(this,t),(a=b()(this,w()(t).call(this))).db=e,a.connector=n,a.parentModel=r,a.childRelation=i,a}return x()(t,e),v()(t,[{key:"fetch",value:function(){var e=l()(s.a.mark(function e(t){var n,r,i,a=this;return s.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return n=this.getRelationModel(this.childRelation),n=this.filteredModel(n,this.childRelation),r=t.map(function(e){return e[a.getLocalKey(a.parentModel,a.childRelation)]}),n.whereMultiIndexIn(this.childRelation.foreignKey,r),e.next=6,n.all();case 6:return i=e.sent,e.abrupt("return",this.bindResults(t,i,this.childRelation));case 8:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()},{key:"bindResults",value:function(e,t,n){var r=this,i=this.getLocalKey(this.parentModel,this.childRelation);return e.forEach(function(e){e[r.getAttributeName(r.parentModel,n)]=t.filter(function(t){return!!t[n.foreignKey].find(function(t){return t===e[i]})})}),Promise.resolve(e)}}]),t}(R),O=function(e){function t(e,n,r,i){var a;return f()(this,t),(a=b()(this,w()(t).call(this))).db=e,a.connector=n,a.parentModel=r,a.childRelation=i,a}return x()(t,e),v()(t,[{key:"fetch",value:function(){var e=l()(s.a.mark(function e(t){var n,r,i,a=this;return s.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return n=this.getRelationModel(this.childRelation),n=this.filteredModel(n,this.childRelation),r=t.reduce(function(e,t){return e.concat(t[a.getLocalKey(a.parentModel,a.childRelation)])},[]),n.whereIndexIn(this.childRelation.foreignKey,r),e.next=6,n.all();case 6:return i=e.sent,e.abrupt("return",this.bindResults(t,i,this.childRelation));case 8:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()},{key:"bindResults",value:function(e,t,n){var r=this,i=this.getLocalKey(this.parentModel,this.childRelation);return e.forEach(function(e){e[r.getAttributeName(r.parentModel,n)]=t.filter(function(t){return!!e[i].find(function(e){return e===t[n.foreignKey]})})}),Promise.resolve(e)}}]),t}(R),M=function(e){function t(){return f()(this,t),b()(this,w()(t).apply(this,arguments))}return x()(t,e),v()(t,[{key:"all",value:function(){var e=this,t=this.tableNames(this.connector.migrationSchema.tables).concat(this.table.name),n=this.getTransaction(t,r.ReadOnly).objectStore(this.table.name),i=this.request(n);return new Promise(function(t,n){var r=[];i.addEventListener("success",function(){var n=l()(s.a.mark(function n(i){var a,o;return s.a.wrap(function(n){for(;;)switch(n.prev=n.next){case 0:if(!(a=i.target.result)){n.next=6;break}if(e.allowedToProcess(a.value)){n.next=4;break}return n.abrupt("return",a.continue());case 4:return r.push(a.value),n.abrupt("return",a.continue());case 6:return 0!==r.length&&0!==e.relations.length||t(r),o=e.loadRelations(r),n.next=10,Promise.all(o);case 10:t(r);case 11:case"end":return n.stop()}},n)}));return function(e){return n.apply(this,arguments)}}()),i.addEventListener("error",function(e){return n(e)})})}},{key:"first",value:function(){var e=this,t=this.tableNames(this.connector.migrationSchema.tables).concat(this.table.name),n=this.getTransaction(t,r.ReadOnly).objectStore(this.table.name),i=this.request(n);return new Promise(function(t,n){var r;i.addEventListener("success",function(){var n=l()(s.a.mark(function n(i){var a,o;return s.a.wrap(function(n){for(;;)switch(n.prev=n.next){case 0:if(!(a=i.target.result)){n.next=5;break}if(e.allowedToProcess(a.value)){n.next=4;break}return n.abrupt("return",a.continue());case 4:r=a.value;case 5:return r&&0!==e.relations.length||t(r||null),o=e.loadRelations([r]),n.next=9,Promise.all(o);case 9:t(r);case 10:case"end":return n.stop()}},n)}));return function(e){return n.apply(this,arguments)}}()),i.addEventListener("error",function(e){return n(e)})})}},{key:"find",value:function(e){var t=this,n=this.tableNames(this.connector.migrationSchema.tables).concat(this.table.name),i=this.getTransaction(n,r.ReadOnly).objectStore(this.table.name).get(e);return new Promise(function(e,n){i.addEventListener("success",function(){var n=l()(s.a.mark(function n(r){var i,a;return s.a.wrap(function(n){for(;;)switch(n.prev=n.next){case 0:return(i=r.target.result)&&0!==t.relations.length||e(i||null),a=t.loadRelations([i]),n.next=5,Promise.all(a);case 5:e(i||null);case 6:case"end":return n.stop()}},n)}));return function(e){return n.apply(this,arguments)}}()),i.addEventListener("error",function(e){return n(e)})})}},{key:"findIndex",value:function(e,t){var n=this;this.resetBuilder();var i=this.tableNames(this.connector.migrationSchema.tables).concat(this.table.name),a=this.getTransaction(i,r.ReadOnly).objectStore(this.table.name).index(e).get(t);return new Promise(function(e,t){a.addEventListener("success",function(){var t=l()(s.a.mark(function t(r){var i,a;return s.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return(i=r.target.result)&&0!==n.relations.length||e(i||null),a=n.loadRelations([i]),t.next=5,Promise.all(a);case 5:e(i);case 6:case"end":return t.stop()}},t)}));return function(e){return t.apply(this,arguments)}}()),a.addEventListener("error",function(e){return t(e)})})}},{key:"findAllIndex",value:function(e,t){return this.resetBuilder(),this.whereIndex(e,t),this.all()}}]),t}(function(e){function t(e,n){var r;return f()(this,t),(r=b()(this,w()(t).call(this))).db=e,r.table=n,r}return x()(t,e),v()(t,[{key:"count",value:function(){var e,t=this,n=[this.table.name],i=this.getTransaction(n,r.ReadOnly).objectStore(this.table.name);return e=0===this.builder.length&&null===this.indexBuilder?i.count():0===this.builder.length&&null!==this.indexBuilder?i.count(this.keyRange(this.indexBuilder)):this.request(i),new Promise(function(n,r){var i=0;e.addEventListener("success",function(){var e=l()(s.a.mark(function e(r){var a;return s.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(0!==t.builder.length){e.next=2;break}return e.abrupt("return",n(r.target.result));case 2:if(!(a=r.target.result)){e.next=8;break}if(t.allowedToProcess(a.value)){e.next=6;break}return e.abrupt("return",a.continue());case 6:return i++,e.abrupt("return",a.continue());case 8:n(i);case 9:case"end":return e.stop()}},e)}));return function(t){return e.apply(this,arguments)}}()),e.addEventListener("error",function(e){return r(e)})})}},{key:"average",value:function(e){var t=this,n=[this.table.name],i=this.getTransaction(n,r.ReadOnly).objectStore(this.table.name),a=this.request(i);return new Promise(function(n,r){var i=0,o=0;a.addEventListener("success",function(){var r=l()(s.a.mark(function r(a){var u,c;return s.a.wrap(function(r){for(;;)switch(r.prev=r.next){case 0:if(!(u=a.target.result)){r.next=8;break}if(t.allowedToProcess(u.value)){r.next=4;break}return r.abrupt("return",u.continue());case 4:return c=k(e,u.value),isNaN(parseFloat(c))||(o+=parseFloat(u.value[e])),i++,r.abrupt("return",u.continue());case 8:n(o/i);case 9:case"end":return r.stop()}},r)}));return function(e){return r.apply(this,arguments)}}()),a.addEventListener("error",function(e){return r(e)})})}},{key:"reduce",value:function(e,t){var n=this,i=[this.table.name],a=this.getTransaction(i,r.ReadOnly).objectStore(this.table.name),o=this.request(a);return new Promise(function(r,i){var a=t;o.addEventListener("success",function(){var t=l()(s.a.mark(function t(i){var o;return s.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if(!(o=i.target.result)){t.next=6;break}if(n.allowedToProcess(o.value)){t.next=4;break}return t.abrupt("return",o.continue());case 4:return a=e(o.value,a),t.abrupt("return",o.continue());case 6:r(a);case 7:case"end":return t.stop()}},t)}));return function(e){return t.apply(this,arguments)}}()),o.addEventListener("error",function(e){return i(e)})})}}]),t}(function(e){function t(){return f()(this,t),b()(this,w()(t).apply(this,arguments))}return x()(t,e),v()(t,[{key:"request",value:function(e){var t=this.cursor||void 0;if(this.indexBuilder){var n=this.keyRange(this.indexBuilder);return(this.indexBuilder.index!==this.primaryId?e.index(this.indexBuilder.index):e).openCursor(n,t)}return e.openCursor(void 0,t)}}]),t}(function(e){function t(){var e;return f()(this,t),(e=b()(this,w()(t).apply(this,arguments))).transaction=null,e}return x()(t,e),v()(t,[{key:"getTransaction",value:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]&&arguments[2];return(null===this.transaction||n)&&(this.transaction=this.createTransaction(e,t)),this.transaction}},{key:"setTransaction",value:function(e){this.transaction=e}},{key:"createTransaction",value:function(e,t){var n=this.db.transaction(e,t);return this.setTransaction(n),n}}]),t}(function(e){function t(){return f()(this,t),b()(this,w()(t).apply(this,arguments))}return x()(t,e),v()(t,[{key:"hasOne",value:function(e,t,n,r){var a=this.convertToRelation(e,i.HasOne,t);return n&&(a.localKey=n),r&&(a.attributeName=r),new T(this.db,this.connector,this,a)}},{key:"hasMany",value:function(e,t,n,r){var a=this.convertToRelation(e,i.HasMany,t);return n&&(a.localKey=n),r&&(a.attributeName=r),new I(this.db,this.connector,this,a)}},{key:"hasManyMultiEntry",value:function(e,t,n,r){var a=this.convertToRelation(e,i.HasManyMultiEntry,t);return n&&(a.localKey=n),r&&(a.attributeName=r),new L(this.db,this.connector,this,a)}},{key:"hasManyThroughMultiEntry",value:function(e,t,n,r){var a=this.convertToRelation(e,i.HasManyThroughMultiEntry,t);return n&&(a.localKey=n),r&&(a.attributeName=r),new O(this.db,this.connector,this,a)}},{key:"convertToRelation",value:function(e,t,n){return{model:this.newModel(e),type:t,foreignKey:n}}},{key:"newModel",value:function(e){var t=this.connector.migrationSchema.tables.find(function(t){return t.name===e.TableName});if(!t)throw new Error("Table schema not found");return new e(this.db,t,this.connector)}}]),t}(E))))),j=n(7),P=n.n(j),B=function(e){function t(){return f()(this,t),b()(this,w()(t).call(this,"Record not found"))}return x()(t,e),t}(P()(Error)),N=function(e){function t(){return f()(this,t),b()(this,w()(t).apply(this,arguments))}return x()(t,e),v()(t,[{key:"firstOrFail",value:function(){var e=l()(s.a.mark(function e(){var t;return s.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.first();case 2:if(t=e.sent){e.next=5;break}throw new B;case 5:return e.abrupt("return",t);case 6:case"end":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}}()},{key:"findOrFail",value:function(){var e=l()(s.a.mark(function e(t){var n;return s.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.find(t);case 2:if(n=e.sent){e.next=5;break}throw new B;case 5:return e.abrupt("return",n);case 6:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()},{key:"findIndexOrFail",value:function(){var e=l()(s.a.mark(function e(t,n){var r;return s.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.findIndex(t,n);case 2:if(r=e.sent){e.next=5;break}throw new B;case 5:return e.abrupt("return",r);case 6:case"end":return e.stop()}},e,this)}));return function(t,n){return e.apply(this,arguments)}}()}]),t}(M),C=function(e){function t(){return f()(this,t),b()(this,w()(t).apply(this,arguments))}return x()(t,e),t}(P()(Error)),K=function(e){function t(e,n,r){var i;return f()(this,t),(i=b()(this,w()(t).call(this,e,n))).db=e,i.table=n,i.connector=r,i.transaction=null,i}return x()(t,e),v()(t,[{key:"sync",value:function(){var e=l()(s.a.mark(function e(t,n){var r,i=arguments;return s.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return r=!(i.length>2&&void 0!==i[2])||i[2],e.next=3,this.save(t,this.syncObj(n),r);case 3:return e.abrupt("return",this.find(t));case 4:case"end":return e.stop()}},e,this)}));return function(t,n){return e.apply(this,arguments)}}()},{key:"syncIndex",value:function(){var e=l()(s.a.mark(function e(t,n,r){var i,a=arguments;return s.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return i=!(a.length>3&&void 0!==a[3])||a[3],e.next=3,this.saveIndex(t,n,this.syncObj(r),i);case 3:return e.abrupt("return",this.findIndex(t,n));case 4:case"end":return e.stop()}},e,this)}));return function(t,n,r){return e.apply(this,arguments)}}()},{key:"syncAllIndex",value:function(){var e=l()(s.a.mark(function e(t,n,r){var i,a=arguments;return s.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return i=!(a.length>3&&void 0!==a[3])||a[3],e.next=3,this.saveAllIndex(t,n,this.syncObj(r),i);case 3:return e.abrupt("return",this.resetBuilder().whereIndex(t,n).all());case 4:case"end":return e.stop()}},e,this)}));return function(t,n,r){return e.apply(this,arguments)}}()},{key:"openTransaction",value:function(e){var n=this,r=this.db.transaction(this.connector.migrationSchema.tables.map(function(e){return e.name})),i={},a=!0,o=!1,u=void 0;try{for(var s,c=function(){var e=s.value;Object.defineProperty(i,e.name,{get:function(){var i;return(i=n.table.ormClass?new n.table.ormClass(n.db,e,n.connector):new t(n.db,e,n.connector)).setTransaction(r),i}})},l=this.connector.migrationSchema.tables[Symbol.iterator]();!(a=(s=l.next()).done);a=!0)c()}catch(e){o=!0,u=e}finally{try{a||null==l.return||l.return()}finally{if(o)throw u}}return{models:i,transaction:r}}},{key:"loadRelations",value:function(e){var t=[],n=!0,r=!1,a=void 0;try{for(var o,u=this.relations[Symbol.iterator]();!(n=(o=u.next()).done);n=!0){var s=o.value,c=void 0;switch(s.type){case i.HasOne:c=new T(this.db,this.connector,this,s),t.push(c.fetch(e));break;case i.HasMany:c=new I(this.db,this.connector,this,s),t.push(c.fetch(e));break;case i.HasManyMultiEntry:c=new L(this.db,this.connector,this,s),t.push(c.fetch(e));break;case i.HasManyThroughMultiEntry:c=new O(this.db,this.connector,this,s),t.push(c.fetch(e));break;default:throw new Error("Unknown relation ".concat(s.type))}}}catch(e){r=!0,a=e}finally{try{n||null==u.return||u.return()}finally{if(r)throw a}}return t.concat(this.loadCustomRelations(e))}},{key:"loadCustomRelations",value:function(e){var t=[],n=!0,r=!1,i=void 0;try{for(var a,o=this.customRelations[Symbol.iterator]();!(n=(a=o.next()).done);n=!0){var u=a.value;if(!Reflect.has(this,u))throw new Error("Method ".concat(u," not defined."));var s=Reflect.get(this,u)();t.push(s.fetch(e))}}catch(e){r=!0,i=e}finally{try{n||null==o.return||o.return()}finally{if(r)throw i}}return t}},{key:"syncObj",value:function(e){if(this.table.syncColumn){var t={};return t[this.table.syncColumnName||"syncOn"]=new Date,S(e,t)}return e}},{key:"primaryId",get:function(){return this.table.primary||"_id"}}]),t}(function(e){function t(){return f()(this,t),b()(this,w()(t).apply(this,arguments))}return x()(t,e),v()(t,[{key:"firstOrCreate",value:function(){var e=l()(s.a.mark(function e(t){var n,i;return s.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(n=this.tableNames(this.connector.migrationSchema.tables).concat(this.table.name),this.createTransaction(n,r.Write).mode===r.Write){e.next=4;break}throw new C("Transaction not in write mode");case 4:return e.next=6,this.first();case 6:if(i=e.sent){e.next=9;break}return e.abrupt("return",this.create(t));case 9:return e.abrupt("return",i);case 10:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()},{key:"findOrCreate",value:function(){var e=l()(s.a.mark(function e(t,n){var i,a,o;return s.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(i=this.tableNames(this.connector.migrationSchema.tables).concat(this.table.name),(a=this.createTransaction(i,r.Write)).mode===r.Write){e.next=4;break}throw new C("Transaction not in write mode");case 4:return this.setTransaction(a),e.next=7,this.find(t);case 7:if(o=e.sent){e.next=10;break}return e.abrupt("return",this.create(n));case 10:return e.abrupt("return",o);case 11:case"end":return e.stop()}},e,this)}));return function(t,n){return e.apply(this,arguments)}}()},{key:"findIndexOrCreate",value:function(){var e=l()(s.a.mark(function e(t,n,i){var a,o;return s.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(a=this.tableNames(this.connector.migrationSchema.tables).concat(this.table.name),this.createTransaction(a,r.Write).mode===r.Write){e.next=4;break}throw new C("Transaction not in write mode");case 4:return e.next=6,this.findIndex(t,n);case 6:if(o=e.sent){e.next=9;break}return e.abrupt("return",this.create(i));case 9:return e.abrupt("return",o);case 10:case"end":return e.stop()}},e,this)}));return function(t,n,r){return e.apply(this,arguments)}}()}]),t}(function(e){function t(){return f()(this,t),b()(this,w()(t).apply(this,arguments))}return x()(t,e),v()(t,[{key:"create",value:function(e){var t=this,n=this.tableNames(this.connector.migrationSchema.tables).concat(this.table.name),i=this.getTransaction(n,r.Write).objectStore(this.table.name).add(e);return new Promise(function(n,r){i.addEventListener("success",function(r){e[t.primaryId]=r.target.result,n(e)}),i.addEventListener("error",function(e){return r(e)})})}},{key:"createMultiple",value:function(e){var t=this,n=this.tableNames(this.connector.migrationSchema.tables).concat(this.table.name),i=this.getTransaction(n,r.Write),a=i.objectStore(this.table.name),o=[],u=!0,s=!1,c=void 0;try{for(var l,h=function(){var e=l.value,n=new Promise(function(n,r){var o=a.add(e);o.addEventListener("success",function(r){e[t.primaryId]=r.target.result,n(e)}),o.addEventListener("error",function(e){r(e),i.abort()})});o.push(n)},f=e[Symbol.iterator]();!(u=(l=f.next()).done);u=!0)h()}catch(e){s=!0,c=e}finally{try{u||null==f.return||f.return()}finally{if(s)throw c}}return Promise.all(o)}},{key:"destroy",value:function(){var e,t=this,n=[this.table.name],i=this.getTransaction(n,r.Write).objectStore(this.table.name);if(0===this.builder.length&&null===this.indexBuilder)throw new Error("Deletion without builder is not allowed. Call truncate if you want to delete all records.");return e=0===this.builder.length&&null!==this.indexBuilder&&this.primaryId===this.indexBuilder.index?i.delete(this.keyRange(this.indexBuilder)):this.request(i),new Promise(function(n,r){var i=[];e.addEventListener("success",function(){var e=l()(s.a.mark(function e(r){var a;return s.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(0!==t.builder.length||null===t.indexBuilder||t.primaryId!==t.indexBuilder.index){e.next=2;break}return e.abrupt("return",n(!0));case 2:if(!(a=r.target.result)){e.next=8;break}if(t.allowedToProcess(a.value)){e.next=6;break}return e.abrupt("return",a.continue());case 6:return i.push(t.delete(a.value[t.primaryId])),e.abrupt("return",a.continue());case 8:return e.next=10,Promise.all(i);case 10:n(!0);case 11:case"end":return e.stop()}},e)}));return function(t){return e.apply(this,arguments)}}()),e.addEventListener("error",function(e){return r(e)})})}},{key:"delete",value:function(){var e=l()(s.a.mark(function e(t){var n,i,a,o;return s.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return n=[this.table.name],i=this.getTransaction(n,r.Write),a=i.objectStore(this.table.name),o=a.delete(t),e.abrupt("return",new Promise(function(e,t){o.addEventListener("success",function(){return e(!0)}),o.addEventListener("error",function(e){return t(e)})}));case 5:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()},{key:"deleteIndex",value:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]&&arguments[2];return this.resetBuilder(),n?this.whereIndex(e,t):this.whereMultiIndexIn(e,[t]),this.destroy()}},{key:"truncate",value:function(){var e=[this.table.name],t=this.getTransaction(e,r.Write).objectStore(this.table.name).clear();return new Promise(function(e,n){t.addEventListener("success",function(){return e(!0)}),t.addEventListener("error",function(e){return n(e)})})}},{key:"destroyId",value:function(e){return this.delete(e)}},{key:"update",value:function(e){var t=this,n=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],i=[this.table.name],a=this.getTransaction(i,r.Write).objectStore(this.table.name),o=this.request(a);return new Promise(function(r,i){var a=0,u=[];o.addEventListener("success",function(){var i=l()(s.a.mark(function i(o){var c;return s.a.wrap(function(i){for(;;)switch(i.prev=i.next){case 0:if(!(c=o.target.result)){i.next=7;break}if(t.allowedToProcess(c.value)){i.next=4;break}return i.abrupt("return",c.continue());case 4:u.push(t.save(c.value[t.primaryId],e,n)),a++,c.continue();case 7:return i.next=9,Promise.all(u);case 9:r(a);case 10:case"end":return i.stop()}},i)}));return function(e){return i.apply(this,arguments)}}()),o.addEventListener("error",function(e){return i(e)})})}},{key:"save",value:function(){var e=l()(s.a.mark(function e(t,n){var i,a,o,u,c,l,h,f=arguments;return s.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return i=!(f.length>2&&void 0!==f[2])||f[2],a=[this.table.name],o=this.getTransaction(a,r.Write),e.next=5,this.findOrFail(t);case 5:if(u=e.sent,o.mode===r.Write){e.next=8;break}throw new C("Transaction not in write mode");case 8:return c=o.objectStore(this.table.name),(l=i?S(u,n):n)[this.primaryId]=t,h=c.put(l),e.abrupt("return",new Promise(function(e,t){h.addEventListener("success",function(){e(!0)}),h.addEventListener("error",function(e){return t(e)})}));case 13:case"end":return e.stop()}},e,this)}));return function(t,n){return e.apply(this,arguments)}}()},{key:"saveIndex",value:function(){var e=l()(s.a.mark(function e(t,n,i){var a,o,u,c,l=arguments;return s.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return a=!(l.length>3&&void 0!==l[3])||l[3],o=[this.table.name],u=this.getTransaction(o,r.Write),e.next=5,this.findIndexOrFail(t,n);case 5:if(c=e.sent,u.mode===r.Write){e.next=8;break}throw new C("Transaction not in write mode");case 8:return e.abrupt("return",this.save(c[this.primaryId],i,a));case 9:case"end":return e.stop()}},e,this)}));return function(t,n,r){return e.apply(this,arguments)}}()},{key:"saveAllIndex",value:function(){var e=l()(s.a.mark(function e(t,n,i){var a,o,u=arguments;return s.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(a=!(u.length>3&&void 0!==u[3])||u[3],o=[this.table.name],this.getTransaction(o,r.Write).mode===r.Write){e.next=5;break}throw new C("Transaction not in write mode");case 5:return this.resetBuilder().whereIndex(t,n),e.next=8,this.update(i,a);case 8:return e.abrupt("return",Promise.resolve(!0));case 9:case"end":return e.stop()}},e,this)}));return function(t,n,r){return e.apply(this,arguments)}}()}]),t}(N))),W=function(){function e(t){f()(this,e),this.migrationSchema=t,this.dbOpenConnection=null,this.migration=null,this.database=null}return v()(e,[{key:"connect",value:function(){var e=this;return this.dbOpenConnection=this.indexedDB().open(this.migrationSchema.name,this.migrationSchema.version),new Promise(function(t,n){if(null===e.dbOpenConnection)throw new Error("Database connection did not open");e.dbOpenConnection.addEventListener("success",function(n){var r=e.completeHandler(n);t(r)}),e.dbOpenConnection.addEventListener("error",function(e){n(e)}),e.dbOpenConnection.addEventListener("upgradeneeded",function(){var t=l()(s.a.mark(function t(n){return s.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,e.migrateHandler(n);case 2:case"end":return t.stop()}},t)}));return function(e){return t.apply(this,arguments)}}())})}},{key:"destroy",value:function(e){var t=this.indexedDB().deleteDatabase(e);return new Promise(function(e,n){t.addEventListener("success",function(){return e(!0)}),t.addEventListener("error",function(e){return n(e)})})}},{key:"indexedDB",value:function(e){function t(){return e.apply(this,arguments)}return t.toString=function(){return e.toString()},t}(function(){var e=indexedDB||self.indexedDB||self.mozIndexedDB||self.webkitIndexedDB||self.msIndexedDB;if(!e)throw new Error("IndexedDB constructor not found in environment");return e})},{key:"migrateHandler",value:function(){var e=l()(s.a.mark(function e(t){var n;return s.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return n=new p(this.migrationSchema.tables,t.target.result,t.target.transaction),e.next=3,n.run();case 3:return this.migrationSchema.tables=e.sent,e.abrupt("return",!0);case 5:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()},{key:"completeHandler",value:function(e){var t=this,n=this.migrationSchema.tables.map(function(e){return e.name}),r=e.target.transaction||e.target.result.transaction(n);this.database=e.target.result;var i=new p(this.migrationSchema.tables,e.target.result,r);this.migration=i;var a=i.listObjectStores(),o={},u=!0,s=!1,c=void 0;try{for(var l,h=function(){var n=l.value,r=t.migrationSchema.tables.find(function(e){return e.name===n.name});Object.defineProperty(o,n.name,{get:function(){return r.ormClass?new r.ormClass(e.target.result,r,t):new K(e.target.result,r,t)}})},f=a[Symbol.iterator]();!(u=(l=f.next()).done);u=!0)h()}catch(e){s=!0,c=e}finally{try{u||null==f.return||f.return()}finally{if(s)throw c}}return o}},{key:"getMigration",value:function(){return this.migration}},{key:"getDatabase",value:function(){return this.database}},{key:"openTransaction",value:function(e){var t=this;if(null===this.database)throw new Error("First initialize the connection using connect.");var n=this.database.transaction(this.migrationSchema.tables.map(function(e){return e.name})),r={},i=!0,a=!1,o=void 0;try{for(var u,s=function(){var e=u.value;Object.defineProperty(r,e.name,{get:function(){var r=new K(t.database,e,t);return r.setTransaction(n),r}})},c=this.migrationSchema.tables[Symbol.iterator]();!(i=(u=c.next()).done);i=!0)s()}catch(e){a=!0,o=e}finally{try{i||null==c.return||c.return()}finally{if(a)throw o}}return{models:r,transaction:n}}},{key:"close",value:function(){return this.database?(this.database.close(),Promise.resolve(!0)):Promise.reject("No Connection open")}}]),e}();n.d(t,"Connector",function(){return W}),n.d(t,"Model",function(){return K}),n.d(t,"Migration",function(){return p}),n.d(t,"RelationTypes",function(){return i}),n.d(t,"CursorDirection",function(){return o}),function(e){e.idb=function(e){return new W(e)},e.idbTypes={CursorTypes:{AscendingUnique:o.AscendingUnique,Ascending:o.Ascending,Descending:o.Descending,DescendingUnique:o.DescendingUnique},RelationTypes:{HasManyThroughMultiEntry:i.HasManyThroughMultiEntry,HasManyMultiEntry:i.HasManyMultiEntry,HasMany:i.HasMany,HasOne:i.HasOne},TransactionModes:{ReadOnly:r.ReadOnly,Write:r.Write,VersionChange:r.VersionChange}}}(self)}]);
//# sourceMappingURL=idb.js.map